{"dependencies":[{"name":"../telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":252},"end":{"line":9,"column":52,"index":304}}],"key":"k7LZwhoWMWET/ud396YGvDlODrM=","exportNames":["*"],"imports":1}},{"name":"./config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":305},"end":{"line":10,"column":50,"index":355}}],"key":"apL7GyCxHQJfXSypmIMW0g+q+wo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.isInsufficientShardsError = isInsufficientShardsError;\n  exports.getProgressionTable = getProgressionTable;\n  exports.getHeroStats = getHeroStats;\n  exports.promoteHero = promoteHero;\n  exports.generatePromotionSourceId = generatePromotionSourceId;\n  var _telemetryEvents = require(_dependencyMap[0], \"../telemetry/events\");\n  var _config = require(_dependencyMap[1], \"./config\");\n  // /app/frontend/lib/api/heroProgression.ts\n  // Phase 3.39-3.41: Hero Progression API\n  //\n  // Server-authoritative hero star/stat system.\n  // All mutations go through canonical receipts.\n  // NO CLIENT-SIDE STAR/STAT MUTATIONS.\n\n  // Auth handled by config.ts\n\n  // Phase 3.49: Robust sourceId generation\n\n  // =============================================================================\n  // TYPES\n  // =============================================================================\n\n  function isInsufficientShardsError(error) {\n    if (!error || typeof error !== 'object') return false;\n    return error.code === 'INSUFFICIENT_SHARDS';\n  }\n\n  // =============================================================================\n  // API FUNCTIONS\n  // =============================================================================\n\n  /**\n   * Get the locked progression table (read-only)\n   */\n  async function getProgressionTable() {\n    const res = await fetch((0, _config.apiUrl)('/api/hero/progression-table'));\n    if (!res.ok) {\n      throw new Error('Failed to fetch progression table');\n    }\n    return await res.json();\n  }\n\n  /**\n   * Get server-derived stats for a hero (Phase 3.41)\n   */\n  async function getHeroStats(heroId) {\n    const headers = await (0, _config.getJsonHeaders)();\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_STATS_VIEWED, {\n      heroId\n    });\n    const res = await fetch((0, _config.apiUrl)(`/api/hero/${heroId}/stats`), {\n      headers\n    });\n    if (!res.ok) {\n      throw new Error('Failed to fetch hero stats');\n    }\n    return await res.json();\n  }\n\n  /**\n   * Promote hero to next star (Phase 3.39)\n   * \n   * @param heroId - Hero to promote\n   * @param sourceId - Client-generated ID for idempotency\n   */\n  async function promoteHero(heroId, sourceId) {\n    const headers = await (0, _config.getJsonHeaders)();\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_SUBMITTED, {\n      heroId,\n      sourceId\n    });\n    const res = await fetch((0, _config.apiUrl)('/api/hero/promote'), {\n      method: 'POST',\n      headers,\n      body: JSON.stringify({\n        hero_id: heroId,\n        source_id: sourceId\n      })\n    });\n    if (!res.ok) {\n      const errorData = await res.json().catch(() => ({}));\n      if (errorData.code === 'INSUFFICIENT_SHARDS') {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_INSUFFICIENT_SHARDS, {\n          heroId,\n          required: errorData.required,\n          available: errorData.available\n        });\n      } else {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_FAILED, {\n          heroId,\n          error: errorData.code || errorData.detail || 'Unknown error'\n        });\n      }\n      throw errorData;\n    }\n    const receipt = await res.json();\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_SUCCESS, {\n      heroId,\n      starBefore: receipt.heroDelta.starBefore,\n      starAfter: receipt.heroDelta.starAfter,\n      shardsSpent: receipt.shardsSpent\n    });\n    return receipt;\n  }\n\n  /**\n   * Generate source ID for promotion\n   */\n  let promotionCounter = 0;\n  function generatePromotionSourceId(heroId) {\n    promotionCounter = (promotionCounter + 1) % 10000;\n    return `promote_${heroId}_${Date.now()}_${promotionCounter.toString().padStart(4, '0')}`;\n  }\n});","lineCount":120,"map":[[7,2,77,0,"exports"],[7,9,77,0],[7,10,77,0,"isInsufficientShardsError"],[7,35,77,0],[7,38,77,0,"isInsufficientShardsError"],[7,63,77,0],[8,2,89,0,"exports"],[8,9,89,0],[8,10,89,0,"getProgressionTable"],[8,29,89,0],[8,32,89,0,"getProgressionTable"],[8,51,89,0],[9,2,102,0,"exports"],[9,9,102,0],[9,10,102,0,"getHeroStats"],[9,22,102,0],[9,25,102,0,"getHeroStats"],[9,37,102,0],[10,2,122,0,"exports"],[10,9,122,0],[10,10,122,0,"promoteHero"],[10,21,122,0],[10,24,122,0,"promoteHero"],[10,35,122,0],[11,2,174,0,"exports"],[11,9,174,0],[11,10,174,0,"generatePromotionSourceId"],[11,35,174,0],[11,38,174,0,"generatePromotionSourceId"],[11,63,174,0],[12,2,9,0],[12,6,9,0,"_telemetryEvents"],[12,22,9,0],[12,25,9,0,"require"],[12,32,9,0],[12,33,9,0,"_dependencyMap"],[12,47,9,0],[13,2,10,0],[13,6,10,0,"_config"],[13,13,10,0],[13,16,10,0,"require"],[13,23,10,0],[13,24,10,0,"_dependencyMap"],[13,38,10,0],[14,2,1,0],[15,2,2,0],[16,2,3,0],[17,2,4,0],[18,2,5,0],[19,2,6,0],[21,2,8,0],[23,2,11,0],[25,2,14,0],[26,2,15,0],[27,2,16,0],[29,2,77,7],[29,11,77,16,"isInsufficientShardsError"],[29,36,77,41,"isInsufficientShardsError"],[29,37,77,42,"error"],[29,42,77,56],[29,44,77,92],[30,4,78,2],[30,8,78,6],[30,9,78,7,"error"],[30,14,78,12],[30,18,78,16],[30,25,78,23,"error"],[30,30,78,28],[30,35,78,33],[30,43,78,41],[30,45,78,43],[30,52,78,50],[30,57,78,55],[31,4,79,2],[31,11,79,10,"error"],[31,16,79,15],[31,17,79,44,"code"],[31,21,79,48],[31,26,79,53],[31,47,79,74],[32,2,80,0],[34,2,82,0],[35,2,83,0],[36,2,84,0],[38,2,86,0],[39,0,87,0],[40,0,88,0],[41,2,89,7],[41,17,89,22,"getProgressionTable"],[41,36,89,41,"getProgressionTable"],[41,37,89,41],[41,39,89,71],[42,4,90,2],[42,10,90,8,"res"],[42,13,90,11],[42,16,90,14],[42,22,90,20,"fetch"],[42,27,90,25],[42,28,90,26],[42,32,90,26,"apiUrl"],[42,39,90,32],[42,40,90,32,"apiUrl"],[42,46,90,32],[42,48,90,33],[42,77,90,62],[42,78,90,63],[42,79,90,64],[43,4,92,2],[43,8,92,6],[43,9,92,7,"res"],[43,12,92,10],[43,13,92,11,"ok"],[43,15,92,13],[43,17,92,15],[44,6,93,4],[44,12,93,10],[44,16,93,14,"Error"],[44,21,93,19],[44,22,93,20],[44,57,93,55],[44,58,93,56],[45,4,94,2],[46,4,96,2],[46,11,96,9],[46,17,96,15,"res"],[46,20,96,18],[46,21,96,19,"json"],[46,25,96,23],[46,26,96,24],[46,27,96,25],[47,2,97,0],[49,2,99,0],[50,0,100,0],[51,0,101,0],[52,2,102,7],[52,17,102,22,"getHeroStats"],[52,29,102,34,"getHeroStats"],[52,30,102,35,"heroId"],[52,36,102,49],[52,38,102,79],[53,4,103,2],[53,10,103,8,"headers"],[53,17,103,15],[53,20,103,18],[53,26,103,24],[53,30,103,24,"getJsonHeaders"],[53,37,103,38],[53,38,103,38,"getJsonHeaders"],[53,52,103,38],[53,54,103,39],[53,55,103,40],[54,4,105,2],[54,8,105,2,"track"],[54,24,105,7],[54,25,105,7,"track"],[54,30,105,7],[54,32,105,8,"Events"],[54,48,105,14],[54,49,105,14,"Events"],[54,55,105,14],[54,56,105,15,"HERO_STATS_VIEWED"],[54,73,105,32],[54,75,105,34],[55,6,105,36,"heroId"],[56,4,105,43],[56,5,105,44],[56,6,105,45],[57,4,107,2],[57,10,107,8,"res"],[57,13,107,11],[57,16,107,14],[57,22,107,20,"fetch"],[57,27,107,25],[57,28,107,26],[57,32,107,26,"apiUrl"],[57,39,107,32],[57,40,107,32,"apiUrl"],[57,46,107,32],[57,48,107,33],[57,61,107,46,"heroId"],[57,67,107,52],[57,75,107,60],[57,76,107,61],[57,78,107,63],[58,6,107,65,"headers"],[59,4,107,73],[59,5,107,74],[59,6,107,75],[60,4,109,2],[60,8,109,6],[60,9,109,7,"res"],[60,12,109,10],[60,13,109,11,"ok"],[60,15,109,13],[60,17,109,15],[61,6,110,4],[61,12,110,10],[61,16,110,14,"Error"],[61,21,110,19],[61,22,110,20],[61,50,110,48],[61,51,110,49],[62,4,111,2],[63,4,113,2],[63,11,113,9],[63,17,113,15,"res"],[63,20,113,18],[63,21,113,19,"json"],[63,25,113,23],[63,26,113,24],[63,27,113,25],[64,2,114,0],[66,2,116,0],[67,0,117,0],[68,0,118,0],[69,0,119,0],[70,0,120,0],[71,0,121,0],[72,2,122,7],[72,17,122,22,"promoteHero"],[72,28,122,33,"promoteHero"],[72,29,123,2,"heroId"],[72,35,123,16],[72,37,124,2,"sourceId"],[72,45,124,18],[72,47,125,29],[73,4,126,2],[73,10,126,8,"headers"],[73,17,126,15],[73,20,126,18],[73,26,126,24],[73,30,126,24,"getJsonHeaders"],[73,37,126,38],[73,38,126,38,"getJsonHeaders"],[73,52,126,38],[73,54,126,39],[73,55,126,40],[74,4,128,2],[74,8,128,2,"track"],[74,24,128,7],[74,25,128,7,"track"],[74,30,128,7],[74,32,128,8,"Events"],[74,48,128,14],[74,49,128,14,"Events"],[74,55,128,14],[74,56,128,15,"HERO_PROMOTION_SUBMITTED"],[74,80,128,39],[74,82,128,41],[75,6,128,43,"heroId"],[75,12,128,49],[76,6,128,51,"sourceId"],[77,4,128,60],[77,5,128,61],[77,6,128,62],[78,4,130,2],[78,10,130,8,"res"],[78,13,130,11],[78,16,130,14],[78,22,130,20,"fetch"],[78,27,130,25],[78,28,130,26],[78,32,130,26,"apiUrl"],[78,39,130,32],[78,40,130,32,"apiUrl"],[78,46,130,32],[78,48,130,33],[78,67,130,52],[78,68,130,53],[78,70,130,55],[79,6,131,4,"method"],[79,12,131,10],[79,14,131,12],[79,20,131,18],[80,6,132,4,"headers"],[80,13,132,11],[81,6,133,4,"body"],[81,10,133,8],[81,12,133,10,"JSON"],[81,16,133,14],[81,17,133,15,"stringify"],[81,26,133,24],[81,27,133,25],[82,8,134,6,"hero_id"],[82,15,134,13],[82,17,134,15,"heroId"],[82,23,134,21],[83,8,135,6,"source_id"],[83,17,135,15],[83,19,135,17,"sourceId"],[84,6,136,4],[84,7,136,5],[85,4,137,2],[85,5,137,3],[85,6,137,4],[86,4,139,2],[86,8,139,6],[86,9,139,7,"res"],[86,12,139,10],[86,13,139,11,"ok"],[86,15,139,13],[86,17,139,15],[87,6,140,4],[87,12,140,10,"errorData"],[87,21,140,19],[87,24,140,22],[87,30,140,28,"res"],[87,33,140,31],[87,34,140,32,"json"],[87,38,140,36],[87,39,140,37],[87,40,140,38],[87,41,140,39,"catch"],[87,46,140,44],[87,47,140,45],[87,54,140,52],[87,55,140,53],[87,56,140,54],[87,57,140,55],[87,58,140,56],[88,6,142,4],[88,10,142,8,"errorData"],[88,19,142,17],[88,20,142,18,"code"],[88,24,142,22],[88,29,142,27],[88,50,142,48],[88,52,142,50],[89,8,143,6],[89,12,143,6,"track"],[89,28,143,11],[89,29,143,11,"track"],[89,34,143,11],[89,36,143,12,"Events"],[89,52,143,18],[89,53,143,18,"Events"],[89,59,143,18],[89,60,143,19,"HERO_PROMOTION_INSUFFICIENT_SHARDS"],[89,94,143,53],[89,96,143,55],[90,10,144,8,"heroId"],[90,16,144,14],[91,10,145,8,"required"],[91,18,145,16],[91,20,145,18,"errorData"],[91,29,145,27],[91,30,145,28,"required"],[91,38,145,36],[92,10,146,8,"available"],[92,19,146,17],[92,21,146,19,"errorData"],[92,30,146,28],[92,31,146,29,"available"],[93,8,147,6],[93,9,147,7],[93,10,147,8],[94,6,148,4],[94,7,148,5],[94,13,148,11],[95,8,149,6],[95,12,149,6,"track"],[95,28,149,11],[95,29,149,11,"track"],[95,34,149,11],[95,36,149,12,"Events"],[95,52,149,18],[95,53,149,18,"Events"],[95,59,149,18],[95,60,149,19,"HERO_PROMOTION_FAILED"],[95,81,149,40],[95,83,149,42],[96,10,150,8,"heroId"],[96,16,150,14],[97,10,151,8,"error"],[97,15,151,13],[97,17,151,15,"errorData"],[97,26,151,24],[97,27,151,25,"code"],[97,31,151,29],[97,35,151,33,"errorData"],[97,44,151,42],[97,45,151,43,"detail"],[97,51,151,49],[97,55,151,53],[98,8,152,6],[98,9,152,7],[98,10,152,8],[99,6,153,4],[100,6,155,4],[100,12,155,10,"errorData"],[100,21,155,19],[101,4,156,2],[102,4,158,2],[102,10,158,8,"receipt"],[102,17,158,15],[102,20,158,18],[102,26,158,24,"res"],[102,29,158,27],[102,30,158,28,"json"],[102,34,158,32],[102,35,158,33],[102,36,158,34],[103,4,160,2],[103,8,160,2,"track"],[103,24,160,7],[103,25,160,7,"track"],[103,30,160,7],[103,32,160,8,"Events"],[103,48,160,14],[103,49,160,14,"Events"],[103,55,160,14],[103,56,160,15,"HERO_PROMOTION_SUCCESS"],[103,78,160,37],[103,80,160,39],[104,6,161,4,"heroId"],[104,12,161,10],[105,6,162,4,"starBefore"],[105,16,162,14],[105,18,162,16,"receipt"],[105,25,162,23],[105,26,162,24,"heroDelta"],[105,35,162,33],[105,36,162,34,"starBefore"],[105,46,162,44],[106,6,163,4,"starAfter"],[106,15,163,13],[106,17,163,15,"receipt"],[106,24,163,22],[106,25,163,23,"heroDelta"],[106,34,163,32],[106,35,163,33,"starAfter"],[106,44,163,42],[107,6,164,4,"shardsSpent"],[107,17,164,15],[107,19,164,17,"receipt"],[107,26,164,24],[107,27,164,25,"shardsSpent"],[108,4,165,2],[108,5,165,3],[108,6,165,4],[109,4,167,2],[109,11,167,9,"receipt"],[109,18,167,16],[110,2,168,0],[112,2,170,0],[113,0,171,0],[114,0,172,0],[115,2,173,0],[115,6,173,4,"promotionCounter"],[115,22,173,20],[115,25,173,23],[115,26,173,24],[116,2,174,7],[116,11,174,16,"generatePromotionSourceId"],[116,36,174,41,"generatePromotionSourceId"],[116,37,174,42,"heroId"],[116,43,174,56],[116,45,174,66],[117,4,175,2,"promotionCounter"],[117,20,175,18],[117,23,175,21],[117,24,175,22,"promotionCounter"],[117,40,175,38],[117,43,175,41],[117,44,175,42],[117,48,175,46],[117,53,175,51],[118,4,176,2],[118,11,176,9],[118,22,176,20,"heroId"],[118,28,176,26],[118,32,176,30,"Date"],[118,36,176,34],[118,37,176,35,"now"],[118,40,176,38],[118,41,176,39],[118,42,176,40],[118,46,176,44,"promotionCounter"],[118,62,176,60],[118,63,176,61,"toString"],[118,71,176,69],[118,72,176,70],[118,73,176,71],[118,74,176,72,"padStart"],[118,82,176,80],[118,83,176,81],[118,84,176,82],[118,86,176,84],[118,89,176,87],[118,90,176,88],[118,92,176,90],[119,2,177,0],[120,0,177,1],[120,3]],"functionMap":{"names":["<global>","isInsufficientShardsError","getProgressionTable","getHeroStats","promoteHero","res.json._catch$argument_0","generatePromotionSourceId"],"mappings":"AAA;OC4E;CDG;OES;CFQ;OGK;CHY;OIQ;6CCkB,UD;CJ4B;OMM;CNG"},"hasCjsExports":false},"type":"js/module"}]}