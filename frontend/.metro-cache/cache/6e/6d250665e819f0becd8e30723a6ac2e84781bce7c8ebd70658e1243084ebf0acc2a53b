{"dependencies":[{"name":"./object.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":15,"index":79},"end":{"line":3,"column":37,"index":101}}],"key":"N01FZ3SqeWR94Jid1p2c86Xuttw=","exportNames":["*"],"imports":1}},{"name":"./stacktrace.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":19,"index":122},"end":{"line":4,"column":45,"index":148}}],"key":"zUeb88uuO1zbd2up7/h5o4gUHKU=","exportNames":["*"],"imports":1}},{"name":"./node-stack-trace.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":23,"index":173},"end":{"line":5,"column":55,"index":205}}],"key":"7IruFZVeCsnYmkV5RjOPWnCcMEM=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  const object = require(_dependencyMap[0], \"./object.js\");\n  const stacktrace = require(_dependencyMap[1], \"./stacktrace.js\");\n  const nodeStackTrace = require(_dependencyMap[2], \"./node-stack-trace.js\");\n\n  /**\n   * A node.js watchdog timer\n   * @param pollInterval The interval that we expect to get polled at\n   * @param anrThreshold The threshold for when we consider ANR\n   * @param callback The callback to call for ANR\n   * @returns An object with `poll` and `enabled` functions {@link WatchdogReturn}\n   */\n  function watchdogTimer(createTimer, pollInterval, anrThreshold, callback) {\n    const timer = createTimer();\n    let triggered = false;\n    let enabled = true;\n    setInterval(() => {\n      const diffMs = timer.getTimeMs();\n      if (triggered === false && diffMs > pollInterval + anrThreshold) {\n        triggered = true;\n        if (enabled) {\n          callback();\n        }\n      }\n      if (diffMs < pollInterval + anrThreshold) {\n        triggered = false;\n      }\n    }, 20);\n    return {\n      poll: () => {\n        timer.reset();\n      },\n      enabled: state => {\n        enabled = state;\n      }\n    };\n  }\n\n  // types copied from inspector.d.ts\n\n  /**\n   * Converts Debugger.CallFrame to Sentry StackFrame\n   */\n  function callFrameToStackFrame(frame, url, getModuleFromFilename) {\n    const filename = url ? url.replace(/^file:\\/\\//, '') : undefined;\n\n    // CallFrame row/col are 0 based, whereas StackFrame are 1 based\n    const colno = frame.location.columnNumber ? frame.location.columnNumber + 1 : undefined;\n    const lineno = frame.location.lineNumber ? frame.location.lineNumber + 1 : undefined;\n    return object.dropUndefinedKeys({\n      filename,\n      module: getModuleFromFilename(filename),\n      function: frame.functionName || '?',\n      colno,\n      lineno,\n      in_app: filename ? nodeStackTrace.filenameIsInApp(filename) : undefined\n    });\n  }\n\n  // The only messages we care about\n\n  /**\n   * Creates a message handler from the v8 debugger protocol and passed stack frames to the callback when paused.\n   */\n  function createDebugPauseMessageHandler(sendCommand, getModuleFromFilename, pausedStackFrames) {\n    // Collect scriptId -> url map so we can look up the filenames later\n    const scripts = new Map();\n    return message => {\n      if (message.method === 'Debugger.scriptParsed') {\n        scripts.set(message.params.scriptId, message.params.url);\n      } else if (message.method === 'Debugger.paused') {\n        // copy the frames\n        const callFrames = [...message.params.callFrames];\n        // and resume immediately\n        sendCommand('Debugger.resume');\n        sendCommand('Debugger.disable');\n        const stackFrames = stacktrace.stripSentryFramesAndReverse(callFrames.map(frame => callFrameToStackFrame(frame, scripts.get(frame.location.scriptId), getModuleFromFilename)));\n        pausedStackFrames(stackFrames);\n      }\n    };\n  }\n  exports.createDebugPauseMessageHandler = createDebugPauseMessageHandler;\n  exports.watchdogTimer = watchdogTimer;\n});","lineCount":87,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,8,3,6,"object"],[5,14,3,12],[5,17,3,15,"require"],[5,24,3,22],[5,25,3,22,"_dependencyMap"],[5,39,3,22],[5,57,3,36],[5,58,3,37],[6,2,4,0],[6,8,4,6,"stacktrace"],[6,18,4,16],[6,21,4,19,"require"],[6,28,4,26],[6,29,4,26,"_dependencyMap"],[6,43,4,26],[6,65,4,44],[6,66,4,45],[7,2,5,0],[7,8,5,6,"nodeStackTrace"],[7,22,5,20],[7,25,5,23,"require"],[7,32,5,30],[7,33,5,30,"_dependencyMap"],[7,47,5,30],[7,75,5,54],[7,76,5,55],[9,2,7,0],[10,0,8,0],[11,0,9,0],[12,0,10,0],[13,0,11,0],[14,0,12,0],[15,0,13,0],[16,2,14,0],[16,11,14,9,"watchdogTimer"],[16,24,14,22,"watchdogTimer"],[16,25,15,2,"createTimer"],[16,36,15,13],[16,38,16,2,"pollInterval"],[16,50,16,14],[16,52,17,2,"anrThreshold"],[16,64,17,14],[16,66,18,2,"callback"],[16,74,18,10],[16,76,19,2],[17,4,20,2],[17,10,20,8,"timer"],[17,15,20,13],[17,18,20,16,"createTimer"],[17,29,20,27],[17,30,20,28],[17,31,20,29],[18,4,21,2],[18,8,21,6,"triggered"],[18,17,21,15],[18,20,21,18],[18,25,21,23],[19,4,22,2],[19,8,22,6,"enabled"],[19,15,22,13],[19,18,22,16],[19,22,22,20],[20,4,24,2,"setInterval"],[20,15,24,13],[20,16,24,14],[20,22,24,20],[21,6,25,4],[21,12,25,10,"diffMs"],[21,18,25,16],[21,21,25,19,"timer"],[21,26,25,24],[21,27,25,25,"getTimeMs"],[21,36,25,34],[21,37,25,35],[21,38,25,36],[22,6,27,4],[22,10,27,8,"triggered"],[22,19,27,17],[22,24,27,22],[22,29,27,27],[22,33,27,31,"diffMs"],[22,39,27,37],[22,42,27,40,"pollInterval"],[22,54,27,52],[22,57,27,55,"anrThreshold"],[22,69,27,67],[22,71,27,69],[23,8,28,6,"triggered"],[23,17,28,15],[23,20,28,18],[23,24,28,22],[24,8,29,6],[24,12,29,10,"enabled"],[24,19,29,17],[24,21,29,19],[25,10,30,8,"callback"],[25,18,30,16],[25,19,30,17],[25,20,30,18],[26,8,31,6],[27,6,32,4],[28,6,34,4],[28,10,34,8,"diffMs"],[28,16,34,14],[28,19,34,17,"pollInterval"],[28,31,34,29],[28,34,34,32,"anrThreshold"],[28,46,34,44],[28,48,34,46],[29,8,35,6,"triggered"],[29,17,35,15],[29,20,35,18],[29,25,35,23],[30,6,36,4],[31,4,37,2],[31,5,37,3],[31,7,37,5],[31,9,37,7],[31,10,37,8],[32,4,39,2],[32,11,39,9],[33,6,40,4,"poll"],[33,10,40,8],[33,12,40,10,"poll"],[33,13,40,10],[33,18,40,16],[34,8,41,6,"timer"],[34,13,41,11],[34,14,41,12,"reset"],[34,19,41,17],[34,20,41,18],[34,21,41,19],[35,6,42,4],[35,7,42,5],[36,6,43,4,"enabled"],[36,13,43,11],[36,15,43,14,"state"],[36,20,43,19],[36,24,43,24],[37,8,44,6,"enabled"],[37,15,44,13],[37,18,44,16,"state"],[37,23,44,21],[38,6,45,4],[39,4,46,2],[39,5,46,3],[40,2,47,0],[42,2,49,0],[44,2,51,0],[45,0,52,0],[46,0,53,0],[47,2,54,0],[47,11,54,9,"callFrameToStackFrame"],[47,32,54,30,"callFrameToStackFrame"],[47,33,55,2,"frame"],[47,38,55,7],[47,40,56,2,"url"],[47,43,56,5],[47,45,57,2,"getModuleFromFilename"],[47,66,57,23],[47,68,58,2],[48,4,59,2],[48,10,59,8,"filename"],[48,18,59,16],[48,21,59,19,"url"],[48,24,59,22],[48,27,59,25,"url"],[48,30,59,28],[48,31,59,29,"replace"],[48,38,59,36],[48,39,59,37],[48,51,59,49],[48,53,59,51],[48,55,59,53],[48,56,59,54],[48,59,59,57,"undefined"],[48,68,59,66],[50,4,61,2],[51,4,62,2],[51,10,62,8,"colno"],[51,15,62,13],[51,18,62,16,"frame"],[51,23,62,21],[51,24,62,22,"location"],[51,32,62,30],[51,33,62,31,"columnNumber"],[51,45,62,43],[51,48,62,46,"frame"],[51,53,62,51],[51,54,62,52,"location"],[51,62,62,60],[51,63,62,61,"columnNumber"],[51,75,62,73],[51,78,62,76],[51,79,62,77],[51,82,62,80,"undefined"],[51,91,62,89],[52,4,63,2],[52,10,63,8,"lineno"],[52,16,63,14],[52,19,63,17,"frame"],[52,24,63,22],[52,25,63,23,"location"],[52,33,63,31],[52,34,63,32,"lineNumber"],[52,44,63,42],[52,47,63,45,"frame"],[52,52,63,50],[52,53,63,51,"location"],[52,61,63,59],[52,62,63,60,"lineNumber"],[52,72,63,70],[52,75,63,73],[52,76,63,74],[52,79,63,77,"undefined"],[52,88,63,86],[53,4,65,2],[53,11,65,9,"object"],[53,17,65,15],[53,18,65,16,"dropUndefinedKeys"],[53,35,65,33],[53,36,65,34],[54,6,66,4,"filename"],[54,14,66,12],[55,6,67,4,"module"],[55,12,67,10],[55,14,67,12,"getModuleFromFilename"],[55,35,67,33],[55,36,67,34,"filename"],[55,44,67,42],[55,45,67,43],[56,6,68,4,"function"],[56,14,68,12],[56,16,68,14,"frame"],[56,21,68,19],[56,22,68,20,"functionName"],[56,34,68,32],[56,38,68,36],[56,41,68,39],[57,6,69,4,"colno"],[57,11,69,9],[58,6,70,4,"lineno"],[58,12,70,10],[59,6,71,4,"in_app"],[59,12,71,10],[59,14,71,12,"filename"],[59,22,71,20],[59,25,71,23,"nodeStackTrace"],[59,39,71,37],[59,40,71,38,"filenameIsInApp"],[59,55,71,53],[59,56,71,54,"filename"],[59,64,71,62],[59,65,71,63],[59,68,71,66,"undefined"],[60,4,72,2],[60,5,72,3],[60,6,72,4],[61,2,73,0],[63,2,75,0],[65,2,77,0],[66,0,78,0],[67,0,79,0],[68,2,80,0],[68,11,80,9,"createDebugPauseMessageHandler"],[68,41,80,39,"createDebugPauseMessageHandler"],[68,42,81,2,"sendCommand"],[68,53,81,13],[68,55,82,2,"getModuleFromFilename"],[68,76,82,23],[68,78,83,2,"pausedStackFrames"],[68,95,83,19],[68,97,84,2],[69,4,85,2],[70,4,86,2],[70,10,86,8,"scripts"],[70,17,86,15],[70,20,86,18],[70,24,86,22,"Map"],[70,27,86,25],[70,28,86,26],[70,29,86,27],[71,4,88,2],[71,11,88,9,"message"],[71,18,88,16],[71,22,88,20],[72,6,89,4],[72,10,89,8,"message"],[72,17,89,15],[72,18,89,16,"method"],[72,24,89,22],[72,29,89,27],[72,52,89,50],[72,54,89,52],[73,8,90,6,"scripts"],[73,15,90,13],[73,16,90,14,"set"],[73,19,90,17],[73,20,90,18,"message"],[73,27,90,25],[73,28,90,26,"params"],[73,34,90,32],[73,35,90,33,"scriptId"],[73,43,90,41],[73,45,90,43,"message"],[73,52,90,50],[73,53,90,51,"params"],[73,59,90,57],[73,60,90,58,"url"],[73,63,90,61],[73,64,90,62],[74,6,91,4],[74,7,91,5],[74,13,91,11],[74,17,91,15,"message"],[74,24,91,22],[74,25,91,23,"method"],[74,31,91,29],[74,36,91,34],[74,53,91,51],[74,55,91,53],[75,8,92,6],[76,8,93,6],[76,14,93,12,"callFrames"],[76,24,93,22],[76,27,93,25],[76,28,93,26],[76,31,93,29,"message"],[76,38,93,36],[76,39,93,37,"params"],[76,45,93,43],[76,46,93,44,"callFrames"],[76,56,93,54],[76,57,93,55],[77,8,94,6],[78,8,95,6,"sendCommand"],[78,19,95,17],[78,20,95,18],[78,37,95,35],[78,38,95,36],[79,8,96,6,"sendCommand"],[79,19,96,17],[79,20,96,18],[79,38,96,36],[79,39,96,37],[80,8,98,6],[80,14,98,12,"stackFrames"],[80,25,98,23],[80,28,98,26,"stacktrace"],[80,38,98,36],[80,39,98,37,"stripSentryFramesAndReverse"],[80,66,98,64],[80,67,99,8,"callFrames"],[80,77,99,18],[80,78,99,19,"map"],[80,81,99,22],[80,82,99,23,"frame"],[80,87,99,28],[80,91,100,10,"callFrameToStackFrame"],[80,112,100,31],[80,113,100,32,"frame"],[80,118,100,37],[80,120,100,39,"scripts"],[80,127,100,46],[80,128,100,47,"get"],[80,131,100,50],[80,132,100,51,"frame"],[80,137,100,56],[80,138,100,57,"location"],[80,146,100,65],[80,147,100,66,"scriptId"],[80,155,100,74],[80,156,100,75],[80,158,100,77,"getModuleFromFilename"],[80,179,100,98],[80,180,101,8],[80,181,102,6],[80,182,102,7],[81,8,104,6,"pausedStackFrames"],[81,25,104,23],[81,26,104,24,"stackFrames"],[81,37,104,35],[81,38,104,36],[82,6,105,4],[83,4,106,2],[83,5,106,3],[84,2,107,0],[85,2,109,0,"exports"],[85,9,109,7],[85,10,109,8,"createDebugPauseMessageHandler"],[85,40,109,38],[85,43,109,41,"createDebugPauseMessageHandler"],[85,73,109,71],[86,2,110,0,"exports"],[86,9,110,7],[86,10,110,8,"watchdogTimer"],[86,23,110,21],[86,26,110,24,"watchdogTimer"],[86,39,110,37],[87,0,110,38],[87,3]],"functionMap":{"names":["<global>","watchdogTimer","setInterval$argument_0","poll","enabled","callFrameToStackFrame","createDebugPauseMessageHandler","<anonymous>","callFrames.map$argument_0"],"mappings":"AAA;ACa;cCU;GDa;UEG;KFE;aGC;KHE;CDE;AKO;CLmB;AMO;SCQ;uBCW;mGDC;GDM;CNC"},"hasCjsExports":true},"type":"js/module"}]}