{"dependencies":[{"name":"../authStorage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":157},"end":{"line":7,"column":47,"index":204}}],"key":"8h7N/7sKemAZqrgZg8dH/jTl5ys=","exportNames":["*"],"imports":1}},{"name":"../types/receipt","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":205},"end":{"line":8,"column":65,"index":270}}],"key":"W14jz77KoHdh2OnwnpYz6E6ocCQ=","exportNames":["*"],"imports":1}},{"name":"../telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":271},"end":{"line":9,"column":52,"index":323}}],"key":"k7LZwhoWMWET/ud396YGvDlODrM=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getStoreCatalog = getStoreCatalog;\n  exports.createPurchaseIntent = createPurchaseIntent;\n  exports.redeemIntent = redeemIntent;\n  var _authStorage = require(_dependencyMap[0], \"../authStorage\");\n  var _typesReceipt = require(_dependencyMap[1], \"../types/receipt\");\n  var _telemetryEvents = require(_dependencyMap[2], \"../telemetry/events\");\n  // /app/frontend/lib/api/store.ts\n  // Phase 3.30: Store API Layer\n  //\n  // Catalog, purchase intent, and dev-only redeem.\n  // Uses canonical receipt for redeem.\n\n  const API_BASE = process.env.EXPO_PUBLIC_API_URL || '';\n\n  // Auth header helper\n  async function getAuthHeaders() {\n    const token = await (0, _authStorage.loadAuthToken)();\n    if (!token) {\n      return {\n        'Content-Type': 'application/json'\n      };\n    }\n    return {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}`\n    };\n  }\n\n  // Store item from catalog\n\n  // Purchase intent response\n\n  /**\n   * Get store catalog\n   */\n  async function getStoreCatalog() {\n    try {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`${API_BASE}/api/store/catalog`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch catalog');\n      const data = await res.json();\n      return data.catalog || [];\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Create purchase intent\n   */\n  async function createPurchaseIntent(sku) {\n    const headers = await getAuthHeaders();\n    const params = new URLSearchParams({\n      sku\n    });\n    const res = await fetch(`${API_BASE}/api/store/purchase-intent?${params}`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) {\n      const error = await res.json().catch(() => ({\n        detail: 'Failed to create intent'\n      }));\n      throw new Error(error.detail || 'Failed to create intent');\n    }\n    const intent = await res.json();\n\n    // Emit telemetry\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_PURCHASE_INTENT_CREATED, {\n      intentId: intent.intentId,\n      sku: intent.sku\n    });\n    return intent;\n  }\n\n  /**\n   * DEV-ONLY: Redeem purchase intent without payment\n   * Returns canonical receipt.\n   */\n  async function redeemIntent(intentId) {\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUBMITTED, {\n      intentId\n    });\n    const headers = await getAuthHeaders();\n    const params = new URLSearchParams({\n      intent_id: intentId\n    });\n    const res = await fetch(`${API_BASE}/api/store/redeem-intent?${params}`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) {\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ERROR, {\n        intentId,\n        status: res.status\n      });\n      const error = await res.json().catch(() => ({\n        detail: 'Failed to redeem'\n      }));\n      throw new Error(error.detail || 'Failed to redeem');\n    }\n    const receipt = await res.json();\n    if ((0, _typesReceipt.isValidReceipt)(receipt)) {\n      if (receipt.alreadyClaimed) {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ALREADY_CLAIMED, {\n          intentId\n        });\n      } else {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUCCESS, {\n          intentId,\n          itemCount: receipt.items.length\n        });\n      }\n    }\n    return receipt;\n  }\n});","lineCount":125,"map":[[7,2,48,0,"exports"],[7,9,48,0],[7,10,48,0,"getStoreCatalog"],[7,25,48,0],[7,28,48,0,"getStoreCatalog"],[7,43,48,0],[8,2,63,0,"exports"],[8,9,63,0],[8,10,63,0,"createPurchaseIntent"],[8,30,63,0],[8,33,63,0,"createPurchaseIntent"],[8,53,63,0],[9,2,92,0,"exports"],[9,9,92,0],[9,10,92,0,"redeemIntent"],[9,22,92,0],[9,25,92,0,"redeemIntent"],[9,37,92,0],[10,2,7,0],[10,6,7,0,"_authStorage"],[10,18,7,0],[10,21,7,0,"require"],[10,28,7,0],[10,29,7,0,"_dependencyMap"],[10,43,7,0],[11,2,8,0],[11,6,8,0,"_typesReceipt"],[11,19,8,0],[11,22,8,0,"require"],[11,29,8,0],[11,30,8,0,"_dependencyMap"],[11,44,8,0],[12,2,9,0],[12,6,9,0,"_telemetryEvents"],[12,22,9,0],[12,25,9,0,"require"],[12,32,9,0],[12,33,9,0,"_dependencyMap"],[12,47,9,0],[13,2,1,0],[14,2,2,0],[15,2,3,0],[16,2,4,0],[17,2,5,0],[19,2,11,0],[19,8,11,6,"API_BASE"],[19,16,11,14],[19,19,11,17,"process"],[19,26,11,24],[19,27,11,25,"env"],[19,30,11,28],[19,31,11,29,"EXPO_PUBLIC_API_URL"],[19,50,11,48],[19,54,11,52],[19,56,11,54],[21,2,13,0],[22,2,14,0],[22,17,14,15,"getAuthHeaders"],[22,31,14,29,"getAuthHeaders"],[22,32,14,29],[22,34,14,65],[23,4,15,2],[23,10,15,8,"token"],[23,15,15,13],[23,18,15,16],[23,24,15,22],[23,28,15,22,"loadAuthToken"],[23,40,15,35],[23,41,15,35,"loadAuthToken"],[23,54,15,35],[23,56,15,36],[23,57,15,37],[24,4,16,2],[24,8,16,6],[24,9,16,7,"token"],[24,14,16,12],[24,16,16,14],[25,6,17,4],[25,13,17,11],[26,8,17,13],[26,22,17,27],[26,24,17,29],[27,6,17,48],[27,7,17,49],[28,4,18,2],[29,4,19,2],[29,11,19,9],[30,6,20,4],[30,20,20,18],[30,22,20,20],[30,40,20,38],[31,6,21,4],[31,21,21,19],[31,23,21,21],[31,33,21,31,"token"],[31,38,21,36],[32,4,22,2],[32,5,22,3],[33,2,23,0],[35,2,25,0],[37,2,35,0],[39,2,45,0],[40,0,46,0],[41,0,47,0],[42,2,48,7],[42,17,48,22,"getStoreCatalog"],[42,32,48,37,"getStoreCatalog"],[42,33,48,37],[42,35,48,62],[43,4,49,2],[43,8,49,6],[44,6,50,4],[44,12,50,10,"headers"],[44,19,50,17],[44,22,50,20],[44,28,50,26,"getAuthHeaders"],[44,42,50,40],[44,43,50,41],[44,44,50,42],[45,6,51,4],[45,12,51,10,"res"],[45,15,51,13],[45,18,51,16],[45,24,51,22,"fetch"],[45,29,51,27],[45,30,51,28],[45,33,51,31,"API_BASE"],[45,41,51,39],[45,61,51,59],[45,63,51,61],[46,8,51,63,"headers"],[47,6,51,71],[47,7,51,72],[47,8,51,73],[48,6,52,4],[48,10,52,8],[48,11,52,9,"res"],[48,14,52,12],[48,15,52,13,"ok"],[48,17,52,15],[48,19,52,17],[48,25,52,23],[48,29,52,27,"Error"],[48,34,52,32],[48,35,52,33],[48,60,52,58],[48,61,52,59],[49,6,53,4],[49,12,53,10,"data"],[49,16,53,14],[49,19,53,17],[49,25,53,23,"res"],[49,28,53,26],[49,29,53,27,"json"],[49,33,53,31],[49,34,53,32],[49,35,53,33],[50,6,54,4],[50,13,54,11,"data"],[50,17,54,15],[50,18,54,16,"catalog"],[50,25,54,23],[50,29,54,27],[50,31,54,29],[51,4,55,2],[51,5,55,3],[51,6,55,4],[51,12,55,10],[52,6,56,4],[52,13,56,11],[52,15,56,13],[53,4,57,2],[54,2,58,0],[56,2,60,0],[57,0,61,0],[58,0,62,0],[59,2,63,7],[59,17,63,22,"createPurchaseIntent"],[59,37,63,42,"createPurchaseIntent"],[59,38,63,43,"sku"],[59,41,63,54],[59,43,63,81],[60,4,64,2],[60,10,64,8,"headers"],[60,17,64,15],[60,20,64,18],[60,26,64,24,"getAuthHeaders"],[60,40,64,38],[60,41,64,39],[60,42,64,40],[61,4,65,2],[61,10,65,8,"params"],[61,16,65,14],[61,19,65,17],[61,23,65,21,"URLSearchParams"],[61,38,65,36],[61,39,65,37],[62,6,65,39,"sku"],[63,4,65,43],[63,5,65,44],[63,6,65,45],[64,4,67,2],[64,10,67,8,"res"],[64,13,67,11],[64,16,67,14],[64,22,67,20,"fetch"],[64,27,67,25],[64,28,67,26],[64,31,67,29,"API_BASE"],[64,39,67,37],[64,69,67,67,"params"],[64,75,67,73],[64,77,67,75],[64,79,67,77],[65,6,68,4,"method"],[65,12,68,10],[65,14,68,12],[65,20,68,18],[66,6,69,4,"headers"],[67,4,70,2],[67,5,70,3],[67,6,70,4],[68,4,72,2],[68,8,72,6],[68,9,72,7,"res"],[68,12,72,10],[68,13,72,11,"ok"],[68,15,72,13],[68,17,72,15],[69,6,73,4],[69,12,73,10,"error"],[69,17,73,15],[69,20,73,18],[69,26,73,24,"res"],[69,29,73,27],[69,30,73,28,"json"],[69,34,73,32],[69,35,73,33],[69,36,73,34],[69,37,73,35,"catch"],[69,42,73,40],[69,43,73,41],[69,50,73,48],[70,8,73,50,"detail"],[70,14,73,56],[70,16,73,58],[71,6,73,84],[71,7,73,85],[71,8,73,86],[71,9,73,87],[72,6,74,4],[72,12,74,10],[72,16,74,14,"Error"],[72,21,74,19],[72,22,74,20,"error"],[72,27,74,25],[72,28,74,26,"detail"],[72,34,74,32],[72,38,74,36],[72,63,74,61],[72,64,74,62],[73,4,75,2],[74,4,77,2],[74,10,77,8,"intent"],[74,16,77,14],[74,19,77,17],[74,25,77,23,"res"],[74,28,77,26],[74,29,77,27,"json"],[74,33,77,31],[74,34,77,32],[74,35,77,33],[76,4,79,2],[77,4,80,2],[77,8,80,2,"track"],[77,24,80,7],[77,25,80,7,"track"],[77,30,80,7],[77,32,80,8,"Events"],[77,48,80,14],[77,49,80,14,"Events"],[77,55,80,14],[77,56,80,15,"STORE_PURCHASE_INTENT_CREATED"],[77,85,80,44],[77,87,80,46],[78,6,81,4,"intentId"],[78,14,81,12],[78,16,81,14,"intent"],[78,22,81,20],[78,23,81,21,"intentId"],[78,31,81,29],[79,6,82,4,"sku"],[79,9,82,7],[79,11,82,9,"intent"],[79,17,82,15],[79,18,82,16,"sku"],[80,4,83,2],[80,5,83,3],[80,6,83,4],[81,4,85,2],[81,11,85,9,"intent"],[81,17,85,15],[82,2,86,0],[84,2,88,0],[85,0,89,0],[86,0,90,0],[87,0,91,0],[88,2,92,7],[88,17,92,22,"redeemIntent"],[88,29,92,34,"redeemIntent"],[88,30,92,35,"intentId"],[88,38,92,51],[88,40,92,77],[89,4,93,2],[89,8,93,2,"track"],[89,24,93,7],[89,25,93,7,"track"],[89,30,93,7],[89,32,93,8,"Events"],[89,48,93,14],[89,49,93,14,"Events"],[89,55,93,14],[89,56,93,15,"STORE_REDEEM_SUBMITTED"],[89,78,93,37],[89,80,93,39],[90,6,93,41,"intentId"],[91,4,93,50],[91,5,93,51],[91,6,93,52],[92,4,95,2],[92,10,95,8,"headers"],[92,17,95,15],[92,20,95,18],[92,26,95,24,"getAuthHeaders"],[92,40,95,38],[92,41,95,39],[92,42,95,40],[93,4,96,2],[93,10,96,8,"params"],[93,16,96,14],[93,19,96,17],[93,23,96,21,"URLSearchParams"],[93,38,96,36],[93,39,96,37],[94,6,96,39,"intent_id"],[94,15,96,48],[94,17,96,50,"intentId"],[95,4,96,59],[95,5,96,60],[95,6,96,61],[96,4,98,2],[96,10,98,8,"res"],[96,13,98,11],[96,16,98,14],[96,22,98,20,"fetch"],[96,27,98,25],[96,28,98,26],[96,31,98,29,"API_BASE"],[96,39,98,37],[96,67,98,65,"params"],[96,73,98,71],[96,75,98,73],[96,77,98,75],[97,6,99,4,"method"],[97,12,99,10],[97,14,99,12],[97,20,99,18],[98,6,100,4,"headers"],[99,4,101,2],[99,5,101,3],[99,6,101,4],[100,4,103,2],[100,8,103,6],[100,9,103,7,"res"],[100,12,103,10],[100,13,103,11,"ok"],[100,15,103,13],[100,17,103,15],[101,6,104,4],[101,10,104,4,"track"],[101,26,104,9],[101,27,104,9,"track"],[101,32,104,9],[101,34,104,10,"Events"],[101,50,104,16],[101,51,104,16,"Events"],[101,57,104,16],[101,58,104,17,"STORE_REDEEM_ERROR"],[101,76,104,35],[101,78,104,37],[102,8,104,39,"intentId"],[102,16,104,47],[103,8,104,49,"status"],[103,14,104,55],[103,16,104,57,"res"],[103,19,104,60],[103,20,104,61,"status"],[104,6,104,68],[104,7,104,69],[104,8,104,70],[105,6,105,4],[105,12,105,10,"error"],[105,17,105,15],[105,20,105,18],[105,26,105,24,"res"],[105,29,105,27],[105,30,105,28,"json"],[105,34,105,32],[105,35,105,33],[105,36,105,34],[105,37,105,35,"catch"],[105,42,105,40],[105,43,105,41],[105,50,105,48],[106,8,105,50,"detail"],[106,14,105,56],[106,16,105,58],[107,6,105,77],[107,7,105,78],[107,8,105,79],[107,9,105,80],[108,6,106,4],[108,12,106,10],[108,16,106,14,"Error"],[108,21,106,19],[108,22,106,20,"error"],[108,27,106,25],[108,28,106,26,"detail"],[108,34,106,32],[108,38,106,36],[108,56,106,54],[108,57,106,55],[109,4,107,2],[110,4,109,2],[110,10,109,8,"receipt"],[110,17,109,15],[110,20,109,18],[110,26,109,24,"res"],[110,29,109,27],[110,30,109,28,"json"],[110,34,109,32],[110,35,109,33],[110,36,109,34],[111,4,111,2],[111,8,111,6],[111,12,111,6,"isValidReceipt"],[111,25,111,20],[111,26,111,20,"isValidReceipt"],[111,40,111,20],[111,42,111,21,"receipt"],[111,49,111,28],[111,50,111,29],[111,52,111,31],[112,6,112,4],[112,10,112,8,"receipt"],[112,17,112,15],[112,18,112,16,"alreadyClaimed"],[112,32,112,30],[112,34,112,32],[113,8,113,6],[113,12,113,6,"track"],[113,28,113,11],[113,29,113,11,"track"],[113,34,113,11],[113,36,113,12,"Events"],[113,52,113,18],[113,53,113,18,"Events"],[113,59,113,18],[113,60,113,19,"STORE_REDEEM_ALREADY_CLAIMED"],[113,88,113,47],[113,90,113,49],[114,10,113,51,"intentId"],[115,8,113,60],[115,9,113,61],[115,10,113,62],[116,6,114,4],[116,7,114,5],[116,13,114,11],[117,8,115,6],[117,12,115,6,"track"],[117,28,115,11],[117,29,115,11,"track"],[117,34,115,11],[117,36,115,12,"Events"],[117,52,115,18],[117,53,115,18,"Events"],[117,59,115,18],[117,60,115,19,"STORE_REDEEM_SUCCESS"],[117,80,115,39],[117,82,115,41],[118,10,116,8,"intentId"],[118,18,116,16],[119,10,117,8,"itemCount"],[119,19,117,17],[119,21,117,19,"receipt"],[119,28,117,26],[119,29,117,27,"items"],[119,34,117,32],[119,35,117,33,"length"],[120,8,118,6],[120,9,118,7],[120,10,118,8],[121,6,119,4],[122,4,120,2],[123,4,122,2],[123,11,122,9,"receipt"],[123,18,122,16],[124,2,123,0],[125,0,123,1],[125,3]],"functionMap":{"names":["<global>","getAuthHeaders","getStoreCatalog","createPurchaseIntent","res.json._catch$argument_0","redeemIntent"],"mappings":"AAA;ACa;CDS;OEyB;CFU;OGK;yCCU,6CD;CHa;OKM;yCDa,sCC;CLkB"},"hasCjsExports":false},"type":"js/module"}]}