{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.isValidReceipt = isValidReceipt;\n  exports.isValidGachaReceipt = isValidGachaReceipt;\n  exports.assertValidReceipt = assertValidReceipt;\n  exports.getReceiptItemCount = getReceiptItemCount;\n  exports.formatReceiptItems = formatReceiptItems;\n  // /app/frontend/lib/types/receipt.ts\n  // Phase 3.24: Canonical Reward Receipt Type\n  // Phase 3.26: Added mail_receipt_claim source\n  // Phase 3.33: Added gacha summon sources\n  //\n  // Single source of truth for receipt shape.\n  // All reward-granting endpoints return this shape.\n  // Frontend MUST use this type for all receipt handling.\n  //\n  // LOCKED source values:\n  // - bond_tribute\n  // - mail_reward_claim\n  // - mail_gift_claim\n  // - mail_receipt_claim (Phase 3.26)\n  // - daily_login_claim\n  // - idle_claim\n  // - admin_grant\n  // - summon_single (Phase 3.33)\n  // - summon_multi (Phase 3.33)\n  // - pity_reward (Phase 3.33)\n\n  /**\n   * Valid reward source types (matches backend RewardSource)\n   */\n\n  // Phase 4.2: PvP season reward\n\n  /**\n   * Single reward item in a receipt\n   */\n\n  /**\n   * Phase 3.33: Gacha pull result item\n   */\n\n  /**\n   * Phase 3.33: Gacha summon receipt (extends canonical receipt)\n   */\n\n  /**\n   * User balance snapshot\n   */\n\n  /**\n   * Canonical receipt shape for all reward grants (Phase 3.24)\n   * \n   * REQUIRED fields: source, sourceId, items, balances\n   * All reward endpoints MUST return this shape.\n   */\n\n  /**\n   * Type guard: Check if an object is a valid RewardReceipt\n   */\n  function isValidReceipt(obj) {\n    if (!obj || typeof obj !== 'object') return false;\n    const receipt = obj;\n    return typeof receipt.source === 'string' && typeof receipt.sourceId === 'string' && Array.isArray(receipt.items) && typeof receipt.balances === 'object' && receipt.balances !== null;\n  }\n\n  /**\n   * Type guard: Check if an object is a valid GachaReceipt\n   */\n  function isValidGachaReceipt(obj) {\n    if (!isValidReceipt(obj)) return false;\n    const receipt = obj;\n    return (receipt.source === 'summon_single' || receipt.source === 'summon_multi' || receipt.source === 'pity_reward') && typeof receipt.bannerId === 'string' && typeof receipt.pullCount === 'number' && Array.isArray(receipt.results);\n  }\n\n  /**\n   * Validate and assert receipt shape (throws if invalid)\n   */\n  function assertValidReceipt(obj, context) {\n    if (!isValidReceipt(obj)) {\n      const msg = `Invalid receipt shape${context ? ` in ${context}` : ''}: ` + `missing source, sourceId, items, or balances`;\n      console.error('[RECEIPT_GUARD_FAILED]', msg, obj);\n      throw new Error(msg);\n    }\n  }\n\n  /**\n   * Extract total reward count from receipt\n   */\n  function getReceiptItemCount(receipt) {\n    return receipt.items.reduce((sum, item) => sum + item.amount, 0);\n  }\n\n  /**\n   * Format reward items for display\n   */\n  function formatReceiptItems(receipt) {\n    if (receipt.items.length === 0) {\n      return receipt.alreadyClaimed ? 'Already claimed' : 'No rewards';\n    }\n    return receipt.items.filter(item => item.amount > 0).map(item => `${item.amount.toLocaleString()} ${formatRewardType(item.type)}`).join(', ');\n  }\n\n  /**\n   * Format reward type for display\n   */\n  function formatRewardType(type) {\n    const typeMap = {\n      gold: 'Gold',\n      coins: 'Coins',\n      gems: 'Gems',\n      divine_gems: 'Divine Gems',\n      crystals: 'Crystals',\n      stamina: 'Stamina',\n      divine_essence: 'Divine Essence',\n      soul_dust: 'Soul Dust',\n      skill_essence: 'Skill Essence',\n      enhancement_stones: 'Enhancement Stones',\n      hero_shards: 'Hero Shards',\n      rune_essence: 'Rune Essence',\n      hero_unlock: 'Hero Unlock',\n      hero_shard: 'Hero Shards'\n    };\n    return typeMap[type] || type.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\n  }\n});","lineCount":130,"map":[[7,2,133,0,"exports"],[7,9,133,0],[7,10,133,0,"isValidReceipt"],[7,24,133,0],[7,27,133,0,"isValidReceipt"],[7,41,133,0],[8,2,149,0,"exports"],[8,9,149,0],[8,10,149,0,"isValidGachaReceipt"],[8,29,149,0],[8,32,149,0,"isValidGachaReceipt"],[8,51,149,0],[9,2,164,0,"exports"],[9,9,164,0],[9,10,164,0,"assertValidReceipt"],[9,28,164,0],[9,31,164,0,"assertValidReceipt"],[9,49,164,0],[10,2,176,0,"exports"],[10,9,176,0],[10,10,176,0,"getReceiptItemCount"],[10,29,176,0],[10,32,176,0,"getReceiptItemCount"],[10,51,176,0],[11,2,183,0,"exports"],[11,9,183,0],[11,10,183,0,"formatReceiptItems"],[11,28,183,0],[11,31,183,0,"formatReceiptItems"],[11,49,183,0],[12,2,1,0],[13,2,2,0],[14,2,3,0],[15,2,4,0],[16,2,5,0],[17,2,6,0],[18,2,7,0],[19,2,8,0],[20,2,9,0],[21,2,10,0],[22,2,11,0],[23,2,12,0],[24,2,13,0],[25,2,14,0],[26,2,15,0],[27,2,16,0],[28,2,17,0],[29,2,18,0],[30,2,19,0],[31,2,20,0],[33,2,22,0],[34,0,23,0],[35,0,24,0],[37,2,43,25],[39,2,45,0],[40,0,46,0],[41,0,47,0],[43,2,57,0],[44,0,58,0],[45,0,59,0],[47,2,75,0],[48,0,76,0],[49,0,77,0],[51,2,96,0],[52,0,97,0],[53,0,98,0],[55,2,115,0],[56,0,116,0],[57,0,117,0],[58,0,118,0],[59,0,119,0],[60,0,120,0],[62,2,130,0],[63,0,131,0],[64,0,132,0],[65,2,133,7],[65,11,133,16,"isValidReceipt"],[65,25,133,30,"isValidReceipt"],[65,26,133,31,"obj"],[65,29,133,43],[65,31,133,67],[66,4,134,2],[66,8,134,6],[66,9,134,7,"obj"],[66,12,134,10],[66,16,134,14],[66,23,134,21,"obj"],[66,26,134,24],[66,31,134,29],[66,39,134,37],[66,41,134,39],[66,48,134,46],[66,53,134,51],[67,4,135,2],[67,10,135,8,"receipt"],[67,17,135,15],[67,20,135,18,"obj"],[67,23,135,48],[68,4,137,2],[68,11,138,4],[68,18,138,11,"receipt"],[68,25,138,18],[68,26,138,19,"source"],[68,32,138,25],[68,37,138,30],[68,45,138,38],[68,49,139,4],[68,56,139,11,"receipt"],[68,63,139,18],[68,64,139,19,"sourceId"],[68,72,139,27],[68,77,139,32],[68,85,139,40],[68,89,140,4,"Array"],[68,94,140,9],[68,95,140,10,"isArray"],[68,102,140,17],[68,103,140,18,"receipt"],[68,110,140,25],[68,111,140,26,"items"],[68,116,140,31],[68,117,140,32],[68,121,141,4],[68,128,141,11,"receipt"],[68,135,141,18],[68,136,141,19,"balances"],[68,144,141,27],[68,149,141,32],[68,157,141,40],[68,161,142,4,"receipt"],[68,168,142,11],[68,169,142,12,"balances"],[68,177,142,20],[68,182,142,25],[68,186,142,29],[69,2,144,0],[71,2,146,0],[72,0,147,0],[73,0,148,0],[74,2,149,7],[74,11,149,16,"isValidGachaReceipt"],[74,30,149,35,"isValidGachaReceipt"],[74,31,149,36,"obj"],[74,34,149,48],[74,36,149,71],[75,4,150,2],[75,8,150,6],[75,9,150,7,"isValidReceipt"],[75,23,150,21],[75,24,150,22,"obj"],[75,27,150,25],[75,28,150,26],[75,30,150,28],[75,37,150,35],[75,42,150,40],[76,4,151,2],[76,10,151,8,"receipt"],[76,17,151,15],[76,20,151,18,"obj"],[76,23,151,59],[77,4,153,2],[77,11,154,4],[77,12,154,5,"receipt"],[77,19,154,12],[77,20,154,13,"source"],[77,26,154,19],[77,31,154,24],[77,46,154,39],[77,50,154,43,"receipt"],[77,57,154,50],[77,58,154,51,"source"],[77,64,154,57],[77,69,154,62],[77,83,154,76],[77,87,154,80,"receipt"],[77,94,154,87],[77,95,154,88,"source"],[77,101,154,94],[77,106,154,99],[77,119,154,112],[77,124,155,4],[77,131,155,11,"receipt"],[77,138,155,18],[77,139,155,19,"bannerId"],[77,147,155,27],[77,152,155,32],[77,160,155,40],[77,164,156,4],[77,171,156,11,"receipt"],[77,178,156,18],[77,179,156,19,"pullCount"],[77,188,156,28],[77,193,156,33],[77,201,156,41],[77,205,157,4,"Array"],[77,210,157,9],[77,211,157,10,"isArray"],[77,218,157,17],[77,219,157,18,"receipt"],[77,226,157,25],[77,227,157,26,"results"],[77,234,157,33],[77,235,157,34],[78,2,159,0],[80,2,161,0],[81,0,162,0],[82,0,163,0],[83,2,164,7],[83,11,164,16,"assertValidReceipt"],[83,29,164,34,"assertValidReceipt"],[83,30,164,35,"obj"],[83,33,164,47],[83,35,164,49,"context"],[83,42,164,65],[83,44,164,97],[84,4,165,2],[84,8,165,6],[84,9,165,7,"isValidReceipt"],[84,23,165,21],[84,24,165,22,"obj"],[84,27,165,25],[84,28,165,26],[84,30,165,28],[85,6,166,4],[85,12,166,10,"msg"],[85,15,166,13],[85,18,166,16],[85,42,166,40,"context"],[85,49,166,47],[85,52,166,50],[85,59,166,57,"context"],[85,66,166,64],[85,68,166,66],[85,71,166,69],[85,73,166,71],[85,77,166,75],[85,80,167,6],[85,126,167,52],[86,6,168,4,"console"],[86,13,168,11],[86,14,168,12,"error"],[86,19,168,17],[86,20,168,18],[86,44,168,42],[86,46,168,44,"msg"],[86,49,168,47],[86,51,168,49,"obj"],[86,54,168,52],[86,55,168,53],[87,6,169,4],[87,12,169,10],[87,16,169,14,"Error"],[87,21,169,19],[87,22,169,20,"msg"],[87,25,169,23],[87,26,169,24],[88,4,170,2],[89,2,171,0],[91,2,173,0],[92,0,174,0],[93,0,175,0],[94,2,176,7],[94,11,176,16,"getReceiptItemCount"],[94,30,176,35,"getReceiptItemCount"],[94,31,176,36,"receipt"],[94,38,176,58],[94,40,176,68],[95,4,177,2],[95,11,177,9,"receipt"],[95,18,177,16],[95,19,177,17,"items"],[95,24,177,22],[95,25,177,23,"reduce"],[95,31,177,29],[95,32,177,30],[95,33,177,31,"sum"],[95,36,177,34],[95,38,177,36,"item"],[95,42,177,40],[95,47,177,45,"sum"],[95,50,177,48],[95,53,177,51,"item"],[95,57,177,55],[95,58,177,56,"amount"],[95,64,177,62],[95,66,177,64],[95,67,177,65],[95,68,177,66],[96,2,178,0],[98,2,180,0],[99,0,181,0],[100,0,182,0],[101,2,183,7],[101,11,183,16,"formatReceiptItems"],[101,29,183,34,"formatReceiptItems"],[101,30,183,35,"receipt"],[101,37,183,57],[101,39,183,67],[102,4,184,2],[102,8,184,6,"receipt"],[102,15,184,13],[102,16,184,14,"items"],[102,21,184,19],[102,22,184,20,"length"],[102,28,184,26],[102,33,184,31],[102,34,184,32],[102,36,184,34],[103,6,185,4],[103,13,185,11,"receipt"],[103,20,185,18],[103,21,185,19,"alreadyClaimed"],[103,35,185,33],[103,38,185,36],[103,55,185,53],[103,58,185,56],[103,70,185,68],[104,4,186,2],[105,4,188,2],[105,11,188,9,"receipt"],[105,18,188,16],[105,19,188,17,"items"],[105,24,188,22],[105,25,189,5,"filter"],[105,31,189,11],[105,32,189,12,"item"],[105,36,189,16],[105,40,189,20,"item"],[105,44,189,24],[105,45,189,25,"amount"],[105,51,189,31],[105,54,189,34],[105,55,189,35],[105,56,189,36],[105,57,190,5,"map"],[105,60,190,8],[105,61,190,9,"item"],[105,65,190,13],[105,69,190,17],[105,72,190,20,"item"],[105,76,190,24],[105,77,190,25,"amount"],[105,83,190,31],[105,84,190,32,"toLocaleString"],[105,98,190,46],[105,99,190,47],[105,100,190,48],[105,104,190,52,"formatRewardType"],[105,120,190,68],[105,121,190,69,"item"],[105,125,190,73],[105,126,190,74,"type"],[105,130,190,78],[105,131,190,79],[105,133,190,81],[105,134,190,82],[105,135,191,5,"join"],[105,139,191,9],[105,140,191,10],[105,144,191,14],[105,145,191,15],[106,2,192,0],[108,2,194,0],[109,0,195,0],[110,0,196,0],[111,2,197,0],[111,11,197,9,"formatRewardType"],[111,27,197,25,"formatRewardType"],[111,28,197,26,"type"],[111,32,197,38],[111,34,197,48],[112,4,198,2],[112,10,198,8,"typeMap"],[112,17,198,39],[112,20,198,42],[113,6,199,4,"gold"],[113,10,199,8],[113,12,199,10],[113,18,199,16],[114,6,200,4,"coins"],[114,11,200,9],[114,13,200,11],[114,20,200,18],[115,6,201,4,"gems"],[115,10,201,8],[115,12,201,10],[115,18,201,16],[116,6,202,4,"divine_gems"],[116,17,202,15],[116,19,202,17],[116,32,202,30],[117,6,203,4,"crystals"],[117,14,203,12],[117,16,203,14],[117,26,203,24],[118,6,204,4,"stamina"],[118,13,204,11],[118,15,204,13],[118,24,204,22],[119,6,205,4,"divine_essence"],[119,20,205,18],[119,22,205,20],[119,38,205,36],[120,6,206,4,"soul_dust"],[120,15,206,13],[120,17,206,15],[120,28,206,26],[121,6,207,4,"skill_essence"],[121,19,207,17],[121,21,207,19],[121,36,207,34],[122,6,208,4,"enhancement_stones"],[122,24,208,22],[122,26,208,24],[122,46,208,44],[123,6,209,4,"hero_shards"],[123,17,209,15],[123,19,209,17],[123,32,209,30],[124,6,210,4,"rune_essence"],[124,18,210,16],[124,20,210,18],[124,34,210,32],[125,6,211,4,"hero_unlock"],[125,17,211,15],[125,19,211,17],[125,32,211,30],[126,6,212,4,"hero_shard"],[126,16,212,14],[126,18,212,16],[127,4,213,2],[127,5,213,3],[128,4,215,2],[128,11,215,9,"typeMap"],[128,18,215,16],[128,19,215,17,"type"],[128,23,215,21],[128,24,215,22],[128,28,215,26,"type"],[128,32,215,30],[128,33,215,31,"replace"],[128,40,215,38],[128,41,215,39],[128,45,215,43],[128,47,215,45],[128,50,215,48],[128,51,215,49],[128,52,215,50,"replace"],[128,59,215,57],[128,60,215,58],[128,67,215,65],[128,69,215,67,"c"],[128,70,215,68],[128,74,215,72,"c"],[128,75,215,73],[128,76,215,74,"toUpperCase"],[128,87,215,85],[128,88,215,86],[128,89,215,87],[128,90,215,88],[129,2,216,0],[130,0,216,1],[130,3]],"functionMap":{"names":["<global>","isValidReceipt","isValidGachaReceipt","assertValidReceipt","getReceiptItemCount","items.reduce$argument_0","formatReceiptItems","items.filter$argument_0","items.filter.map$argument_0","formatRewardType","type.replace.replace$argument_1"],"mappings":"AAA;OCoI;CDW;OEK;CFU;OGK;CHO;OIK;8BCC,gCD;CJC;OMK;YCM,uBD;SEC,wEF;CNE;ASK;mECkB,oBD;CTC"},"hasCjsExports":false},"type":"js/module"}]}