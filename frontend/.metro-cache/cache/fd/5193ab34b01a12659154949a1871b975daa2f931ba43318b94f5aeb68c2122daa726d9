{"dependencies":[{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":14,"index":78},"end":{"line":3,"column":38,"index":102}}],"key":"ud8OE6Lg8Q81+bS6ynZj2uyMPdA=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  const utils = require(_dependencyMap[0], \"@sentry/utils\");\n  const MIN_DELAY = 100; // 100 ms\n  const START_DELAY = 5000; // 5 seconds\n  const MAX_DELAY = 3.6e6; // 1 hour\n\n  function log(msg, error) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && utils.logger.info(`[Offline]: ${msg}`, error);\n  }\n\n  /**\n   * Wraps a transport and stores and retries events when they fail to send.\n   *\n   * @param createTransport The transport to wrap.\n   */\n  function makeOfflineTransport(createTransport) {\n    return options => {\n      const transport = createTransport(options);\n      const store = options.createStore ? options.createStore(options) : undefined;\n      let retryDelay = START_DELAY;\n      let flushTimer;\n      function shouldQueue(env, error, retryDelay) {\n        // We don't queue Session Replay envelopes because they are:\n        // - Ordered and Replay relies on the response status to know when they're successfully sent.\n        // - Likely to fill the queue quickly and block other events from being sent.\n        // We also want to drop client reports because they can be generated when we retry sending events while offline.\n        if (utils.envelopeContainsItemType(env, ['replay_event', 'replay_recording', 'client_report'])) {\n          return false;\n        }\n        if (options.shouldStore) {\n          return options.shouldStore(env, error, retryDelay);\n        }\n        return true;\n      }\n      function flushIn(delay) {\n        if (!store) {\n          return;\n        }\n        if (flushTimer) {\n          clearTimeout(flushTimer);\n        }\n        flushTimer = setTimeout(async () => {\n          flushTimer = undefined;\n          const found = await store.pop();\n          if (found) {\n            log('Attempting to send previously queued event');\n            void send(found).catch(e => {\n              log('Failed to retry sending', e);\n            });\n          }\n        }, delay);\n\n        // We need to unref the timer in node.js, otherwise the node process never exit.\n        if (typeof flushTimer !== 'number' && flushTimer.unref) {\n          flushTimer.unref();\n        }\n      }\n      function flushWithBackOff() {\n        if (flushTimer) {\n          return;\n        }\n        flushIn(retryDelay);\n        retryDelay = Math.min(retryDelay * 2, MAX_DELAY);\n      }\n      async function send(envelope) {\n        try {\n          const result = await transport.send(envelope);\n          let delay = MIN_DELAY;\n          if (result) {\n            // If there's a retry-after header, use that as the next delay.\n            if (result.headers && result.headers['retry-after']) {\n              delay = utils.parseRetryAfterHeader(result.headers['retry-after']);\n            } // If we have a server error, return now so we don't flush the queue.\n            else if ((result.statusCode || 0) >= 400) {\n              return result;\n            }\n          }\n          flushIn(delay);\n          retryDelay = START_DELAY;\n          return result;\n        } catch (e) {\n          if (store && (await shouldQueue(envelope, e, retryDelay))) {\n            await store.insert(envelope);\n            flushWithBackOff();\n            log('Error sending. Event queued', e);\n            return {};\n          } else {\n            throw e;\n          }\n        }\n      }\n      if (options.flushAtStartup) {\n        flushWithBackOff();\n      }\n      return {\n        send,\n        flush: t => transport.flush(t)\n      };\n    };\n  }\n  exports.MIN_DELAY = MIN_DELAY;\n  exports.START_DELAY = START_DELAY;\n  exports.makeOfflineTransport = makeOfflineTransport;\n});","lineCount":107,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,8,3,6,"utils"],[5,13,3,11],[5,16,3,14,"require"],[5,23,3,21],[5,24,3,21,"_dependencyMap"],[5,38,3,21],[5,58,3,37],[5,59,3,38],[6,2,5,0],[6,8,5,6,"MIN_DELAY"],[6,17,5,15],[6,20,5,18],[6,23,5,21],[6,24,5,22],[6,25,5,23],[7,2,6,0],[7,8,6,6,"START_DELAY"],[7,19,6,17],[7,22,6,20],[7,26,6,24],[7,27,6,25],[7,28,6,26],[8,2,7,0],[8,8,7,6,"MAX_DELAY"],[8,17,7,15],[8,20,7,18],[8,25,7,23],[8,26,7,24],[8,27,7,25],[10,2,9,0],[10,11,9,9,"log"],[10,14,9,12,"log"],[10,15,9,13,"msg"],[10,18,9,16],[10,20,9,18,"error"],[10,25,9,23],[10,27,9,25],[11,4,10,2],[11,5,10,3],[11,12,10,10,"__SENTRY_DEBUG__"],[11,28,10,26],[11,33,10,31],[11,44,10,42],[11,48,10,46,"__SENTRY_DEBUG__"],[11,64,10,62],[11,69,10,67,"utils"],[11,74,10,72],[11,75,10,73,"logger"],[11,81,10,79],[11,82,10,80,"info"],[11,86,10,84],[11,87,10,85],[11,101,10,99,"msg"],[11,104,10,102],[11,106,10,104],[11,108,10,106,"error"],[11,113,10,111],[11,114,10,112],[12,2,11,0],[14,2,13,0],[15,0,14,0],[16,0,15,0],[17,0,16,0],[18,0,17,0],[19,2,18,0],[19,11,18,9,"makeOfflineTransport"],[19,31,18,29,"makeOfflineTransport"],[19,32,19,2,"createTransport"],[19,47,19,17],[19,49,20,2],[20,4,21,2],[20,11,21,9,"options"],[20,18,21,16],[20,22,21,20],[21,6,22,4],[21,12,22,10,"transport"],[21,21,22,19],[21,24,22,22,"createTransport"],[21,39,22,37],[21,40,22,38,"options"],[21,47,22,45],[21,48,22,46],[22,6,23,4],[22,12,23,10,"store"],[22,17,23,15],[22,20,23,18,"options"],[22,27,23,25],[22,28,23,26,"createStore"],[22,39,23,37],[22,42,23,40,"options"],[22,49,23,47],[22,50,23,48,"createStore"],[22,61,23,59],[22,62,23,60,"options"],[22,69,23,67],[22,70,23,68],[22,73,23,71,"undefined"],[22,82,23,80],[23,6,25,4],[23,10,25,8,"retryDelay"],[23,20,25,18],[23,23,25,21,"START_DELAY"],[23,34,25,32],[24,6,26,4],[24,10,26,8,"flushTimer"],[24,20,26,18],[25,6,28,4],[25,15,28,13,"shouldQueue"],[25,26,28,24,"shouldQueue"],[25,27,28,25,"env"],[25,30,28,28],[25,32,28,30,"error"],[25,37,28,35],[25,39,28,37,"retryDelay"],[25,49,28,47],[25,51,28,49],[26,8,29,6],[27,8,30,6],[28,8,31,6],[29,8,32,6],[30,8,33,6],[30,12,33,10,"utils"],[30,17,33,15],[30,18,33,16,"envelopeContainsItemType"],[30,42,33,40],[30,43,33,41,"env"],[30,46,33,44],[30,48,33,46],[30,49,33,47],[30,63,33,61],[30,65,33,63],[30,83,33,81],[30,85,33,83],[30,100,33,98],[30,101,33,99],[30,102,33,100],[30,104,33,102],[31,10,34,8],[31,17,34,15],[31,22,34,20],[32,8,35,6],[33,8,37,6],[33,12,37,10,"options"],[33,19,37,17],[33,20,37,18,"shouldStore"],[33,31,37,29],[33,33,37,31],[34,10,38,8],[34,17,38,15,"options"],[34,24,38,22],[34,25,38,23,"shouldStore"],[34,36,38,34],[34,37,38,35,"env"],[34,40,38,38],[34,42,38,40,"error"],[34,47,38,45],[34,49,38,47,"retryDelay"],[34,59,38,57],[34,60,38,58],[35,8,39,6],[36,8,41,6],[36,15,41,13],[36,19,41,17],[37,6,42,4],[38,6,44,4],[38,15,44,13,"flushIn"],[38,22,44,20,"flushIn"],[38,23,44,21,"delay"],[38,28,44,26],[38,30,44,28],[39,8,45,6],[39,12,45,10],[39,13,45,11,"store"],[39,18,45,16],[39,20,45,18],[40,10,46,8],[41,8,47,6],[42,8,49,6],[42,12,49,10,"flushTimer"],[42,22,49,20],[42,24,49,22],[43,10,50,8,"clearTimeout"],[43,22,50,20],[43,23,50,21,"flushTimer"],[43,33,50,32],[43,34,50,33],[44,8,51,6],[45,8,53,6,"flushTimer"],[45,18,53,16],[45,21,53,19,"setTimeout"],[45,31,53,29],[45,32,53,30],[45,44,53,42],[46,10,54,8,"flushTimer"],[46,20,54,18],[46,23,54,21,"undefined"],[46,32,54,30],[47,10,56,8],[47,16,56,14,"found"],[47,21,56,19],[47,24,56,22],[47,30,56,28,"store"],[47,35,56,33],[47,36,56,34,"pop"],[47,39,56,37],[47,40,56,38],[47,41,56,39],[48,10,57,8],[48,14,57,12,"found"],[48,19,57,17],[48,21,57,19],[49,12,58,10,"log"],[49,15,58,13],[49,16,58,14],[49,60,58,58],[49,61,58,59],[50,12,59,10],[50,17,59,15,"send"],[50,21,59,19],[50,22,59,20,"found"],[50,27,59,25],[50,28,59,26],[50,29,59,27,"catch"],[50,34,59,32],[50,35,59,33,"e"],[50,36,59,34],[50,40,59,38],[51,14,60,12,"log"],[51,17,60,15],[51,18,60,16],[51,43,60,41],[51,45,60,43,"e"],[51,46,60,44],[51,47,60,45],[52,12,61,10],[52,13,61,11],[52,14,61,12],[53,10,62,8],[54,8,63,6],[54,9,63,7],[54,11,63,9,"delay"],[54,16,63,14],[54,17,63,15],[56,8,65,6],[57,8,66,6],[57,12,66,10],[57,19,66,17,"flushTimer"],[57,29,66,27],[57,34,66,32],[57,42,66,40],[57,46,66,44,"flushTimer"],[57,56,66,54],[57,57,66,55,"unref"],[57,62,66,60],[57,64,66,62],[58,10,67,8,"flushTimer"],[58,20,67,18],[58,21,67,19,"unref"],[58,26,67,24],[58,27,67,25],[58,28,67,26],[59,8,68,6],[60,6,69,4],[61,6,71,4],[61,15,71,13,"flushWithBackOff"],[61,31,71,29,"flushWithBackOff"],[61,32,71,29],[61,34,71,32],[62,8,72,6],[62,12,72,10,"flushTimer"],[62,22,72,20],[62,24,72,22],[63,10,73,8],[64,8,74,6],[65,8,76,6,"flushIn"],[65,15,76,13],[65,16,76,14,"retryDelay"],[65,26,76,24],[65,27,76,25],[66,8,78,6,"retryDelay"],[66,18,78,16],[66,21,78,19,"Math"],[66,25,78,23],[66,26,78,24,"min"],[66,29,78,27],[66,30,78,28,"retryDelay"],[66,40,78,38],[66,43,78,41],[66,44,78,42],[66,46,78,44,"MAX_DELAY"],[66,55,78,53],[66,56,78,54],[67,6,79,4],[68,6,81,4],[68,21,81,19,"send"],[68,25,81,23,"send"],[68,26,81,24,"envelope"],[68,34,81,32],[68,36,81,34],[69,8,82,6],[69,12,82,10],[70,10,83,8],[70,16,83,14,"result"],[70,22,83,20],[70,25,83,23],[70,31,83,29,"transport"],[70,40,83,38],[70,41,83,39,"send"],[70,45,83,43],[70,46,83,44,"envelope"],[70,54,83,52],[70,55,83,53],[71,10,85,8],[71,14,85,12,"delay"],[71,19,85,17],[71,22,85,20,"MIN_DELAY"],[71,31,85,29],[72,10,87,8],[72,14,87,12,"result"],[72,20,87,18],[72,22,87,20],[73,12,88,10],[74,12,89,10],[74,16,89,14,"result"],[74,22,89,20],[74,23,89,21,"headers"],[74,30,89,28],[74,34,89,32,"result"],[74,40,89,38],[74,41,89,39,"headers"],[74,48,89,46],[74,49,89,47],[74,62,89,60],[74,63,89,61],[74,65,89,63],[75,14,90,12,"delay"],[75,19,90,17],[75,22,90,20,"utils"],[75,27,90,25],[75,28,90,26,"parseRetryAfterHeader"],[75,49,90,47],[75,50,90,48,"result"],[75,56,90,54],[75,57,90,55,"headers"],[75,64,90,62],[75,65,90,63],[75,78,90,76],[75,79,90,77],[75,80,90,78],[76,12,91,10],[76,13,91,11],[76,14,91,12],[77,12,91,12],[77,17,92,15],[77,21,92,19],[77,22,92,20,"result"],[77,28,92,26],[77,29,92,27,"statusCode"],[77,39,92,37],[77,43,92,41],[77,44,92,42],[77,49,92,47],[77,52,92,50],[77,54,92,52],[78,14,93,12],[78,21,93,19,"result"],[78,27,93,25],[79,12,94,10],[80,10,95,8],[81,10,97,8,"flushIn"],[81,17,97,15],[81,18,97,16,"delay"],[81,23,97,21],[81,24,97,22],[82,10,98,8,"retryDelay"],[82,20,98,18],[82,23,98,21,"START_DELAY"],[82,34,98,32],[83,10,99,8],[83,17,99,15,"result"],[83,23,99,21],[84,8,100,6],[84,9,100,7],[84,10,100,8],[84,17,100,15,"e"],[84,18,100,16],[84,20,100,18],[85,10,101,8],[85,14,101,12,"store"],[85,19,101,17],[85,24,101,22],[85,30,101,28,"shouldQueue"],[85,41,101,39],[85,42,101,40,"envelope"],[85,50,101,48],[85,52,101,50,"e"],[85,53,101,51],[85,55,101,54,"retryDelay"],[85,65,101,64],[85,66,101,65],[85,67,101,66],[85,69,101,68],[86,12,102,10],[86,18,102,16,"store"],[86,23,102,21],[86,24,102,22,"insert"],[86,30,102,28],[86,31,102,29,"envelope"],[86,39,102,37],[86,40,102,38],[87,12,103,10,"flushWithBackOff"],[87,28,103,26],[87,29,103,27],[87,30,103,28],[88,12,104,10,"log"],[88,15,104,13],[88,16,104,14],[88,45,104,43],[88,47,104,45,"e"],[88,48,104,47],[88,49,104,48],[89,12,105,10],[89,19,105,17],[89,20,105,18],[89,21,105,19],[90,10,106,8],[90,11,106,9],[90,17,106,15],[91,12,107,10],[91,18,107,16,"e"],[91,19,107,17],[92,10,108,8],[93,8,109,6],[94,6,110,4],[95,6,112,4],[95,10,112,8,"options"],[95,17,112,15],[95,18,112,16,"flushAtStartup"],[95,32,112,30],[95,34,112,32],[96,8,113,6,"flushWithBackOff"],[96,24,113,22],[96,25,113,23],[96,26,113,24],[97,6,114,4],[98,6,116,4],[98,13,116,11],[99,8,117,6,"send"],[99,12,117,10],[100,8,118,6,"flush"],[100,13,118,11],[100,15,118,13,"t"],[100,16,118,14],[100,20,118,18,"transport"],[100,29,118,27],[100,30,118,28,"flush"],[100,35,118,33],[100,36,118,34,"t"],[100,37,118,35],[101,6,119,4],[101,7,119,5],[102,4,120,2],[102,5,120,3],[103,2,121,0],[104,2,123,0,"exports"],[104,9,123,7],[104,10,123,8,"MIN_DELAY"],[104,19,123,17],[104,22,123,20,"MIN_DELAY"],[104,31,123,29],[105,2,124,0,"exports"],[105,9,124,7],[105,10,124,8,"START_DELAY"],[105,21,124,19],[105,24,124,22,"START_DELAY"],[105,35,124,33],[106,2,125,0,"exports"],[106,9,125,7],[106,10,125,8,"makeOfflineTransport"],[106,30,125,28],[106,33,125,31,"makeOfflineTransport"],[106,53,125,51],[107,0,125,52],[107,3]],"functionMap":{"names":["<global>","log","makeOfflineTransport","<anonymous>","shouldQueue","flushIn","setTimeout$argument_0","send._catch$argument_0","flushWithBackOff","send","flush"],"mappings":"AAA;ACQ;CDE;AEO;SCG;ICO;KDc;IEE;8BCS;iCCM;WDE;ODE;KFM;IKE;KLQ;IME;KN6B;aOQ,uBP;GDE;CFC"},"hasCjsExports":true},"type":"js/module"}]}