{"dependencies":[{"name":"../telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":252},"end":{"line":9,"column":52,"index":304}}],"key":"k7LZwhoWMWET/ud396YGvDlODrM=","exportNames":["*"],"imports":1}},{"name":"./config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":305},"end":{"line":10,"column":50,"index":355}}],"key":"apL7GyCxHQJfXSypmIMW0g+q+wo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.isInsufficientShardsError = isInsufficientShardsError;\n  exports.getProgressionTable = getProgressionTable;\n  exports.getHeroStats = getHeroStats;\n  exports.promoteHero = promoteHero;\n  exports.generatePromotionSourceId = generatePromotionSourceId;\n  var _telemetryEvents = require(_dependencyMap[0], \"../telemetry/events\");\n  var _config = require(_dependencyMap[1], \"./config\");\n  // /app/frontend/lib/api/heroProgression.ts\n  // Phase 3.39-3.41: Hero Progression API\n  //\n  // Server-authoritative hero star/stat system.\n  // All mutations go through canonical receipts.\n  // NO CLIENT-SIDE STAR/STAT MUTATIONS.\n\n  // Auth handled by config.ts\n\n  // =============================================================================\n  // TYPES\n  // =============================================================================\n\n  function isInsufficientShardsError(error) {\n    if (!error || typeof error !== 'object') return false;\n    return error.code === 'INSUFFICIENT_SHARDS';\n  }\n\n  // =============================================================================\n  // API FUNCTIONS\n  // =============================================================================\n\n  /**\n   * Get the locked progression table (read-only)\n   */\n  async function getProgressionTable() {\n    const res = await fetch((0, _config.apiUrl)('/api/hero/progression-table'));\n    if (!res.ok) {\n      throw new Error('Failed to fetch progression table');\n    }\n    return await res.json();\n  }\n\n  /**\n   * Get server-derived stats for a hero (Phase 3.41)\n   */\n  async function getHeroStats(heroId) {\n    const headers = await (0, _config.getJsonHeaders)();\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_STATS_VIEWED, {\n      heroId\n    });\n    const res = await fetch((0, _config.apiUrl)(`/api/hero/${heroId}/stats`), {\n      headers\n    });\n    if (!res.ok) {\n      throw new Error('Failed to fetch hero stats');\n    }\n    return await res.json();\n  }\n\n  /**\n   * Promote hero to next star (Phase 3.39)\n   * \n   * @param heroId - Hero to promote\n   * @param sourceId - Client-generated ID for idempotency\n   */\n  async function promoteHero(heroId, sourceId) {\n    const headers = await (0, _config.getJsonHeaders)();\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_SUBMITTED, {\n      heroId,\n      sourceId\n    });\n    const res = await fetch((0, _config.apiUrl)('/api/hero/promote'), {\n      method: 'POST',\n      headers,\n      body: JSON.stringify({\n        hero_id: heroId,\n        source_id: sourceId\n      })\n    });\n    if (!res.ok) {\n      const errorData = await res.json().catch(() => ({}));\n      if (errorData.code === 'INSUFFICIENT_SHARDS') {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_INSUFFICIENT_SHARDS, {\n          heroId,\n          required: errorData.required,\n          available: errorData.available\n        });\n      } else {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_FAILED, {\n          heroId,\n          error: errorData.code || errorData.detail || 'Unknown error'\n        });\n      }\n      throw errorData;\n    }\n    const receipt = await res.json();\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_SUCCESS, {\n      heroId,\n      starBefore: receipt.heroDelta.starBefore,\n      starAfter: receipt.heroDelta.starAfter,\n      shardsSpent: receipt.shardsSpent\n    });\n    return receipt;\n  }\n\n  /**\n   * Generate source ID for promotion\n   */\n  let promotionCounter = 0;\n  function generatePromotionSourceId(heroId) {\n    promotionCounter = (promotionCounter + 1) % 10000;\n    return `promote_${heroId}_${Date.now()}_${promotionCounter.toString().padStart(4, '0')}`;\n  }\n});","lineCount":118,"map":[[7,2,75,0,"exports"],[7,9,75,0],[7,10,75,0,"isInsufficientShardsError"],[7,35,75,0],[7,38,75,0,"isInsufficientShardsError"],[7,63,75,0],[8,2,87,0,"exports"],[8,9,87,0],[8,10,87,0,"getProgressionTable"],[8,29,87,0],[8,32,87,0,"getProgressionTable"],[8,51,87,0],[9,2,100,0,"exports"],[9,9,100,0],[9,10,100,0,"getHeroStats"],[9,22,100,0],[9,25,100,0,"getHeroStats"],[9,37,100,0],[10,2,120,0,"exports"],[10,9,120,0],[10,10,120,0,"promoteHero"],[10,21,120,0],[10,24,120,0,"promoteHero"],[10,35,120,0],[11,2,172,0,"exports"],[11,9,172,0],[11,10,172,0,"generatePromotionSourceId"],[11,35,172,0],[11,38,172,0,"generatePromotionSourceId"],[11,63,172,0],[12,2,9,0],[12,6,9,0,"_telemetryEvents"],[12,22,9,0],[12,25,9,0,"require"],[12,32,9,0],[12,33,9,0,"_dependencyMap"],[12,47,9,0],[13,2,10,0],[13,6,10,0,"_config"],[13,13,10,0],[13,16,10,0,"require"],[13,23,10,0],[13,24,10,0,"_dependencyMap"],[13,38,10,0],[14,2,1,0],[15,2,2,0],[16,2,3,0],[17,2,4,0],[18,2,5,0],[19,2,6,0],[21,2,8,0],[23,2,12,0],[24,2,13,0],[25,2,14,0],[27,2,75,7],[27,11,75,16,"isInsufficientShardsError"],[27,36,75,41,"isInsufficientShardsError"],[27,37,75,42,"error"],[27,42,75,56],[27,44,75,92],[28,4,76,2],[28,8,76,6],[28,9,76,7,"error"],[28,14,76,12],[28,18,76,16],[28,25,76,23,"error"],[28,30,76,28],[28,35,76,33],[28,43,76,41],[28,45,76,43],[28,52,76,50],[28,57,76,55],[29,4,77,2],[29,11,77,10,"error"],[29,16,77,15],[29,17,77,44,"code"],[29,21,77,48],[29,26,77,53],[29,47,77,74],[30,2,78,0],[32,2,80,0],[33,2,81,0],[34,2,82,0],[36,2,84,0],[37,0,85,0],[38,0,86,0],[39,2,87,7],[39,17,87,22,"getProgressionTable"],[39,36,87,41,"getProgressionTable"],[39,37,87,41],[39,39,87,71],[40,4,88,2],[40,10,88,8,"res"],[40,13,88,11],[40,16,88,14],[40,22,88,20,"fetch"],[40,27,88,25],[40,28,88,26],[40,32,88,26,"apiUrl"],[40,39,88,32],[40,40,88,32,"apiUrl"],[40,46,88,32],[40,48,88,33],[40,77,88,62],[40,78,88,63],[40,79,88,64],[41,4,90,2],[41,8,90,6],[41,9,90,7,"res"],[41,12,90,10],[41,13,90,11,"ok"],[41,15,90,13],[41,17,90,15],[42,6,91,4],[42,12,91,10],[42,16,91,14,"Error"],[42,21,91,19],[42,22,91,20],[42,57,91,55],[42,58,91,56],[43,4,92,2],[44,4,94,2],[44,11,94,9],[44,17,94,15,"res"],[44,20,94,18],[44,21,94,19,"json"],[44,25,94,23],[44,26,94,24],[44,27,94,25],[45,2,95,0],[47,2,97,0],[48,0,98,0],[49,0,99,0],[50,2,100,7],[50,17,100,22,"getHeroStats"],[50,29,100,34,"getHeroStats"],[50,30,100,35,"heroId"],[50,36,100,49],[50,38,100,79],[51,4,101,2],[51,10,101,8,"headers"],[51,17,101,15],[51,20,101,18],[51,26,101,24],[51,30,101,24,"getJsonHeaders"],[51,37,101,38],[51,38,101,38,"getJsonHeaders"],[51,52,101,38],[51,54,101,39],[51,55,101,40],[52,4,103,2],[52,8,103,2,"track"],[52,24,103,7],[52,25,103,7,"track"],[52,30,103,7],[52,32,103,8,"Events"],[52,48,103,14],[52,49,103,14,"Events"],[52,55,103,14],[52,56,103,15,"HERO_STATS_VIEWED"],[52,73,103,32],[52,75,103,34],[53,6,103,36,"heroId"],[54,4,103,43],[54,5,103,44],[54,6,103,45],[55,4,105,2],[55,10,105,8,"res"],[55,13,105,11],[55,16,105,14],[55,22,105,20,"fetch"],[55,27,105,25],[55,28,105,26],[55,32,105,26,"apiUrl"],[55,39,105,32],[55,40,105,32,"apiUrl"],[55,46,105,32],[55,48,105,33],[55,61,105,46,"heroId"],[55,67,105,52],[55,75,105,60],[55,76,105,61],[55,78,105,63],[56,6,105,65,"headers"],[57,4,105,73],[57,5,105,74],[57,6,105,75],[58,4,107,2],[58,8,107,6],[58,9,107,7,"res"],[58,12,107,10],[58,13,107,11,"ok"],[58,15,107,13],[58,17,107,15],[59,6,108,4],[59,12,108,10],[59,16,108,14,"Error"],[59,21,108,19],[59,22,108,20],[59,50,108,48],[59,51,108,49],[60,4,109,2],[61,4,111,2],[61,11,111,9],[61,17,111,15,"res"],[61,20,111,18],[61,21,111,19,"json"],[61,25,111,23],[61,26,111,24],[61,27,111,25],[62,2,112,0],[64,2,114,0],[65,0,115,0],[66,0,116,0],[67,0,117,0],[68,0,118,0],[69,0,119,0],[70,2,120,7],[70,17,120,22,"promoteHero"],[70,28,120,33,"promoteHero"],[70,29,121,2,"heroId"],[70,35,121,16],[70,37,122,2,"sourceId"],[70,45,122,18],[70,47,123,29],[71,4,124,2],[71,10,124,8,"headers"],[71,17,124,15],[71,20,124,18],[71,26,124,24],[71,30,124,24,"getJsonHeaders"],[71,37,124,38],[71,38,124,38,"getJsonHeaders"],[71,52,124,38],[71,54,124,39],[71,55,124,40],[72,4,126,2],[72,8,126,2,"track"],[72,24,126,7],[72,25,126,7,"track"],[72,30,126,7],[72,32,126,8,"Events"],[72,48,126,14],[72,49,126,14,"Events"],[72,55,126,14],[72,56,126,15,"HERO_PROMOTION_SUBMITTED"],[72,80,126,39],[72,82,126,41],[73,6,126,43,"heroId"],[73,12,126,49],[74,6,126,51,"sourceId"],[75,4,126,60],[75,5,126,61],[75,6,126,62],[76,4,128,2],[76,10,128,8,"res"],[76,13,128,11],[76,16,128,14],[76,22,128,20,"fetch"],[76,27,128,25],[76,28,128,26],[76,32,128,26,"apiUrl"],[76,39,128,32],[76,40,128,32,"apiUrl"],[76,46,128,32],[76,48,128,33],[76,67,128,52],[76,68,128,53],[76,70,128,55],[77,6,129,4,"method"],[77,12,129,10],[77,14,129,12],[77,20,129,18],[78,6,130,4,"headers"],[78,13,130,11],[79,6,131,4,"body"],[79,10,131,8],[79,12,131,10,"JSON"],[79,16,131,14],[79,17,131,15,"stringify"],[79,26,131,24],[79,27,131,25],[80,8,132,6,"hero_id"],[80,15,132,13],[80,17,132,15,"heroId"],[80,23,132,21],[81,8,133,6,"source_id"],[81,17,133,15],[81,19,133,17,"sourceId"],[82,6,134,4],[82,7,134,5],[83,4,135,2],[83,5,135,3],[83,6,135,4],[84,4,137,2],[84,8,137,6],[84,9,137,7,"res"],[84,12,137,10],[84,13,137,11,"ok"],[84,15,137,13],[84,17,137,15],[85,6,138,4],[85,12,138,10,"errorData"],[85,21,138,19],[85,24,138,22],[85,30,138,28,"res"],[85,33,138,31],[85,34,138,32,"json"],[85,38,138,36],[85,39,138,37],[85,40,138,38],[85,41,138,39,"catch"],[85,46,138,44],[85,47,138,45],[85,54,138,52],[85,55,138,53],[85,56,138,54],[85,57,138,55],[85,58,138,56],[86,6,140,4],[86,10,140,8,"errorData"],[86,19,140,17],[86,20,140,18,"code"],[86,24,140,22],[86,29,140,27],[86,50,140,48],[86,52,140,50],[87,8,141,6],[87,12,141,6,"track"],[87,28,141,11],[87,29,141,11,"track"],[87,34,141,11],[87,36,141,12,"Events"],[87,52,141,18],[87,53,141,18,"Events"],[87,59,141,18],[87,60,141,19,"HERO_PROMOTION_INSUFFICIENT_SHARDS"],[87,94,141,53],[87,96,141,55],[88,10,142,8,"heroId"],[88,16,142,14],[89,10,143,8,"required"],[89,18,143,16],[89,20,143,18,"errorData"],[89,29,143,27],[89,30,143,28,"required"],[89,38,143,36],[90,10,144,8,"available"],[90,19,144,17],[90,21,144,19,"errorData"],[90,30,144,28],[90,31,144,29,"available"],[91,8,145,6],[91,9,145,7],[91,10,145,8],[92,6,146,4],[92,7,146,5],[92,13,146,11],[93,8,147,6],[93,12,147,6,"track"],[93,28,147,11],[93,29,147,11,"track"],[93,34,147,11],[93,36,147,12,"Events"],[93,52,147,18],[93,53,147,18,"Events"],[93,59,147,18],[93,60,147,19,"HERO_PROMOTION_FAILED"],[93,81,147,40],[93,83,147,42],[94,10,148,8,"heroId"],[94,16,148,14],[95,10,149,8,"error"],[95,15,149,13],[95,17,149,15,"errorData"],[95,26,149,24],[95,27,149,25,"code"],[95,31,149,29],[95,35,149,33,"errorData"],[95,44,149,42],[95,45,149,43,"detail"],[95,51,149,49],[95,55,149,53],[96,8,150,6],[96,9,150,7],[96,10,150,8],[97,6,151,4],[98,6,153,4],[98,12,153,10,"errorData"],[98,21,153,19],[99,4,154,2],[100,4,156,2],[100,10,156,8,"receipt"],[100,17,156,15],[100,20,156,18],[100,26,156,24,"res"],[100,29,156,27],[100,30,156,28,"json"],[100,34,156,32],[100,35,156,33],[100,36,156,34],[101,4,158,2],[101,8,158,2,"track"],[101,24,158,7],[101,25,158,7,"track"],[101,30,158,7],[101,32,158,8,"Events"],[101,48,158,14],[101,49,158,14,"Events"],[101,55,158,14],[101,56,158,15,"HERO_PROMOTION_SUCCESS"],[101,78,158,37],[101,80,158,39],[102,6,159,4,"heroId"],[102,12,159,10],[103,6,160,4,"starBefore"],[103,16,160,14],[103,18,160,16,"receipt"],[103,25,160,23],[103,26,160,24,"heroDelta"],[103,35,160,33],[103,36,160,34,"starBefore"],[103,46,160,44],[104,6,161,4,"starAfter"],[104,15,161,13],[104,17,161,15,"receipt"],[104,24,161,22],[104,25,161,23,"heroDelta"],[104,34,161,32],[104,35,161,33,"starAfter"],[104,44,161,42],[105,6,162,4,"shardsSpent"],[105,17,162,15],[105,19,162,17,"receipt"],[105,26,162,24],[105,27,162,25,"shardsSpent"],[106,4,163,2],[106,5,163,3],[106,6,163,4],[107,4,165,2],[107,11,165,9,"receipt"],[107,18,165,16],[108,2,166,0],[110,2,168,0],[111,0,169,0],[112,0,170,0],[113,2,171,0],[113,6,171,4,"promotionCounter"],[113,22,171,20],[113,25,171,23],[113,26,171,24],[114,2,172,7],[114,11,172,16,"generatePromotionSourceId"],[114,36,172,41,"generatePromotionSourceId"],[114,37,172,42,"heroId"],[114,43,172,56],[114,45,172,66],[115,4,173,2,"promotionCounter"],[115,20,173,18],[115,23,173,21],[115,24,173,22,"promotionCounter"],[115,40,173,38],[115,43,173,41],[115,44,173,42],[115,48,173,46],[115,53,173,51],[116,4,174,2],[116,11,174,9],[116,22,174,20,"heroId"],[116,28,174,26],[116,32,174,30,"Date"],[116,36,174,34],[116,37,174,35,"now"],[116,40,174,38],[116,41,174,39],[116,42,174,40],[116,46,174,44,"promotionCounter"],[116,62,174,60],[116,63,174,61,"toString"],[116,71,174,69],[116,72,174,70],[116,73,174,71],[116,74,174,72,"padStart"],[116,82,174,80],[116,83,174,81],[116,84,174,82],[116,86,174,84],[116,89,174,87],[116,90,174,88],[116,92,174,90],[117,2,175,0],[118,0,175,1],[118,3]],"functionMap":{"names":["<global>","isInsufficientShardsError","getProgressionTable","getHeroStats","promoteHero","res.json._catch$argument_0","generatePromotionSourceId"],"mappings":"AAA;OC0E;CDG;OES;CFQ;OGK;CHY;OIQ;6CCkB,UD;CJ4B;OMM;CNG"},"hasCjsExports":false},"type":"js/module"}]}