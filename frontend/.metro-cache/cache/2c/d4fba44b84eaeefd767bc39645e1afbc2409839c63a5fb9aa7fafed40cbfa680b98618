{"dependencies":[{"name":"./is.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":11,"index":75},"end":{"line":3,"column":29,"index":93}}],"key":"7L+qE4U1JkzGTtK8kDgvAl12vZ8=","exportNames":["*"],"imports":1}},{"name":"./string.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":15,"index":110},"end":{"line":4,"column":37,"index":132}}],"key":"tSXB7Kbh7swZWumhEmzaYOqkqug=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  const is = require(_dependencyMap[0], \"./is.js\");\n  const string = require(_dependencyMap[1], \"./string.js\");\n\n  /**\n   * Creates exceptions inside `event.exception.values` for errors that are nested on properties based on the `key` parameter.\n   */\n  function applyAggregateErrorsToEvent(exceptionFromErrorImplementation, parser, maxValueLimit = 250, key, limit, event, hint) {\n    if (!event.exception || !event.exception.values || !hint || !is.isInstanceOf(hint.originalException, Error)) {\n      return;\n    }\n\n    // Generally speaking the last item in `event.exception.values` is the exception originating from the original Error\n    const originalException = event.exception.values.length > 0 ? event.exception.values[event.exception.values.length - 1] : undefined;\n\n    // We only create exception grouping if there is an exception in the event.\n    if (originalException) {\n      event.exception.values = truncateAggregateExceptions(aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, hint.originalException, key, event.exception.values, originalException, 0), maxValueLimit);\n    }\n  }\n  function aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, error, key, prevExceptions, exception, exceptionId) {\n    if (prevExceptions.length >= limit + 1) {\n      return prevExceptions;\n    }\n    let newExceptions = [...prevExceptions];\n    if (is.isInstanceOf(error[key], Error)) {\n      applyExceptionGroupFieldsForParentException(exception, exceptionId);\n      const newException = exceptionFromErrorImplementation(parser, error[key]);\n      const newExceptionId = newExceptions.length;\n      applyExceptionGroupFieldsForChildException(newException, key, newExceptionId, exceptionId);\n      newExceptions = aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, error[key], key, [newException, ...newExceptions], newException, newExceptionId);\n    }\n\n    // This will create exception grouping for AggregateErrors\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AggregateError\n    if (Array.isArray(error.errors)) {\n      error.errors.forEach((childError, i) => {\n        if (is.isInstanceOf(childError, Error)) {\n          applyExceptionGroupFieldsForParentException(exception, exceptionId);\n          const newException = exceptionFromErrorImplementation(parser, childError);\n          const newExceptionId = newExceptions.length;\n          applyExceptionGroupFieldsForChildException(newException, `errors[${i}]`, newExceptionId, exceptionId);\n          newExceptions = aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, childError, key, [newException, ...newExceptions], newException, newExceptionId);\n        }\n      });\n    }\n    return newExceptions;\n  }\n  function applyExceptionGroupFieldsForParentException(exception, exceptionId) {\n    // Don't know if this default makes sense. The protocol requires us to set these values so we pick *some* default.\n    exception.mechanism = exception.mechanism || {\n      type: 'generic',\n      handled: true\n    };\n    exception.mechanism = {\n      ...exception.mechanism,\n      is_exception_group: true,\n      exception_id: exceptionId\n    };\n  }\n  function applyExceptionGroupFieldsForChildException(exception, source, exceptionId, parentId) {\n    // Don't know if this default makes sense. The protocol requires us to set these values so we pick *some* default.\n    exception.mechanism = exception.mechanism || {\n      type: 'generic',\n      handled: true\n    };\n    exception.mechanism = {\n      ...exception.mechanism,\n      type: 'chained',\n      source,\n      exception_id: exceptionId,\n      parent_id: parentId\n    };\n  }\n\n  /**\n   * Truncate the message (exception.value) of all exceptions in the event.\n   * Because this event processor is ran after `applyClientOptions`,\n   * we need to truncate the message of the added exceptions here.\n   */\n  function truncateAggregateExceptions(exceptions, maxValueLength) {\n    return exceptions.map(exception => {\n      if (exception.value) {\n        exception.value = string.truncate(exception.value, maxValueLength);\n      }\n      return exception;\n    });\n  }\n  exports.applyAggregateErrorsToEvent = applyAggregateErrorsToEvent;\n});","lineCount":93,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,8,3,6,"is"],[5,10,3,8],[5,13,3,11,"require"],[5,20,3,18],[5,21,3,18,"_dependencyMap"],[5,35,3,18],[5,49,3,28],[5,50,3,29],[6,2,4,0],[6,8,4,6,"string"],[6,14,4,12],[6,17,4,15,"require"],[6,24,4,22],[6,25,4,22,"_dependencyMap"],[6,39,4,22],[6,57,4,36],[6,58,4,37],[8,2,6,0],[9,0,7,0],[10,0,8,0],[11,2,9,0],[11,11,9,9,"applyAggregateErrorsToEvent"],[11,38,9,36,"applyAggregateErrorsToEvent"],[11,39,10,2,"exceptionFromErrorImplementation"],[11,71,10,34],[11,73,11,2,"parser"],[11,79,11,8],[11,81,12,2,"maxValueLimit"],[11,94,12,15],[11,97,12,18],[11,100,12,21],[11,102,13,2,"key"],[11,105,13,5],[11,107,14,2,"limit"],[11,112,14,7],[11,114,15,2,"event"],[11,119,15,7],[11,121,16,2,"hint"],[11,125,16,6],[11,127,17,2],[12,4,18,2],[12,8,18,6],[12,9,18,7,"event"],[12,14,18,12],[12,15,18,13,"exception"],[12,24,18,22],[12,28,18,26],[12,29,18,27,"event"],[12,34,18,32],[12,35,18,33,"exception"],[12,44,18,42],[12,45,18,43,"values"],[12,51,18,49],[12,55,18,53],[12,56,18,54,"hint"],[12,60,18,58],[12,64,18,62],[12,65,18,63,"is"],[12,67,18,65],[12,68,18,66,"isInstanceOf"],[12,80,18,78],[12,81,18,79,"hint"],[12,85,18,83],[12,86,18,84,"originalException"],[12,103,18,101],[12,105,18,103,"Error"],[12,110,18,108],[12,111,18,109],[12,113,18,111],[13,6,19,4],[14,4,20,2],[16,4,22,2],[17,4,23,2],[17,10,23,8,"originalException"],[17,27,23,25],[17,30,24,4,"event"],[17,35,24,9],[17,36,24,10,"exception"],[17,45,24,19],[17,46,24,20,"values"],[17,52,24,26],[17,53,24,27,"length"],[17,59,24,33],[17,62,24,36],[17,63,24,37],[17,66,24,40,"event"],[17,71,24,45],[17,72,24,46,"exception"],[17,81,24,55],[17,82,24,56,"values"],[17,88,24,62],[17,89,24,63,"event"],[17,94,24,68],[17,95,24,69,"exception"],[17,104,24,78],[17,105,24,79,"values"],[17,111,24,85],[17,112,24,86,"length"],[17,118,24,92],[17,121,24,95],[17,122,24,96],[17,123,24,97],[17,126,24,100,"undefined"],[17,135,24,109],[19,4,26,2],[20,4,27,2],[20,8,27,6,"originalException"],[20,25,27,23],[20,27,27,25],[21,6,28,4,"event"],[21,11,28,9],[21,12,28,10,"exception"],[21,21,28,19],[21,22,28,20,"values"],[21,28,28,26],[21,31,28,29,"truncateAggregateExceptions"],[21,58,28,56],[21,59,29,6,"aggregateExceptionsFromError"],[21,87,29,34],[21,88,30,8,"exceptionFromErrorImplementation"],[21,120,30,40],[21,122,31,8,"parser"],[21,128,31,14],[21,130,32,8,"limit"],[21,135,32,13],[21,137,33,8,"hint"],[21,141,33,12],[21,142,33,13,"originalException"],[21,159,33,30],[21,161,34,8,"key"],[21,164,34,11],[21,166,35,8,"event"],[21,171,35,13],[21,172,35,14,"exception"],[21,181,35,23],[21,182,35,24,"values"],[21,188,35,30],[21,190,36,8,"originalException"],[21,207,36,25],[21,209,37,8],[21,210,38,6],[21,211,38,7],[21,213,39,6,"maxValueLimit"],[21,226,40,4],[21,227,40,5],[22,4,41,2],[23,2,42,0],[24,2,44,0],[24,11,44,9,"aggregateExceptionsFromError"],[24,39,44,37,"aggregateExceptionsFromError"],[24,40,45,2,"exceptionFromErrorImplementation"],[24,72,45,34],[24,74,46,2,"parser"],[24,80,46,8],[24,82,47,2,"limit"],[24,87,47,7],[24,89,48,2,"error"],[24,94,48,7],[24,96,49,2,"key"],[24,99,49,5],[24,101,50,2,"prevExceptions"],[24,115,50,16],[24,117,51,2,"exception"],[24,126,51,11],[24,128,52,2,"exceptionId"],[24,139,52,13],[24,141,53,2],[25,4,54,2],[25,8,54,6,"prevExceptions"],[25,22,54,20],[25,23,54,21,"length"],[25,29,54,27],[25,33,54,31,"limit"],[25,38,54,36],[25,41,54,39],[25,42,54,40],[25,44,54,42],[26,6,55,4],[26,13,55,11,"prevExceptions"],[26,27,55,25],[27,4,56,2],[28,4,58,2],[28,8,58,6,"newExceptions"],[28,21,58,19],[28,24,58,22],[28,25,58,23],[28,28,58,26,"prevExceptions"],[28,42,58,40],[28,43,58,41],[29,4,60,2],[29,8,60,6,"is"],[29,10,60,8],[29,11,60,9,"isInstanceOf"],[29,23,60,21],[29,24,60,22,"error"],[29,29,60,27],[29,30,60,28,"key"],[29,33,60,31],[29,34,60,32],[29,36,60,34,"Error"],[29,41,60,39],[29,42,60,40],[29,44,60,42],[30,6,61,4,"applyExceptionGroupFieldsForParentException"],[30,49,61,47],[30,50,61,48,"exception"],[30,59,61,57],[30,61,61,59,"exceptionId"],[30,72,61,70],[30,73,61,71],[31,6,62,4],[31,12,62,10,"newException"],[31,24,62,22],[31,27,62,25,"exceptionFromErrorImplementation"],[31,59,62,57],[31,60,62,58,"parser"],[31,66,62,64],[31,68,62,66,"error"],[31,73,62,71],[31,74,62,72,"key"],[31,77,62,75],[31,78,62,76],[31,79,62,77],[32,6,63,4],[32,12,63,10,"newExceptionId"],[32,26,63,24],[32,29,63,27,"newExceptions"],[32,42,63,40],[32,43,63,41,"length"],[32,49,63,47],[33,6,64,4,"applyExceptionGroupFieldsForChildException"],[33,48,64,46],[33,49,64,47,"newException"],[33,61,64,59],[33,63,64,61,"key"],[33,66,64,64],[33,68,64,66,"newExceptionId"],[33,82,64,80],[33,84,64,82,"exceptionId"],[33,95,64,93],[33,96,64,94],[34,6,65,4,"newExceptions"],[34,19,65,17],[34,22,65,20,"aggregateExceptionsFromError"],[34,50,65,48],[34,51,66,6,"exceptionFromErrorImplementation"],[34,83,66,38],[34,85,67,6,"parser"],[34,91,67,12],[34,93,68,6,"limit"],[34,98,68,11],[34,100,69,6,"error"],[34,105,69,11],[34,106,69,12,"key"],[34,109,69,15],[34,110,69,16],[34,112,70,6,"key"],[34,115,70,9],[34,117,71,6],[34,118,71,7,"newException"],[34,130,71,19],[34,132,71,21],[34,135,71,24,"newExceptions"],[34,148,71,37],[34,149,71,38],[34,151,72,6,"newException"],[34,163,72,18],[34,165,73,6,"newExceptionId"],[34,179,74,4],[34,180,74,5],[35,4,75,2],[37,4,77,2],[38,4,78,2],[39,4,79,2],[39,8,79,6,"Array"],[39,13,79,11],[39,14,79,12,"isArray"],[39,21,79,19],[39,22,79,20,"error"],[39,27,79,25],[39,28,79,26,"errors"],[39,34,79,32],[39,35,79,33],[39,37,79,35],[40,6,80,4,"error"],[40,11,80,9],[40,12,80,10,"errors"],[40,18,80,16],[40,19,80,17,"forEach"],[40,26,80,24],[40,27,80,25],[40,28,80,26,"childError"],[40,38,80,36],[40,40,80,38,"i"],[40,41,80,39],[40,46,80,44],[41,8,81,6],[41,12,81,10,"is"],[41,14,81,12],[41,15,81,13,"isInstanceOf"],[41,27,81,25],[41,28,81,26,"childError"],[41,38,81,36],[41,40,81,38,"Error"],[41,45,81,43],[41,46,81,44],[41,48,81,46],[42,10,82,8,"applyExceptionGroupFieldsForParentException"],[42,53,82,51],[42,54,82,52,"exception"],[42,63,82,61],[42,65,82,63,"exceptionId"],[42,76,82,74],[42,77,82,75],[43,10,83,8],[43,16,83,14,"newException"],[43,28,83,26],[43,31,83,29,"exceptionFromErrorImplementation"],[43,63,83,61],[43,64,83,62,"parser"],[43,70,83,68],[43,72,83,70,"childError"],[43,82,83,80],[43,83,83,81],[44,10,84,8],[44,16,84,14,"newExceptionId"],[44,30,84,28],[44,33,84,31,"newExceptions"],[44,46,84,44],[44,47,84,45,"length"],[44,53,84,51],[45,10,85,8,"applyExceptionGroupFieldsForChildException"],[45,52,85,50],[45,53,85,51,"newException"],[45,65,85,63],[45,67,85,65],[45,77,85,75,"i"],[45,78,85,76],[45,81,85,79],[45,83,85,81,"newExceptionId"],[45,97,85,95],[45,99,85,97,"exceptionId"],[45,110,85,108],[45,111,85,109],[46,10,86,8,"newExceptions"],[46,23,86,21],[46,26,86,24,"aggregateExceptionsFromError"],[46,54,86,52],[46,55,87,10,"exceptionFromErrorImplementation"],[46,87,87,42],[46,89,88,10,"parser"],[46,95,88,16],[46,97,89,10,"limit"],[46,102,89,15],[46,104,90,10,"childError"],[46,114,90,20],[46,116,91,10,"key"],[46,119,91,13],[46,121,92,10],[46,122,92,11,"newException"],[46,134,92,23],[46,136,92,25],[46,139,92,28,"newExceptions"],[46,152,92,41],[46,153,92,42],[46,155,93,10,"newException"],[46,167,93,22],[46,169,94,10,"newExceptionId"],[46,183,95,8],[46,184,95,9],[47,8,96,6],[48,6,97,4],[48,7,97,5],[48,8,97,6],[49,4,98,2],[50,4,100,2],[50,11,100,9,"newExceptions"],[50,24,100,22],[51,2,101,0],[52,2,103,0],[52,11,103,9,"applyExceptionGroupFieldsForParentException"],[52,54,103,52,"applyExceptionGroupFieldsForParentException"],[52,55,103,53,"exception"],[52,64,103,62],[52,66,103,64,"exceptionId"],[52,77,103,75],[52,79,103,77],[53,4,104,2],[54,4,105,2,"exception"],[54,13,105,11],[54,14,105,12,"mechanism"],[54,23,105,21],[54,26,105,24,"exception"],[54,35,105,33],[54,36,105,34,"mechanism"],[54,45,105,43],[54,49,105,47],[55,6,105,49,"type"],[55,10,105,53],[55,12,105,55],[55,21,105,64],[56,6,105,66,"handled"],[56,13,105,73],[56,15,105,75],[57,4,105,80],[57,5,105,81],[58,4,107,2,"exception"],[58,13,107,11],[58,14,107,12,"mechanism"],[58,23,107,21],[58,26,107,24],[59,6,108,4],[59,9,108,7,"exception"],[59,18,108,16],[59,19,108,17,"mechanism"],[59,28,108,26],[60,6,109,4,"is_exception_group"],[60,24,109,22],[60,26,109,24],[60,30,109,28],[61,6,110,4,"exception_id"],[61,18,110,16],[61,20,110,18,"exceptionId"],[62,4,111,2],[62,5,111,3],[63,2,112,0],[64,2,114,0],[64,11,114,9,"applyExceptionGroupFieldsForChildException"],[64,53,114,51,"applyExceptionGroupFieldsForChildException"],[64,54,115,2,"exception"],[64,63,115,11],[64,65,116,2,"source"],[64,71,116,8],[64,73,117,2,"exceptionId"],[64,84,117,13],[64,86,118,2,"parentId"],[64,94,118,10],[64,96,119,2],[65,4,120,2],[66,4,121,2,"exception"],[66,13,121,11],[66,14,121,12,"mechanism"],[66,23,121,21],[66,26,121,24,"exception"],[66,35,121,33],[66,36,121,34,"mechanism"],[66,45,121,43],[66,49,121,47],[67,6,121,49,"type"],[67,10,121,53],[67,12,121,55],[67,21,121,64],[68,6,121,66,"handled"],[68,13,121,73],[68,15,121,75],[69,4,121,80],[69,5,121,81],[70,4,123,2,"exception"],[70,13,123,11],[70,14,123,12,"mechanism"],[70,23,123,21],[70,26,123,24],[71,6,124,4],[71,9,124,7,"exception"],[71,18,124,16],[71,19,124,17,"mechanism"],[71,28,124,26],[72,6,125,4,"type"],[72,10,125,8],[72,12,125,10],[72,21,125,19],[73,6,126,4,"source"],[73,12,126,10],[74,6,127,4,"exception_id"],[74,18,127,16],[74,20,127,18,"exceptionId"],[74,31,127,29],[75,6,128,4,"parent_id"],[75,15,128,13],[75,17,128,15,"parentId"],[76,4,129,2],[76,5,129,3],[77,2,130,0],[79,2,132,0],[80,0,133,0],[81,0,134,0],[82,0,135,0],[83,0,136,0],[84,2,137,0],[84,11,137,9,"truncateAggregateExceptions"],[84,38,137,36,"truncateAggregateExceptions"],[84,39,137,37,"exceptions"],[84,49,137,47],[84,51,137,49,"maxValueLength"],[84,65,137,63],[84,67,137,65],[85,4,138,2],[85,11,138,9,"exceptions"],[85,21,138,19],[85,22,138,20,"map"],[85,25,138,23],[85,26,138,24,"exception"],[85,35,138,33],[85,39,138,37],[86,6,139,4],[86,10,139,8,"exception"],[86,19,139,17],[86,20,139,18,"value"],[86,25,139,23],[86,27,139,25],[87,8,140,6,"exception"],[87,17,140,15],[87,18,140,16,"value"],[87,23,140,21],[87,26,140,24,"string"],[87,32,140,30],[87,33,140,31,"truncate"],[87,41,140,39],[87,42,140,40,"exception"],[87,51,140,49],[87,52,140,50,"value"],[87,57,140,55],[87,59,140,57,"maxValueLength"],[87,73,140,71],[87,74,140,72],[88,6,141,4],[89,6,142,4],[89,13,142,11,"exception"],[89,22,142,20],[90,4,143,2],[90,5,143,3],[90,6,143,4],[91,2,144,0],[92,2,146,0,"exports"],[92,9,146,7],[92,10,146,8,"applyAggregateErrorsToEvent"],[92,37,146,35],[92,40,146,38,"applyAggregateErrorsToEvent"],[92,67,146,65],[93,0,146,66],[93,3]],"functionMap":{"names":["<global>","applyAggregateErrorsToEvent","aggregateExceptionsFromError","error.errors.forEach$argument_0","applyExceptionGroupFieldsForParentException","applyExceptionGroupFieldsForChildException","truncateAggregateExceptions","exceptions.map$argument_0"],"mappings":"AAA;ACQ;CDiC;AEE;yBCoC;KDiB;CFI;AIE;CJS;AKE;CLgB;AMO;wBCC;GDK;CNC"},"hasCjsExports":true},"type":"js/module"}]}