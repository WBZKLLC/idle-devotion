{"dependencies":[{"name":"./featureUtils","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":34},"end":{"line":8,"column":24,"index":162}}],"key":"FACoi85IMzpe+kZO3DG9/H6Umsk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"DEFAULT_FLAGS\", {\n    enumerable: true,\n    get: function () {\n      return DEFAULT_FLAGS;\n    }\n  });\n  exports.setDevFeatureOverride = setDevFeatureOverride;\n  exports.clearDevFeatureOverride = clearDevFeatureOverride;\n  exports.clearAllDevFeatureOverrides = clearAllDevFeatureOverrides;\n  exports.setRemoteFeatures = setRemoteFeatures;\n  exports.clearRemoteFeatures = clearRemoteFeatures;\n  exports.getRemoteFeaturesSnapshot = getRemoteFeaturesSnapshot;\n  exports.isFeatureEnabled = isFeatureEnabled;\n  var _featureUtils = require(_dependencyMap[0], \"./featureUtils\");\n  // /app/frontend/lib/features.ts\n\n  /**\n   * Single source of truth for KNOWN flags (compile-time defaults).\n   * Add new flags here first.\n   */\n  const DEFAULT_FLAGS = {\n    AWAKENING_PREVIEW_UI: false,\n    GACHA_PITY_UI: true,\n    NEW_LOGIN_FLOW: false,\n    MAINTENANCE_MODE: false,\n    CAMPAIGN_SWEEP: true,\n    HERO_CINEMATICS: true,\n    HERO_PROGRESSION_ENABLED: true\n  };\n  let remoteFlags = {};\n  let remoteVersion = null;\n\n  /**\n   * Dev overrides: ONLY applied in __DEV__.\n   * Stored in-memory; you can optionally add persistence later.\n   */\n  const devOverrides = {};\n  function setDevFeatureOverride(flag, enabled) {\n    if (!__DEV__) return;\n    devOverrides[flag] = enabled;\n  }\n  function clearDevFeatureOverride(flag) {\n    if (!__DEV__) return;\n    delete devOverrides[flag];\n  }\n  function clearAllDevFeatureOverrides() {\n    if (!__DEV__) return;\n    for (const k of Object.keys(devOverrides)) delete devOverrides[k];\n  }\n\n  /**\n   * Called by the feature store after hydration/fetch.\n   */\n  function setRemoteFeatures(payload) {\n    remoteVersion = payload.version ?? null;\n    remoteFlags = (0, _featureUtils.normalizeRemoteFlags)(payload.flags);\n  }\n  function clearRemoteFeatures() {\n    remoteVersion = null;\n    remoteFlags = {};\n  }\n  function getRemoteFeaturesSnapshot() {\n    return {\n      version: remoteVersion,\n      flags: remoteFlags\n    };\n  }\n\n  /**\n   * Main entrypoint used by UI.\n   * Keep usage standardized: isFeatureEnabled('FLAG', { stableId: userId })\n   */\n\n  function isFeatureEnabled(flag, ctx) {\n    // 1) dev override wins (dev-only)\n    if (__DEV__ && Object.prototype.hasOwnProperty.call(devOverrides, flag)) {\n      return !!devOverrides[flag];\n    }\n\n    // 2) remote override next\n    const r = remoteFlags[flag];\n    if (r) {\n      if (!r.enabled) return false;\n      if (typeof r.rollout === 'number') {\n        const stableId = ctx?.stableId;\n        if (!stableId) return true; // enabled but no stableId => treat as on\n        const b = (0, _featureUtils.bucket01)(`${flag}:${stableId}`);\n        return b < r.rollout;\n      }\n      return true;\n    }\n\n    // 3) local default fallback (known flags)\n    if (Object.prototype.hasOwnProperty.call(DEFAULT_FLAGS, flag)) {\n      return !!DEFAULT_FLAGS[flag];\n    }\n\n    // 4) unknown flag => safe off\n    return false;\n  }\n});","lineCount":107,"map":[[7,2,14,0,"Object"],[7,8,14,0],[7,9,14,0,"defineProperty"],[7,23,14,0],[7,24,14,0,"exports"],[7,31,14,0],[8,4,14,0,"enumerable"],[8,14,14,0],[9,4,14,0,"get"],[9,7,14,0],[9,18,14,0,"get"],[9,19,14,0],[10,6,14,0],[10,13,14,0,"DEFAULT_FLAGS"],[10,26,14,0],[11,4,14,0],[12,2,14,0],[13,2,43,0,"exports"],[13,9,43,0],[13,10,43,0,"setDevFeatureOverride"],[13,31,43,0],[13,34,43,0,"setDevFeatureOverride"],[13,55,43,0],[14,2,48,0,"exports"],[14,9,48,0],[14,10,48,0,"clearDevFeatureOverride"],[14,33,48,0],[14,36,48,0,"clearDevFeatureOverride"],[14,59,48,0],[15,2,53,0,"exports"],[15,9,53,0],[15,10,53,0,"clearAllDevFeatureOverrides"],[15,37,53,0],[15,40,53,0,"clearAllDevFeatureOverrides"],[15,67,53,0],[16,2,61,0,"exports"],[16,9,61,0],[16,10,61,0,"setRemoteFeatures"],[16,27,61,0],[16,30,61,0,"setRemoteFeatures"],[16,47,61,0],[17,2,66,0,"exports"],[17,9,66,0],[17,10,66,0,"clearRemoteFeatures"],[17,29,66,0],[17,32,66,0,"clearRemoteFeatures"],[17,51,66,0],[18,2,71,0,"exports"],[18,9,71,0],[18,10,71,0,"getRemoteFeaturesSnapshot"],[18,35,71,0],[18,38,71,0,"getRemoteFeaturesSnapshot"],[18,63,71,0],[19,2,84,0,"exports"],[19,9,84,0],[19,10,84,0,"isFeatureEnabled"],[19,26,84,0],[19,29,84,0,"isFeatureEnabled"],[19,45,84,0],[20,2,3,0],[20,6,3,0,"_featureUtils"],[20,19,3,0],[20,22,3,0,"require"],[20,29,3,0],[20,30,3,0,"_dependencyMap"],[20,44,3,0],[21,2,1,0],[23,2,10,0],[24,0,11,0],[25,0,12,0],[26,0,13,0],[27,2,14,7],[27,8,14,13,"DEFAULT_FLAGS"],[27,21,14,26],[27,24,14,29],[28,4,15,2,"AWAKENING_PREVIEW_UI"],[28,24,15,22],[28,26,15,24],[28,31,15,29],[29,4,16,2,"GACHA_PITY_UI"],[29,17,16,15],[29,19,16,17],[29,23,16,21],[30,4,17,2,"NEW_LOGIN_FLOW"],[30,18,17,16],[30,20,17,18],[30,25,17,23],[31,4,18,2,"MAINTENANCE_MODE"],[31,20,18,18],[31,22,18,20],[31,27,18,25],[32,4,19,2,"CAMPAIGN_SWEEP"],[32,18,19,16],[32,20,19,18],[32,24,19,22],[33,4,20,2,"HERO_CINEMATICS"],[33,19,20,17],[33,21,20,19],[33,25,20,23],[34,4,21,2,"HERO_PROGRESSION_ENABLED"],[34,28,21,26],[34,30,21,28],[35,2,22,0],[35,3,22,10],[36,2,34,0],[36,6,34,4,"remoteFlags"],[36,17,34,53],[36,20,34,56],[36,21,34,57],[36,22,34,58],[37,2,35,0],[37,6,35,4,"remoteVersion"],[37,19,35,32],[37,22,35,35],[37,26,35,39],[39,2,37,0],[40,0,38,0],[41,0,39,0],[42,0,40,0],[43,2,41,0],[43,8,41,6,"devOverrides"],[43,20,41,43],[43,23,41,46],[43,24,41,47],[43,25,41,48],[44,2,43,7],[44,11,43,16,"setDevFeatureOverride"],[44,32,43,37,"setDevFeatureOverride"],[44,33,43,38,"flag"],[44,37,43,50],[44,39,43,52,"enabled"],[44,46,43,68],[44,48,43,76],[45,4,44,2],[45,8,44,6],[45,9,44,7,"__DEV__"],[45,16,44,14],[45,18,44,16],[46,4,45,2,"devOverrides"],[46,16,45,14],[46,17,45,15,"flag"],[46,21,45,19],[46,22,45,20],[46,25,45,23,"enabled"],[46,32,45,30],[47,2,46,0],[48,2,48,7],[48,11,48,16,"clearDevFeatureOverride"],[48,34,48,39,"clearDevFeatureOverride"],[48,35,48,40,"flag"],[48,39,48,52],[48,41,48,60],[49,4,49,2],[49,8,49,6],[49,9,49,7,"__DEV__"],[49,16,49,14],[49,18,49,16],[50,4,50,2],[50,11,50,9,"devOverrides"],[50,23,50,21],[50,24,50,22,"flag"],[50,28,50,26],[50,29,50,27],[51,2,51,0],[52,2,53,7],[52,11,53,16,"clearAllDevFeatureOverrides"],[52,38,53,43,"clearAllDevFeatureOverrides"],[52,39,53,43],[52,41,53,52],[53,4,54,2],[53,8,54,6],[53,9,54,7,"__DEV__"],[53,16,54,14],[53,18,54,16],[54,4,55,2],[54,9,55,7],[54,15,55,13,"k"],[54,16,55,14],[54,20,55,18,"Object"],[54,26,55,24],[54,27,55,25,"keys"],[54,31,55,29],[54,32,55,30,"devOverrides"],[54,44,55,42],[54,45,55,43],[54,47,55,45],[54,54,55,52,"devOverrides"],[54,66,55,64],[54,67,55,65,"k"],[54,68,55,66],[54,69,55,67],[55,2,56,0],[57,2,58,0],[58,0,59,0],[59,0,60,0],[60,2,61,7],[60,11,61,16,"setRemoteFeatures"],[60,28,61,33,"setRemoteFeatures"],[60,29,61,34,"payload"],[60,36,61,64],[60,38,61,72],[61,4,62,2,"remoteVersion"],[61,17,62,15],[61,20,62,18,"payload"],[61,27,62,25],[61,28,62,26,"version"],[61,35,62,33],[61,39,62,37],[61,43,62,41],[62,4,63,2,"remoteFlags"],[62,15,63,13],[62,18,63,16],[62,22,63,16,"normalizeRemoteFlags"],[62,35,63,36],[62,36,63,36,"normalizeRemoteFlags"],[62,56,63,36],[62,58,63,37,"payload"],[62,65,63,44],[62,66,63,45,"flags"],[62,71,63,50],[62,72,63,51],[63,2,64,0],[64,2,66,7],[64,11,66,16,"clearRemoteFeatures"],[64,30,66,35,"clearRemoteFeatures"],[64,31,66,35],[64,33,66,44],[65,4,67,2,"remoteVersion"],[65,17,67,15],[65,20,67,18],[65,24,67,22],[66,4,68,2,"remoteFlags"],[66,15,68,13],[66,18,68,16],[66,19,68,17],[66,20,68,18],[67,2,69,0],[68,2,71,7],[68,11,71,16,"getRemoteFeaturesSnapshot"],[68,36,71,41,"getRemoteFeaturesSnapshot"],[68,37,71,41],[68,39,74,2],[69,4,75,2],[69,11,75,9],[70,6,75,11,"version"],[70,13,75,18],[70,15,75,20,"remoteVersion"],[70,28,75,33],[71,6,75,35,"flags"],[71,11,75,40],[71,13,75,42,"remoteFlags"],[72,4,75,54],[72,5,75,55],[73,2,76,0],[75,2,78,0],[76,0,79,0],[77,0,80,0],[78,0,81,0],[80,2,84,7],[80,11,84,16,"isFeatureEnabled"],[80,27,84,32,"isFeatureEnabled"],[80,28,84,33,"flag"],[80,32,84,45],[80,34,84,47,"ctx"],[80,37,84,71],[80,39,84,82],[81,4,85,2],[82,4,86,2],[82,8,86,6,"__DEV__"],[82,15,86,13],[82,19,86,17,"Object"],[82,25,86,23],[82,26,86,24,"prototype"],[82,35,86,33],[82,36,86,34,"hasOwnProperty"],[82,50,86,48],[82,51,86,49,"call"],[82,55,86,53],[82,56,86,54,"devOverrides"],[82,68,86,66],[82,70,86,68,"flag"],[82,74,86,72],[82,75,86,73],[82,77,86,75],[83,6,87,4],[83,13,87,11],[83,14,87,12],[83,15,87,13,"devOverrides"],[83,27,87,25],[83,28,87,26,"flag"],[83,32,87,30],[83,33,87,31],[84,4,88,2],[86,4,90,2],[87,4,91,2],[87,10,91,8,"r"],[87,11,91,9],[87,14,91,12,"remoteFlags"],[87,25,91,23],[87,26,91,24,"flag"],[87,30,91,28],[87,31,91,29],[88,4,92,2],[88,8,92,6,"r"],[88,9,92,7],[88,11,92,9],[89,6,93,4],[89,10,93,8],[89,11,93,9,"r"],[89,12,93,10],[89,13,93,11,"enabled"],[89,20,93,18],[89,22,93,20],[89,29,93,27],[89,34,93,32],[90,6,94,4],[90,10,94,8],[90,17,94,15,"r"],[90,18,94,16],[90,19,94,17,"rollout"],[90,26,94,24],[90,31,94,29],[90,39,94,37],[90,41,94,39],[91,8,95,6],[91,14,95,12,"stableId"],[91,22,95,20],[91,25,95,23,"ctx"],[91,28,95,26],[91,30,95,28,"stableId"],[91,38,95,36],[92,8,96,6],[92,12,96,10],[92,13,96,11,"stableId"],[92,21,96,19],[92,23,96,21],[92,30,96,28],[92,34,96,32],[92,35,96,33],[92,36,96,34],[93,8,97,6],[93,14,97,12,"b"],[93,15,97,13],[93,18,97,16],[93,22,97,16,"bucket01"],[93,35,97,24],[93,36,97,24,"bucket01"],[93,44,97,24],[93,46,97,25],[93,49,97,28,"flag"],[93,53,97,32],[93,57,97,36,"stableId"],[93,65,97,44],[93,67,97,46],[93,68,97,47],[94,8,98,6],[94,15,98,13,"b"],[94,16,98,14],[94,19,98,17,"r"],[94,20,98,18],[94,21,98,19,"rollout"],[94,28,98,26],[95,6,99,4],[96,6,100,4],[96,13,100,11],[96,17,100,15],[97,4,101,2],[99,4,103,2],[100,4,104,2],[100,8,104,6,"Object"],[100,14,104,12],[100,15,104,13,"prototype"],[100,24,104,22],[100,25,104,23,"hasOwnProperty"],[100,39,104,37],[100,40,104,38,"call"],[100,44,104,42],[100,45,104,43,"DEFAULT_FLAGS"],[100,58,104,56],[100,60,104,58,"flag"],[100,64,104,62],[100,65,104,63],[100,67,104,65],[101,6,105,4],[101,13,105,11],[101,14,105,12],[101,15,105,14,"DEFAULT_FLAGS"],[101,28,105,27],[101,29,105,56,"flag"],[101,33,105,60],[101,34,105,61],[102,4,106,2],[104,4,108,2],[105,4,109,2],[105,11,109,9],[105,16,109,14],[106,2,110,0],[107,0,110,1],[107,3]],"functionMap":{"names":["<global>","setDevFeatureOverride","clearDevFeatureOverride","clearAllDevFeatureOverrides","setRemoteFeatures","clearRemoteFeatures","getRemoteFeaturesSnapshot","isFeatureEnabled"],"mappings":"AAA;OC0C;CDG;OEE;CFG;OGE;CHG;OIK;CJG;OKE;CLG;OME;CNK;OOQ;CP0B"},"hasCjsExports":false},"type":"js/module"}]}