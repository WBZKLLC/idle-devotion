{"dependencies":[{"name":"zustand","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":173},"end":{"line":5,"column":33,"index":206}}],"key":"POPvx7yS3Y3wz+S/9OAefiXNs0Q=","exportNames":["*"],"imports":1}},{"name":"../lib/telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":207},"end":{"line":6,"column":56,"index":263}}],"key":"j0wJDu3zbUGF7WArrpsULhFTytY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"usePurchaseStore\", {\n    enumerable: true,\n    get: function () {\n      return usePurchaseStore;\n    }\n  });\n  exports.generateIdempotencyKey = generateIdempotencyKey;\n  var _zustand = require(_dependencyMap[0], \"zustand\");\n  var _libTelemetryEvents = require(_dependencyMap[1], \"../lib/telemetry/events\");\n  // /app/frontend/stores/purchaseStore.ts\n  // Purchase State Machine - single source of truth for purchase flow\n  // NO ad-hoc flags in screens - all purchase state lives here\n\n  /**\n   * Purchase states - strict state machine\n   */\n\n  // Previously owned, now revoked\n\n  /**\n   * Purchase error types for consistent handling\n   */\n\n  var usePurchaseStore = (0, _zustand.create)((set, get) => ({\n    state: 'idle',\n    activeProductId: null,\n    activeIdempotencyKey: null,\n    error: null,\n    errorMessage: null,\n    viewPaywall: () => {\n      set({\n        state: 'paywall_viewed',\n        error: null,\n        errorMessage: null\n      });\n    },\n    startPurchase: (productId, idempotencyKey) => {\n      var current = get().state;\n\n      // Can only start from idle or paywall_viewed\n      if (current !== 'idle' && current !== 'paywall_viewed' && current !== 'purchase_failed' && current !== 'purchase_cancelled') {\n        console.warn(`[purchaseStore] Cannot start purchase in state: ${current}`);\n        return;\n      }\n      (0, _libTelemetryEvents.track)(_libTelemetryEvents.Events.PURCHASE_ATTEMPT, {\n        productId\n      });\n      set({\n        state: 'purchase_started',\n        activeProductId: productId,\n        activeIdempotencyKey: idempotencyKey,\n        error: null,\n        errorMessage: null\n      });\n    },\n    setPending: () => {\n      var current = get().state;\n      if (current !== 'purchase_started') {\n        console.warn(`[purchaseStore] Cannot set pending in state: ${current}`);\n        return;\n      }\n      set({\n        state: 'purchase_pending'\n      });\n    },\n    setVerified: () => {\n      var _get = get(),\n        activeProductId = _get.activeProductId;\n      (0, _libTelemetryEvents.track)(_libTelemetryEvents.Events.PURCHASE_SUCCESS, {\n        productId: activeProductId\n      });\n      set({\n        state: 'purchase_verified',\n        error: null,\n        errorMessage: null\n      });\n    },\n    setFailed: (error, message) => {\n      var _get2 = get(),\n        activeProductId = _get2.activeProductId;\n      (0, _libTelemetryEvents.track)(_libTelemetryEvents.Events.PURCHASE_FAILURE, {\n        productId: activeProductId,\n        error\n      });\n      set({\n        state: 'purchase_failed',\n        error,\n        errorMessage: message || getDefaultErrorMessage(error)\n      });\n    },\n    setCancelled: () => {\n      set({\n        state: 'purchase_cancelled',\n        error: 'CANCELLED',\n        errorMessage: null\n      });\n    },\n    reset: () => {\n      set({\n        state: 'idle',\n        activeProductId: null,\n        activeIdempotencyKey: null,\n        error: null,\n        errorMessage: null\n      });\n    },\n    isProcessing: () => {\n      var _get3 = get(),\n        state = _get3.state;\n      return state === 'purchase_started' || state === 'purchase_pending';\n    },\n    canStartPurchase: () => {\n      var _get4 = get(),\n        state = _get4.state;\n      return state === 'idle' || state === 'paywall_viewed' || state === 'purchase_failed' || state === 'purchase_cancelled';\n    }\n  }));\n  function getDefaultErrorMessage(error) {\n    switch (error) {\n      case 'CANCELLED':\n        return 'Purchase was cancelled';\n      case 'NETWORK_ERROR':\n        return 'Network error. Please check your connection and try again.';\n      case 'VERIFICATION_FAILED':\n        return 'Purchase verification failed. Please contact support if you were charged.';\n      case 'ALREADY_OWNED':\n        return 'You already own this item';\n      case 'NOT_AVAILABLE':\n        return 'This item is not available for purchase';\n      case 'INSUFFICIENT_FUNDS':\n        return 'Insufficient funds';\n      default:\n        return 'An unexpected error occurred. Please try again.';\n    }\n  }\n\n  /**\n   * Generate idempotency key for purchase\n   */\n  function generateIdempotencyKey() {\n    return `purchase_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;\n  }\n});","lineCount":149,"map":[[7,2,59,0,"Object"],[7,8,59,0],[7,9,59,0,"defineProperty"],[7,23,59,0],[7,24,59,0,"exports"],[7,31,59,0],[8,4,59,0,"enumerable"],[8,14,59,0],[9,4,59,0,"get"],[9,7,59,0],[9,18,59,0,"get"],[9,19,59,0],[10,6,59,0],[10,13,59,0,"usePurchaseStore"],[10,29,59,0],[11,4,59,0],[12,2,59,0],[13,2,174,0,"exports"],[13,9,174,0],[13,10,174,0,"generateIdempotencyKey"],[13,32,174,0],[13,35,174,0,"generateIdempotencyKey"],[13,57,174,0],[14,2,5,0],[14,6,5,0,"_zustand"],[14,14,5,0],[14,17,5,0,"require"],[14,24,5,0],[14,25,5,0,"_dependencyMap"],[14,39,5,0],[15,2,6,0],[15,6,6,0,"_libTelemetryEvents"],[15,25,6,0],[15,28,6,0,"require"],[15,35,6,0],[15,36,6,0,"_dependencyMap"],[15,50,6,0],[16,2,1,0],[17,2,2,0],[18,2,3,0],[20,2,8,0],[21,0,9,0],[22,0,10,0],[24,2,19,28],[26,2,21,0],[27,0,22,0],[28,0,23,0],[30,2,59,7],[30,6,59,13,"usePurchaseStore"],[30,22,59,29],[30,25,59,32],[30,29,59,32,"create"],[30,37,59,38],[30,38,59,38,"create"],[30,44,59,38],[30,46,59,59],[30,47,59,60,"set"],[30,50,59,63],[30,52,59,65,"get"],[30,55,59,68],[30,61,59,74],[31,4,60,2,"state"],[31,9,60,7],[31,11,60,9],[31,17,60,15],[32,4,61,2,"activeProductId"],[32,19,61,17],[32,21,61,19],[32,25,61,23],[33,4,62,2,"activeIdempotencyKey"],[33,24,62,22],[33,26,62,24],[33,30,62,28],[34,4,63,2,"error"],[34,9,63,7],[34,11,63,9],[34,15,63,13],[35,4,64,2,"errorMessage"],[35,16,64,14],[35,18,64,16],[35,22,64,20],[36,4,66,2,"viewPaywall"],[36,15,66,13],[36,17,66,15,"viewPaywall"],[36,18,66,15],[36,23,66,21],[37,6,67,4,"set"],[37,9,67,7],[37,10,67,8],[38,8,67,10,"state"],[38,13,67,15],[38,15,67,17],[38,31,67,33],[39,8,67,35,"error"],[39,13,67,40],[39,15,67,42],[39,19,67,46],[40,8,67,48,"errorMessage"],[40,20,67,60],[40,22,67,62],[41,6,67,67],[41,7,67,68],[41,8,67,69],[42,4,68,2],[42,5,68,3],[43,4,70,2,"startPurchase"],[43,17,70,15],[43,19,70,17,"startPurchase"],[43,20,70,18,"productId"],[43,29,70,35],[43,31,70,37,"idempotencyKey"],[43,45,70,59],[43,50,70,64],[44,6,71,4],[44,10,71,10,"current"],[44,17,71,17],[44,20,71,20,"get"],[44,23,71,23],[44,24,71,24],[44,25,71,25],[44,26,71,26,"state"],[44,31,71,31],[46,6,73,4],[47,6,74,4],[47,10,74,8,"current"],[47,17,74,15],[47,22,74,20],[47,28,74,26],[47,32,74,30,"current"],[47,39,74,37],[47,44,74,42],[47,60,74,58],[47,64,74,62,"current"],[47,71,74,69],[47,76,74,74],[47,93,74,91],[47,97,74,95,"current"],[47,104,74,102],[47,109,74,107],[47,129,74,127],[47,131,74,129],[48,8,75,6,"console"],[48,15,75,13],[48,16,75,14,"warn"],[48,20,75,18],[48,21,75,19],[48,72,75,70,"current"],[48,79,75,77],[48,81,75,79],[48,82,75,80],[49,8,76,6],[50,6,77,4],[51,6,79,4],[51,10,79,4,"track"],[51,29,79,9],[51,30,79,9,"track"],[51,35,79,9],[51,37,79,10,"Events"],[51,56,79,16],[51,57,79,16,"Events"],[51,63,79,16],[51,64,79,17,"PURCHASE_ATTEMPT"],[51,80,79,33],[51,82,79,35],[52,8,79,37,"productId"],[53,6,79,47],[53,7,79,48],[53,8,79,49],[54,6,81,4,"set"],[54,9,81,7],[54,10,81,8],[55,8,82,6,"state"],[55,13,82,11],[55,15,82,13],[55,33,82,31],[56,8,83,6,"activeProductId"],[56,23,83,21],[56,25,83,23,"productId"],[56,34,83,32],[57,8,84,6,"activeIdempotencyKey"],[57,28,84,26],[57,30,84,28,"idempotencyKey"],[57,44,84,42],[58,8,85,6,"error"],[58,13,85,11],[58,15,85,13],[58,19,85,17],[59,8,86,6,"errorMessage"],[59,20,86,18],[59,22,86,20],[60,6,87,4],[60,7,87,5],[60,8,87,6],[61,4,88,2],[61,5,88,3],[62,4,90,2,"setPending"],[62,14,90,12],[62,16,90,14,"setPending"],[62,17,90,14],[62,22,90,20],[63,6,91,4],[63,10,91,10,"current"],[63,17,91,17],[63,20,91,20,"get"],[63,23,91,23],[63,24,91,24],[63,25,91,25],[63,26,91,26,"state"],[63,31,91,31],[64,6,92,4],[64,10,92,8,"current"],[64,17,92,15],[64,22,92,20],[64,40,92,38],[64,42,92,40],[65,8,93,6,"console"],[65,15,93,13],[65,16,93,14,"warn"],[65,20,93,18],[65,21,93,19],[65,69,93,67,"current"],[65,76,93,74],[65,78,93,76],[65,79,93,77],[66,8,94,6],[67,6,95,4],[68,6,96,4,"set"],[68,9,96,7],[68,10,96,8],[69,8,96,10,"state"],[69,13,96,15],[69,15,96,17],[70,6,96,36],[70,7,96,37],[70,8,96,38],[71,4,97,2],[71,5,97,3],[72,4,99,2,"setVerified"],[72,15,99,13],[72,17,99,15,"setVerified"],[72,18,99,15],[72,23,99,21],[73,6,100,4],[73,10,100,4,"_get"],[73,14,100,4],[73,17,100,32,"get"],[73,20,100,35],[73,21,100,36],[73,22,100,37],[74,8,100,12,"activeProductId"],[74,23,100,27],[74,26,100,27,"_get"],[74,30,100,27],[74,31,100,12,"activeProductId"],[74,46,100,27],[75,6,102,4],[75,10,102,4,"track"],[75,29,102,9],[75,30,102,9,"track"],[75,35,102,9],[75,37,102,10,"Events"],[75,56,102,16],[75,57,102,16,"Events"],[75,63,102,16],[75,64,102,17,"PURCHASE_SUCCESS"],[75,80,102,33],[75,82,102,35],[76,8,102,37,"productId"],[76,17,102,46],[76,19,102,48,"activeProductId"],[77,6,102,64],[77,7,102,65],[77,8,102,66],[78,6,104,4,"set"],[78,9,104,7],[78,10,104,8],[79,8,105,6,"state"],[79,13,105,11],[79,15,105,13],[79,34,105,32],[80,8,106,6,"error"],[80,13,106,11],[80,15,106,13],[80,19,106,17],[81,8,107,6,"errorMessage"],[81,20,107,18],[81,22,107,20],[82,6,108,4],[82,7,108,5],[82,8,108,6],[83,4,109,2],[83,5,109,3],[84,4,111,2,"setFailed"],[84,13,111,11],[84,15,111,13,"setFailed"],[84,16,111,14,"error"],[84,21,111,34],[84,23,111,36,"message"],[84,30,111,52],[84,35,111,57],[85,6,112,4],[85,10,112,4,"_get2"],[85,15,112,4],[85,18,112,32,"get"],[85,21,112,35],[85,22,112,36],[85,23,112,37],[86,8,112,12,"activeProductId"],[86,23,112,27],[86,26,112,27,"_get2"],[86,31,112,27],[86,32,112,12,"activeProductId"],[86,47,112,27],[87,6,114,4],[87,10,114,4,"track"],[87,29,114,9],[87,30,114,9,"track"],[87,35,114,9],[87,37,114,10,"Events"],[87,56,114,16],[87,57,114,16,"Events"],[87,63,114,16],[87,64,114,17,"PURCHASE_FAILURE"],[87,80,114,33],[87,82,114,35],[88,8,114,37,"productId"],[88,17,114,46],[88,19,114,48,"activeProductId"],[88,34,114,63],[89,8,114,65,"error"],[90,6,114,71],[90,7,114,72],[90,8,114,73],[91,6,116,4,"set"],[91,9,116,7],[91,10,116,8],[92,8,117,6,"state"],[92,13,117,11],[92,15,117,13],[92,32,117,30],[93,8,118,6,"error"],[93,13,118,11],[94,8,119,6,"errorMessage"],[94,20,119,18],[94,22,119,20,"message"],[94,29,119,27],[94,33,119,31,"getDefaultErrorMessage"],[94,55,119,53],[94,56,119,54,"error"],[94,61,119,59],[95,6,120,4],[95,7,120,5],[95,8,120,6],[96,4,121,2],[96,5,121,3],[97,4,123,2,"setCancelled"],[97,16,123,14],[97,18,123,16,"setCancelled"],[97,19,123,16],[97,24,123,22],[98,6,124,4,"set"],[98,9,124,7],[98,10,124,8],[99,8,125,6,"state"],[99,13,125,11],[99,15,125,13],[99,35,125,33],[100,8,126,6,"error"],[100,13,126,11],[100,15,126,13],[100,26,126,24],[101,8,127,6,"errorMessage"],[101,20,127,18],[101,22,127,20],[102,6,128,4],[102,7,128,5],[102,8,128,6],[103,4,129,2],[103,5,129,3],[104,4,131,2,"reset"],[104,9,131,7],[104,11,131,9,"reset"],[104,12,131,9],[104,17,131,15],[105,6,132,4,"set"],[105,9,132,7],[105,10,132,8],[106,8,133,6,"state"],[106,13,133,11],[106,15,133,13],[106,21,133,19],[107,8,134,6,"activeProductId"],[107,23,134,21],[107,25,134,23],[107,29,134,27],[108,8,135,6,"activeIdempotencyKey"],[108,28,135,26],[108,30,135,28],[108,34,135,32],[109,8,136,6,"error"],[109,13,136,11],[109,15,136,13],[109,19,136,17],[110,8,137,6,"errorMessage"],[110,20,137,18],[110,22,137,20],[111,6,138,4],[111,7,138,5],[111,8,138,6],[112,4,139,2],[112,5,139,3],[113,4,141,2,"isProcessing"],[113,16,141,14],[113,18,141,16,"isProcessing"],[113,19,141,16],[113,24,141,22],[114,6,142,4],[114,10,142,4,"_get3"],[114,15,142,4],[114,18,142,22,"get"],[114,21,142,25],[114,22,142,26],[114,23,142,27],[115,8,142,12,"state"],[115,13,142,17],[115,16,142,17,"_get3"],[115,21,142,17],[115,22,142,12,"state"],[115,27,142,17],[116,6,143,4],[116,13,143,11,"state"],[116,18,143,16],[116,23,143,21],[116,41,143,39],[116,45,143,43,"state"],[116,50,143,48],[116,55,143,53],[116,73,143,71],[117,4,144,2],[117,5,144,3],[118,4,146,2,"canStartPurchase"],[118,20,146,18],[118,22,146,20,"canStartPurchase"],[118,23,146,20],[118,28,146,26],[119,6,147,4],[119,10,147,4,"_get4"],[119,15,147,4],[119,18,147,22,"get"],[119,21,147,25],[119,22,147,26],[119,23,147,27],[120,8,147,12,"state"],[120,13,147,17],[120,16,147,17,"_get4"],[120,21,147,17],[120,22,147,12,"state"],[120,27,147,17],[121,6,148,4],[121,13,148,11,"state"],[121,18,148,16],[121,23,148,21],[121,29,148,27],[121,33,148,31,"state"],[121,38,148,36],[121,43,148,41],[121,59,148,57],[121,63,148,61,"state"],[121,68,148,66],[121,73,148,71],[121,90,148,88],[121,94,148,92,"state"],[121,99,148,97],[121,104,148,102],[121,124,148,122],[122,4,149,2],[123,2,150,0],[123,3,150,1],[123,4,150,2],[123,5,150,3],[124,2,152,0],[124,11,152,9,"getDefaultErrorMessage"],[124,33,152,31,"getDefaultErrorMessage"],[124,34,152,32,"error"],[124,39,152,52],[124,41,152,62],[125,4,153,2],[125,12,153,10,"error"],[125,17,153,15],[126,6,154,4],[126,11,154,9],[126,22,154,20],[127,8,155,6],[127,15,155,13],[127,39,155,37],[128,6,156,4],[128,11,156,9],[128,26,156,24],[129,8,157,6],[129,15,157,13],[129,75,157,73],[130,6,158,4],[130,11,158,9],[130,32,158,30],[131,8,159,6],[131,15,159,13],[131,90,159,88],[132,6,160,4],[132,11,160,9],[132,26,160,24],[133,8,161,6],[133,15,161,13],[133,42,161,40],[134,6,162,4],[134,11,162,9],[134,26,162,24],[135,8,163,6],[135,15,163,13],[135,56,163,54],[136,6,164,4],[136,11,164,9],[136,31,164,29],[137,8,165,6],[137,15,165,13],[137,35,165,33],[138,6,166,4],[139,8,167,6],[139,15,167,13],[139,64,167,62],[140,4,168,2],[141,2,169,0],[143,2,171,0],[144,0,172,0],[145,0,173,0],[146,2,174,7],[146,11,174,16,"generateIdempotencyKey"],[146,33,174,38,"generateIdempotencyKey"],[146,34,174,38],[146,36,174,49],[147,4,175,2],[147,11,175,9],[147,23,175,21,"Date"],[147,27,175,25],[147,28,175,26,"now"],[147,31,175,29],[147,32,175,30],[147,33,175,31],[147,37,175,35,"Math"],[147,41,175,39],[147,42,175,40,"random"],[147,48,175,46],[147,49,175,47],[147,50,175,48],[147,51,175,49,"toString"],[147,59,175,57],[147,60,175,58],[147,62,175,60],[147,63,175,61],[147,64,175,62,"substring"],[147,73,175,71],[147,74,175,72],[147,75,175,73],[147,77,175,75],[147,79,175,77],[147,80,175,78],[147,82,175,80],[148,2,176,0],[149,0,176,1],[149,3]],"functionMap":{"names":["<global>","create$argument_0","viewPaywall","startPurchase","setPending","setVerified","setFailed","setCancelled","reset","isProcessing","canStartPurchase","getDefaultErrorMessage","generateIdempotencyKey"],"mappings":"AAA;2DC0D;eCO;GDE;iBEE;GFkB;cGE;GHO;eIE;GJU;aKE;GLU;gBME;GNM;SOE;GPQ;gBQE;GRG;oBSE;GTG;EDC;AWE;CXiB;OYK;CZE"},"hasCjsExports":false},"type":"js/module"}]}