{"dependencies":[{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":16,"index":80},"end":{"line":3,"column":40,"index":104}}],"key":"ud8OE6Lg8Q81+bS6ynZj2uyMPdA=","exportNames":["*"],"imports":1}},{"name":"./hubextensions.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":22,"index":128},"end":{"line":4,"column":51,"index":157}}],"key":"7HjDwovq+/jLcBJGE1VlN+5bInU=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":14,"index":173},"end":{"line":5,"column":35,"index":194}}],"key":"v6h+l9IeOWbEcXdtKQqd2f4now4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  const utils$1 = require(_dependencyMap[0], \"@sentry/utils\");\n  const hubextensions = require(_dependencyMap[1], \"./hubextensions.js\");\n  const utils = require(_dependencyMap[2], \"./utils.js\");\n\n  /**\n   * Browser profiling integration. Stores any event that has contexts[\"profile\"][\"profile_id\"]\n   * This exists because we do not want to await async profiler.stop calls as transaction.finish is called\n   * in a synchronous context. Instead, we handle sending the profile async from the promise callback and\n   * rely on being able to pull the event from the cache when we need to construct the envelope. This makes the\n   * integration less reliable as we might be dropping profiles when the cache is full.\n   *\n   * @experimental\n   */\n  class BrowserProfilingIntegration {\n    static __initStatic() {\n      this.id = 'BrowserProfilingIntegration';\n    }\n    constructor() {\n      this.name = BrowserProfilingIntegration.id;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    setupOnce(_addGlobalEventProcessor, getCurrentHub) {\n      this.getCurrentHub = getCurrentHub;\n      const hub = this.getCurrentHub();\n      const client = hub.getClient();\n      const scope = hub.getScope();\n      const transaction = scope.getTransaction();\n      if (transaction && utils.isAutomatedPageLoadTransaction(transaction)) {\n        if (utils.shouldProfileTransaction(transaction)) {\n          hubextensions.startProfileForTransaction(transaction);\n        }\n      }\n      if (client && typeof client.on === 'function') {\n        client.on('startTransaction', transaction => {\n          if (utils.shouldProfileTransaction(transaction)) {\n            hubextensions.startProfileForTransaction(transaction);\n          }\n        });\n        client.on('beforeEnvelope', envelope => {\n          // if not profiles are in queue, there is nothing to add to the envelope.\n          if (!utils.getActiveProfilesCount()) {\n            return;\n          }\n          const profiledTransactionEvents = utils.findProfiledTransactionsFromEnvelope(envelope);\n          if (!profiledTransactionEvents.length) {\n            return;\n          }\n          const profilesToAddToEnvelope = [];\n          for (const profiledTransaction of profiledTransactionEvents) {\n            const context = profiledTransaction && profiledTransaction.contexts;\n            const profile_id = context && context['profile'] && context['profile']['profile_id'];\n            const start_timestamp = context && context['profile'] && context['profile']['start_timestamp'];\n            if (typeof profile_id !== 'string') {\n              (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && utils$1.logger.log('[Profiling] cannot find profile for a transaction without a profile context');\n              continue;\n            }\n            if (!profile_id) {\n              (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && utils$1.logger.log('[Profiling] cannot find profile for a transaction without a profile context');\n              continue;\n            }\n\n            // Remove the profile from the transaction context before sending, relay will take care of the rest.\n            if (context && context['profile']) {\n              delete context.profile;\n            }\n            const profile = utils.takeProfileFromGlobalCache(profile_id);\n            if (!profile) {\n              (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && utils$1.logger.log(`[Profiling] Could not retrieve profile for transaction: ${profile_id}`);\n              continue;\n            }\n            const profileEvent = utils.createProfilingEvent(profile_id, start_timestamp, profile, profiledTransaction);\n            if (profileEvent) {\n              profilesToAddToEnvelope.push(profileEvent);\n            }\n          }\n          utils.addProfilesToEnvelope(envelope, profilesToAddToEnvelope);\n        });\n      } else {\n        utils$1.logger.warn('[Profiling] Client does not support hooks, profiling will be disabled');\n      }\n    }\n  }\n  BrowserProfilingIntegration.__initStatic();\n  exports.BrowserProfilingIntegration = BrowserProfilingIntegration;\n});","lineCount":92,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,8,3,6,"utils$1"],[5,15,3,13],[5,18,3,16,"require"],[5,25,3,23],[5,26,3,23,"_dependencyMap"],[5,40,3,23],[5,60,3,39],[5,61,3,40],[6,2,4,0],[6,8,4,6,"hubextensions"],[6,21,4,19],[6,24,4,22,"require"],[6,31,4,29],[6,32,4,29,"_dependencyMap"],[6,46,4,29],[6,71,4,50],[6,72,4,51],[7,2,5,0],[7,8,5,6,"utils"],[7,13,5,11],[7,16,5,14,"require"],[7,23,5,21],[7,24,5,21,"_dependencyMap"],[7,38,5,21],[7,55,5,34],[7,56,5,35],[9,2,7,0],[10,0,8,0],[11,0,9,0],[12,0,10,0],[13,0,11,0],[14,0,12,0],[15,0,13,0],[16,0,14,0],[17,0,15,0],[18,2,16,0],[18,8,16,6,"BrowserProfilingIntegration"],[18,35,16,33],[18,36,16,35],[19,4,17,3],[19,11,17,10,"__initStatic"],[19,23,17,22,"__initStatic"],[19,24,17,22],[19,26,17,25],[20,6,17,26],[20,10,17,30],[20,11,17,31,"id"],[20,13,17,33],[20,16,17,36],[20,45,17,65],[21,4,17,66],[22,4,19,3,"constructor"],[22,15,19,14,"constructor"],[22,16,19,14],[22,18,19,17],[23,6,20,4],[23,10,20,8],[23,11,20,9,"name"],[23,15,20,13],[23,18,20,16,"BrowserProfilingIntegration"],[23,45,20,43],[23,46,20,44,"id"],[23,48,20,46],[24,4,21,2],[26,4,23,2],[27,0,24,0],[28,0,25,0],[29,4,26,3,"setupOnce"],[29,13,26,12,"setupOnce"],[29,14,26,13,"_addGlobalEventProcessor"],[29,38,26,37],[29,40,26,39,"getCurrentHub"],[29,53,26,52],[29,55,26,54],[30,6,27,4],[30,10,27,8],[30,11,27,9,"getCurrentHub"],[30,24,27,22],[30,27,27,25,"getCurrentHub"],[30,40,27,38],[31,6,29,4],[31,12,29,10,"hub"],[31,15,29,13],[31,18,29,16],[31,22,29,20],[31,23,29,21,"getCurrentHub"],[31,36,29,34],[31,37,29,35],[31,38,29,36],[32,6,30,4],[32,12,30,10,"client"],[32,18,30,16],[32,21,30,19,"hub"],[32,24,30,22],[32,25,30,23,"getClient"],[32,34,30,32],[32,35,30,33],[32,36,30,34],[33,6,31,4],[33,12,31,10,"scope"],[33,17,31,15],[33,20,31,18,"hub"],[33,23,31,21],[33,24,31,22,"getScope"],[33,32,31,30],[33,33,31,31],[33,34,31,32],[34,6,33,4],[34,12,33,10,"transaction"],[34,23,33,21],[34,26,33,24,"scope"],[34,31,33,29],[34,32,33,30,"getTransaction"],[34,46,33,44],[34,47,33,45],[34,48,33,46],[35,6,35,4],[35,10,35,8,"transaction"],[35,21,35,19],[35,25,35,23,"utils"],[35,30,35,28],[35,31,35,29,"isAutomatedPageLoadTransaction"],[35,61,35,59],[35,62,35,60,"transaction"],[35,73,35,71],[35,74,35,72],[35,76,35,74],[36,8,36,6],[36,12,36,10,"utils"],[36,17,36,15],[36,18,36,16,"shouldProfileTransaction"],[36,42,36,40],[36,43,36,41,"transaction"],[36,54,36,52],[36,55,36,53],[36,57,36,55],[37,10,37,8,"hubextensions"],[37,23,37,21],[37,24,37,22,"startProfileForTransaction"],[37,50,37,48],[37,51,37,49,"transaction"],[37,62,37,60],[37,63,37,61],[38,8,38,6],[39,6,39,4],[40,6,41,4],[40,10,41,8,"client"],[40,16,41,14],[40,20,41,18],[40,27,41,25,"client"],[40,33,41,31],[40,34,41,32,"on"],[40,36,41,34],[40,41,41,39],[40,51,41,49],[40,53,41,51],[41,8,42,6,"client"],[41,14,42,12],[41,15,42,13,"on"],[41,17,42,15],[41,18,42,16],[41,36,42,34],[41,38,42,37,"transaction"],[41,49,42,48],[41,53,42,53],[42,10,43,8],[42,14,43,12,"utils"],[42,19,43,17],[42,20,43,18,"shouldProfileTransaction"],[42,44,43,42],[42,45,43,43,"transaction"],[42,56,43,54],[42,57,43,55],[42,59,43,57],[43,12,44,10,"hubextensions"],[43,25,44,23],[43,26,44,24,"startProfileForTransaction"],[43,52,44,50],[43,53,44,51,"transaction"],[43,64,44,62],[43,65,44,63],[44,10,45,8],[45,8,46,6],[45,9,46,7],[45,10,46,8],[46,8,48,6,"client"],[46,14,48,12],[46,15,48,13,"on"],[46,17,48,15],[46,18,48,16],[46,34,48,32],[46,36,48,35,"envelope"],[46,44,48,43],[46,48,48,48],[47,10,49,8],[48,10,50,8],[48,14,50,12],[48,15,50,13,"utils"],[48,20,50,18],[48,21,50,19,"getActiveProfilesCount"],[48,43,50,41],[48,44,50,42],[48,45,50,43],[48,47,50,45],[49,12,51,10],[50,10,52,8],[51,10,54,8],[51,16,54,14,"profiledTransactionEvents"],[51,41,54,39],[51,44,54,42,"utils"],[51,49,54,47],[51,50,54,48,"findProfiledTransactionsFromEnvelope"],[51,86,54,84],[51,87,54,85,"envelope"],[51,95,54,93],[51,96,54,94],[52,10,55,8],[52,14,55,12],[52,15,55,13,"profiledTransactionEvents"],[52,40,55,38],[52,41,55,39,"length"],[52,47,55,45],[52,49,55,47],[53,12,56,10],[54,10,57,8],[55,10,59,8],[55,16,59,14,"profilesToAddToEnvelope"],[55,39,59,37],[55,42,59,40],[55,44,59,42],[56,10,61,8],[56,15,61,13],[56,21,61,19,"profiledTransaction"],[56,40,61,38],[56,44,61,42,"profiledTransactionEvents"],[56,69,61,67],[56,71,61,69],[57,12,62,10],[57,18,62,16,"context"],[57,25,62,23],[57,28,62,26,"profiledTransaction"],[57,47,62,45],[57,51,62,49,"profiledTransaction"],[57,70,62,68],[57,71,62,69,"contexts"],[57,79,62,77],[58,12,63,10],[58,18,63,16,"profile_id"],[58,28,63,26],[58,31,63,29,"context"],[58,38,63,36],[58,42,63,40,"context"],[58,49,63,47],[58,50,63,48],[58,59,63,57],[58,60,63,58],[58,64,63,62,"context"],[58,71,63,69],[58,72,63,70],[58,81,63,79],[58,82,63,80],[58,83,63,81],[58,95,63,93],[58,96,63,94],[59,12,64,10],[59,18,64,16,"start_timestamp"],[59,33,64,31],[59,36,64,34,"context"],[59,43,64,41],[59,47,64,45,"context"],[59,54,64,52],[59,55,64,53],[59,64,64,62],[59,65,64,63],[59,69,64,67,"context"],[59,76,64,74],[59,77,64,75],[59,86,64,84],[59,87,64,85],[59,88,64,86],[59,105,64,103],[59,106,64,104],[60,12,66,10],[60,16,66,14],[60,23,66,21,"profile_id"],[60,33,66,31],[60,38,66,36],[60,46,66,44],[60,48,66,46],[61,14,67,12],[61,15,67,13],[61,22,67,20,"__SENTRY_DEBUG__"],[61,38,67,36],[61,43,67,41],[61,54,67,52],[61,58,67,56,"__SENTRY_DEBUG__"],[61,74,67,72],[61,79,68,14,"utils$1"],[61,86,68,21],[61,87,68,22,"logger"],[61,93,68,28],[61,94,68,29,"log"],[61,97,68,32],[61,98,68,33],[61,175,68,110],[61,176,68,111],[62,14,69,12],[63,12,70,10],[64,12,72,10],[64,16,72,14],[64,17,72,15,"profile_id"],[64,27,72,25],[64,29,72,27],[65,14,73,12],[65,15,73,13],[65,22,73,20,"__SENTRY_DEBUG__"],[65,38,73,36],[65,43,73,41],[65,54,73,52],[65,58,73,56,"__SENTRY_DEBUG__"],[65,74,73,72],[65,79,74,14,"utils$1"],[65,86,74,21],[65,87,74,22,"logger"],[65,93,74,28],[65,94,74,29,"log"],[65,97,74,32],[65,98,74,33],[65,175,74,110],[65,176,74,111],[66,14,75,12],[67,12,76,10],[69,12,78,10],[70,12,79,10],[70,16,79,14,"context"],[70,23,79,21],[70,27,79,25,"context"],[70,34,79,32],[70,35,79,33],[70,44,79,42],[70,45,79,43],[70,47,79,45],[71,14,80,12],[71,21,80,19,"context"],[71,28,80,26],[71,29,80,27,"profile"],[71,36,80,34],[72,12,81,10],[73,12,83,10],[73,18,83,16,"profile"],[73,25,83,23],[73,28,83,26,"utils"],[73,33,83,31],[73,34,83,32,"takeProfileFromGlobalCache"],[73,60,83,58],[73,61,83,59,"profile_id"],[73,71,83,69],[73,72,83,70],[74,12,84,10],[74,16,84,14],[74,17,84,15,"profile"],[74,24,84,22],[74,26,84,24],[75,14,85,12],[75,15,85,13],[75,22,85,20,"__SENTRY_DEBUG__"],[75,38,85,36],[75,43,85,41],[75,54,85,52],[75,58,85,56,"__SENTRY_DEBUG__"],[75,74,85,72],[75,79,85,77,"utils$1"],[75,86,85,84],[75,87,85,85,"logger"],[75,93,85,91],[75,94,85,92,"log"],[75,97,85,95],[75,98,85,96],[75,157,85,155,"profile_id"],[75,167,85,165],[75,169,85,167],[75,170,85,168],[76,14,86,12],[77,12,87,10],[78,12,89,10],[78,18,89,16,"profileEvent"],[78,30,89,28],[78,33,89,31,"utils"],[78,38,89,36],[78,39,89,37,"createProfilingEvent"],[78,59,89,57],[78,60,90,12,"profile_id"],[78,70,90,22],[78,72,91,12,"start_timestamp"],[78,87,91,27],[78,89,92,12,"profile"],[78,96,92,19],[78,98,93,12,"profiledTransaction"],[78,117,94,10],[78,118,94,11],[79,12,95,10],[79,16,95,14,"profileEvent"],[79,28,95,26],[79,30,95,28],[80,14,96,12,"profilesToAddToEnvelope"],[80,37,96,35],[80,38,96,36,"push"],[80,42,96,40],[80,43,96,41,"profileEvent"],[80,55,96,53],[80,56,96,54],[81,12,97,10],[82,10,98,8],[83,10,100,8,"utils"],[83,15,100,13],[83,16,100,14,"addProfilesToEnvelope"],[83,37,100,35],[83,38,100,36,"envelope"],[83,46,100,44],[83,48,100,46,"profilesToAddToEnvelope"],[83,71,100,69],[83,72,100,70],[84,8,101,6],[84,9,101,7],[84,10,101,8],[85,6,102,4],[85,7,102,5],[85,13,102,11],[86,8,103,6,"utils$1"],[86,15,103,13],[86,16,103,14,"logger"],[86,22,103,20],[86,23,103,21,"warn"],[86,27,103,25],[86,28,103,26],[86,99,103,97],[86,100,103,98],[87,6,104,4],[88,4,105,2],[89,2,106,0],[90,2,106,2,"BrowserProfilingIntegration"],[90,29,106,29],[90,30,106,30,"__initStatic"],[90,42,106,42],[90,43,106,43],[90,44,106,44],[91,2,108,0,"exports"],[91,9,108,7],[91,10,108,8,"BrowserProfilingIntegration"],[91,37,108,35],[91,40,108,38,"BrowserProfilingIntegration"],[91,67,108,65],[92,0,108,66],[92,3]],"functionMap":{"names":["<global>","BrowserProfilingIntegration","BrowserProfilingIntegration.__initStatic","BrowserProfilingIntegration#constructor","BrowserProfilingIntegration#setupOnce","client.on$argument_1"],"mappings":"AAA;ACe;GCC,gED;GEE;GFE;GGK;oCCgB;ODI;kCCE;ODqD;GHI;CDC"},"hasCjsExports":true},"type":"js/module"}]}