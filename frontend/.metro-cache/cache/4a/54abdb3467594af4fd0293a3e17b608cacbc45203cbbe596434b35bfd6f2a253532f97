{"dependencies":[{"name":"../authStorage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":243},"end":{"line":8,"column":47,"index":290}}],"key":"8h7N/7sKemAZqrgZg8dH/jTl5ys=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getFriendsSummary = getFriendsSummary;\n  exports.getFriendsList = getFriendsList;\n  exports.getFriendRequests = getFriendRequests;\n  exports.acceptFriendRequest = acceptFriendRequest;\n  exports.declineFriendRequest = declineFriendRequest;\n  exports.searchPlayers = searchPlayers;\n  exports.sendFriendRequest = sendFriendRequest;\n  var _authStorage = require(_dependencyMap[0], \"../authStorage\");\n  // /app/frontend/lib/api/friends.ts\n  // Phase 3.23.2.P: Friends API Layer with Auth\n  //\n  // Canonical API calls for friends system.\n  // Uses auth token from gameStore for server identity.\n  // Graceful error handling â€” returns defaults on failure.\n\n  const API_BASE = process.env.EXPO_PUBLIC_API_URL || '';\n\n  /**\n   * Get auth headers for API calls\n   */\n  async function getAuthHeaders() {\n    const token = await (0, _authStorage.loadAuthToken)();\n    if (token) {\n      return {\n        Authorization: `Bearer ${token}`\n      };\n    }\n    return {};\n  }\n\n  /**\n   * Get friends summary (badge counts) - uses auth token\n   */\n  async function getFriendsSummary(username) {\n    try {\n      const headers = await getAuthHeaders();\n      // Use legacy route for compatibility, but server uses auth token for identity\n      const res = await fetch(`${API_BASE}/api/friends/summary/${username}`, {\n        headers\n      });\n      if (res.status === 401) {\n        return {\n          pendingRequests: 0,\n          totalFriends: 0\n        };\n      }\n      if (!res.ok) throw new Error('Failed to fetch friends summary');\n      return await res.json();\n    } catch {\n      return {\n        pendingRequests: 0,\n        totalFriends: 0\n      };\n    }\n  }\n\n  /**\n   * Get friends list\n   */\n  async function getFriendsList(username) {\n    try {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`${API_BASE}/api/friends/list/${username}`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch friends list');\n      const data = await res.json();\n      // Transform backend response to frontend format\n      return data.map(f => ({\n        id: f.friend_id || f.id,\n        username: f.friend_username || f.username,\n        lastOnline: f.last_collected ? 'Earlier today' : 'Yesterday',\n        status: 'offline',\n        affinity: f.can_collect ? 50 : undefined\n      }));\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Get friend requests\n   */\n  async function getFriendRequests(username) {\n    try {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`${API_BASE}/api/friends/requests/${username}`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch friend requests');\n      const data = await res.json();\n      // Transform to frontend format\n      return data.map(r => ({\n        id: r.id,\n        fromUsername: r.from_username,\n        timestamp: 'Just now'\n      }));\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Accept friend request (idempotent)\n   */\n  async function acceptFriendRequest(username, requestId) {\n    const headers = await getAuthHeaders();\n    const res = await fetch(`${API_BASE}/api/friends/requests/${username}/${requestId}/accept`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) throw new Error('Failed to accept request');\n    return await res.json();\n  }\n\n  /**\n   * Decline friend request (idempotent)\n   */\n  async function declineFriendRequest(username, requestId) {\n    const headers = await getAuthHeaders();\n    const res = await fetch(`${API_BASE}/api/friends/requests/${username}/${requestId}/decline`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) throw new Error('Failed to decline request');\n    return await res.json();\n  }\n\n  /**\n   * Search for players (auth required, min 3 chars)\n   */\n  async function searchPlayers(query, username) {\n    // Client-side validation - min 3 chars\n    if (!query || query.length < 3) return [];\n    try {\n      const headers = await getAuthHeaders();\n      const params = new URLSearchParams({\n        q: query\n      });\n      const res = await fetch(`${API_BASE}/api/friends/search?${params}`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to search players');\n      return await res.json();\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Send friend request (auth required)\n   */\n  async function sendFriendRequest(fromUsername, toUsername) {\n    const headers = await getAuthHeaders();\n    const res = await fetch(`${API_BASE}/api/friends/requests/send`, {\n      method: 'POST',\n      headers: {\n        ...headers,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        to: toUsername\n      })\n    });\n    if (!res.ok) throw new Error('Failed to send request');\n  }\n});","lineCount":173,"map":[[7,2,26,0,"exports"],[7,9,26,0],[7,10,26,0,"getFriendsSummary"],[7,27,26,0],[7,30,26,0,"getFriendsSummary"],[7,47,26,0],[8,2,47,0,"exports"],[8,9,47,0],[8,10,47,0,"getFriendsList"],[8,24,47,0],[8,27,47,0,"getFriendsList"],[8,41,47,0],[9,2,75,0,"exports"],[9,9,75,0],[9,10,75,0,"getFriendRequests"],[9,27,75,0],[9,30,75,0,"getFriendRequests"],[9,47,75,0],[10,2,99,0,"exports"],[10,9,99,0],[10,10,99,0,"acceptFriendRequest"],[10,29,99,0],[10,32,99,0,"acceptFriendRequest"],[10,51,99,0],[11,2,112,0,"exports"],[11,9,112,0],[11,10,112,0,"declineFriendRequest"],[11,30,112,0],[11,33,112,0,"declineFriendRequest"],[11,53,112,0],[12,2,125,0,"exports"],[12,9,125,0],[12,10,125,0,"searchPlayers"],[12,23,125,0],[12,26,125,0,"searchPlayers"],[12,39,125,0],[13,2,150,0,"exports"],[13,9,150,0],[13,10,150,0,"sendFriendRequest"],[13,27,150,0],[13,30,150,0,"sendFriendRequest"],[13,47,150,0],[14,2,8,0],[14,6,8,0,"_authStorage"],[14,18,8,0],[14,21,8,0,"require"],[14,28,8,0],[14,29,8,0,"_dependencyMap"],[14,43,8,0],[15,2,1,0],[16,2,2,0],[17,2,3,0],[18,2,4,0],[19,2,5,0],[20,2,6,0],[22,2,10,0],[22,8,10,6,"API_BASE"],[22,16,10,14],[22,19,10,17,"process"],[22,26,10,24],[22,27,10,25,"env"],[22,30,10,28],[22,31,10,29,"EXPO_PUBLIC_API_URL"],[22,50,10,48],[22,54,10,52],[22,56,10,54],[24,2,12,0],[25,0,13,0],[26,0,14,0],[27,2,15,0],[27,17,15,15,"getAuthHeaders"],[27,31,15,29,"getAuthHeaders"],[27,32,15,29],[27,34,15,65],[28,4,16,2],[28,10,16,8,"token"],[28,15,16,13],[28,18,16,16],[28,24,16,22],[28,28,16,22,"loadAuthToken"],[28,40,16,35],[28,41,16,35,"loadAuthToken"],[28,54,16,35],[28,56,16,36],[28,57,16,37],[29,4,17,2],[29,8,17,6,"token"],[29,13,17,11],[29,15,17,13],[30,6,18,4],[30,13,18,11],[31,8,18,13,"Authorization"],[31,21,18,26],[31,23,18,28],[31,33,18,38,"token"],[31,38,18,43],[32,6,18,46],[32,7,18,47],[33,4,19,2],[34,4,20,2],[34,11,20,9],[34,12,20,10],[34,13,20,11],[35,2,21,0],[37,2,23,0],[38,0,24,0],[39,0,25,0],[40,2,26,7],[40,17,26,22,"getFriendsSummary"],[40,34,26,39,"getFriendsSummary"],[40,35,26,40,"username"],[40,43,26,56],[40,45,29,3],[41,4,30,2],[41,8,30,6],[42,6,31,4],[42,12,31,10,"headers"],[42,19,31,17],[42,22,31,20],[42,28,31,26,"getAuthHeaders"],[42,42,31,40],[42,43,31,41],[42,44,31,42],[43,6,32,4],[44,6,33,4],[44,12,33,10,"res"],[44,15,33,13],[44,18,33,16],[44,24,33,22,"fetch"],[44,29,33,27],[44,30,33,28],[44,33,33,31,"API_BASE"],[44,41,33,39],[44,65,33,63,"username"],[44,73,33,71],[44,75,33,73],[44,77,33,75],[45,8,33,77,"headers"],[46,6,33,85],[46,7,33,86],[46,8,33,87],[47,6,34,4],[47,10,34,8,"res"],[47,13,34,11],[47,14,34,12,"status"],[47,20,34,18],[47,25,34,23],[47,28,34,26],[47,30,34,28],[48,8,35,6],[48,15,35,13],[49,10,35,15,"pendingRequests"],[49,25,35,30],[49,27,35,32],[49,28,35,33],[50,10,35,35,"totalFriends"],[50,22,35,47],[50,24,35,49],[51,8,35,51],[51,9,35,52],[52,6,36,4],[53,6,37,4],[53,10,37,8],[53,11,37,9,"res"],[53,14,37,12],[53,15,37,13,"ok"],[53,17,37,15],[53,19,37,17],[53,25,37,23],[53,29,37,27,"Error"],[53,34,37,32],[53,35,37,33],[53,68,37,66],[53,69,37,67],[54,6,38,4],[54,13,38,11],[54,19,38,17,"res"],[54,22,38,20],[54,23,38,21,"json"],[54,27,38,25],[54,28,38,26],[54,29,38,27],[55,4,39,2],[55,5,39,3],[55,6,39,4],[55,12,39,10],[56,6,40,4],[56,13,40,11],[57,8,40,13,"pendingRequests"],[57,23,40,28],[57,25,40,30],[57,26,40,31],[58,8,40,33,"totalFriends"],[58,20,40,45],[58,22,40,47],[59,6,40,49],[59,7,40,50],[60,4,41,2],[61,2,42,0],[63,2,44,0],[64,0,45,0],[65,0,46,0],[66,2,47,7],[66,17,47,22,"getFriendsList"],[66,31,47,36,"getFriendsList"],[66,32,47,37,"username"],[66,40,47,53],[66,42,53,4],[67,4,54,2],[67,8,54,6],[68,6,55,4],[68,12,55,10,"headers"],[68,19,55,17],[68,22,55,20],[68,28,55,26,"getAuthHeaders"],[68,42,55,40],[68,43,55,41],[68,44,55,42],[69,6,56,4],[69,12,56,10,"res"],[69,15,56,13],[69,18,56,16],[69,24,56,22,"fetch"],[69,29,56,27],[69,30,56,28],[69,33,56,31,"API_BASE"],[69,41,56,39],[69,62,56,60,"username"],[69,70,56,68],[69,72,56,70],[69,74,56,72],[70,8,56,74,"headers"],[71,6,56,82],[71,7,56,83],[71,8,56,84],[72,6,57,4],[72,10,57,8],[72,11,57,9,"res"],[72,14,57,12],[72,15,57,13,"ok"],[72,17,57,15],[72,19,57,17],[72,25,57,23],[72,29,57,27,"Error"],[72,34,57,32],[72,35,57,33],[72,65,57,63],[72,66,57,64],[73,6,58,4],[73,12,58,10,"data"],[73,16,58,14],[73,19,58,17],[73,25,58,23,"res"],[73,28,58,26],[73,29,58,27,"json"],[73,33,58,31],[73,34,58,32],[73,35,58,33],[74,6,59,4],[75,6,60,4],[75,13,60,11,"data"],[75,17,60,15],[75,18,60,16,"map"],[75,21,60,19],[75,22,60,21,"f"],[75,23,60,27],[75,28,60,33],[76,8,61,6,"id"],[76,10,61,8],[76,12,61,10,"f"],[76,13,61,11],[76,14,61,12,"friend_id"],[76,23,61,21],[76,27,61,25,"f"],[76,28,61,26],[76,29,61,27,"id"],[76,31,61,29],[77,8,62,6,"username"],[77,16,62,14],[77,18,62,16,"f"],[77,19,62,17],[77,20,62,18,"friend_username"],[77,35,62,33],[77,39,62,37,"f"],[77,40,62,38],[77,41,62,39,"username"],[77,49,62,47],[78,8,63,6,"lastOnline"],[78,18,63,16],[78,20,63,18,"f"],[78,21,63,19],[78,22,63,20,"last_collected"],[78,36,63,34],[78,39,63,37],[78,54,63,52],[78,57,63,55],[78,68,63,66],[79,8,64,6,"status"],[79,14,64,12],[79,16,64,14],[79,25,64,32],[80,8,65,6,"affinity"],[80,16,65,14],[80,18,65,16,"f"],[80,19,65,17],[80,20,65,18,"can_collect"],[80,31,65,29],[80,34,65,32],[80,36,65,34],[80,39,65,37,"undefined"],[81,6,66,4],[81,7,66,5],[81,8,66,6],[81,9,66,7],[82,4,67,2],[82,5,67,3],[82,6,67,4],[82,12,67,10],[83,6,68,4],[83,13,68,11],[83,15,68,13],[84,4,69,2],[85,2,70,0],[87,2,72,0],[88,0,73,0],[89,0,74,0],[90,2,75,7],[90,17,75,22,"getFriendRequests"],[90,34,75,39,"getFriendRequests"],[90,35,75,40,"username"],[90,43,75,56],[90,45,79,4],[91,4,80,2],[91,8,80,6],[92,6,81,4],[92,12,81,10,"headers"],[92,19,81,17],[92,22,81,20],[92,28,81,26,"getAuthHeaders"],[92,42,81,40],[92,43,81,41],[92,44,81,42],[93,6,82,4],[93,12,82,10,"res"],[93,15,82,13],[93,18,82,16],[93,24,82,22,"fetch"],[93,29,82,27],[93,30,82,28],[93,33,82,31,"API_BASE"],[93,41,82,39],[93,66,82,64,"username"],[93,74,82,72],[93,76,82,74],[93,78,82,76],[94,8,82,78,"headers"],[95,6,82,86],[95,7,82,87],[95,8,82,88],[96,6,83,4],[96,10,83,8],[96,11,83,9,"res"],[96,14,83,12],[96,15,83,13,"ok"],[96,17,83,15],[96,19,83,17],[96,25,83,23],[96,29,83,27,"Error"],[96,34,83,32],[96,35,83,33],[96,68,83,66],[96,69,83,67],[97,6,84,4],[97,12,84,10,"data"],[97,16,84,14],[97,19,84,17],[97,25,84,23,"res"],[97,28,84,26],[97,29,84,27,"json"],[97,33,84,31],[97,34,84,32],[97,35,84,33],[98,6,85,4],[99,6,86,4],[99,13,86,11,"data"],[99,17,86,15],[99,18,86,16,"map"],[99,21,86,19],[99,22,86,21,"r"],[99,23,86,27],[99,28,86,33],[100,8,87,6,"id"],[100,10,87,8],[100,12,87,10,"r"],[100,13,87,11],[100,14,87,12,"id"],[100,16,87,14],[101,8,88,6,"fromUsername"],[101,20,88,18],[101,22,88,20,"r"],[101,23,88,21],[101,24,88,22,"from_username"],[101,37,88,35],[102,8,89,6,"timestamp"],[102,17,89,15],[102,19,89,17],[103,6,90,4],[103,7,90,5],[103,8,90,6],[103,9,90,7],[104,4,91,2],[104,5,91,3],[104,6,91,4],[104,12,91,10],[105,6,92,4],[105,13,92,11],[105,15,92,13],[106,4,93,2],[107,2,94,0],[109,2,96,0],[110,0,97,0],[111,0,98,0],[112,2,99,7],[112,17,99,22,"acceptFriendRequest"],[112,36,99,41,"acceptFriendRequest"],[112,37,99,42,"username"],[112,45,99,58],[112,47,99,60,"requestId"],[112,56,99,77],[112,58,99,119],[113,4,100,2],[113,10,100,8,"headers"],[113,17,100,15],[113,20,100,18],[113,26,100,24,"getAuthHeaders"],[113,40,100,38],[113,41,100,39],[113,42,100,40],[114,4,101,2],[114,10,101,8,"res"],[114,13,101,11],[114,16,101,14],[114,22,101,20,"fetch"],[114,27,101,25],[114,28,101,26],[114,31,101,29,"API_BASE"],[114,39,101,37],[114,64,101,62,"username"],[114,72,101,70],[114,76,101,74,"requestId"],[114,85,101,83],[114,94,101,92],[114,96,101,94],[115,6,102,4,"method"],[115,12,102,10],[115,14,102,12],[115,20,102,18],[116,6,103,4,"headers"],[117,4,104,2],[117,5,104,3],[117,6,104,4],[118,4,105,2],[118,8,105,6],[118,9,105,7,"res"],[118,12,105,10],[118,13,105,11,"ok"],[118,15,105,13],[118,17,105,15],[118,23,105,21],[118,27,105,25,"Error"],[118,32,105,30],[118,33,105,31],[118,59,105,57],[118,60,105,58],[119,4,106,2],[119,11,106,9],[119,17,106,15,"res"],[119,20,106,18],[119,21,106,19,"json"],[119,25,106,23],[119,26,106,24],[119,27,106,25],[120,2,107,0],[122,2,109,0],[123,0,110,0],[124,0,111,0],[125,2,112,7],[125,17,112,22,"declineFriendRequest"],[125,37,112,42,"declineFriendRequest"],[125,38,112,43,"username"],[125,46,112,59],[125,48,112,61,"requestId"],[125,57,112,78],[125,59,112,120],[126,4,113,2],[126,10,113,8,"headers"],[126,17,113,15],[126,20,113,18],[126,26,113,24,"getAuthHeaders"],[126,40,113,38],[126,41,113,39],[126,42,113,40],[127,4,114,2],[127,10,114,8,"res"],[127,13,114,11],[127,16,114,14],[127,22,114,20,"fetch"],[127,27,114,25],[127,28,114,26],[127,31,114,29,"API_BASE"],[127,39,114,37],[127,64,114,62,"username"],[127,72,114,70],[127,76,114,74,"requestId"],[127,85,114,83],[127,95,114,93],[127,97,114,95],[128,6,115,4,"method"],[128,12,115,10],[128,14,115,12],[128,20,115,18],[129,6,116,4,"headers"],[130,4,117,2],[130,5,117,3],[130,6,117,4],[131,4,118,2],[131,8,118,6],[131,9,118,7,"res"],[131,12,118,10],[131,13,118,11,"ok"],[131,15,118,13],[131,17,118,15],[131,23,118,21],[131,27,118,25,"Error"],[131,32,118,30],[131,33,118,31],[131,60,118,58],[131,61,118,59],[132,4,119,2],[132,11,119,9],[132,17,119,15,"res"],[132,20,119,18],[132,21,119,19,"json"],[132,25,119,23],[132,26,119,24],[132,27,119,25],[133,2,120,0],[135,2,122,0],[136,0,123,0],[137,0,124,0],[138,2,125,7],[138,17,125,22,"searchPlayers"],[138,30,125,35,"searchPlayers"],[138,31,125,36,"query"],[138,36,125,49],[138,38,125,51,"username"],[138,46,125,68],[138,48,131,4],[139,4,132,2],[140,4,133,2],[140,8,133,6],[140,9,133,7,"query"],[140,14,133,12],[140,18,133,16,"query"],[140,23,133,21],[140,24,133,22,"length"],[140,30,133,28],[140,33,133,31],[140,34,133,32],[140,36,133,34],[140,43,133,41],[140,45,133,43],[141,4,135,2],[141,8,135,6],[142,6,136,4],[142,12,136,10,"headers"],[142,19,136,17],[142,22,136,20],[142,28,136,26,"getAuthHeaders"],[142,42,136,40],[142,43,136,41],[142,44,136,42],[143,6,137,4],[143,12,137,10,"params"],[143,18,137,16],[143,21,137,19],[143,25,137,23,"URLSearchParams"],[143,40,137,38],[143,41,137,39],[144,8,137,41,"q"],[144,9,137,42],[144,11,137,44,"query"],[145,6,137,50],[145,7,137,51],[145,8,137,52],[146,6,139,4],[146,12,139,10,"res"],[146,15,139,13],[146,18,139,16],[146,24,139,22,"fetch"],[146,29,139,27],[146,30,139,28],[146,33,139,31,"API_BASE"],[146,41,139,39],[146,64,139,62,"params"],[146,70,139,68],[146,72,139,70],[146,74,139,72],[147,8,139,74,"headers"],[148,6,139,82],[148,7,139,83],[148,8,139,84],[149,6,140,4],[149,10,140,8],[149,11,140,9,"res"],[149,14,140,12],[149,15,140,13,"ok"],[149,17,140,15],[149,19,140,17],[149,25,140,23],[149,29,140,27,"Error"],[149,34,140,32],[149,35,140,33],[149,61,140,59],[149,62,140,60],[150,6,141,4],[150,13,141,11],[150,19,141,17,"res"],[150,22,141,20],[150,23,141,21,"json"],[150,27,141,25],[150,28,141,26],[150,29,141,27],[151,4,142,2],[151,5,142,3],[151,6,142,4],[151,12,142,10],[152,6,143,4],[152,13,143,11],[152,15,143,13],[153,4,144,2],[154,2,145,0],[156,2,147,0],[157,0,148,0],[158,0,149,0],[159,2,150,7],[159,17,150,22,"sendFriendRequest"],[159,34,150,39,"sendFriendRequest"],[159,35,150,40,"fromUsername"],[159,47,150,60],[159,49,150,62,"toUsername"],[159,59,150,80],[159,61,150,97],[160,4,151,2],[160,10,151,8,"headers"],[160,17,151,15],[160,20,151,18],[160,26,151,24,"getAuthHeaders"],[160,40,151,38],[160,41,151,39],[160,42,151,40],[161,4,152,2],[161,10,152,8,"res"],[161,13,152,11],[161,16,152,14],[161,22,152,20,"fetch"],[161,27,152,25],[161,28,152,26],[161,31,152,29,"API_BASE"],[161,39,152,37],[161,67,152,65],[161,69,152,67],[162,6,153,4,"method"],[162,12,153,10],[162,14,153,12],[162,20,153,18],[163,6,154,4,"headers"],[163,13,154,11],[163,15,154,13],[164,8,155,6],[164,11,155,9,"headers"],[164,18,155,16],[165,8,156,6],[165,22,156,20],[165,24,156,22],[166,6,157,4],[166,7,157,5],[167,6,158,4,"body"],[167,10,158,8],[167,12,158,10,"JSON"],[167,16,158,14],[167,17,158,15,"stringify"],[167,26,158,24],[167,27,158,25],[168,8,158,27,"to"],[168,10,158,29],[168,12,158,31,"toUsername"],[169,6,158,42],[169,7,158,43],[170,4,159,2],[170,5,159,3],[170,6,159,4],[171,4,160,2],[171,8,160,6],[171,9,160,7,"res"],[171,12,160,10],[171,13,160,11,"ok"],[171,15,160,13],[171,17,160,15],[171,23,160,21],[171,27,160,25,"Error"],[171,32,160,30],[171,33,160,31],[171,57,160,55],[171,58,160,56],[172,2,161,0],[173,0,161,1],[173,3]],"functionMap":{"names":["<global>","getAuthHeaders","getFriendsSummary","getFriendsList","data.map$argument_0","getFriendRequests","acceptFriendRequest","declineFriendRequest","searchPlayers","sendFriendRequest"],"mappings":"AAA;ACc;CDM;OEK;CFgB;OGK;oBCa;MDM;CHI;OKK;oBDW;MCI;CLI;OMK;CNQ;OOK;CPQ;OQK;CRoB;OSK;CTW"},"hasCjsExports":false},"type":"js/module"}]}