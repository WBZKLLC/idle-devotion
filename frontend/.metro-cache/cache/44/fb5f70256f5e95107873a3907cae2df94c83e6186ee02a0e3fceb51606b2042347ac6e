{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.isValidReceipt = isValidReceipt;\n  exports.isValidGachaReceipt = isValidGachaReceipt;\n  exports.assertValidReceipt = assertValidReceipt;\n  exports.getReceiptItemCount = getReceiptItemCount;\n  exports.formatReceiptItems = formatReceiptItems;\n  // /app/frontend/lib/types/receipt.ts\n  // Phase 3.24: Canonical Reward Receipt Type\n  // Phase 3.26: Added mail_receipt_claim source\n  // Phase 3.33: Added gacha summon sources\n  //\n  // Single source of truth for receipt shape.\n  // All reward-granting endpoints return this shape.\n  // Frontend MUST use this type for all receipt handling.\n  //\n  // LOCKED source values:\n  // - bond_tribute\n  // - mail_reward_claim\n  // - mail_gift_claim\n  // - mail_receipt_claim (Phase 3.26)\n  // - daily_login_claim\n  // - idle_claim\n  // - admin_grant\n  // - summon_single (Phase 3.33)\n  // - summon_multi (Phase 3.33)\n  // - pity_reward (Phase 3.33)\n\n  /**\n   * Valid reward source types (matches backend RewardSource)\n   */\n\n  // Phase 3.42: RevenueCat IAP\n\n  /**\n   * Single reward item in a receipt\n   */\n\n  /**\n   * Phase 3.33: Gacha pull result item\n   */\n\n  /**\n   * Phase 3.33: Gacha summon receipt (extends canonical receipt)\n   */\n\n  /**\n   * User balance snapshot\n   */\n\n  /**\n   * Canonical receipt shape for all reward grants (Phase 3.24)\n   * \n   * REQUIRED fields: source, sourceId, items, balances\n   * All reward endpoints MUST return this shape.\n   */\n\n  /**\n   * Type guard: Check if an object is a valid RewardReceipt\n   */\n  function isValidReceipt(obj) {\n    if (!obj || typeof obj !== 'object') return false;\n    const receipt = obj;\n    return typeof receipt.source === 'string' && typeof receipt.sourceId === 'string' && Array.isArray(receipt.items) && typeof receipt.balances === 'object' && receipt.balances !== null;\n  }\n\n  /**\n   * Type guard: Check if an object is a valid GachaReceipt\n   */\n  function isValidGachaReceipt(obj) {\n    if (!isValidReceipt(obj)) return false;\n    const receipt = obj;\n    return (receipt.source === 'summon_single' || receipt.source === 'summon_multi' || receipt.source === 'pity_reward') && typeof receipt.bannerId === 'string' && typeof receipt.pullCount === 'number' && Array.isArray(receipt.results);\n  }\n\n  /**\n   * Validate and assert receipt shape (throws if invalid)\n   */\n  function assertValidReceipt(obj, context) {\n    if (!isValidReceipt(obj)) {\n      const msg = `Invalid receipt shape${context ? ` in ${context}` : ''}: ` + `missing source, sourceId, items, or balances`;\n      console.error('[RECEIPT_GUARD_FAILED]', msg, obj);\n      throw new Error(msg);\n    }\n  }\n\n  /**\n   * Extract total reward count from receipt\n   */\n  function getReceiptItemCount(receipt) {\n    return receipt.items.reduce((sum, item) => sum + item.amount, 0);\n  }\n\n  /**\n   * Format reward items for display\n   */\n  function formatReceiptItems(receipt) {\n    if (receipt.items.length === 0) {\n      return receipt.alreadyClaimed ? 'Already claimed' : 'No rewards';\n    }\n    return receipt.items.filter(item => item.amount > 0).map(item => `${item.amount.toLocaleString()} ${formatRewardType(item.type)}`).join(', ');\n  }\n\n  /**\n   * Format reward type for display\n   */\n  function formatRewardType(type) {\n    const typeMap = {\n      gold: 'Gold',\n      coins: 'Coins',\n      gems: 'Gems',\n      divine_gems: 'Divine Gems',\n      crystals: 'Crystals',\n      stamina: 'Stamina',\n      divine_essence: 'Divine Essence',\n      soul_dust: 'Soul Dust',\n      skill_essence: 'Skill Essence',\n      enhancement_stones: 'Enhancement Stones',\n      hero_shards: 'Hero Shards',\n      rune_essence: 'Rune Essence',\n      hero_unlock: 'Hero Unlock',\n      hero_shard: 'Hero Shards'\n    };\n    return typeMap[type] || type.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\n  }\n});","lineCount":130,"map":[[7,2,131,0,"exports"],[7,9,131,0],[7,10,131,0,"isValidReceipt"],[7,24,131,0],[7,27,131,0,"isValidReceipt"],[7,41,131,0],[8,2,147,0,"exports"],[8,9,147,0],[8,10,147,0,"isValidGachaReceipt"],[8,29,147,0],[8,32,147,0,"isValidGachaReceipt"],[8,51,147,0],[9,2,162,0,"exports"],[9,9,162,0],[9,10,162,0,"assertValidReceipt"],[9,28,162,0],[9,31,162,0,"assertValidReceipt"],[9,49,162,0],[10,2,174,0,"exports"],[10,9,174,0],[10,10,174,0,"getReceiptItemCount"],[10,29,174,0],[10,32,174,0,"getReceiptItemCount"],[10,51,174,0],[11,2,181,0,"exports"],[11,9,181,0],[11,10,181,0,"formatReceiptItems"],[11,28,181,0],[11,31,181,0,"formatReceiptItems"],[11,49,181,0],[12,2,1,0],[13,2,2,0],[14,2,3,0],[15,2,4,0],[16,2,5,0],[17,2,6,0],[18,2,7,0],[19,2,8,0],[20,2,9,0],[21,2,10,0],[22,2,11,0],[23,2,12,0],[24,2,13,0],[25,2,14,0],[26,2,15,0],[27,2,16,0],[28,2,17,0],[29,2,18,0],[30,2,19,0],[31,2,20,0],[33,2,22,0],[34,0,23,0],[35,0,24,0],[37,2,41,21],[39,2,43,0],[40,0,44,0],[41,0,45,0],[43,2,55,0],[44,0,56,0],[45,0,57,0],[47,2,73,0],[48,0,74,0],[49,0,75,0],[51,2,94,0],[52,0,95,0],[53,0,96,0],[55,2,113,0],[56,0,114,0],[57,0,115,0],[58,0,116,0],[59,0,117,0],[60,0,118,0],[62,2,128,0],[63,0,129,0],[64,0,130,0],[65,2,131,7],[65,11,131,16,"isValidReceipt"],[65,25,131,30,"isValidReceipt"],[65,26,131,31,"obj"],[65,29,131,43],[65,31,131,67],[66,4,132,2],[66,8,132,6],[66,9,132,7,"obj"],[66,12,132,10],[66,16,132,14],[66,23,132,21,"obj"],[66,26,132,24],[66,31,132,29],[66,39,132,37],[66,41,132,39],[66,48,132,46],[66,53,132,51],[67,4,133,2],[67,10,133,8,"receipt"],[67,17,133,15],[67,20,133,18,"obj"],[67,23,133,48],[68,4,135,2],[68,11,136,4],[68,18,136,11,"receipt"],[68,25,136,18],[68,26,136,19,"source"],[68,32,136,25],[68,37,136,30],[68,45,136,38],[68,49,137,4],[68,56,137,11,"receipt"],[68,63,137,18],[68,64,137,19,"sourceId"],[68,72,137,27],[68,77,137,32],[68,85,137,40],[68,89,138,4,"Array"],[68,94,138,9],[68,95,138,10,"isArray"],[68,102,138,17],[68,103,138,18,"receipt"],[68,110,138,25],[68,111,138,26,"items"],[68,116,138,31],[68,117,138,32],[68,121,139,4],[68,128,139,11,"receipt"],[68,135,139,18],[68,136,139,19,"balances"],[68,144,139,27],[68,149,139,32],[68,157,139,40],[68,161,140,4,"receipt"],[68,168,140,11],[68,169,140,12,"balances"],[68,177,140,20],[68,182,140,25],[68,186,140,29],[69,2,142,0],[71,2,144,0],[72,0,145,0],[73,0,146,0],[74,2,147,7],[74,11,147,16,"isValidGachaReceipt"],[74,30,147,35,"isValidGachaReceipt"],[74,31,147,36,"obj"],[74,34,147,48],[74,36,147,71],[75,4,148,2],[75,8,148,6],[75,9,148,7,"isValidReceipt"],[75,23,148,21],[75,24,148,22,"obj"],[75,27,148,25],[75,28,148,26],[75,30,148,28],[75,37,148,35],[75,42,148,40],[76,4,149,2],[76,10,149,8,"receipt"],[76,17,149,15],[76,20,149,18,"obj"],[76,23,149,59],[77,4,151,2],[77,11,152,4],[77,12,152,5,"receipt"],[77,19,152,12],[77,20,152,13,"source"],[77,26,152,19],[77,31,152,24],[77,46,152,39],[77,50,152,43,"receipt"],[77,57,152,50],[77,58,152,51,"source"],[77,64,152,57],[77,69,152,62],[77,83,152,76],[77,87,152,80,"receipt"],[77,94,152,87],[77,95,152,88,"source"],[77,101,152,94],[77,106,152,99],[77,119,152,112],[77,124,153,4],[77,131,153,11,"receipt"],[77,138,153,18],[77,139,153,19,"bannerId"],[77,147,153,27],[77,152,153,32],[77,160,153,40],[77,164,154,4],[77,171,154,11,"receipt"],[77,178,154,18],[77,179,154,19,"pullCount"],[77,188,154,28],[77,193,154,33],[77,201,154,41],[77,205,155,4,"Array"],[77,210,155,9],[77,211,155,10,"isArray"],[77,218,155,17],[77,219,155,18,"receipt"],[77,226,155,25],[77,227,155,26,"results"],[77,234,155,33],[77,235,155,34],[78,2,157,0],[80,2,159,0],[81,0,160,0],[82,0,161,0],[83,2,162,7],[83,11,162,16,"assertValidReceipt"],[83,29,162,34,"assertValidReceipt"],[83,30,162,35,"obj"],[83,33,162,47],[83,35,162,49,"context"],[83,42,162,65],[83,44,162,97],[84,4,163,2],[84,8,163,6],[84,9,163,7,"isValidReceipt"],[84,23,163,21],[84,24,163,22,"obj"],[84,27,163,25],[84,28,163,26],[84,30,163,28],[85,6,164,4],[85,12,164,10,"msg"],[85,15,164,13],[85,18,164,16],[85,42,164,40,"context"],[85,49,164,47],[85,52,164,50],[85,59,164,57,"context"],[85,66,164,64],[85,68,164,66],[85,71,164,69],[85,73,164,71],[85,77,164,75],[85,80,165,6],[85,126,165,52],[86,6,166,4,"console"],[86,13,166,11],[86,14,166,12,"error"],[86,19,166,17],[86,20,166,18],[86,44,166,42],[86,46,166,44,"msg"],[86,49,166,47],[86,51,166,49,"obj"],[86,54,166,52],[86,55,166,53],[87,6,167,4],[87,12,167,10],[87,16,167,14,"Error"],[87,21,167,19],[87,22,167,20,"msg"],[87,25,167,23],[87,26,167,24],[88,4,168,2],[89,2,169,0],[91,2,171,0],[92,0,172,0],[93,0,173,0],[94,2,174,7],[94,11,174,16,"getReceiptItemCount"],[94,30,174,35,"getReceiptItemCount"],[94,31,174,36,"receipt"],[94,38,174,58],[94,40,174,68],[95,4,175,2],[95,11,175,9,"receipt"],[95,18,175,16],[95,19,175,17,"items"],[95,24,175,22],[95,25,175,23,"reduce"],[95,31,175,29],[95,32,175,30],[95,33,175,31,"sum"],[95,36,175,34],[95,38,175,36,"item"],[95,42,175,40],[95,47,175,45,"sum"],[95,50,175,48],[95,53,175,51,"item"],[95,57,175,55],[95,58,175,56,"amount"],[95,64,175,62],[95,66,175,64],[95,67,175,65],[95,68,175,66],[96,2,176,0],[98,2,178,0],[99,0,179,0],[100,0,180,0],[101,2,181,7],[101,11,181,16,"formatReceiptItems"],[101,29,181,34,"formatReceiptItems"],[101,30,181,35,"receipt"],[101,37,181,57],[101,39,181,67],[102,4,182,2],[102,8,182,6,"receipt"],[102,15,182,13],[102,16,182,14,"items"],[102,21,182,19],[102,22,182,20,"length"],[102,28,182,26],[102,33,182,31],[102,34,182,32],[102,36,182,34],[103,6,183,4],[103,13,183,11,"receipt"],[103,20,183,18],[103,21,183,19,"alreadyClaimed"],[103,35,183,33],[103,38,183,36],[103,55,183,53],[103,58,183,56],[103,70,183,68],[104,4,184,2],[105,4,186,2],[105,11,186,9,"receipt"],[105,18,186,16],[105,19,186,17,"items"],[105,24,186,22],[105,25,187,5,"filter"],[105,31,187,11],[105,32,187,12,"item"],[105,36,187,16],[105,40,187,20,"item"],[105,44,187,24],[105,45,187,25,"amount"],[105,51,187,31],[105,54,187,34],[105,55,187,35],[105,56,187,36],[105,57,188,5,"map"],[105,60,188,8],[105,61,188,9,"item"],[105,65,188,13],[105,69,188,17],[105,72,188,20,"item"],[105,76,188,24],[105,77,188,25,"amount"],[105,83,188,31],[105,84,188,32,"toLocaleString"],[105,98,188,46],[105,99,188,47],[105,100,188,48],[105,104,188,52,"formatRewardType"],[105,120,188,68],[105,121,188,69,"item"],[105,125,188,73],[105,126,188,74,"type"],[105,130,188,78],[105,131,188,79],[105,133,188,81],[105,134,188,82],[105,135,189,5,"join"],[105,139,189,9],[105,140,189,10],[105,144,189,14],[105,145,189,15],[106,2,190,0],[108,2,192,0],[109,0,193,0],[110,0,194,0],[111,2,195,0],[111,11,195,9,"formatRewardType"],[111,27,195,25,"formatRewardType"],[111,28,195,26,"type"],[111,32,195,38],[111,34,195,48],[112,4,196,2],[112,10,196,8,"typeMap"],[112,17,196,39],[112,20,196,42],[113,6,197,4,"gold"],[113,10,197,8],[113,12,197,10],[113,18,197,16],[114,6,198,4,"coins"],[114,11,198,9],[114,13,198,11],[114,20,198,18],[115,6,199,4,"gems"],[115,10,199,8],[115,12,199,10],[115,18,199,16],[116,6,200,4,"divine_gems"],[116,17,200,15],[116,19,200,17],[116,32,200,30],[117,6,201,4,"crystals"],[117,14,201,12],[117,16,201,14],[117,26,201,24],[118,6,202,4,"stamina"],[118,13,202,11],[118,15,202,13],[118,24,202,22],[119,6,203,4,"divine_essence"],[119,20,203,18],[119,22,203,20],[119,38,203,36],[120,6,204,4,"soul_dust"],[120,15,204,13],[120,17,204,15],[120,28,204,26],[121,6,205,4,"skill_essence"],[121,19,205,17],[121,21,205,19],[121,36,205,34],[122,6,206,4,"enhancement_stones"],[122,24,206,22],[122,26,206,24],[122,46,206,44],[123,6,207,4,"hero_shards"],[123,17,207,15],[123,19,207,17],[123,32,207,30],[124,6,208,4,"rune_essence"],[124,18,208,16],[124,20,208,18],[124,34,208,32],[125,6,209,4,"hero_unlock"],[125,17,209,15],[125,19,209,17],[125,32,209,30],[126,6,210,4,"hero_shard"],[126,16,210,14],[126,18,210,16],[127,4,211,2],[127,5,211,3],[128,4,213,2],[128,11,213,9,"typeMap"],[128,18,213,16],[128,19,213,17,"type"],[128,23,213,21],[128,24,213,22],[128,28,213,26,"type"],[128,32,213,30],[128,33,213,31,"replace"],[128,40,213,38],[128,41,213,39],[128,45,213,43],[128,47,213,45],[128,50,213,48],[128,51,213,49],[128,52,213,50,"replace"],[128,59,213,57],[128,60,213,58],[128,67,213,65],[128,69,213,67,"c"],[128,70,213,68],[128,74,213,72,"c"],[128,75,213,73],[128,76,213,74,"toUpperCase"],[128,87,213,85],[128,88,213,86],[128,89,213,87],[128,90,213,88],[129,2,214,0],[130,0,214,1],[130,3]],"functionMap":{"names":["<global>","isValidReceipt","isValidGachaReceipt","assertValidReceipt","getReceiptItemCount","items.reduce$argument_0","formatReceiptItems","items.filter$argument_0","items.filter.map$argument_0","formatRewardType","type.replace.replace$argument_1"],"mappings":"AAA;OCkI;CDW;OEK;CFU;OGK;CHO;OIK;8BCC,gCD;CJC;OMK;YCM,uBD;SEC,wEF;CNE;ASK;mECkB,oBD;CTC"},"hasCjsExports":false},"type":"js/module"}]}