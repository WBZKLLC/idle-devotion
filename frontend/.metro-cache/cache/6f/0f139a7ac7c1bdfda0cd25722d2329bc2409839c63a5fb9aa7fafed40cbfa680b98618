{"dependencies":[{"name":"./is.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":11,"index":75},"end":{"line":3,"column":29,"index":93}}],"key":"7L+qE4U1JkzGTtK8kDgvAl12vZ8=","exportNames":["*"],"imports":1}},{"name":"./string.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":15,"index":110},"end":{"line":4,"column":37,"index":132}}],"key":"tSXB7Kbh7swZWumhEmzaYOqkqug=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  var is = require(_dependencyMap[0], \"./is.js\");\n  var string = require(_dependencyMap[1], \"./string.js\");\n\n  /**\n   * Creates exceptions inside `event.exception.values` for errors that are nested on properties based on the `key` parameter.\n   */\n  function applyAggregateErrorsToEvent(exceptionFromErrorImplementation, parser) {\n    var maxValueLimit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 250;\n    var key = arguments.length > 3 ? arguments[3] : undefined;\n    var limit = arguments.length > 4 ? arguments[4] : undefined;\n    var event = arguments.length > 5 ? arguments[5] : undefined;\n    var hint = arguments.length > 6 ? arguments[6] : undefined;\n    if (!event.exception || !event.exception.values || !hint || !is.isInstanceOf(hint.originalException, Error)) {\n      return;\n    }\n\n    // Generally speaking the last item in `event.exception.values` is the exception originating from the original Error\n    var originalException = event.exception.values.length > 0 ? event.exception.values[event.exception.values.length - 1] : undefined;\n\n    // We only create exception grouping if there is an exception in the event.\n    if (originalException) {\n      event.exception.values = truncateAggregateExceptions(aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, hint.originalException, key, event.exception.values, originalException, 0), maxValueLimit);\n    }\n  }\n  function aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, error, key, prevExceptions, exception, exceptionId) {\n    if (prevExceptions.length >= limit + 1) {\n      return prevExceptions;\n    }\n    var newExceptions = [...prevExceptions];\n    if (is.isInstanceOf(error[key], Error)) {\n      applyExceptionGroupFieldsForParentException(exception, exceptionId);\n      var newException = exceptionFromErrorImplementation(parser, error[key]);\n      var newExceptionId = newExceptions.length;\n      applyExceptionGroupFieldsForChildException(newException, key, newExceptionId, exceptionId);\n      newExceptions = aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, error[key], key, [newException, ...newExceptions], newException, newExceptionId);\n    }\n\n    // This will create exception grouping for AggregateErrors\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AggregateError\n    if (Array.isArray(error.errors)) {\n      error.errors.forEach((childError, i) => {\n        if (is.isInstanceOf(childError, Error)) {\n          applyExceptionGroupFieldsForParentException(exception, exceptionId);\n          var _newException = exceptionFromErrorImplementation(parser, childError);\n          var _newExceptionId = newExceptions.length;\n          applyExceptionGroupFieldsForChildException(_newException, `errors[${i}]`, _newExceptionId, exceptionId);\n          newExceptions = aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, childError, key, [_newException, ...newExceptions], _newException, _newExceptionId);\n        }\n      });\n    }\n    return newExceptions;\n  }\n  function applyExceptionGroupFieldsForParentException(exception, exceptionId) {\n    // Don't know if this default makes sense. The protocol requires us to set these values so we pick *some* default.\n    exception.mechanism = exception.mechanism || {\n      type: 'generic',\n      handled: true\n    };\n    exception.mechanism = {\n      ...exception.mechanism,\n      is_exception_group: true,\n      exception_id: exceptionId\n    };\n  }\n  function applyExceptionGroupFieldsForChildException(exception, source, exceptionId, parentId) {\n    // Don't know if this default makes sense. The protocol requires us to set these values so we pick *some* default.\n    exception.mechanism = exception.mechanism || {\n      type: 'generic',\n      handled: true\n    };\n    exception.mechanism = {\n      ...exception.mechanism,\n      type: 'chained',\n      source,\n      exception_id: exceptionId,\n      parent_id: parentId\n    };\n  }\n\n  /**\n   * Truncate the message (exception.value) of all exceptions in the event.\n   * Because this event processor is ran after `applyClientOptions`,\n   * we need to truncate the message of the added exceptions here.\n   */\n  function truncateAggregateExceptions(exceptions, maxValueLength) {\n    return exceptions.map(exception => {\n      if (exception.value) {\n        exception.value = string.truncate(exception.value, maxValueLength);\n      }\n      return exception;\n    });\n  }\n  exports.applyAggregateErrorsToEvent = applyAggregateErrorsToEvent;\n});","lineCount":98,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,6,3,6,"is"],[5,8,3,8],[5,11,3,11,"require"],[5,18,3,18],[5,19,3,18,"_dependencyMap"],[5,33,3,18],[5,47,3,28],[5,48,3,29],[6,2,4,0],[6,6,4,6,"string"],[6,12,4,12],[6,15,4,15,"require"],[6,22,4,22],[6,23,4,22,"_dependencyMap"],[6,37,4,22],[6,55,4,36],[6,56,4,37],[8,2,6,0],[9,0,7,0],[10,0,8,0],[11,2,9,0],[11,11,9,9,"applyAggregateErrorsToEvent"],[11,38,9,36,"applyAggregateErrorsToEvent"],[11,39,10,2,"exceptionFromErrorImplementation"],[11,71,10,34],[11,73,11,2,"parser"],[11,79,11,8],[11,81,17,2],[12,4,17,2],[12,8,12,2,"maxValueLimit"],[12,21,12,15],[12,24,12,15,"arguments"],[12,33,12,15],[12,34,12,15,"length"],[12,40,12,15],[12,48,12,15,"arguments"],[12,57,12,15],[12,65,12,15,"undefined"],[12,74,12,15],[12,77,12,15,"arguments"],[12,86,12,15],[12,92,12,18],[12,95,12,21],[13,4,12,21],[13,8,13,2,"key"],[13,11,13,5],[13,14,13,5,"arguments"],[13,23,13,5],[13,24,13,5,"length"],[13,30,13,5],[13,37,13,5,"arguments"],[13,46,13,5],[13,52,13,5,"undefined"],[13,61,13,5],[14,4,13,5],[14,8,14,2,"limit"],[14,13,14,7],[14,16,14,7,"arguments"],[14,25,14,7],[14,26,14,7,"length"],[14,32,14,7],[14,39,14,7,"arguments"],[14,48,14,7],[14,54,14,7,"undefined"],[14,63,14,7],[15,4,14,7],[15,8,15,2,"event"],[15,13,15,7],[15,16,15,7,"arguments"],[15,25,15,7],[15,26,15,7,"length"],[15,32,15,7],[15,39,15,7,"arguments"],[15,48,15,7],[15,54,15,7,"undefined"],[15,63,15,7],[16,4,15,7],[16,8,16,2,"hint"],[16,12,16,6],[16,15,16,6,"arguments"],[16,24,16,6],[16,25,16,6,"length"],[16,31,16,6],[16,38,16,6,"arguments"],[16,47,16,6],[16,53,16,6,"undefined"],[16,62,16,6],[17,4,18,2],[17,8,18,6],[17,9,18,7,"event"],[17,14,18,12],[17,15,18,13,"exception"],[17,24,18,22],[17,28,18,26],[17,29,18,27,"event"],[17,34,18,32],[17,35,18,33,"exception"],[17,44,18,42],[17,45,18,43,"values"],[17,51,18,49],[17,55,18,53],[17,56,18,54,"hint"],[17,60,18,58],[17,64,18,62],[17,65,18,63,"is"],[17,67,18,65],[17,68,18,66,"isInstanceOf"],[17,80,18,78],[17,81,18,79,"hint"],[17,85,18,83],[17,86,18,84,"originalException"],[17,103,18,101],[17,105,18,103,"Error"],[17,110,18,108],[17,111,18,109],[17,113,18,111],[18,6,19,4],[19,4,20,2],[21,4,22,2],[22,4,23,2],[22,8,23,8,"originalException"],[22,25,23,25],[22,28,24,4,"event"],[22,33,24,9],[22,34,24,10,"exception"],[22,43,24,19],[22,44,24,20,"values"],[22,50,24,26],[22,51,24,27,"length"],[22,57,24,33],[22,60,24,36],[22,61,24,37],[22,64,24,40,"event"],[22,69,24,45],[22,70,24,46,"exception"],[22,79,24,55],[22,80,24,56,"values"],[22,86,24,62],[22,87,24,63,"event"],[22,92,24,68],[22,93,24,69,"exception"],[22,102,24,78],[22,103,24,79,"values"],[22,109,24,85],[22,110,24,86,"length"],[22,116,24,92],[22,119,24,95],[22,120,24,96],[22,121,24,97],[22,124,24,100,"undefined"],[22,133,24,109],[24,4,26,2],[25,4,27,2],[25,8,27,6,"originalException"],[25,25,27,23],[25,27,27,25],[26,6,28,4,"event"],[26,11,28,9],[26,12,28,10,"exception"],[26,21,28,19],[26,22,28,20,"values"],[26,28,28,26],[26,31,28,29,"truncateAggregateExceptions"],[26,58,28,56],[26,59,29,6,"aggregateExceptionsFromError"],[26,87,29,34],[26,88,30,8,"exceptionFromErrorImplementation"],[26,120,30,40],[26,122,31,8,"parser"],[26,128,31,14],[26,130,32,8,"limit"],[26,135,32,13],[26,137,33,8,"hint"],[26,141,33,12],[26,142,33,13,"originalException"],[26,159,33,30],[26,161,34,8,"key"],[26,164,34,11],[26,166,35,8,"event"],[26,171,35,13],[26,172,35,14,"exception"],[26,181,35,23],[26,182,35,24,"values"],[26,188,35,30],[26,190,36,8,"originalException"],[26,207,36,25],[26,209,37,8],[26,210,38,6],[26,211,38,7],[26,213,39,6,"maxValueLimit"],[26,226,40,4],[26,227,40,5],[27,4,41,2],[28,2,42,0],[29,2,44,0],[29,11,44,9,"aggregateExceptionsFromError"],[29,39,44,37,"aggregateExceptionsFromError"],[29,40,45,2,"exceptionFromErrorImplementation"],[29,72,45,34],[29,74,46,2,"parser"],[29,80,46,8],[29,82,47,2,"limit"],[29,87,47,7],[29,89,48,2,"error"],[29,94,48,7],[29,96,49,2,"key"],[29,99,49,5],[29,101,50,2,"prevExceptions"],[29,115,50,16],[29,117,51,2,"exception"],[29,126,51,11],[29,128,52,2,"exceptionId"],[29,139,52,13],[29,141,53,2],[30,4,54,2],[30,8,54,6,"prevExceptions"],[30,22,54,20],[30,23,54,21,"length"],[30,29,54,27],[30,33,54,31,"limit"],[30,38,54,36],[30,41,54,39],[30,42,54,40],[30,44,54,42],[31,6,55,4],[31,13,55,11,"prevExceptions"],[31,27,55,25],[32,4,56,2],[33,4,58,2],[33,8,58,6,"newExceptions"],[33,21,58,19],[33,24,58,22],[33,25,58,23],[33,28,58,26,"prevExceptions"],[33,42,58,40],[33,43,58,41],[34,4,60,2],[34,8,60,6,"is"],[34,10,60,8],[34,11,60,9,"isInstanceOf"],[34,23,60,21],[34,24,60,22,"error"],[34,29,60,27],[34,30,60,28,"key"],[34,33,60,31],[34,34,60,32],[34,36,60,34,"Error"],[34,41,60,39],[34,42,60,40],[34,44,60,42],[35,6,61,4,"applyExceptionGroupFieldsForParentException"],[35,49,61,47],[35,50,61,48,"exception"],[35,59,61,57],[35,61,61,59,"exceptionId"],[35,72,61,70],[35,73,61,71],[36,6,62,4],[36,10,62,10,"newException"],[36,22,62,22],[36,25,62,25,"exceptionFromErrorImplementation"],[36,57,62,57],[36,58,62,58,"parser"],[36,64,62,64],[36,66,62,66,"error"],[36,71,62,71],[36,72,62,72,"key"],[36,75,62,75],[36,76,62,76],[36,77,62,77],[37,6,63,4],[37,10,63,10,"newExceptionId"],[37,24,63,24],[37,27,63,27,"newExceptions"],[37,40,63,40],[37,41,63,41,"length"],[37,47,63,47],[38,6,64,4,"applyExceptionGroupFieldsForChildException"],[38,48,64,46],[38,49,64,47,"newException"],[38,61,64,59],[38,63,64,61,"key"],[38,66,64,64],[38,68,64,66,"newExceptionId"],[38,82,64,80],[38,84,64,82,"exceptionId"],[38,95,64,93],[38,96,64,94],[39,6,65,4,"newExceptions"],[39,19,65,17],[39,22,65,20,"aggregateExceptionsFromError"],[39,50,65,48],[39,51,66,6,"exceptionFromErrorImplementation"],[39,83,66,38],[39,85,67,6,"parser"],[39,91,67,12],[39,93,68,6,"limit"],[39,98,68,11],[39,100,69,6,"error"],[39,105,69,11],[39,106,69,12,"key"],[39,109,69,15],[39,110,69,16],[39,112,70,6,"key"],[39,115,70,9],[39,117,71,6],[39,118,71,7,"newException"],[39,130,71,19],[39,132,71,21],[39,135,71,24,"newExceptions"],[39,148,71,37],[39,149,71,38],[39,151,72,6,"newException"],[39,163,72,18],[39,165,73,6,"newExceptionId"],[39,179,74,4],[39,180,74,5],[40,4,75,2],[42,4,77,2],[43,4,78,2],[44,4,79,2],[44,8,79,6,"Array"],[44,13,79,11],[44,14,79,12,"isArray"],[44,21,79,19],[44,22,79,20,"error"],[44,27,79,25],[44,28,79,26,"errors"],[44,34,79,32],[44,35,79,33],[44,37,79,35],[45,6,80,4,"error"],[45,11,80,9],[45,12,80,10,"errors"],[45,18,80,16],[45,19,80,17,"forEach"],[45,26,80,24],[45,27,80,25],[45,28,80,26,"childError"],[45,38,80,36],[45,40,80,38,"i"],[45,41,80,39],[45,46,80,44],[46,8,81,6],[46,12,81,10,"is"],[46,14,81,12],[46,15,81,13,"isInstanceOf"],[46,27,81,25],[46,28,81,26,"childError"],[46,38,81,36],[46,40,81,38,"Error"],[46,45,81,43],[46,46,81,44],[46,48,81,46],[47,10,82,8,"applyExceptionGroupFieldsForParentException"],[47,53,82,51],[47,54,82,52,"exception"],[47,63,82,61],[47,65,82,63,"exceptionId"],[47,76,82,74],[47,77,82,75],[48,10,83,8],[48,14,83,14,"newException"],[48,27,83,26],[48,30,83,29,"exceptionFromErrorImplementation"],[48,62,83,61],[48,63,83,62,"parser"],[48,69,83,68],[48,71,83,70,"childError"],[48,81,83,80],[48,82,83,81],[49,10,84,8],[49,14,84,14,"newExceptionId"],[49,29,84,28],[49,32,84,31,"newExceptions"],[49,45,84,44],[49,46,84,45,"length"],[49,52,84,51],[50,10,85,8,"applyExceptionGroupFieldsForChildException"],[50,52,85,50],[50,53,85,51,"newException"],[50,66,85,63],[50,68,85,65],[50,78,85,75,"i"],[50,79,85,76],[50,82,85,79],[50,84,85,81,"newExceptionId"],[50,99,85,95],[50,101,85,97,"exceptionId"],[50,112,85,108],[50,113,85,109],[51,10,86,8,"newExceptions"],[51,23,86,21],[51,26,86,24,"aggregateExceptionsFromError"],[51,54,86,52],[51,55,87,10,"exceptionFromErrorImplementation"],[51,87,87,42],[51,89,88,10,"parser"],[51,95,88,16],[51,97,89,10,"limit"],[51,102,89,15],[51,104,90,10,"childError"],[51,114,90,20],[51,116,91,10,"key"],[51,119,91,13],[51,121,92,10],[51,122,92,11,"newException"],[51,135,92,23],[51,137,92,25],[51,140,92,28,"newExceptions"],[51,153,92,41],[51,154,92,42],[51,156,93,10,"newException"],[51,169,93,22],[51,171,94,10,"newExceptionId"],[51,186,95,8],[51,187,95,9],[52,8,96,6],[53,6,97,4],[53,7,97,5],[53,8,97,6],[54,4,98,2],[55,4,100,2],[55,11,100,9,"newExceptions"],[55,24,100,22],[56,2,101,0],[57,2,103,0],[57,11,103,9,"applyExceptionGroupFieldsForParentException"],[57,54,103,52,"applyExceptionGroupFieldsForParentException"],[57,55,103,53,"exception"],[57,64,103,62],[57,66,103,64,"exceptionId"],[57,77,103,75],[57,79,103,77],[58,4,104,2],[59,4,105,2,"exception"],[59,13,105,11],[59,14,105,12,"mechanism"],[59,23,105,21],[59,26,105,24,"exception"],[59,35,105,33],[59,36,105,34,"mechanism"],[59,45,105,43],[59,49,105,47],[60,6,105,49,"type"],[60,10,105,53],[60,12,105,55],[60,21,105,64],[61,6,105,66,"handled"],[61,13,105,73],[61,15,105,75],[62,4,105,80],[62,5,105,81],[63,4,107,2,"exception"],[63,13,107,11],[63,14,107,12,"mechanism"],[63,23,107,21],[63,26,107,24],[64,6,108,4],[64,9,108,7,"exception"],[64,18,108,16],[64,19,108,17,"mechanism"],[64,28,108,26],[65,6,109,4,"is_exception_group"],[65,24,109,22],[65,26,109,24],[65,30,109,28],[66,6,110,4,"exception_id"],[66,18,110,16],[66,20,110,18,"exceptionId"],[67,4,111,2],[67,5,111,3],[68,2,112,0],[69,2,114,0],[69,11,114,9,"applyExceptionGroupFieldsForChildException"],[69,53,114,51,"applyExceptionGroupFieldsForChildException"],[69,54,115,2,"exception"],[69,63,115,11],[69,65,116,2,"source"],[69,71,116,8],[69,73,117,2,"exceptionId"],[69,84,117,13],[69,86,118,2,"parentId"],[69,94,118,10],[69,96,119,2],[70,4,120,2],[71,4,121,2,"exception"],[71,13,121,11],[71,14,121,12,"mechanism"],[71,23,121,21],[71,26,121,24,"exception"],[71,35,121,33],[71,36,121,34,"mechanism"],[71,45,121,43],[71,49,121,47],[72,6,121,49,"type"],[72,10,121,53],[72,12,121,55],[72,21,121,64],[73,6,121,66,"handled"],[73,13,121,73],[73,15,121,75],[74,4,121,80],[74,5,121,81],[75,4,123,2,"exception"],[75,13,123,11],[75,14,123,12,"mechanism"],[75,23,123,21],[75,26,123,24],[76,6,124,4],[76,9,124,7,"exception"],[76,18,124,16],[76,19,124,17,"mechanism"],[76,28,124,26],[77,6,125,4,"type"],[77,10,125,8],[77,12,125,10],[77,21,125,19],[78,6,126,4,"source"],[78,12,126,10],[79,6,127,4,"exception_id"],[79,18,127,16],[79,20,127,18,"exceptionId"],[79,31,127,29],[80,6,128,4,"parent_id"],[80,15,128,13],[80,17,128,15,"parentId"],[81,4,129,2],[81,5,129,3],[82,2,130,0],[84,2,132,0],[85,0,133,0],[86,0,134,0],[87,0,135,0],[88,0,136,0],[89,2,137,0],[89,11,137,9,"truncateAggregateExceptions"],[89,38,137,36,"truncateAggregateExceptions"],[89,39,137,37,"exceptions"],[89,49,137,47],[89,51,137,49,"maxValueLength"],[89,65,137,63],[89,67,137,65],[90,4,138,2],[90,11,138,9,"exceptions"],[90,21,138,19],[90,22,138,20,"map"],[90,25,138,23],[90,26,138,24,"exception"],[90,35,138,33],[90,39,138,37],[91,6,139,4],[91,10,139,8,"exception"],[91,19,139,17],[91,20,139,18,"value"],[91,25,139,23],[91,27,139,25],[92,8,140,6,"exception"],[92,17,140,15],[92,18,140,16,"value"],[92,23,140,21],[92,26,140,24,"string"],[92,32,140,30],[92,33,140,31,"truncate"],[92,41,140,39],[92,42,140,40,"exception"],[92,51,140,49],[92,52,140,50,"value"],[92,57,140,55],[92,59,140,57,"maxValueLength"],[92,73,140,71],[92,74,140,72],[93,6,141,4],[94,6,142,4],[94,13,142,11,"exception"],[94,22,142,20],[95,4,143,2],[95,5,143,3],[95,6,143,4],[96,2,144,0],[97,2,146,0,"exports"],[97,9,146,7],[97,10,146,8,"applyAggregateErrorsToEvent"],[97,37,146,35],[97,40,146,38,"applyAggregateErrorsToEvent"],[97,67,146,65],[98,0,146,66],[98,3]],"functionMap":{"names":["<global>","applyAggregateErrorsToEvent","aggregateExceptionsFromError","error.errors.forEach$argument_0","applyExceptionGroupFieldsForParentException","applyExceptionGroupFieldsForChildException","truncateAggregateExceptions","exceptions.map$argument_0"],"mappings":"AAA;ACQ;CDiC;AEE;yBCoC;KDiB;CFI;AIE;CJS;AKE;CLgB;AMO;wBCC;GDK;CNC"},"hasCjsExports":true},"type":"js/module"}]}