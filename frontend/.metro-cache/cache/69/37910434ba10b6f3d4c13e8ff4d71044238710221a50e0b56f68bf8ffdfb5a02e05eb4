{"dependencies":[{"name":"./combatBonuses","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":13,"column":0,"index":419},"end":{"line":13,"column":76,"index":495}}],"key":"aNIGFi1xJSUR+87U6PdTo8zGYrM=","exportNames":["*"],"imports":1}},{"name":"./cinematicsAccess","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":496},"end":{"line":14,"column":59,"index":555}}],"key":"PaDawwzoTolULKHYkbZSbi1QB8Q=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.computeCombatStats = computeCombatStats;\n  exports.computeHeroPower = computeHeroPower;\n  exports.computePowerFromStats = computePowerFromStats;\n  var _combatBonuses = require(_dependencyMap[0], \"./combatBonuses\");\n  var _cinematicsAccess = require(_dependencyMap[1], \"./cinematicsAccess\");\n  /**\n   * Combat Stats - SINGLE SOURCE OF TRUTH\n   * \n   * This is the CANONICAL place where hero combat stats are computed for display.\n   * All UI screens MUST use this helper for HP/ATK/DEF/SPD display and power calculations.\n   * \n   * Applies all bonuses (currently: cinematic ownership).\n   * \n   * Later, when server-side verification is implemented, this logic can be\n   * mirrored on the backend for actual combat outcomes.\n   */\n\n  /**\n   * Clamp a number to integer within bounds\n   */\n  function clampInt(n, min, max) {\n    const x = Number.isFinite(Number(n)) ? Math.floor(Number(n)) : 0;\n    return Math.max(min, Math.min(max, x));\n  }\n\n  /**\n   * Combat stats structure returned by computeCombatStats\n   */\n\n  /**\n   * Extract hero ID from various hero object formats\n   */\n  function extractHeroId(hero) {\n    // Try various common field names\n    return String(hero?.hero_id ?? hero?.hero_key ?? hero?.stableId ?? hero?.stable_id ?? hero?.id ?? hero?.hero_data?.hero_id ?? hero?.hero_data?.stable_id ?? '');\n  }\n\n  /**\n   * Compute final combat stats for a hero with all bonuses applied.\n   * \n   * THIS IS THE ONLY PLACE WHERE CINEMATIC PERK IS APPLIED.\n   * All UI must use this function for consistency.\n   * \n   * @param hero - User's hero instance (with current_hp, current_atk, etc.)\n   * @param heroData - Hero base data (with base_hp, base_atk, etc.)\n   * @returns CombatStats with all bonuses applied\n   */\n  function computeCombatStats(hero, heroData) {\n    // Get base stats (prefer current_ from hero, fallback to base_ from heroData)\n    const baseHp = clampInt(hero?.current_hp ?? heroData?.base_hp ?? 0, 0, 999999999);\n    const baseAtk = clampInt(hero?.current_atk ?? heroData?.base_atk ?? 0, 0, 999999999);\n    const baseDef = clampInt(hero?.current_def ?? heroData?.base_def ?? 0, 0, 999999999);\n    const baseSpeed = clampInt(hero?.current_speed ?? heroData?.base_speed ?? 100, 0, 999999999);\n\n    // Get hero ID for per-hero bonuses\n    const heroId = extractHeroId(hero) || extractHeroId(heroData);\n\n    // Check cinematic ownership\n    const hasCinematicOwned = heroId ? (0, _cinematicsAccess.hasHeroCinematicOwned)(heroId) : false;\n    const bonus = (0, _combatBonuses.cinematicOwnershipBonus)(hasCinematicOwned);\n\n    // Apply bonuses\n    return {\n      hp: Math.floor(baseHp * bonus.hpMult),\n      atk: Math.floor(baseAtk * bonus.atkMult),\n      def: Math.floor(baseDef * bonus.defMult),\n      speed: Math.floor(baseSpeed * bonus.speedMult),\n      hasCinematicBonus: hasCinematicOwned\n    };\n  }\n\n  /**\n   * Compute hero power rating using bonused stats.\n   * Uses the standard formula: HP + ATK*3 + DEF*2 + SPD*1.5\n   * \n   * @param hero - User's hero instance\n   * @param heroData - Hero base data\n   * @returns Power rating (integer)\n   */\n  function computeHeroPower(hero, heroData) {\n    const stats = computeCombatStats(hero, heroData);\n    return Math.floor(stats.hp + stats.atk * 3 + stats.def * 2 + stats.speed * 1.5);\n  }\n\n  /**\n   * Compute power from raw stats (for cases where stats are already computed)\n   */\n  function computePowerFromStats(stats) {\n    return Math.floor(stats.hp + stats.atk * 3 + stats.def * 2 + stats.speed * 1.5);\n  }\n});","lineCount":97,"map":[[7,2,63,0,"exports"],[7,9,63,0],[7,10,63,0,"computeCombatStats"],[7,28,63,0],[7,31,63,0,"computeCombatStats"],[7,49,63,0],[8,2,95,0,"exports"],[8,9,95,0],[8,10,95,0,"computeHeroPower"],[8,26,95,0],[8,29,95,0,"computeHeroPower"],[8,45,95,0],[9,2,103,0,"exports"],[9,9,103,0],[9,10,103,0,"computePowerFromStats"],[9,31,103,0],[9,34,103,0,"computePowerFromStats"],[9,55,103,0],[10,2,13,0],[10,6,13,0,"_combatBonuses"],[10,20,13,0],[10,23,13,0,"require"],[10,30,13,0],[10,31,13,0,"_dependencyMap"],[10,45,13,0],[11,2,14,0],[11,6,14,0,"_cinematicsAccess"],[11,23,14,0],[11,26,14,0,"require"],[11,33,14,0],[11,34,14,0,"_dependencyMap"],[11,48,14,0],[12,2,1,0],[13,0,2,0],[14,0,3,0],[15,0,4,0],[16,0,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,0,11,0],[24,2,16,0],[25,0,17,0],[26,0,18,0],[27,2,19,0],[27,11,19,9,"clampInt"],[27,19,19,17,"clampInt"],[27,20,19,18,"n"],[27,21,19,24],[27,23,19,26,"min"],[27,26,19,37],[27,28,19,39,"max"],[27,31,19,50],[27,33,19,60],[28,4,20,2],[28,10,20,8,"x"],[28,11,20,9],[28,14,20,12,"Number"],[28,20,20,18],[28,21,20,19,"isFinite"],[28,29,20,27],[28,30,20,28,"Number"],[28,36,20,34],[28,37,20,35,"n"],[28,38,20,36],[28,39,20,37],[28,40,20,38],[28,43,20,41,"Math"],[28,47,20,45],[28,48,20,46,"floor"],[28,53,20,51],[28,54,20,52,"Number"],[28,60,20,58],[28,61,20,59,"n"],[28,62,20,60],[28,63,20,61],[28,64,20,62],[28,67,20,65],[28,68,20,66],[29,4,21,2],[29,11,21,9,"Math"],[29,15,21,13],[29,16,21,14,"max"],[29,19,21,17],[29,20,21,18,"min"],[29,23,21,21],[29,25,21,23,"Math"],[29,29,21,27],[29,30,21,28,"min"],[29,33,21,31],[29,34,21,32,"max"],[29,37,21,35],[29,39,21,37,"x"],[29,40,21,38],[29,41,21,39],[29,42,21,40],[30,2,22,0],[32,2,24,0],[33,0,25,0],[34,0,26,0],[36,2,36,0],[37,0,37,0],[38,0,38,0],[39,2,39,0],[39,11,39,9,"extractHeroId"],[39,24,39,22,"extractHeroId"],[39,25,39,23,"hero"],[39,29,39,32],[39,31,39,42],[40,4,40,2],[41,4,41,2],[41,11,41,9,"String"],[41,17,41,15],[41,18,42,4,"hero"],[41,22,42,8],[41,24,42,10,"hero_id"],[41,31,42,17],[41,35,43,4,"hero"],[41,39,43,8],[41,41,43,10,"hero_key"],[41,49,43,18],[41,53,44,4,"hero"],[41,57,44,8],[41,59,44,10,"stableId"],[41,67,44,18],[41,71,45,4,"hero"],[41,75,45,8],[41,77,45,10,"stable_id"],[41,86,45,19],[41,90,46,4,"hero"],[41,94,46,8],[41,96,46,10,"id"],[41,98,46,12],[41,102,47,4,"hero"],[41,106,47,8],[41,108,47,10,"hero_data"],[41,117,47,19],[41,119,47,21,"hero_id"],[41,126,47,28],[41,130,48,4,"hero"],[41,134,48,8],[41,136,48,10,"hero_data"],[41,145,48,19],[41,147,48,21,"stable_id"],[41,156,48,30],[41,160,49,4],[41,162,50,2],[41,163,50,3],[42,2,51,0],[44,2,53,0],[45,0,54,0],[46,0,55,0],[47,0,56,0],[48,0,57,0],[49,0,58,0],[50,0,59,0],[51,0,60,0],[52,0,61,0],[53,0,62,0],[54,2,63,7],[54,11,63,16,"computeCombatStats"],[54,29,63,34,"computeCombatStats"],[54,30,63,35,"hero"],[54,34,63,44],[54,36,63,46,"heroData"],[54,44,63,59],[54,46,63,74],[55,4,64,2],[56,4,65,2],[56,10,65,8,"baseHp"],[56,16,65,14],[56,19,65,17,"clampInt"],[56,27,65,25],[56,28,65,26,"hero"],[56,32,65,30],[56,34,65,32,"current_hp"],[56,44,65,42],[56,48,65,46,"heroData"],[56,56,65,54],[56,58,65,56,"base_hp"],[56,65,65,63],[56,69,65,67],[56,70,65,68],[56,72,65,70],[56,73,65,71],[56,75,65,73],[56,84,65,82],[56,85,65,83],[57,4,66,2],[57,10,66,8,"baseAtk"],[57,17,66,15],[57,20,66,18,"clampInt"],[57,28,66,26],[57,29,66,27,"hero"],[57,33,66,31],[57,35,66,33,"current_atk"],[57,46,66,44],[57,50,66,48,"heroData"],[57,58,66,56],[57,60,66,58,"base_atk"],[57,68,66,66],[57,72,66,70],[57,73,66,71],[57,75,66,73],[57,76,66,74],[57,78,66,76],[57,87,66,85],[57,88,66,86],[58,4,67,2],[58,10,67,8,"baseDef"],[58,17,67,15],[58,20,67,18,"clampInt"],[58,28,67,26],[58,29,67,27,"hero"],[58,33,67,31],[58,35,67,33,"current_def"],[58,46,67,44],[58,50,67,48,"heroData"],[58,58,67,56],[58,60,67,58,"base_def"],[58,68,67,66],[58,72,67,70],[58,73,67,71],[58,75,67,73],[58,76,67,74],[58,78,67,76],[58,87,67,85],[58,88,67,86],[59,4,68,2],[59,10,68,8,"baseSpeed"],[59,19,68,17],[59,22,68,20,"clampInt"],[59,30,68,28],[59,31,68,29,"hero"],[59,35,68,33],[59,37,68,35,"current_speed"],[59,50,68,48],[59,54,68,52,"heroData"],[59,62,68,60],[59,64,68,62,"base_speed"],[59,74,68,72],[59,78,68,76],[59,81,68,79],[59,83,68,81],[59,84,68,82],[59,86,68,84],[59,95,68,93],[59,96,68,94],[61,4,70,2],[62,4,71,2],[62,10,71,8,"heroId"],[62,16,71,14],[62,19,71,17,"extractHeroId"],[62,32,71,30],[62,33,71,31,"hero"],[62,37,71,35],[62,38,71,36],[62,42,71,40,"extractHeroId"],[62,55,71,53],[62,56,71,54,"heroData"],[62,64,71,62],[62,65,71,63],[64,4,73,2],[65,4,74,2],[65,10,74,8,"hasCinematicOwned"],[65,27,74,25],[65,30,74,28,"heroId"],[65,36,74,34],[65,39,74,37],[65,43,74,37,"hasHeroCinematicOwned"],[65,60,74,58],[65,61,74,58,"hasHeroCinematicOwned"],[65,82,74,58],[65,84,74,59,"heroId"],[65,90,74,65],[65,91,74,66],[65,94,74,69],[65,99,74,74],[66,4,75,2],[66,10,75,8,"bonus"],[66,15,75,13],[66,18,75,16],[66,22,75,16,"cinematicOwnershipBonus"],[66,36,75,39],[66,37,75,39,"cinematicOwnershipBonus"],[66,60,75,39],[66,62,75,40,"hasCinematicOwned"],[66,79,75,57],[66,80,75,58],[68,4,77,2],[69,4,78,2],[69,11,78,9],[70,6,79,4,"hp"],[70,8,79,6],[70,10,79,8,"Math"],[70,14,79,12],[70,15,79,13,"floor"],[70,20,79,18],[70,21,79,19,"baseHp"],[70,27,79,25],[70,30,79,28,"bonus"],[70,35,79,33],[70,36,79,34,"hpMult"],[70,42,79,40],[70,43,79,41],[71,6,80,4,"atk"],[71,9,80,7],[71,11,80,9,"Math"],[71,15,80,13],[71,16,80,14,"floor"],[71,21,80,19],[71,22,80,20,"baseAtk"],[71,29,80,27],[71,32,80,30,"bonus"],[71,37,80,35],[71,38,80,36,"atkMult"],[71,45,80,43],[71,46,80,44],[72,6,81,4,"def"],[72,9,81,7],[72,11,81,9,"Math"],[72,15,81,13],[72,16,81,14,"floor"],[72,21,81,19],[72,22,81,20,"baseDef"],[72,29,81,27],[72,32,81,30,"bonus"],[72,37,81,35],[72,38,81,36,"defMult"],[72,45,81,43],[72,46,81,44],[73,6,82,4,"speed"],[73,11,82,9],[73,13,82,11,"Math"],[73,17,82,15],[73,18,82,16,"floor"],[73,23,82,21],[73,24,82,22,"baseSpeed"],[73,33,82,31],[73,36,82,34,"bonus"],[73,41,82,39],[73,42,82,40,"speedMult"],[73,51,82,49],[73,52,82,50],[74,6,83,4,"hasCinematicBonus"],[74,23,83,21],[74,25,83,23,"hasCinematicOwned"],[75,4,84,2],[75,5,84,3],[76,2,85,0],[78,2,87,0],[79,0,88,0],[80,0,89,0],[81,0,90,0],[82,0,91,0],[83,0,92,0],[84,0,93,0],[85,0,94,0],[86,2,95,7],[86,11,95,16,"computeHeroPower"],[86,27,95,32,"computeHeroPower"],[86,28,95,33,"hero"],[86,32,95,42],[86,34,95,44,"heroData"],[86,42,95,57],[86,44,95,67],[87,4,96,2],[87,10,96,8,"stats"],[87,15,96,13],[87,18,96,16,"computeCombatStats"],[87,36,96,34],[87,37,96,35,"hero"],[87,41,96,39],[87,43,96,41,"heroData"],[87,51,96,49],[87,52,96,50],[88,4,97,2],[88,11,97,9,"Math"],[88,15,97,13],[88,16,97,14,"floor"],[88,21,97,19],[88,22,97,20,"stats"],[88,27,97,25],[88,28,97,26,"hp"],[88,30,97,28],[88,33,97,31,"stats"],[88,38,97,36],[88,39,97,37,"atk"],[88,42,97,40],[88,45,97,43],[88,46,97,44],[88,49,97,47,"stats"],[88,54,97,52],[88,55,97,53,"def"],[88,58,97,56],[88,61,97,59],[88,62,97,60],[88,65,97,63,"stats"],[88,70,97,68],[88,71,97,69,"speed"],[88,76,97,74],[88,79,97,77],[88,82,97,80],[88,83,97,81],[89,2,98,0],[91,2,100,0],[92,0,101,0],[93,0,102,0],[94,2,103,7],[94,11,103,16,"computePowerFromStats"],[94,32,103,37,"computePowerFromStats"],[94,33,103,38,"stats"],[94,38,103,56],[94,40,103,66],[95,4,104,2],[95,11,104,9,"Math"],[95,15,104,13],[95,16,104,14,"floor"],[95,21,104,19],[95,22,104,20,"stats"],[95,27,104,25],[95,28,104,26,"hp"],[95,30,104,28],[95,33,104,31,"stats"],[95,38,104,36],[95,39,104,37,"atk"],[95,42,104,40],[95,45,104,43],[95,46,104,44],[95,49,104,47,"stats"],[95,54,104,52],[95,55,104,53,"def"],[95,58,104,56],[95,61,104,59],[95,62,104,60],[95,65,104,63,"stats"],[95,70,104,68],[95,71,104,69,"speed"],[95,76,104,74],[95,79,104,77],[95,82,104,80],[95,83,104,81],[96,2,105,0],[97,0,105,1],[97,3]],"functionMap":{"names":["<global>","clampInt","extractHeroId","computeCombatStats","computeHeroPower","computePowerFromStats"],"mappings":"AAA;ACkB;CDG;AEiB;CFY;OGY;CHsB;OIU;CJG;OKK;CLE"},"hasCjsExports":false},"type":"js/module"}]}