{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"../types/receipt","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":186},"end":{"line":8,"column":65,"index":251}}],"key":"W14jz77KoHdh2OnwnpYz6E6ocCQ=","exportNames":["*"],"imports":1}},{"name":"../telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":252},"end":{"line":9,"column":52,"index":304}}],"key":"k7LZwhoWMWET/ud396YGvDlODrM=","exportNames":["*"],"imports":1}},{"name":"./config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":305},"end":{"line":10,"column":50,"index":355}}],"key":"apL7GyCxHQJfXSypmIMW0g+q+wo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.getStoreCatalog = getStoreCatalog;\n  exports.createPurchaseIntent = createPurchaseIntent;\n  exports.redeemIntent = redeemIntent;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _typesReceipt = require(_dependencyMap[1], \"../types/receipt\");\n  var _telemetryEvents = require(_dependencyMap[2], \"../telemetry/events\");\n  var _config = require(_dependencyMap[3], \"./config\");\n  // /app/frontend/lib/api/store.ts\n  // Phase 3.30: Store API Layer\n  //\n  // Catalog, purchase intent, and dev-only redeem.\n  // Uses canonical receipt for redeem.\n  // Auth handled by config.ts\n  // Store item from catalog\n  // Purchase intent response\n  /**\n   * Get store catalog\n   */\n  function getStoreCatalog() {\n    return _getStoreCatalog.apply(this, arguments);\n  }\n  /**\n   * Create purchase intent\n   */\n  function _getStoreCatalog() {\n    _getStoreCatalog = (0, _asyncToGenerator.default)(function* () {\n      try {\n        var headers = yield (0, _config.getJsonHeaders)();\n        var res = yield fetch((0, _config.apiUrl)('/api/store/catalog'), {\n          headers\n        });\n        if (!res.ok) throw new Error('Failed to fetch catalog');\n        var data = yield res.json();\n        return data.catalog || [];\n      } catch {\n        return [];\n      }\n    });\n    return _getStoreCatalog.apply(this, arguments);\n  }\n  function createPurchaseIntent(_x) {\n    return _createPurchaseIntent.apply(this, arguments);\n  }\n  /**\n   * DEV-ONLY: Redeem purchase intent without payment\n   * Returns canonical receipt.\n   */\n  function _createPurchaseIntent() {\n    _createPurchaseIntent = (0, _asyncToGenerator.default)(function* (sku) {\n      var headers = yield (0, _config.getJsonHeaders)();\n      var params = new URLSearchParams({\n        sku\n      });\n      var res = yield fetch((0, _config.apiUrl)(`/api/store/purchase-intent?${params}`), {\n        method: 'POST',\n        headers\n      });\n      if (!res.ok) {\n        var error = yield res.json().catch(() => ({\n          detail: 'Failed to create intent'\n        }));\n        throw new Error(error.detail || 'Failed to create intent');\n      }\n      var intent = yield res.json();\n\n      // Emit telemetry\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_PURCHASE_INTENT_CREATED, {\n        intentId: intent.intentId,\n        sku: intent.sku\n      });\n      return intent;\n    });\n    return _createPurchaseIntent.apply(this, arguments);\n  }\n  function redeemIntent(_x2) {\n    return _redeemIntent.apply(this, arguments);\n  }\n  function _redeemIntent() {\n    _redeemIntent = (0, _asyncToGenerator.default)(function* (intentId) {\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUBMITTED, {\n        intentId\n      });\n      var headers = yield (0, _config.getJsonHeaders)();\n      var params = new URLSearchParams({\n        intent_id: intentId\n      });\n      var res = yield fetch((0, _config.apiUrl)(`/api/store/redeem-intent?${params}`), {\n        method: 'POST',\n        headers\n      });\n      if (!res.ok) {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ERROR, {\n          intentId,\n          status: res.status\n        });\n        var error = yield res.json().catch(() => ({\n          detail: 'Failed to redeem'\n        }));\n        throw new Error(error.detail || 'Failed to redeem');\n      }\n      var receipt = yield res.json();\n      if ((0, _typesReceipt.isValidReceipt)(receipt)) {\n        if (receipt.alreadyClaimed) {\n          (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ALREADY_CLAIMED, {\n            intentId\n          });\n        } else {\n          (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUCCESS, {\n            intentId,\n            itemCount: receipt.items.length\n          });\n        }\n      }\n      return receipt;\n    });\n    return _redeemIntent.apply(this, arguments);\n  }\n});","lineCount":130,"map":[[12,2,35,0,"exports"],[12,9,35,0],[12,10,35,0,"getStoreCatalog"],[12,25,35,0],[12,28,35,0,"getStoreCatalog"],[12,43,35,0],[13,2,50,0,"exports"],[13,9,50,0],[13,10,50,0,"createPurchaseIntent"],[13,30,50,0],[13,33,50,0,"createPurchaseIntent"],[13,53,50,0],[14,2,79,0,"exports"],[14,9,79,0],[14,10,79,0,"redeemIntent"],[14,22,79,0],[14,25,79,0,"redeemIntent"],[14,37,79,0],[15,2,110,1],[15,6,110,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,42,110,1],[15,45,110,1,"require"],[15,52,110,1],[15,53,110,1,"_dependencyMap"],[15,67,110,1],[16,2,110,1],[16,6,110,1,"_asyncToGenerator"],[16,23,110,1],[16,26,110,1,"_interopDefault"],[16,41,110,1],[16,42,110,1,"_babelRuntimeHelpersAsyncToGenerator"],[16,78,110,1],[17,2,8,0],[17,6,8,0,"_typesReceipt"],[17,19,8,0],[17,22,8,0,"require"],[17,29,8,0],[17,30,8,0,"_dependencyMap"],[17,44,8,0],[18,2,9,0],[18,6,9,0,"_telemetryEvents"],[18,22,9,0],[18,25,9,0,"require"],[18,32,9,0],[18,33,9,0,"_dependencyMap"],[18,47,9,0],[19,2,10,0],[19,6,10,0,"_config"],[19,13,10,0],[19,16,10,0,"require"],[19,23,10,0],[19,24,10,0,"_dependencyMap"],[19,38,10,0],[20,2,1,0],[21,2,2,0],[22,2,3,0],[23,2,4,0],[24,2,5,0],[25,2,7,0],[26,2,12,0],[27,2,22,0],[28,2,32,0],[29,0,33,0],[30,0,34,0],[31,2,32,0],[31,11,35,22,"getStoreCatalog"],[31,26,35,37,"getStoreCatalog"],[31,27,35,37],[32,4,35,37],[32,11,35,37,"_getStoreCatalog"],[32,27,35,37],[32,28,35,37,"apply"],[32,33,35,37],[32,40,35,37,"arguments"],[32,49,35,37],[33,2,35,37],[34,2,47,0],[35,0,48,0],[36,0,49,0],[37,2,47,0],[37,11,47,0,"_getStoreCatalog"],[37,28,47,0],[38,4,47,0,"_getStoreCatalog"],[38,20,47,0],[38,27,47,0,"_asyncToGenerator"],[38,44,47,0],[38,45,47,0,"default"],[38,52,47,0],[38,54,35,7],[38,67,35,62],[39,6,36,2],[39,10,36,6],[40,8,37,4],[40,12,37,10,"headers"],[40,19,37,17],[40,28,37,26],[40,32,37,26,"getJsonHeaders"],[40,39,37,40],[40,40,37,40,"getJsonHeaders"],[40,54,37,40],[40,56,37,41],[40,57,37,42],[41,8,38,4],[41,12,38,10,"res"],[41,15,38,13],[41,24,38,22,"fetch"],[41,29,38,27],[41,30,38,28],[41,34,38,28,"apiUrl"],[41,41,38,34],[41,42,38,34,"apiUrl"],[41,48,38,34],[41,50,38,35],[41,70,38,55],[41,71,38,56],[41,73,38,58],[42,10,38,60,"headers"],[43,8,38,68],[43,9,38,69],[43,10,38,70],[44,8,39,4],[44,12,39,8],[44,13,39,9,"res"],[44,16,39,12],[44,17,39,13,"ok"],[44,19,39,15],[44,21,39,17],[44,27,39,23],[44,31,39,27,"Error"],[44,36,39,32],[44,37,39,33],[44,62,39,58],[44,63,39,59],[45,8,40,4],[45,12,40,10,"data"],[45,16,40,14],[45,25,40,23,"res"],[45,28,40,26],[45,29,40,27,"json"],[45,33,40,31],[45,34,40,32],[45,35,40,33],[46,8,41,4],[46,15,41,11,"data"],[46,19,41,15],[46,20,41,16,"catalog"],[46,27,41,23],[46,31,41,27],[46,33,41,29],[47,6,42,2],[47,7,42,3],[47,8,42,4],[47,14,42,10],[48,8,43,4],[48,15,43,11],[48,17,43,13],[49,6,44,2],[50,4,45,0],[50,5,45,1],[51,4,45,1],[51,11,45,1,"_getStoreCatalog"],[51,27,45,1],[51,28,45,1,"apply"],[51,33,45,1],[51,40,45,1,"arguments"],[51,49,45,1],[52,2,45,1],[53,2,45,1],[53,11,50,22,"createPurchaseIntent"],[53,31,50,42,"createPurchaseIntent"],[53,32,50,42,"_x"],[53,34,50,42],[54,4,50,42],[54,11,50,42,"_createPurchaseIntent"],[54,32,50,42],[54,33,50,42,"apply"],[54,38,50,42],[54,45,50,42,"arguments"],[54,54,50,42],[55,2,50,42],[56,2,75,0],[57,0,76,0],[58,0,77,0],[59,0,78,0],[60,2,75,0],[60,11,75,0,"_createPurchaseIntent"],[60,33,75,0],[61,4,75,0,"_createPurchaseIntent"],[61,25,75,0],[61,32,75,0,"_asyncToGenerator"],[61,49,75,0],[61,50,75,0,"default"],[61,57,75,0],[61,59,50,7],[61,70,50,43,"sku"],[61,73,50,54],[61,75,50,81],[62,6,51,2],[62,10,51,8,"headers"],[62,17,51,15],[62,26,51,24],[62,30,51,24,"getJsonHeaders"],[62,37,51,38],[62,38,51,38,"getJsonHeaders"],[62,52,51,38],[62,54,51,39],[62,55,51,40],[63,6,52,2],[63,10,52,8,"params"],[63,16,52,14],[63,19,52,17],[63,23,52,21,"URLSearchParams"],[63,38,52,36],[63,39,52,37],[64,8,52,39,"sku"],[65,6,52,43],[65,7,52,44],[65,8,52,45],[66,6,54,2],[66,10,54,8,"res"],[66,13,54,11],[66,22,54,20,"fetch"],[66,27,54,25],[66,28,54,26],[66,32,54,26,"apiUrl"],[66,39,54,32],[66,40,54,32,"apiUrl"],[66,46,54,32],[66,48,54,33],[66,78,54,63,"params"],[66,84,54,69],[66,86,54,71],[66,87,54,72],[66,89,54,74],[67,8,55,4,"method"],[67,14,55,10],[67,16,55,12],[67,22,55,18],[68,8,56,4,"headers"],[69,6,57,2],[69,7,57,3],[69,8,57,4],[70,6,59,2],[70,10,59,6],[70,11,59,7,"res"],[70,14,59,10],[70,15,59,11,"ok"],[70,17,59,13],[70,19,59,15],[71,8,60,4],[71,12,60,10,"error"],[71,17,60,15],[71,26,60,24,"res"],[71,29,60,27],[71,30,60,28,"json"],[71,34,60,32],[71,35,60,33],[71,36,60,34],[71,37,60,35,"catch"],[71,42,60,40],[71,43,60,41],[71,50,60,48],[72,10,60,50,"detail"],[72,16,60,56],[72,18,60,58],[73,8,60,84],[73,9,60,85],[73,10,60,86],[73,11,60,87],[74,8,61,4],[74,14,61,10],[74,18,61,14,"Error"],[74,23,61,19],[74,24,61,20,"error"],[74,29,61,25],[74,30,61,26,"detail"],[74,36,61,32],[74,40,61,36],[74,65,61,61],[74,66,61,62],[75,6,62,2],[76,6,64,2],[76,10,64,8,"intent"],[76,16,64,14],[76,25,64,23,"res"],[76,28,64,26],[76,29,64,27,"json"],[76,33,64,31],[76,34,64,32],[76,35,64,33],[78,6,66,2],[79,6,67,2],[79,10,67,2,"track"],[79,26,67,7],[79,27,67,7,"track"],[79,32,67,7],[79,34,67,8,"Events"],[79,50,67,14],[79,51,67,14,"Events"],[79,57,67,14],[79,58,67,15,"STORE_PURCHASE_INTENT_CREATED"],[79,87,67,44],[79,89,67,46],[80,8,68,4,"intentId"],[80,16,68,12],[80,18,68,14,"intent"],[80,24,68,20],[80,25,68,21,"intentId"],[80,33,68,29],[81,8,69,4,"sku"],[81,11,69,7],[81,13,69,9,"intent"],[81,19,69,15],[81,20,69,16,"sku"],[82,6,70,2],[82,7,70,3],[82,8,70,4],[83,6,72,2],[83,13,72,9,"intent"],[83,19,72,15],[84,4,73,0],[84,5,73,1],[85,4,73,1],[85,11,73,1,"_createPurchaseIntent"],[85,32,73,1],[85,33,73,1,"apply"],[85,38,73,1],[85,45,73,1,"arguments"],[85,54,73,1],[86,2,73,1],[87,2,73,1],[87,11,79,22,"redeemIntent"],[87,23,79,34,"redeemIntent"],[87,24,79,34,"_x2"],[87,27,79,34],[88,4,79,34],[88,11,79,34,"_redeemIntent"],[88,24,79,34],[88,25,79,34,"apply"],[88,30,79,34],[88,37,79,34,"arguments"],[88,46,79,34],[89,2,79,34],[90,2,79,34],[90,11,79,34,"_redeemIntent"],[90,25,79,34],[91,4,79,34,"_redeemIntent"],[91,17,79,34],[91,24,79,34,"_asyncToGenerator"],[91,41,79,34],[91,42,79,34,"default"],[91,49,79,34],[91,51,79,7],[91,62,79,35,"intentId"],[91,70,79,51],[91,72,79,77],[92,6,80,2],[92,10,80,2,"track"],[92,26,80,7],[92,27,80,7,"track"],[92,32,80,7],[92,34,80,8,"Events"],[92,50,80,14],[92,51,80,14,"Events"],[92,57,80,14],[92,58,80,15,"STORE_REDEEM_SUBMITTED"],[92,80,80,37],[92,82,80,39],[93,8,80,41,"intentId"],[94,6,80,50],[94,7,80,51],[94,8,80,52],[95,6,82,2],[95,10,82,8,"headers"],[95,17,82,15],[95,26,82,24],[95,30,82,24,"getJsonHeaders"],[95,37,82,38],[95,38,82,38,"getJsonHeaders"],[95,52,82,38],[95,54,82,39],[95,55,82,40],[96,6,83,2],[96,10,83,8,"params"],[96,16,83,14],[96,19,83,17],[96,23,83,21,"URLSearchParams"],[96,38,83,36],[96,39,83,37],[97,8,83,39,"intent_id"],[97,17,83,48],[97,19,83,50,"intentId"],[98,6,83,59],[98,7,83,60],[98,8,83,61],[99,6,85,2],[99,10,85,8,"res"],[99,13,85,11],[99,22,85,20,"fetch"],[99,27,85,25],[99,28,85,26],[99,32,85,26,"apiUrl"],[99,39,85,32],[99,40,85,32,"apiUrl"],[99,46,85,32],[99,48,85,33],[99,76,85,61,"params"],[99,82,85,67],[99,84,85,69],[99,85,85,70],[99,87,85,72],[100,8,86,4,"method"],[100,14,86,10],[100,16,86,12],[100,22,86,18],[101,8,87,4,"headers"],[102,6,88,2],[102,7,88,3],[102,8,88,4],[103,6,90,2],[103,10,90,6],[103,11,90,7,"res"],[103,14,90,10],[103,15,90,11,"ok"],[103,17,90,13],[103,19,90,15],[104,8,91,4],[104,12,91,4,"track"],[104,28,91,9],[104,29,91,9,"track"],[104,34,91,9],[104,36,91,10,"Events"],[104,52,91,16],[104,53,91,16,"Events"],[104,59,91,16],[104,60,91,17,"STORE_REDEEM_ERROR"],[104,78,91,35],[104,80,91,37],[105,10,91,39,"intentId"],[105,18,91,47],[106,10,91,49,"status"],[106,16,91,55],[106,18,91,57,"res"],[106,21,91,60],[106,22,91,61,"status"],[107,8,91,68],[107,9,91,69],[107,10,91,70],[108,8,92,4],[108,12,92,10,"error"],[108,17,92,15],[108,26,92,24,"res"],[108,29,92,27],[108,30,92,28,"json"],[108,34,92,32],[108,35,92,33],[108,36,92,34],[108,37,92,35,"catch"],[108,42,92,40],[108,43,92,41],[108,50,92,48],[109,10,92,50,"detail"],[109,16,92,56],[109,18,92,58],[110,8,92,77],[110,9,92,78],[110,10,92,79],[110,11,92,80],[111,8,93,4],[111,14,93,10],[111,18,93,14,"Error"],[111,23,93,19],[111,24,93,20,"error"],[111,29,93,25],[111,30,93,26,"detail"],[111,36,93,32],[111,40,93,36],[111,58,93,54],[111,59,93,55],[112,6,94,2],[113,6,96,2],[113,10,96,8,"receipt"],[113,17,96,15],[113,26,96,24,"res"],[113,29,96,27],[113,30,96,28,"json"],[113,34,96,32],[113,35,96,33],[113,36,96,34],[114,6,98,2],[114,10,98,6],[114,14,98,6,"isValidReceipt"],[114,27,98,20],[114,28,98,20,"isValidReceipt"],[114,42,98,20],[114,44,98,21,"receipt"],[114,51,98,28],[114,52,98,29],[114,54,98,31],[115,8,99,4],[115,12,99,8,"receipt"],[115,19,99,15],[115,20,99,16,"alreadyClaimed"],[115,34,99,30],[115,36,99,32],[116,10,100,6],[116,14,100,6,"track"],[116,30,100,11],[116,31,100,11,"track"],[116,36,100,11],[116,38,100,12,"Events"],[116,54,100,18],[116,55,100,18,"Events"],[116,61,100,18],[116,62,100,19,"STORE_REDEEM_ALREADY_CLAIMED"],[116,90,100,47],[116,92,100,49],[117,12,100,51,"intentId"],[118,10,100,60],[118,11,100,61],[118,12,100,62],[119,8,101,4],[119,9,101,5],[119,15,101,11],[120,10,102,6],[120,14,102,6,"track"],[120,30,102,11],[120,31,102,11,"track"],[120,36,102,11],[120,38,102,12,"Events"],[120,54,102,18],[120,55,102,18,"Events"],[120,61,102,18],[120,62,102,19,"STORE_REDEEM_SUCCESS"],[120,82,102,39],[120,84,102,41],[121,12,103,8,"intentId"],[121,20,103,16],[122,12,104,8,"itemCount"],[122,21,104,17],[122,23,104,19,"receipt"],[122,30,104,26],[122,31,104,27,"items"],[122,36,104,32],[122,37,104,33,"length"],[123,10,105,6],[123,11,105,7],[123,12,105,8],[124,8,106,4],[125,6,107,2],[126,6,109,2],[126,13,109,9,"receipt"],[126,20,109,16],[127,4,110,0],[127,5,110,1],[128,4,110,1],[128,11,110,1,"_redeemIntent"],[128,24,110,1],[128,25,110,1,"apply"],[128,30,110,1],[128,37,110,1,"arguments"],[128,46,110,1],[129,2,110,1],[130,0,110,1],[130,3]],"functionMap":{"names":["<global>","getStoreCatalog","createPurchaseIntent","res.json._catch$argument_0","redeemIntent"],"mappings":"AAA;OCkC;CDU;OEK;yCCU,6CD;CFa;OIM;yCDa,sCC;CJkB"},"hasCjsExports":false},"type":"js/module"}]}