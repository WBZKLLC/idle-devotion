{"dependencies":[{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":14,"index":78},"end":{"line":3,"column":38,"index":102}}],"key":"ud8OE6Lg8Q81+bS6ynZj2uyMPdA=","exportNames":["*"],"imports":1}},{"name":"../helpers.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":16,"index":120},"end":{"line":4,"column":40,"index":144}}],"key":"SE77CtsJgC8iI+dksCgETtr2kFg=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":16,"index":162},"end":{"line":5,"column":37,"index":183}}],"key":"v6h+l9IeOWbEcXdtKQqd2f4now4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  const utils = require(_dependencyMap[0], \"@sentry/utils\");\n  const helpers = require(_dependencyMap[1], \"../helpers.js\");\n  const utils$1 = require(_dependencyMap[2], \"./utils.js\");\n\n  /**\n   * Safety wrapper for startTransaction for the unlikely case that transaction starts before tracing is imported -\n   * if that happens we want to avoid throwing an error from profiling code.\n   * see https://github.com/getsentry/sentry-javascript/issues/4731.\n   *\n   * @experimental\n   */\n  function onProfilingStartRouteTransaction(transaction) {\n    if (!transaction) {\n      if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n        utils.logger.log('[Profiling] Transaction is undefined, skipping profiling');\n      }\n      return transaction;\n    }\n    if (utils$1.shouldProfileTransaction(transaction)) {\n      return startProfileForTransaction(transaction);\n    }\n    return transaction;\n  }\n\n  /**\n   * Wraps startTransaction and stopTransaction with profiling related logic.\n   * startProfileForTransaction is called after the call to startTransaction in order to avoid our own code from\n   * being profiled. Because of that same reason, stopProfiling is called before the call to stopTransaction.\n   */\n  function startProfileForTransaction(transaction) {\n    // Start the profiler and get the profiler instance.\n    let startTimestamp;\n    if (utils$1.isAutomatedPageLoadTransaction(transaction)) {\n      startTimestamp = utils.timestampInSeconds() * 1000;\n    }\n    const profiler = utils$1.startJSSelfProfile();\n\n    // We failed to construct the profiler, fallback to original transaction.\n    // No need to log anything as this has already been logged in startProfile.\n    if (!profiler) {\n      return transaction;\n    }\n    if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n      utils.logger.log(`[Profiling] started profiling transaction: ${transaction.name || transaction.description}`);\n    }\n\n    // We create \"unique\" transaction names to avoid concurrent transactions with same names\n    // from being ignored by the profiler. From here on, only this transaction name should be used when\n    // calling the profiler methods. Note: we log the original name to the user to avoid confusion.\n    const profileId = utils.uuid4();\n\n    /**\n     * Idempotent handler for profile stop\n     */\n    async function onProfileHandler() {\n      // Check if the profile exists and return it the behavior has to be idempotent as users may call transaction.finish multiple times.\n      if (!transaction) {\n        return null;\n      }\n      // Satisfy the type checker, but profiler will always be defined here.\n      if (!profiler) {\n        return null;\n      }\n      return profiler.stop().then(profile => {\n        if (maxDurationTimeoutID) {\n          helpers.WINDOW.clearTimeout(maxDurationTimeoutID);\n          maxDurationTimeoutID = undefined;\n        }\n        if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n          utils.logger.log(`[Profiling] stopped profiling of transaction: ${transaction.name || transaction.description}`);\n        }\n\n        // In case of an overlapping transaction, stopProfiling may return null and silently ignore the overlapping profile.\n        if (!profile) {\n          if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n            utils.logger.log(`[Profiling] profiler returned null profile for: ${transaction.name || transaction.description}`, 'this may indicate an overlapping transaction or a call to stopProfiling with a profile title that was never started');\n          }\n          return null;\n        }\n        utils$1.addProfileToGlobalCache(profileId, profile);\n        return null;\n      }).catch(error => {\n        if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n          utils.logger.log('[Profiling] error while stopping profiler:', error);\n        }\n        return null;\n      });\n    }\n\n    // Enqueue a timeout to prevent profiles from running over max duration.\n    let maxDurationTimeoutID = helpers.WINDOW.setTimeout(() => {\n      if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n        utils.logger.log('[Profiling] max profile duration elapsed, stopping profiling for:', transaction.name || transaction.description);\n      }\n      // If the timeout exceeds, we want to stop profiling, but not finish the transaction\n      void onProfileHandler();\n    }, utils$1.MAX_PROFILE_DURATION_MS);\n\n    // We need to reference the original finish call to avoid creating an infinite loop\n    const originalFinish = transaction.finish.bind(transaction);\n\n    /**\n     * Wraps startTransaction and stopTransaction with profiling related logic.\n     * startProfiling is called after the call to startTransaction in order to avoid our own code from\n     * being profiled. Because of that same reason, stopProfiling is called before the call to stopTransaction.\n     */\n    function profilingWrappedTransactionFinish() {\n      if (!transaction) {\n        return originalFinish();\n      }\n      // onProfileHandler should always return the same profile even if this is called multiple times.\n      // Always call onProfileHandler to ensure stopProfiling is called and the timeout is cleared.\n      void onProfileHandler().then(() => {\n        transaction.setContext('profile', {\n          profile_id: profileId,\n          start_timestamp: startTimestamp\n        });\n        originalFinish();\n      }, () => {\n        // If onProfileHandler fails, we still want to call the original finish method.\n        originalFinish();\n      });\n      return transaction;\n    }\n    transaction.finish = profilingWrappedTransactionFinish;\n    return transaction;\n  }\n  exports.onProfilingStartRouteTransaction = onProfilingStartRouteTransaction;\n  exports.startProfileForTransaction = startProfileForTransaction;\n});","lineCount":134,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,8,3,6,"utils"],[5,13,3,11],[5,16,3,14,"require"],[5,23,3,21],[5,24,3,21,"_dependencyMap"],[5,38,3,21],[5,58,3,37],[5,59,3,38],[6,2,4,0],[6,8,4,6,"helpers"],[6,15,4,13],[6,18,4,16,"require"],[6,25,4,23],[6,26,4,23,"_dependencyMap"],[6,40,4,23],[6,60,4,39],[6,61,4,40],[7,2,5,0],[7,8,5,6,"utils$1"],[7,15,5,13],[7,18,5,16,"require"],[7,25,5,23],[7,26,5,23,"_dependencyMap"],[7,40,5,23],[7,57,5,36],[7,58,5,37],[9,2,7,0],[10,0,8,0],[11,0,9,0],[12,0,10,0],[13,0,11,0],[14,0,12,0],[15,0,13,0],[16,2,14,0],[16,11,14,9,"onProfilingStartRouteTransaction"],[16,43,14,41,"onProfilingStartRouteTransaction"],[16,44,14,42,"transaction"],[16,55,14,53],[16,57,14,55],[17,4,15,2],[17,8,15,6],[17,9,15,7,"transaction"],[17,20,15,18],[17,22,15,20],[18,6,16,4],[18,10,16,9],[18,17,16,16,"__SENTRY_DEBUG__"],[18,33,16,32],[18,38,16,37],[18,49,16,48],[18,53,16,52,"__SENTRY_DEBUG__"],[18,69,16,68],[18,71,16,71],[19,8,17,6,"utils"],[19,13,17,11],[19,14,17,12,"logger"],[19,20,17,18],[19,21,17,19,"log"],[19,24,17,22],[19,25,17,23],[19,83,17,81],[19,84,17,82],[20,6,18,4],[21,6,19,4],[21,13,19,11,"transaction"],[21,24,19,22],[22,4,20,2],[23,4,22,2],[23,8,22,6,"utils$1"],[23,15,22,13],[23,16,22,14,"shouldProfileTransaction"],[23,40,22,38],[23,41,22,39,"transaction"],[23,52,22,50],[23,53,22,51],[23,55,22,53],[24,6,23,4],[24,13,23,11,"startProfileForTransaction"],[24,39,23,37],[24,40,23,38,"transaction"],[24,51,23,49],[24,52,23,50],[25,4,24,2],[26,4,26,2],[26,11,26,9,"transaction"],[26,22,26,20],[27,2,27,0],[29,2,29,0],[30,0,30,0],[31,0,31,0],[32,0,32,0],[33,0,33,0],[34,2,34,0],[34,11,34,9,"startProfileForTransaction"],[34,37,34,35,"startProfileForTransaction"],[34,38,34,36,"transaction"],[34,49,34,47],[34,51,34,49],[35,4,35,2],[36,4,36,2],[36,8,36,6,"startTimestamp"],[36,22,36,20],[37,4,37,2],[37,8,37,6,"utils$1"],[37,15,37,13],[37,16,37,14,"isAutomatedPageLoadTransaction"],[37,46,37,44],[37,47,37,45,"transaction"],[37,58,37,56],[37,59,37,57],[37,61,37,59],[38,6,38,4,"startTimestamp"],[38,20,38,18],[38,23,38,21,"utils"],[38,28,38,26],[38,29,38,27,"timestampInSeconds"],[38,47,38,45],[38,48,38,46],[38,49,38,47],[38,52,38,50],[38,56,38,54],[39,4,39,2],[40,4,41,2],[40,10,41,8,"profiler"],[40,18,41,16],[40,21,41,19,"utils$1"],[40,28,41,26],[40,29,41,27,"startJSSelfProfile"],[40,47,41,45],[40,48,41,46],[40,49,41,47],[42,4,43,2],[43,4,44,2],[44,4,45,2],[44,8,45,6],[44,9,45,7,"profiler"],[44,17,45,15],[44,19,45,17],[45,6,46,4],[45,13,46,11,"transaction"],[45,24,46,22],[46,4,47,2],[47,4,49,2],[47,8,49,7],[47,15,49,14,"__SENTRY_DEBUG__"],[47,31,49,30],[47,36,49,35],[47,47,49,46],[47,51,49,50,"__SENTRY_DEBUG__"],[47,67,49,66],[47,69,49,69],[48,6,50,4,"utils"],[48,11,50,9],[48,12,50,10,"logger"],[48,18,50,16],[48,19,50,17,"log"],[48,22,50,20],[48,23,50,21],[48,69,50,67,"transaction"],[48,80,50,78],[48,81,50,79,"name"],[48,85,50,83],[48,89,50,87,"transaction"],[48,100,50,98],[48,101,50,99,"description"],[48,112,50,110],[48,114,50,112],[48,115,50,113],[49,4,51,2],[51,4,53,2],[52,4,54,2],[53,4,55,2],[54,4,56,2],[54,10,56,8,"profileId"],[54,19,56,17],[54,22,56,20,"utils"],[54,27,56,25],[54,28,56,26,"uuid4"],[54,33,56,31],[54,34,56,32],[54,35,56,33],[56,4,58,2],[57,0,59,0],[58,0,60,0],[59,4,61,2],[59,19,61,17,"onProfileHandler"],[59,35,61,33,"onProfileHandler"],[59,36,61,33],[59,38,61,36],[60,6,62,4],[61,6,63,4],[61,10,63,8],[61,11,63,9,"transaction"],[61,22,63,20],[61,24,63,22],[62,8,64,6],[62,15,64,13],[62,19,64,17],[63,6,65,4],[64,6,66,4],[65,6,67,4],[65,10,67,8],[65,11,67,9,"profiler"],[65,19,67,17],[65,21,67,19],[66,8,68,6],[66,15,68,13],[66,19,68,17],[67,6,69,4],[68,6,71,4],[68,13,71,11,"profiler"],[68,21,71,19],[68,22,72,7,"stop"],[68,26,72,11],[68,27,72,12],[68,28,72,13],[68,29,73,7,"then"],[68,33,73,11],[68,34,73,13,"profile"],[68,41,73,20],[68,45,73,25],[69,8,74,8],[69,12,74,12,"maxDurationTimeoutID"],[69,32,74,32],[69,34,74,34],[70,10,75,10,"helpers"],[70,17,75,17],[70,18,75,18,"WINDOW"],[70,24,75,24],[70,25,75,25,"clearTimeout"],[70,37,75,37],[70,38,75,38,"maxDurationTimeoutID"],[70,58,75,58],[70,59,75,59],[71,10,76,10,"maxDurationTimeoutID"],[71,30,76,30],[71,33,76,33,"undefined"],[71,42,76,42],[72,8,77,8],[73,8,79,8],[73,12,79,13],[73,19,79,20,"__SENTRY_DEBUG__"],[73,35,79,36],[73,40,79,41],[73,51,79,52],[73,55,79,56,"__SENTRY_DEBUG__"],[73,71,79,72],[73,73,79,75],[74,10,80,10,"utils"],[74,15,80,15],[74,16,80,16,"logger"],[74,22,80,22],[74,23,80,23,"log"],[74,26,80,26],[74,27,80,27],[74,76,80,76,"transaction"],[74,87,80,87],[74,88,80,88,"name"],[74,92,80,92],[74,96,80,96,"transaction"],[74,107,80,107],[74,108,80,108,"description"],[74,119,80,119],[74,121,80,121],[74,122,80,122],[75,8,81,8],[77,8,83,8],[78,8,84,8],[78,12,84,12],[78,13,84,13,"profile"],[78,20,84,20],[78,22,84,22],[79,10,85,10],[79,14,85,15],[79,21,85,22,"__SENTRY_DEBUG__"],[79,37,85,38],[79,42,85,43],[79,53,85,54],[79,57,85,58,"__SENTRY_DEBUG__"],[79,73,85,74],[79,75,85,77],[80,12,86,12,"utils"],[80,17,86,17],[80,18,86,18,"logger"],[80,24,86,24],[80,25,86,25,"log"],[80,28,86,28],[80,29,87,14],[80,80,87,65,"transaction"],[80,91,87,76],[80,92,87,77,"name"],[80,96,87,81],[80,100,87,85,"transaction"],[80,111,87,96],[80,112,87,97,"description"],[80,123,87,108],[80,125,87,110],[80,127,88,14],[80,244,89,12],[80,245,89,13],[81,10,90,10],[82,10,91,10],[82,17,91,17],[82,21,91,21],[83,8,92,8],[84,8,94,8,"utils$1"],[84,15,94,15],[84,16,94,16,"addProfileToGlobalCache"],[84,39,94,39],[84,40,94,40,"profileId"],[84,49,94,49],[84,51,94,51,"profile"],[84,58,94,58],[84,59,94,59],[85,8,95,8],[85,15,95,15],[85,19,95,19],[86,6,96,6],[86,7,96,7],[86,8,96,8],[86,9,97,7,"catch"],[86,14,97,12],[86,15,97,13,"error"],[86,20,97,18],[86,24,97,22],[87,8,98,8],[87,12,98,13],[87,19,98,20,"__SENTRY_DEBUG__"],[87,35,98,36],[87,40,98,41],[87,51,98,52],[87,55,98,56,"__SENTRY_DEBUG__"],[87,71,98,72],[87,73,98,75],[88,10,99,10,"utils"],[88,15,99,15],[88,16,99,16,"logger"],[88,22,99,22],[88,23,99,23,"log"],[88,26,99,26],[88,27,99,27],[88,71,99,71],[88,73,99,73,"error"],[88,78,99,78],[88,79,99,79],[89,8,100,8],[90,8,101,8],[90,15,101,15],[90,19,101,19],[91,6,102,6],[91,7,102,7],[91,8,102,8],[92,4,103,2],[94,4,105,2],[95,4,106,2],[95,8,106,6,"maxDurationTimeoutID"],[95,28,106,26],[95,31,106,29,"helpers"],[95,38,106,36],[95,39,106,37,"WINDOW"],[95,45,106,43],[95,46,106,44,"setTimeout"],[95,56,106,54],[95,57,106,55],[95,63,106,61],[96,6,107,4],[96,10,107,9],[96,17,107,16,"__SENTRY_DEBUG__"],[96,33,107,32],[96,38,107,37],[96,49,107,48],[96,53,107,52,"__SENTRY_DEBUG__"],[96,69,107,68],[96,71,107,71],[97,8,108,6,"utils"],[97,13,108,11],[97,14,108,12,"logger"],[97,20,108,18],[97,21,108,19,"log"],[97,24,108,22],[97,25,109,8],[97,92,109,75],[97,94,110,8,"transaction"],[97,105,110,19],[97,106,110,20,"name"],[97,110,110,24],[97,114,110,28,"transaction"],[97,125,110,39],[97,126,110,40,"description"],[97,137,111,6],[97,138,111,7],[98,6,112,4],[99,6,113,4],[100,6,114,4],[100,11,114,9,"onProfileHandler"],[100,27,114,25],[100,28,114,26],[100,29,114,27],[101,4,115,2],[101,5,115,3],[101,7,115,5,"utils$1"],[101,14,115,12],[101,15,115,13,"MAX_PROFILE_DURATION_MS"],[101,38,115,36],[101,39,115,37],[103,4,117,2],[104,4,118,2],[104,10,118,8,"originalFinish"],[104,24,118,22],[104,27,118,25,"transaction"],[104,38,118,36],[104,39,118,37,"finish"],[104,45,118,43],[104,46,118,44,"bind"],[104,50,118,48],[104,51,118,49,"transaction"],[104,62,118,60],[104,63,118,61],[106,4,120,2],[107,0,121,0],[108,0,122,0],[109,0,123,0],[110,0,124,0],[111,4,125,2],[111,13,125,11,"profilingWrappedTransactionFinish"],[111,46,125,44,"profilingWrappedTransactionFinish"],[111,47,125,44],[111,49,125,47],[112,6,126,4],[112,10,126,8],[112,11,126,9,"transaction"],[112,22,126,20],[112,24,126,22],[113,8,127,6],[113,15,127,13,"originalFinish"],[113,29,127,27],[113,30,127,28],[113,31,127,29],[114,6,128,4],[115,6,129,4],[116,6,130,4],[117,6,131,4],[117,11,131,9,"onProfileHandler"],[117,27,131,25],[117,28,131,26],[117,29,131,27],[117,30,131,28,"then"],[117,34,131,32],[117,35,132,6],[117,41,132,12],[118,8,133,8,"transaction"],[118,19,133,19],[118,20,133,20,"setContext"],[118,30,133,30],[118,31,133,31],[118,40,133,40],[118,42,133,42],[119,10,133,44,"profile_id"],[119,20,133,54],[119,22,133,56,"profileId"],[119,31,133,65],[120,10,133,67,"start_timestamp"],[120,25,133,82],[120,27,133,84,"startTimestamp"],[121,8,133,99],[121,9,133,100],[121,10,133,101],[122,8,134,8,"originalFinish"],[122,22,134,22],[122,23,134,23],[122,24,134,24],[123,6,135,6],[123,7,135,7],[123,9,136,6],[123,15,136,12],[124,8,137,8],[125,8,138,8,"originalFinish"],[125,22,138,22],[125,23,138,23],[125,24,138,24],[126,6,139,6],[126,7,140,4],[126,8,140,5],[127,6,142,4],[127,13,142,11,"transaction"],[127,24,142,22],[128,4,143,2],[129,4,145,2,"transaction"],[129,15,145,13],[129,16,145,14,"finish"],[129,22,145,20],[129,25,145,23,"profilingWrappedTransactionFinish"],[129,58,145,56],[130,4,146,2],[130,11,146,9,"transaction"],[130,22,146,20],[131,2,147,0],[132,2,149,0,"exports"],[132,9,149,7],[132,10,149,8,"onProfilingStartRouteTransaction"],[132,42,149,40],[132,45,149,43,"onProfilingStartRouteTransaction"],[132,77,149,75],[133,2,150,0,"exports"],[133,9,150,7],[133,10,150,8,"startProfileForTransaction"],[133,36,150,34],[133,39,150,37,"startProfileForTransaction"],[133,65,150,63],[134,0,150,64],[134,3]],"functionMap":{"names":["<global>","onProfilingStartRouteTransaction","startProfileForTransaction","onProfileHandler","profiler.stop.then$argument_0","profiler.stop.then._catch$argument_0","helpers.WINDOW.setTimeout$argument_0","profilingWrappedTransactionFinish","onProfileHandler.then$argument_0","onProfileHandler.then$argument_1"],"mappings":"AAA;ACa;CDa;AEO;EC2B;YCY;ODuB;aEC;OFK;GDC;uDIG;GJS;EKU;MCO;ODG;MEC;OFG;GLI;CFI"},"hasCjsExports":true},"type":"js/module"}]}