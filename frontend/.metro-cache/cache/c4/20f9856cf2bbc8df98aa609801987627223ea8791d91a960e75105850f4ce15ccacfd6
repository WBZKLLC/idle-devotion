{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":14,"index":78},"end":{"line":3,"column":38,"index":102}}],"key":"ud8OE6Lg8Q81+bS6ynZj2uyMPdA=","exportNames":["*"],"imports":1}},{"name":"../helpers.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":16,"index":120},"end":{"line":4,"column":40,"index":144}}],"key":"SE77CtsJgC8iI+dksCgETtr2kFg=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":16,"index":162},"end":{"line":5,"column":37,"index":183}}],"key":"v6h+l9IeOWbEcXdtKQqd2f4now4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _asyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\").default;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  var utils = require(_dependencyMap[1], \"@sentry/utils\");\n  var helpers = require(_dependencyMap[2], \"../helpers.js\");\n  var utils$1 = require(_dependencyMap[3], \"./utils.js\");\n\n  /**\n   * Safety wrapper for startTransaction for the unlikely case that transaction starts before tracing is imported -\n   * if that happens we want to avoid throwing an error from profiling code.\n   * see https://github.com/getsentry/sentry-javascript/issues/4731.\n   *\n   * @experimental\n   */\n  function onProfilingStartRouteTransaction(transaction) {\n    if (!transaction) {\n      if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n        utils.logger.log('[Profiling] Transaction is undefined, skipping profiling');\n      }\n      return transaction;\n    }\n    if (utils$1.shouldProfileTransaction(transaction)) {\n      return startProfileForTransaction(transaction);\n    }\n    return transaction;\n  }\n\n  /**\n   * Wraps startTransaction and stopTransaction with profiling related logic.\n   * startProfileForTransaction is called after the call to startTransaction in order to avoid our own code from\n   * being profiled. Because of that same reason, stopProfiling is called before the call to stopTransaction.\n   */\n  function startProfileForTransaction(transaction) {\n    // Start the profiler and get the profiler instance.\n    var startTimestamp;\n    if (utils$1.isAutomatedPageLoadTransaction(transaction)) {\n      startTimestamp = utils.timestampInSeconds() * 1000;\n    }\n    var profiler = utils$1.startJSSelfProfile();\n\n    // We failed to construct the profiler, fallback to original transaction.\n    // No need to log anything as this has already been logged in startProfile.\n    if (!profiler) {\n      return transaction;\n    }\n    if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n      utils.logger.log(`[Profiling] started profiling transaction: ${transaction.name || transaction.description}`);\n    }\n\n    // We create \"unique\" transaction names to avoid concurrent transactions with same names\n    // from being ignored by the profiler. From here on, only this transaction name should be used when\n    // calling the profiler methods. Note: we log the original name to the user to avoid confusion.\n    var profileId = utils.uuid4();\n\n    /**\n     * Idempotent handler for profile stop\n     */\n    function onProfileHandler() {\n      return _onProfileHandler.apply(this, arguments);\n    } // Enqueue a timeout to prevent profiles from running over max duration.\n    function _onProfileHandler() {\n      _onProfileHandler = _asyncToGenerator(function* () {\n        // Check if the profile exists and return it the behavior has to be idempotent as users may call transaction.finish multiple times.\n        if (!transaction) {\n          return null;\n        }\n        // Satisfy the type checker, but profiler will always be defined here.\n        if (!profiler) {\n          return null;\n        }\n        return profiler.stop().then(profile => {\n          if (maxDurationTimeoutID) {\n            helpers.WINDOW.clearTimeout(maxDurationTimeoutID);\n            maxDurationTimeoutID = undefined;\n          }\n          if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n            utils.logger.log(`[Profiling] stopped profiling of transaction: ${transaction.name || transaction.description}`);\n          }\n\n          // In case of an overlapping transaction, stopProfiling may return null and silently ignore the overlapping profile.\n          if (!profile) {\n            if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n              utils.logger.log(`[Profiling] profiler returned null profile for: ${transaction.name || transaction.description}`, 'this may indicate an overlapping transaction or a call to stopProfiling with a profile title that was never started');\n            }\n            return null;\n          }\n          utils$1.addProfileToGlobalCache(profileId, profile);\n          return null;\n        }).catch(error => {\n          if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n            utils.logger.log('[Profiling] error while stopping profiler:', error);\n          }\n          return null;\n        });\n      });\n      return _onProfileHandler.apply(this, arguments);\n    }\n    var maxDurationTimeoutID = helpers.WINDOW.setTimeout(() => {\n      if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n        utils.logger.log('[Profiling] max profile duration elapsed, stopping profiling for:', transaction.name || transaction.description);\n      }\n      // If the timeout exceeds, we want to stop profiling, but not finish the transaction\n      void onProfileHandler();\n    }, utils$1.MAX_PROFILE_DURATION_MS);\n\n    // We need to reference the original finish call to avoid creating an infinite loop\n    var originalFinish = transaction.finish.bind(transaction);\n\n    /**\n     * Wraps startTransaction and stopTransaction with profiling related logic.\n     * startProfiling is called after the call to startTransaction in order to avoid our own code from\n     * being profiled. Because of that same reason, stopProfiling is called before the call to stopTransaction.\n     */\n    function profilingWrappedTransactionFinish() {\n      if (!transaction) {\n        return originalFinish();\n      }\n      // onProfileHandler should always return the same profile even if this is called multiple times.\n      // Always call onProfileHandler to ensure stopProfiling is called and the timeout is cleared.\n      void onProfileHandler().then(() => {\n        transaction.setContext('profile', {\n          profile_id: profileId,\n          start_timestamp: startTimestamp\n        });\n        originalFinish();\n      }, () => {\n        // If onProfileHandler fails, we still want to call the original finish method.\n        originalFinish();\n      });\n      return transaction;\n    }\n    transaction.finish = profilingWrappedTransactionFinish;\n    return transaction;\n  }\n  exports.onProfilingStartRouteTransaction = onProfilingStartRouteTransaction;\n  exports.startProfileForTransaction = startProfileForTransaction;\n});","lineCount":139,"map":[[3,2,1,0,"Object"],[3,8,1,6],[3,9,1,7,"defineProperty"],[3,23,1,21],[3,24,1,22,"exports"],[3,31,1,29],[3,33,1,31],[3,45,1,43],[3,47,1,45],[4,4,1,47,"value"],[4,9,1,52],[4,11,1,54],[5,2,1,59],[5,3,1,60],[5,4,1,61],[6,2,3,0],[6,6,3,6,"utils"],[6,11,3,11],[6,14,3,14,"require"],[6,21,3,21],[6,22,3,21,"_dependencyMap"],[6,36,3,21],[6,56,3,37],[6,57,3,38],[7,2,4,0],[7,6,4,6,"helpers"],[7,13,4,13],[7,16,4,16,"require"],[7,23,4,23],[7,24,4,23,"_dependencyMap"],[7,38,4,23],[7,58,4,39],[7,59,4,40],[8,2,5,0],[8,6,5,6,"utils$1"],[8,13,5,13],[8,16,5,16,"require"],[8,23,5,23],[8,24,5,23,"_dependencyMap"],[8,38,5,23],[8,55,5,36],[8,56,5,37],[10,2,7,0],[11,0,8,0],[12,0,9,0],[13,0,10,0],[14,0,11,0],[15,0,12,0],[16,0,13,0],[17,2,14,0],[17,11,14,9,"onProfilingStartRouteTransaction"],[17,43,14,41,"onProfilingStartRouteTransaction"],[17,44,14,42,"transaction"],[17,55,14,53],[17,57,14,55],[18,4,15,2],[18,8,15,6],[18,9,15,7,"transaction"],[18,20,15,18],[18,22,15,20],[19,6,16,4],[19,10,16,9],[19,17,16,16,"__SENTRY_DEBUG__"],[19,33,16,32],[19,38,16,37],[19,49,16,48],[19,53,16,52,"__SENTRY_DEBUG__"],[19,69,16,68],[19,71,16,71],[20,8,17,6,"utils"],[20,13,17,11],[20,14,17,12,"logger"],[20,20,17,18],[20,21,17,19,"log"],[20,24,17,22],[20,25,17,23],[20,83,17,81],[20,84,17,82],[21,6,18,4],[22,6,19,4],[22,13,19,11,"transaction"],[22,24,19,22],[23,4,20,2],[24,4,22,2],[24,8,22,6,"utils$1"],[24,15,22,13],[24,16,22,14,"shouldProfileTransaction"],[24,40,22,38],[24,41,22,39,"transaction"],[24,52,22,50],[24,53,22,51],[24,55,22,53],[25,6,23,4],[25,13,23,11,"startProfileForTransaction"],[25,39,23,37],[25,40,23,38,"transaction"],[25,51,23,49],[25,52,23,50],[26,4,24,2],[27,4,26,2],[27,11,26,9,"transaction"],[27,22,26,20],[28,2,27,0],[30,2,29,0],[31,0,30,0],[32,0,31,0],[33,0,32,0],[34,0,33,0],[35,2,34,0],[35,11,34,9,"startProfileForTransaction"],[35,37,34,35,"startProfileForTransaction"],[35,38,34,36,"transaction"],[35,49,34,47],[35,51,34,49],[36,4,35,2],[37,4,36,2],[37,8,36,6,"startTimestamp"],[37,22,36,20],[38,4,37,2],[38,8,37,6,"utils$1"],[38,15,37,13],[38,16,37,14,"isAutomatedPageLoadTransaction"],[38,46,37,44],[38,47,37,45,"transaction"],[38,58,37,56],[38,59,37,57],[38,61,37,59],[39,6,38,4,"startTimestamp"],[39,20,38,18],[39,23,38,21,"utils"],[39,28,38,26],[39,29,38,27,"timestampInSeconds"],[39,47,38,45],[39,48,38,46],[39,49,38,47],[39,52,38,50],[39,56,38,54],[40,4,39,2],[41,4,41,2],[41,8,41,8,"profiler"],[41,16,41,16],[41,19,41,19,"utils$1"],[41,26,41,26],[41,27,41,27,"startJSSelfProfile"],[41,45,41,45],[41,46,41,46],[41,47,41,47],[43,4,43,2],[44,4,44,2],[45,4,45,2],[45,8,45,6],[45,9,45,7,"profiler"],[45,17,45,15],[45,19,45,17],[46,6,46,4],[46,13,46,11,"transaction"],[46,24,46,22],[47,4,47,2],[48,4,49,2],[48,8,49,7],[48,15,49,14,"__SENTRY_DEBUG__"],[48,31,49,30],[48,36,49,35],[48,47,49,46],[48,51,49,50,"__SENTRY_DEBUG__"],[48,67,49,66],[48,69,49,69],[49,6,50,4,"utils"],[49,11,50,9],[49,12,50,10,"logger"],[49,18,50,16],[49,19,50,17,"log"],[49,22,50,20],[49,23,50,21],[49,69,50,67,"transaction"],[49,80,50,78],[49,81,50,79,"name"],[49,85,50,83],[49,89,50,87,"transaction"],[49,100,50,98],[49,101,50,99,"description"],[49,112,50,110],[49,114,50,112],[49,115,50,113],[50,4,51,2],[52,4,53,2],[53,4,54,2],[54,4,55,2],[55,4,56,2],[55,8,56,8,"profileId"],[55,17,56,17],[55,20,56,20,"utils"],[55,25,56,25],[55,26,56,26,"uuid4"],[55,31,56,31],[55,32,56,32],[55,33,56,33],[57,4,58,2],[58,0,59,0],[59,0,60,0],[60,4,58,2],[60,13,61,17,"onProfileHandler"],[60,29,61,33,"onProfileHandler"],[60,30,61,33],[61,6,61,33],[61,13,61,33,"_onProfileHandler"],[61,30,61,33],[61,31,61,33,"apply"],[61,36,61,33],[61,43,61,33,"arguments"],[61,52,61,33],[62,4,61,33],[62,6,105,2],[63,4,105,2],[63,13,105,2,"_onProfileHandler"],[63,31,105,2],[64,6,105,2,"_onProfileHandler"],[64,23,105,2],[64,26,105,2,"_asyncToGenerator"],[64,43,105,2],[64,44,61,2],[64,57,61,36],[65,8,62,4],[66,8,63,4],[66,12,63,8],[66,13,63,9,"transaction"],[66,24,63,20],[66,26,63,22],[67,10,64,6],[67,17,64,13],[67,21,64,17],[68,8,65,4],[69,8,66,4],[70,8,67,4],[70,12,67,8],[70,13,67,9,"profiler"],[70,21,67,17],[70,23,67,19],[71,10,68,6],[71,17,68,13],[71,21,68,17],[72,8,69,4],[73,8,71,4],[73,15,71,11,"profiler"],[73,23,71,19],[73,24,72,7,"stop"],[73,28,72,11],[73,29,72,12],[73,30,72,13],[73,31,73,7,"then"],[73,35,73,11],[73,36,73,13,"profile"],[73,43,73,20],[73,47,73,25],[74,10,74,8],[74,14,74,12,"maxDurationTimeoutID"],[74,34,74,32],[74,36,74,34],[75,12,75,10,"helpers"],[75,19,75,17],[75,20,75,18,"WINDOW"],[75,26,75,24],[75,27,75,25,"clearTimeout"],[75,39,75,37],[75,40,75,38,"maxDurationTimeoutID"],[75,60,75,58],[75,61,75,59],[76,12,76,10,"maxDurationTimeoutID"],[76,32,76,30],[76,35,76,33,"undefined"],[76,44,76,42],[77,10,77,8],[78,10,79,8],[78,14,79,13],[78,21,79,20,"__SENTRY_DEBUG__"],[78,37,79,36],[78,42,79,41],[78,53,79,52],[78,57,79,56,"__SENTRY_DEBUG__"],[78,73,79,72],[78,75,79,75],[79,12,80,10,"utils"],[79,17,80,15],[79,18,80,16,"logger"],[79,24,80,22],[79,25,80,23,"log"],[79,28,80,26],[79,29,80,27],[79,78,80,76,"transaction"],[79,89,80,87],[79,90,80,88,"name"],[79,94,80,92],[79,98,80,96,"transaction"],[79,109,80,107],[79,110,80,108,"description"],[79,121,80,119],[79,123,80,121],[79,124,80,122],[80,10,81,8],[82,10,83,8],[83,10,84,8],[83,14,84,12],[83,15,84,13,"profile"],[83,22,84,20],[83,24,84,22],[84,12,85,10],[84,16,85,15],[84,23,85,22,"__SENTRY_DEBUG__"],[84,39,85,38],[84,44,85,43],[84,55,85,54],[84,59,85,58,"__SENTRY_DEBUG__"],[84,75,85,74],[84,77,85,77],[85,14,86,12,"utils"],[85,19,86,17],[85,20,86,18,"logger"],[85,26,86,24],[85,27,86,25,"log"],[85,30,86,28],[85,31,87,14],[85,82,87,65,"transaction"],[85,93,87,76],[85,94,87,77,"name"],[85,98,87,81],[85,102,87,85,"transaction"],[85,113,87,96],[85,114,87,97,"description"],[85,125,87,108],[85,127,87,110],[85,129,88,14],[85,246,89,12],[85,247,89,13],[86,12,90,10],[87,12,91,10],[87,19,91,17],[87,23,91,21],[88,10,92,8],[89,10,94,8,"utils$1"],[89,17,94,15],[89,18,94,16,"addProfileToGlobalCache"],[89,41,94,39],[89,42,94,40,"profileId"],[89,51,94,49],[89,53,94,51,"profile"],[89,60,94,58],[89,61,94,59],[90,10,95,8],[90,17,95,15],[90,21,95,19],[91,8,96,6],[91,9,96,7],[91,10,96,8],[91,11,97,7,"catch"],[91,16,97,12],[91,17,97,13,"error"],[91,22,97,18],[91,26,97,22],[92,10,98,8],[92,14,98,13],[92,21,98,20,"__SENTRY_DEBUG__"],[92,37,98,36],[92,42,98,41],[92,53,98,52],[92,57,98,56,"__SENTRY_DEBUG__"],[92,73,98,72],[92,75,98,75],[93,12,99,10,"utils"],[93,17,99,15],[93,18,99,16,"logger"],[93,24,99,22],[93,25,99,23,"log"],[93,28,99,26],[93,29,99,27],[93,73,99,71],[93,75,99,73,"error"],[93,80,99,78],[93,81,99,79],[94,10,100,8],[95,10,101,8],[95,17,101,15],[95,21,101,19],[96,8,102,6],[96,9,102,7],[96,10,102,8],[97,6,103,2],[97,7,103,3],[98,6,103,3],[98,13,103,3,"_onProfileHandler"],[98,30,103,3],[98,31,103,3,"apply"],[98,36,103,3],[98,43,103,3,"arguments"],[98,52,103,3],[99,4,103,3],[100,4,106,2],[100,8,106,6,"maxDurationTimeoutID"],[100,28,106,26],[100,31,106,29,"helpers"],[100,38,106,36],[100,39,106,37,"WINDOW"],[100,45,106,43],[100,46,106,44,"setTimeout"],[100,56,106,54],[100,57,106,55],[100,63,106,61],[101,6,107,4],[101,10,107,9],[101,17,107,16,"__SENTRY_DEBUG__"],[101,33,107,32],[101,38,107,37],[101,49,107,48],[101,53,107,52,"__SENTRY_DEBUG__"],[101,69,107,68],[101,71,107,71],[102,8,108,6,"utils"],[102,13,108,11],[102,14,108,12,"logger"],[102,20,108,18],[102,21,108,19,"log"],[102,24,108,22],[102,25,109,8],[102,92,109,75],[102,94,110,8,"transaction"],[102,105,110,19],[102,106,110,20,"name"],[102,110,110,24],[102,114,110,28,"transaction"],[102,125,110,39],[102,126,110,40,"description"],[102,137,111,6],[102,138,111,7],[103,6,112,4],[104,6,113,4],[105,6,114,4],[105,11,114,9,"onProfileHandler"],[105,27,114,25],[105,28,114,26],[105,29,114,27],[106,4,115,2],[106,5,115,3],[106,7,115,5,"utils$1"],[106,14,115,12],[106,15,115,13,"MAX_PROFILE_DURATION_MS"],[106,38,115,36],[106,39,115,37],[108,4,117,2],[109,4,118,2],[109,8,118,8,"originalFinish"],[109,22,118,22],[109,25,118,25,"transaction"],[109,36,118,36],[109,37,118,37,"finish"],[109,43,118,43],[109,44,118,44,"bind"],[109,48,118,48],[109,49,118,49,"transaction"],[109,60,118,60],[109,61,118,61],[111,4,120,2],[112,0,121,0],[113,0,122,0],[114,0,123,0],[115,0,124,0],[116,4,125,2],[116,13,125,11,"profilingWrappedTransactionFinish"],[116,46,125,44,"profilingWrappedTransactionFinish"],[116,47,125,44],[116,49,125,47],[117,6,126,4],[117,10,126,8],[117,11,126,9,"transaction"],[117,22,126,20],[117,24,126,22],[118,8,127,6],[118,15,127,13,"originalFinish"],[118,29,127,27],[118,30,127,28],[118,31,127,29],[119,6,128,4],[120,6,129,4],[121,6,130,4],[122,6,131,4],[122,11,131,9,"onProfileHandler"],[122,27,131,25],[122,28,131,26],[122,29,131,27],[122,30,131,28,"then"],[122,34,131,32],[122,35,132,6],[122,41,132,12],[123,8,133,8,"transaction"],[123,19,133,19],[123,20,133,20,"setContext"],[123,30,133,30],[123,31,133,31],[123,40,133,40],[123,42,133,42],[124,10,133,44,"profile_id"],[124,20,133,54],[124,22,133,56,"profileId"],[124,31,133,65],[125,10,133,67,"start_timestamp"],[125,25,133,82],[125,27,133,84,"startTimestamp"],[126,8,133,99],[126,9,133,100],[126,10,133,101],[127,8,134,8,"originalFinish"],[127,22,134,22],[127,23,134,23],[127,24,134,24],[128,6,135,6],[128,7,135,7],[128,9,136,6],[128,15,136,12],[129,8,137,8],[130,8,138,8,"originalFinish"],[130,22,138,22],[130,23,138,23],[130,24,138,24],[131,6,139,6],[131,7,140,4],[131,8,140,5],[132,6,142,4],[132,13,142,11,"transaction"],[132,24,142,22],[133,4,143,2],[134,4,145,2,"transaction"],[134,15,145,13],[134,16,145,14,"finish"],[134,22,145,20],[134,25,145,23,"profilingWrappedTransactionFinish"],[134,58,145,56],[135,4,146,2],[135,11,146,9,"transaction"],[135,22,146,20],[136,2,147,0],[137,2,149,0,"exports"],[137,9,149,7],[137,10,149,8,"onProfilingStartRouteTransaction"],[137,42,149,40],[137,45,149,43,"onProfilingStartRouteTransaction"],[137,77,149,75],[138,2,150,0,"exports"],[138,9,150,7],[138,10,150,8,"startProfileForTransaction"],[138,36,150,34],[138,39,150,37,"startProfileForTransaction"],[138,65,150,63],[139,0,150,64],[139,3]],"functionMap":{"names":["<global>","onProfilingStartRouteTransaction","startProfileForTransaction","onProfileHandler","profiler.stop.then$argument_0","profiler.stop.then._catch$argument_0","helpers.WINDOW.setTimeout$argument_0","profilingWrappedTransactionFinish","onProfileHandler.then$argument_0","onProfileHandler.then$argument_1"],"mappings":"AAA;ACa;CDa;AEO;EC2B;YCY;ODuB;aEC;OFK;GDC;uDIG;GJS;EKU;MCO;ODG;MEC;OFG;GLI;CFI"},"hasCjsExports":true},"type":"js/module"}]}