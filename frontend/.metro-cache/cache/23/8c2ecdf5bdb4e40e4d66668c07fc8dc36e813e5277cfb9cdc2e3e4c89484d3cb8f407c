{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"../authStorage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":157},"end":{"line":7,"column":47,"index":204}}],"key":"8h7N/7sKemAZqrgZg8dH/jTl5ys=","exportNames":["*"],"imports":1}},{"name":"../types/receipt","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":205},"end":{"line":8,"column":65,"index":270}}],"key":"W14jz77KoHdh2OnwnpYz6E6ocCQ=","exportNames":["*"],"imports":1}},{"name":"../telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":271},"end":{"line":9,"column":52,"index":323}}],"key":"k7LZwhoWMWET/ud396YGvDlODrM=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getStoreCatalog = getStoreCatalog;\n  exports.createPurchaseIntent = createPurchaseIntent;\n  exports.redeemIntent = redeemIntent;\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _authStorage = require(_dependencyMap[1], \"../authStorage\");\n  var _typesReceipt = require(_dependencyMap[2], \"../types/receipt\");\n  var _telemetryEvents = require(_dependencyMap[3], \"../telemetry/events\");\n  // /app/frontend/lib/api/store.ts\n  // Phase 3.30: Store API Layer\n  //\n  // Catalog, purchase intent, and dev-only redeem.\n  // Uses canonical receipt for redeem.\n\n  const API_BASE = _expoVirtualEnv.env.EXPO_PUBLIC_API_URL || '';\n\n  // Auth header helper\n  async function getAuthHeaders() {\n    const token = await (0, _authStorage.loadAuthToken)();\n    if (!token) {\n      return {\n        'Content-Type': 'application/json'\n      };\n    }\n    return {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}`\n    };\n  }\n\n  // Store item from catalog\n\n  // Purchase intent response\n\n  /**\n   * Get store catalog\n   */\n  async function getStoreCatalog() {\n    try {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`${API_BASE}/api/store/catalog`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch catalog');\n      const data = await res.json();\n      return data.catalog || [];\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Create purchase intent\n   */\n  async function createPurchaseIntent(sku) {\n    const headers = await getAuthHeaders();\n    const params = new URLSearchParams({\n      sku\n    });\n    const res = await fetch(`${API_BASE}/api/store/purchase-intent?${params}`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) {\n      const error = await res.json().catch(() => ({\n        detail: 'Failed to create intent'\n      }));\n      throw new Error(error.detail || 'Failed to create intent');\n    }\n    const intent = await res.json();\n\n    // Emit telemetry\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_PURCHASE_INTENT_CREATED, {\n      intentId: intent.intentId,\n      sku: intent.sku\n    });\n    return intent;\n  }\n\n  /**\n   * DEV-ONLY: Redeem purchase intent without payment\n   * Returns canonical receipt.\n   */\n  async function redeemIntent(intentId) {\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUBMITTED, {\n      intentId\n    });\n    const headers = await getAuthHeaders();\n    const params = new URLSearchParams({\n      intent_id: intentId\n    });\n    const res = await fetch(`${API_BASE}/api/store/redeem-intent?${params}`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) {\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ERROR, {\n        intentId,\n        status: res.status\n      });\n      const error = await res.json().catch(() => ({\n        detail: 'Failed to redeem'\n      }));\n      throw new Error(error.detail || 'Failed to redeem');\n    }\n    const receipt = await res.json();\n    if ((0, _typesReceipt.isValidReceipt)(receipt)) {\n      if (receipt.alreadyClaimed) {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ALREADY_CLAIMED, {\n          intentId\n        });\n      } else {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUCCESS, {\n          intentId,\n          itemCount: receipt.items.length\n        });\n      }\n    }\n    return receipt;\n  }\n});","lineCount":126,"map":[[7,2,48,0,"exports"],[7,9,48,0],[7,10,48,0,"getStoreCatalog"],[7,25,48,0],[7,28,48,0,"getStoreCatalog"],[7,43,48,0],[8,2,63,0,"exports"],[8,9,63,0],[8,10,63,0,"createPurchaseIntent"],[8,30,63,0],[8,33,63,0,"createPurchaseIntent"],[8,53,63,0],[9,2,92,0,"exports"],[9,9,92,0],[9,10,92,0,"redeemIntent"],[9,22,92,0],[9,25,92,0,"redeemIntent"],[9,37,92,0],[10,2,123,1],[10,6,123,1,"_expoVirtualEnv"],[10,21,123,1],[10,24,123,1,"require"],[10,31,123,1],[10,32,123,1,"_dependencyMap"],[10,46,123,1],[11,2,7,0],[11,6,7,0,"_authStorage"],[11,18,7,0],[11,21,7,0,"require"],[11,28,7,0],[11,29,7,0,"_dependencyMap"],[11,43,7,0],[12,2,8,0],[12,6,8,0,"_typesReceipt"],[12,19,8,0],[12,22,8,0,"require"],[12,29,8,0],[12,30,8,0,"_dependencyMap"],[12,44,8,0],[13,2,9,0],[13,6,9,0,"_telemetryEvents"],[13,22,9,0],[13,25,9,0,"require"],[13,32,9,0],[13,33,9,0,"_dependencyMap"],[13,47,9,0],[14,2,1,0],[15,2,2,0],[16,2,3,0],[17,2,4,0],[18,2,5,0],[20,2,11,0],[20,8,11,6,"API_BASE"],[20,16,11,14],[20,19,11,17,"_expoVirtualEnv"],[20,34,11,17],[20,35,11,17,"env"],[20,38,11,17],[20,39,11,17,"EXPO_PUBLIC_API_URL"],[20,58,11,17],[20,62,11,52],[20,64,11,54],[22,2,13,0],[23,2,14,0],[23,17,14,15,"getAuthHeaders"],[23,31,14,29,"getAuthHeaders"],[23,32,14,29],[23,34,14,65],[24,4,15,2],[24,10,15,8,"token"],[24,15,15,13],[24,18,15,16],[24,24,15,22],[24,28,15,22,"loadAuthToken"],[24,40,15,35],[24,41,15,35,"loadAuthToken"],[24,54,15,35],[24,56,15,36],[24,57,15,37],[25,4,16,2],[25,8,16,6],[25,9,16,7,"token"],[25,14,16,12],[25,16,16,14],[26,6,17,4],[26,13,17,11],[27,8,17,13],[27,22,17,27],[27,24,17,29],[28,6,17,48],[28,7,17,49],[29,4,18,2],[30,4,19,2],[30,11,19,9],[31,6,20,4],[31,20,20,18],[31,22,20,20],[31,40,20,38],[32,6,21,4],[32,21,21,19],[32,23,21,21],[32,33,21,31,"token"],[32,38,21,36],[33,4,22,2],[33,5,22,3],[34,2,23,0],[36,2,25,0],[38,2,35,0],[40,2,45,0],[41,0,46,0],[42,0,47,0],[43,2,48,7],[43,17,48,22,"getStoreCatalog"],[43,32,48,37,"getStoreCatalog"],[43,33,48,37],[43,35,48,62],[44,4,49,2],[44,8,49,6],[45,6,50,4],[45,12,50,10,"headers"],[45,19,50,17],[45,22,50,20],[45,28,50,26,"getAuthHeaders"],[45,42,50,40],[45,43,50,41],[45,44,50,42],[46,6,51,4],[46,12,51,10,"res"],[46,15,51,13],[46,18,51,16],[46,24,51,22,"fetch"],[46,29,51,27],[46,30,51,28],[46,33,51,31,"API_BASE"],[46,41,51,39],[46,61,51,59],[46,63,51,61],[47,8,51,63,"headers"],[48,6,51,71],[48,7,51,72],[48,8,51,73],[49,6,52,4],[49,10,52,8],[49,11,52,9,"res"],[49,14,52,12],[49,15,52,13,"ok"],[49,17,52,15],[49,19,52,17],[49,25,52,23],[49,29,52,27,"Error"],[49,34,52,32],[49,35,52,33],[49,60,52,58],[49,61,52,59],[50,6,53,4],[50,12,53,10,"data"],[50,16,53,14],[50,19,53,17],[50,25,53,23,"res"],[50,28,53,26],[50,29,53,27,"json"],[50,33,53,31],[50,34,53,32],[50,35,53,33],[51,6,54,4],[51,13,54,11,"data"],[51,17,54,15],[51,18,54,16,"catalog"],[51,25,54,23],[51,29,54,27],[51,31,54,29],[52,4,55,2],[52,5,55,3],[52,6,55,4],[52,12,55,10],[53,6,56,4],[53,13,56,11],[53,15,56,13],[54,4,57,2],[55,2,58,0],[57,2,60,0],[58,0,61,0],[59,0,62,0],[60,2,63,7],[60,17,63,22,"createPurchaseIntent"],[60,37,63,42,"createPurchaseIntent"],[60,38,63,43,"sku"],[60,41,63,54],[60,43,63,81],[61,4,64,2],[61,10,64,8,"headers"],[61,17,64,15],[61,20,64,18],[61,26,64,24,"getAuthHeaders"],[61,40,64,38],[61,41,64,39],[61,42,64,40],[62,4,65,2],[62,10,65,8,"params"],[62,16,65,14],[62,19,65,17],[62,23,65,21,"URLSearchParams"],[62,38,65,36],[62,39,65,37],[63,6,65,39,"sku"],[64,4,65,43],[64,5,65,44],[64,6,65,45],[65,4,67,2],[65,10,67,8,"res"],[65,13,67,11],[65,16,67,14],[65,22,67,20,"fetch"],[65,27,67,25],[65,28,67,26],[65,31,67,29,"API_BASE"],[65,39,67,37],[65,69,67,67,"params"],[65,75,67,73],[65,77,67,75],[65,79,67,77],[66,6,68,4,"method"],[66,12,68,10],[66,14,68,12],[66,20,68,18],[67,6,69,4,"headers"],[68,4,70,2],[68,5,70,3],[68,6,70,4],[69,4,72,2],[69,8,72,6],[69,9,72,7,"res"],[69,12,72,10],[69,13,72,11,"ok"],[69,15,72,13],[69,17,72,15],[70,6,73,4],[70,12,73,10,"error"],[70,17,73,15],[70,20,73,18],[70,26,73,24,"res"],[70,29,73,27],[70,30,73,28,"json"],[70,34,73,32],[70,35,73,33],[70,36,73,34],[70,37,73,35,"catch"],[70,42,73,40],[70,43,73,41],[70,50,73,48],[71,8,73,50,"detail"],[71,14,73,56],[71,16,73,58],[72,6,73,84],[72,7,73,85],[72,8,73,86],[72,9,73,87],[73,6,74,4],[73,12,74,10],[73,16,74,14,"Error"],[73,21,74,19],[73,22,74,20,"error"],[73,27,74,25],[73,28,74,26,"detail"],[73,34,74,32],[73,38,74,36],[73,63,74,61],[73,64,74,62],[74,4,75,2],[75,4,77,2],[75,10,77,8,"intent"],[75,16,77,14],[75,19,77,17],[75,25,77,23,"res"],[75,28,77,26],[75,29,77,27,"json"],[75,33,77,31],[75,34,77,32],[75,35,77,33],[77,4,79,2],[78,4,80,2],[78,8,80,2,"track"],[78,24,80,7],[78,25,80,7,"track"],[78,30,80,7],[78,32,80,8,"Events"],[78,48,80,14],[78,49,80,14,"Events"],[78,55,80,14],[78,56,80,15,"STORE_PURCHASE_INTENT_CREATED"],[78,85,80,44],[78,87,80,46],[79,6,81,4,"intentId"],[79,14,81,12],[79,16,81,14,"intent"],[79,22,81,20],[79,23,81,21,"intentId"],[79,31,81,29],[80,6,82,4,"sku"],[80,9,82,7],[80,11,82,9,"intent"],[80,17,82,15],[80,18,82,16,"sku"],[81,4,83,2],[81,5,83,3],[81,6,83,4],[82,4,85,2],[82,11,85,9,"intent"],[82,17,85,15],[83,2,86,0],[85,2,88,0],[86,0,89,0],[87,0,90,0],[88,0,91,0],[89,2,92,7],[89,17,92,22,"redeemIntent"],[89,29,92,34,"redeemIntent"],[89,30,92,35,"intentId"],[89,38,92,51],[89,40,92,77],[90,4,93,2],[90,8,93,2,"track"],[90,24,93,7],[90,25,93,7,"track"],[90,30,93,7],[90,32,93,8,"Events"],[90,48,93,14],[90,49,93,14,"Events"],[90,55,93,14],[90,56,93,15,"STORE_REDEEM_SUBMITTED"],[90,78,93,37],[90,80,93,39],[91,6,93,41,"intentId"],[92,4,93,50],[92,5,93,51],[92,6,93,52],[93,4,95,2],[93,10,95,8,"headers"],[93,17,95,15],[93,20,95,18],[93,26,95,24,"getAuthHeaders"],[93,40,95,38],[93,41,95,39],[93,42,95,40],[94,4,96,2],[94,10,96,8,"params"],[94,16,96,14],[94,19,96,17],[94,23,96,21,"URLSearchParams"],[94,38,96,36],[94,39,96,37],[95,6,96,39,"intent_id"],[95,15,96,48],[95,17,96,50,"intentId"],[96,4,96,59],[96,5,96,60],[96,6,96,61],[97,4,98,2],[97,10,98,8,"res"],[97,13,98,11],[97,16,98,14],[97,22,98,20,"fetch"],[97,27,98,25],[97,28,98,26],[97,31,98,29,"API_BASE"],[97,39,98,37],[97,67,98,65,"params"],[97,73,98,71],[97,75,98,73],[97,77,98,75],[98,6,99,4,"method"],[98,12,99,10],[98,14,99,12],[98,20,99,18],[99,6,100,4,"headers"],[100,4,101,2],[100,5,101,3],[100,6,101,4],[101,4,103,2],[101,8,103,6],[101,9,103,7,"res"],[101,12,103,10],[101,13,103,11,"ok"],[101,15,103,13],[101,17,103,15],[102,6,104,4],[102,10,104,4,"track"],[102,26,104,9],[102,27,104,9,"track"],[102,32,104,9],[102,34,104,10,"Events"],[102,50,104,16],[102,51,104,16,"Events"],[102,57,104,16],[102,58,104,17,"STORE_REDEEM_ERROR"],[102,76,104,35],[102,78,104,37],[103,8,104,39,"intentId"],[103,16,104,47],[104,8,104,49,"status"],[104,14,104,55],[104,16,104,57,"res"],[104,19,104,60],[104,20,104,61,"status"],[105,6,104,68],[105,7,104,69],[105,8,104,70],[106,6,105,4],[106,12,105,10,"error"],[106,17,105,15],[106,20,105,18],[106,26,105,24,"res"],[106,29,105,27],[106,30,105,28,"json"],[106,34,105,32],[106,35,105,33],[106,36,105,34],[106,37,105,35,"catch"],[106,42,105,40],[106,43,105,41],[106,50,105,48],[107,8,105,50,"detail"],[107,14,105,56],[107,16,105,58],[108,6,105,77],[108,7,105,78],[108,8,105,79],[108,9,105,80],[109,6,106,4],[109,12,106,10],[109,16,106,14,"Error"],[109,21,106,19],[109,22,106,20,"error"],[109,27,106,25],[109,28,106,26,"detail"],[109,34,106,32],[109,38,106,36],[109,56,106,54],[109,57,106,55],[110,4,107,2],[111,4,109,2],[111,10,109,8,"receipt"],[111,17,109,15],[111,20,109,18],[111,26,109,24,"res"],[111,29,109,27],[111,30,109,28,"json"],[111,34,109,32],[111,35,109,33],[111,36,109,34],[112,4,111,2],[112,8,111,6],[112,12,111,6,"isValidReceipt"],[112,25,111,20],[112,26,111,20,"isValidReceipt"],[112,40,111,20],[112,42,111,21,"receipt"],[112,49,111,28],[112,50,111,29],[112,52,111,31],[113,6,112,4],[113,10,112,8,"receipt"],[113,17,112,15],[113,18,112,16,"alreadyClaimed"],[113,32,112,30],[113,34,112,32],[114,8,113,6],[114,12,113,6,"track"],[114,28,113,11],[114,29,113,11,"track"],[114,34,113,11],[114,36,113,12,"Events"],[114,52,113,18],[114,53,113,18,"Events"],[114,59,113,18],[114,60,113,19,"STORE_REDEEM_ALREADY_CLAIMED"],[114,88,113,47],[114,90,113,49],[115,10,113,51,"intentId"],[116,8,113,60],[116,9,113,61],[116,10,113,62],[117,6,114,4],[117,7,114,5],[117,13,114,11],[118,8,115,6],[118,12,115,6,"track"],[118,28,115,11],[118,29,115,11,"track"],[118,34,115,11],[118,36,115,12,"Events"],[118,52,115,18],[118,53,115,18,"Events"],[118,59,115,18],[118,60,115,19,"STORE_REDEEM_SUCCESS"],[118,80,115,39],[118,82,115,41],[119,10,116,8,"intentId"],[119,18,116,16],[120,10,117,8,"itemCount"],[120,19,117,17],[120,21,117,19,"receipt"],[120,28,117,26],[120,29,117,27,"items"],[120,34,117,32],[120,35,117,33,"length"],[121,8,118,6],[121,9,118,7],[121,10,118,8],[122,6,119,4],[123,4,120,2],[124,4,122,2],[124,11,122,9,"receipt"],[124,18,122,16],[125,2,123,0],[126,0,123,1],[126,3]],"functionMap":{"names":["<global>","getAuthHeaders","getStoreCatalog","createPurchaseIntent","res.json._catch$argument_0","redeemIntent"],"mappings":"AAA;ACa;CDS;OEyB;CFU;OGK;yCCU,6CD;CHa;OKM;yCDa,sCC;CLkB"},"hasCjsExports":false},"type":"js/module"}]}