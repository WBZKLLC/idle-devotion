{"dependencies":[{"name":"../types/receipt","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":186},"end":{"line":8,"column":65,"index":251}}],"key":"W14jz77KoHdh2OnwnpYz6E6ocCQ=","exportNames":["*"],"imports":1}},{"name":"../telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":252},"end":{"line":9,"column":52,"index":304}}],"key":"k7LZwhoWMWET/ud396YGvDlODrM=","exportNames":["*"],"imports":1}},{"name":"./config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":305},"end":{"line":10,"column":50,"index":355}}],"key":"apL7GyCxHQJfXSypmIMW0g+q+wo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getStoreCatalog = getStoreCatalog;\n  exports.createPurchaseIntent = createPurchaseIntent;\n  exports.redeemIntent = redeemIntent;\n  var _typesReceipt = require(_dependencyMap[0], \"../types/receipt\");\n  var _telemetryEvents = require(_dependencyMap[1], \"../telemetry/events\");\n  var _config = require(_dependencyMap[2], \"./config\");\n  // /app/frontend/lib/api/store.ts\n  // Phase 3.30: Store API Layer\n  //\n  // Catalog, purchase intent, and dev-only redeem.\n  // Uses canonical receipt for redeem.\n\n  // Auth handled by config.ts\n\n  // Store item from catalog\n\n  // Purchase intent response\n\n  /**\n   * Get store catalog\n   */\n  async function getStoreCatalog() {\n    try {\n      const headers = await (0, _config.getAuthHeaders)();\n      const res = await fetch((0, _config.apiUrl)('/api/store/catalog'), {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch catalog');\n      const data = await res.json();\n      return data.catalog || [];\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Create purchase intent\n   */\n  async function createPurchaseIntent(sku) {\n    const headers = await (0, _config.getAuthHeaders)();\n    const params = new URLSearchParams({\n      sku\n    });\n    const res = await fetch((0, _config.apiUrl)(`/api/store/purchase-intent?${params}`), {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) {\n      const error = await res.json().catch(() => ({\n        detail: 'Failed to create intent'\n      }));\n      throw new Error(error.detail || 'Failed to create intent');\n    }\n    const intent = await res.json();\n\n    // Emit telemetry\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_PURCHASE_INTENT_CREATED, {\n      intentId: intent.intentId,\n      sku: intent.sku\n    });\n    return intent;\n  }\n\n  /**\n   * DEV-ONLY: Redeem purchase intent without payment\n   * Returns canonical receipt.\n   */\n  async function redeemIntent(intentId) {\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUBMITTED, {\n      intentId\n    });\n    const headers = await (0, _config.getAuthHeaders)();\n    const params = new URLSearchParams({\n      intent_id: intentId\n    });\n    const res = await fetch((0, _config.apiUrl)(`/api/store/redeem-intent?${params}`), {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) {\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ERROR, {\n        intentId,\n        status: res.status\n      });\n      const error = await res.json().catch(() => ({\n        detail: 'Failed to redeem'\n      }));\n      throw new Error(error.detail || 'Failed to redeem');\n    }\n    const receipt = await res.json();\n    if ((0, _typesReceipt.isValidReceipt)(receipt)) {\n      if (receipt.alreadyClaimed) {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ALREADY_CLAIMED, {\n          intentId\n        });\n      } else {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUCCESS, {\n          intentId,\n          itemCount: receipt.items.length\n        });\n      }\n    }\n    return receipt;\n  }\n});","lineCount":111,"map":[[7,2,35,0,"exports"],[7,9,35,0],[7,10,35,0,"getStoreCatalog"],[7,25,35,0],[7,28,35,0,"getStoreCatalog"],[7,43,35,0],[8,2,50,0,"exports"],[8,9,50,0],[8,10,50,0,"createPurchaseIntent"],[8,30,50,0],[8,33,50,0,"createPurchaseIntent"],[8,53,50,0],[9,2,79,0,"exports"],[9,9,79,0],[9,10,79,0,"redeemIntent"],[9,22,79,0],[9,25,79,0,"redeemIntent"],[9,37,79,0],[10,2,8,0],[10,6,8,0,"_typesReceipt"],[10,19,8,0],[10,22,8,0,"require"],[10,29,8,0],[10,30,8,0,"_dependencyMap"],[10,44,8,0],[11,2,9,0],[11,6,9,0,"_telemetryEvents"],[11,22,9,0],[11,25,9,0,"require"],[11,32,9,0],[11,33,9,0,"_dependencyMap"],[11,47,9,0],[12,2,10,0],[12,6,10,0,"_config"],[12,13,10,0],[12,16,10,0,"require"],[12,23,10,0],[12,24,10,0,"_dependencyMap"],[12,38,10,0],[13,2,1,0],[14,2,2,0],[15,2,3,0],[16,2,4,0],[17,2,5,0],[19,2,7,0],[21,2,12,0],[23,2,22,0],[25,2,32,0],[26,0,33,0],[27,0,34,0],[28,2,35,7],[28,17,35,22,"getStoreCatalog"],[28,32,35,37,"getStoreCatalog"],[28,33,35,37],[28,35,35,62],[29,4,36,2],[29,8,36,6],[30,6,37,4],[30,12,37,10,"headers"],[30,19,37,17],[30,22,37,20],[30,28,37,26],[30,32,37,26,"getAuthHeaders"],[30,39,37,40],[30,40,37,40,"getAuthHeaders"],[30,54,37,40],[30,56,37,41],[30,57,37,42],[31,6,38,4],[31,12,38,10,"res"],[31,15,38,13],[31,18,38,16],[31,24,38,22,"fetch"],[31,29,38,27],[31,30,38,28],[31,34,38,28,"apiUrl"],[31,41,38,34],[31,42,38,34,"apiUrl"],[31,48,38,34],[31,50,38,35],[31,70,38,55],[31,71,38,56],[31,73,38,58],[32,8,38,60,"headers"],[33,6,38,68],[33,7,38,69],[33,8,38,70],[34,6,39,4],[34,10,39,8],[34,11,39,9,"res"],[34,14,39,12],[34,15,39,13,"ok"],[34,17,39,15],[34,19,39,17],[34,25,39,23],[34,29,39,27,"Error"],[34,34,39,32],[34,35,39,33],[34,60,39,58],[34,61,39,59],[35,6,40,4],[35,12,40,10,"data"],[35,16,40,14],[35,19,40,17],[35,25,40,23,"res"],[35,28,40,26],[35,29,40,27,"json"],[35,33,40,31],[35,34,40,32],[35,35,40,33],[36,6,41,4],[36,13,41,11,"data"],[36,17,41,15],[36,18,41,16,"catalog"],[36,25,41,23],[36,29,41,27],[36,31,41,29],[37,4,42,2],[37,5,42,3],[37,6,42,4],[37,12,42,10],[38,6,43,4],[38,13,43,11],[38,15,43,13],[39,4,44,2],[40,2,45,0],[42,2,47,0],[43,0,48,0],[44,0,49,0],[45,2,50,7],[45,17,50,22,"createPurchaseIntent"],[45,37,50,42,"createPurchaseIntent"],[45,38,50,43,"sku"],[45,41,50,54],[45,43,50,81],[46,4,51,2],[46,10,51,8,"headers"],[46,17,51,15],[46,20,51,18],[46,26,51,24],[46,30,51,24,"getAuthHeaders"],[46,37,51,38],[46,38,51,38,"getAuthHeaders"],[46,52,51,38],[46,54,51,39],[46,55,51,40],[47,4,52,2],[47,10,52,8,"params"],[47,16,52,14],[47,19,52,17],[47,23,52,21,"URLSearchParams"],[47,38,52,36],[47,39,52,37],[48,6,52,39,"sku"],[49,4,52,43],[49,5,52,44],[49,6,52,45],[50,4,54,2],[50,10,54,8,"res"],[50,13,54,11],[50,16,54,14],[50,22,54,20,"fetch"],[50,27,54,25],[50,28,54,26],[50,32,54,26,"apiUrl"],[50,39,54,32],[50,40,54,32,"apiUrl"],[50,46,54,32],[50,48,54,33],[50,78,54,63,"params"],[50,84,54,69],[50,86,54,71],[50,87,54,72],[50,89,54,74],[51,6,55,4,"method"],[51,12,55,10],[51,14,55,12],[51,20,55,18],[52,6,56,4,"headers"],[53,4,57,2],[53,5,57,3],[53,6,57,4],[54,4,59,2],[54,8,59,6],[54,9,59,7,"res"],[54,12,59,10],[54,13,59,11,"ok"],[54,15,59,13],[54,17,59,15],[55,6,60,4],[55,12,60,10,"error"],[55,17,60,15],[55,20,60,18],[55,26,60,24,"res"],[55,29,60,27],[55,30,60,28,"json"],[55,34,60,32],[55,35,60,33],[55,36,60,34],[55,37,60,35,"catch"],[55,42,60,40],[55,43,60,41],[55,50,60,48],[56,8,60,50,"detail"],[56,14,60,56],[56,16,60,58],[57,6,60,84],[57,7,60,85],[57,8,60,86],[57,9,60,87],[58,6,61,4],[58,12,61,10],[58,16,61,14,"Error"],[58,21,61,19],[58,22,61,20,"error"],[58,27,61,25],[58,28,61,26,"detail"],[58,34,61,32],[58,38,61,36],[58,63,61,61],[58,64,61,62],[59,4,62,2],[60,4,64,2],[60,10,64,8,"intent"],[60,16,64,14],[60,19,64,17],[60,25,64,23,"res"],[60,28,64,26],[60,29,64,27,"json"],[60,33,64,31],[60,34,64,32],[60,35,64,33],[62,4,66,2],[63,4,67,2],[63,8,67,2,"track"],[63,24,67,7],[63,25,67,7,"track"],[63,30,67,7],[63,32,67,8,"Events"],[63,48,67,14],[63,49,67,14,"Events"],[63,55,67,14],[63,56,67,15,"STORE_PURCHASE_INTENT_CREATED"],[63,85,67,44],[63,87,67,46],[64,6,68,4,"intentId"],[64,14,68,12],[64,16,68,14,"intent"],[64,22,68,20],[64,23,68,21,"intentId"],[64,31,68,29],[65,6,69,4,"sku"],[65,9,69,7],[65,11,69,9,"intent"],[65,17,69,15],[65,18,69,16,"sku"],[66,4,70,2],[66,5,70,3],[66,6,70,4],[67,4,72,2],[67,11,72,9,"intent"],[67,17,72,15],[68,2,73,0],[70,2,75,0],[71,0,76,0],[72,0,77,0],[73,0,78,0],[74,2,79,7],[74,17,79,22,"redeemIntent"],[74,29,79,34,"redeemIntent"],[74,30,79,35,"intentId"],[74,38,79,51],[74,40,79,77],[75,4,80,2],[75,8,80,2,"track"],[75,24,80,7],[75,25,80,7,"track"],[75,30,80,7],[75,32,80,8,"Events"],[75,48,80,14],[75,49,80,14,"Events"],[75,55,80,14],[75,56,80,15,"STORE_REDEEM_SUBMITTED"],[75,78,80,37],[75,80,80,39],[76,6,80,41,"intentId"],[77,4,80,50],[77,5,80,51],[77,6,80,52],[78,4,82,2],[78,10,82,8,"headers"],[78,17,82,15],[78,20,82,18],[78,26,82,24],[78,30,82,24,"getAuthHeaders"],[78,37,82,38],[78,38,82,38,"getAuthHeaders"],[78,52,82,38],[78,54,82,39],[78,55,82,40],[79,4,83,2],[79,10,83,8,"params"],[79,16,83,14],[79,19,83,17],[79,23,83,21,"URLSearchParams"],[79,38,83,36],[79,39,83,37],[80,6,83,39,"intent_id"],[80,15,83,48],[80,17,83,50,"intentId"],[81,4,83,59],[81,5,83,60],[81,6,83,61],[82,4,85,2],[82,10,85,8,"res"],[82,13,85,11],[82,16,85,14],[82,22,85,20,"fetch"],[82,27,85,25],[82,28,85,26],[82,32,85,26,"apiUrl"],[82,39,85,32],[82,40,85,32,"apiUrl"],[82,46,85,32],[82,48,85,33],[82,76,85,61,"params"],[82,82,85,67],[82,84,85,69],[82,85,85,70],[82,87,85,72],[83,6,86,4,"method"],[83,12,86,10],[83,14,86,12],[83,20,86,18],[84,6,87,4,"headers"],[85,4,88,2],[85,5,88,3],[85,6,88,4],[86,4,90,2],[86,8,90,6],[86,9,90,7,"res"],[86,12,90,10],[86,13,90,11,"ok"],[86,15,90,13],[86,17,90,15],[87,6,91,4],[87,10,91,4,"track"],[87,26,91,9],[87,27,91,9,"track"],[87,32,91,9],[87,34,91,10,"Events"],[87,50,91,16],[87,51,91,16,"Events"],[87,57,91,16],[87,58,91,17,"STORE_REDEEM_ERROR"],[87,76,91,35],[87,78,91,37],[88,8,91,39,"intentId"],[88,16,91,47],[89,8,91,49,"status"],[89,14,91,55],[89,16,91,57,"res"],[89,19,91,60],[89,20,91,61,"status"],[90,6,91,68],[90,7,91,69],[90,8,91,70],[91,6,92,4],[91,12,92,10,"error"],[91,17,92,15],[91,20,92,18],[91,26,92,24,"res"],[91,29,92,27],[91,30,92,28,"json"],[91,34,92,32],[91,35,92,33],[91,36,92,34],[91,37,92,35,"catch"],[91,42,92,40],[91,43,92,41],[91,50,92,48],[92,8,92,50,"detail"],[92,14,92,56],[92,16,92,58],[93,6,92,77],[93,7,92,78],[93,8,92,79],[93,9,92,80],[94,6,93,4],[94,12,93,10],[94,16,93,14,"Error"],[94,21,93,19],[94,22,93,20,"error"],[94,27,93,25],[94,28,93,26,"detail"],[94,34,93,32],[94,38,93,36],[94,56,93,54],[94,57,93,55],[95,4,94,2],[96,4,96,2],[96,10,96,8,"receipt"],[96,17,96,15],[96,20,96,18],[96,26,96,24,"res"],[96,29,96,27],[96,30,96,28,"json"],[96,34,96,32],[96,35,96,33],[96,36,96,34],[97,4,98,2],[97,8,98,6],[97,12,98,6,"isValidReceipt"],[97,25,98,20],[97,26,98,20,"isValidReceipt"],[97,40,98,20],[97,42,98,21,"receipt"],[97,49,98,28],[97,50,98,29],[97,52,98,31],[98,6,99,4],[98,10,99,8,"receipt"],[98,17,99,15],[98,18,99,16,"alreadyClaimed"],[98,32,99,30],[98,34,99,32],[99,8,100,6],[99,12,100,6,"track"],[99,28,100,11],[99,29,100,11,"track"],[99,34,100,11],[99,36,100,12,"Events"],[99,52,100,18],[99,53,100,18,"Events"],[99,59,100,18],[99,60,100,19,"STORE_REDEEM_ALREADY_CLAIMED"],[99,88,100,47],[99,90,100,49],[100,10,100,51,"intentId"],[101,8,100,60],[101,9,100,61],[101,10,100,62],[102,6,101,4],[102,7,101,5],[102,13,101,11],[103,8,102,6],[103,12,102,6,"track"],[103,28,102,11],[103,29,102,11,"track"],[103,34,102,11],[103,36,102,12,"Events"],[103,52,102,18],[103,53,102,18,"Events"],[103,59,102,18],[103,60,102,19,"STORE_REDEEM_SUCCESS"],[103,80,102,39],[103,82,102,41],[104,10,103,8,"intentId"],[104,18,103,16],[105,10,104,8,"itemCount"],[105,19,104,17],[105,21,104,19,"receipt"],[105,28,104,26],[105,29,104,27,"items"],[105,34,104,32],[105,35,104,33,"length"],[106,8,105,6],[106,9,105,7],[106,10,105,8],[107,6,106,4],[108,4,107,2],[109,4,109,2],[109,11,109,9,"receipt"],[109,18,109,16],[110,2,110,0],[111,0,110,1],[111,3]],"functionMap":{"names":["<global>","getStoreCatalog","createPurchaseIntent","res.json._catch$argument_0","redeemIntent"],"mappings":"AAA;OCkC;CDU;OEK;yCCU,6CD;CFa;OIM;yCDa,sCC;CJkB"},"hasCjsExports":false},"type":"js/module"}]}