{"dependencies":[{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":88,"index":88}}],"key":"m+kcirlwHAgMIuUoyR2vCxbhWD4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"MIN_DELAY\", {\n    enumerable: true,\n    get: function () {\n      return MIN_DELAY;\n    }\n  });\n  Object.defineProperty(exports, \"START_DELAY\", {\n    enumerable: true,\n    get: function () {\n      return START_DELAY;\n    }\n  });\n  Object.defineProperty(exports, \"makeOfflineTransport\", {\n    enumerable: true,\n    get: function () {\n      return makeOfflineTransport;\n    }\n  });\n  var _sentryUtils = require(_dependencyMap[0], \"@sentry/utils\");\n  const MIN_DELAY = 100; // 100 ms\n  const START_DELAY = 5000; // 5 seconds\n  const MAX_DELAY = 3.6e6; // 1 hour\n\n  function log(msg, error) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && _sentryUtils.logger.info(`[Offline]: ${msg}`, error);\n  }\n\n  /**\n   * Wraps a transport and stores and retries events when they fail to send.\n   *\n   * @param createTransport The transport to wrap.\n   */\n  function makeOfflineTransport(createTransport) {\n    return options => {\n      const transport = createTransport(options);\n      const store = options.createStore ? options.createStore(options) : undefined;\n      let retryDelay = START_DELAY;\n      let flushTimer;\n      function shouldQueue(env, error, retryDelay) {\n        // We don't queue Session Replay envelopes because they are:\n        // - Ordered and Replay relies on the response status to know when they're successfully sent.\n        // - Likely to fill the queue quickly and block other events from being sent.\n        // We also want to drop client reports because they can be generated when we retry sending events while offline.\n        if ((0, _sentryUtils.envelopeContainsItemType)(env, ['replay_event', 'replay_recording', 'client_report'])) {\n          return false;\n        }\n        if (options.shouldStore) {\n          return options.shouldStore(env, error, retryDelay);\n        }\n        return true;\n      }\n      function flushIn(delay) {\n        if (!store) {\n          return;\n        }\n        if (flushTimer) {\n          clearTimeout(flushTimer);\n        }\n        flushTimer = setTimeout(async () => {\n          flushTimer = undefined;\n          const found = await store.pop();\n          if (found) {\n            log('Attempting to send previously queued event');\n            void send(found).catch(e => {\n              log('Failed to retry sending', e);\n            });\n          }\n        }, delay);\n\n        // We need to unref the timer in node.js, otherwise the node process never exit.\n        if (typeof flushTimer !== 'number' && flushTimer.unref) {\n          flushTimer.unref();\n        }\n      }\n      function flushWithBackOff() {\n        if (flushTimer) {\n          return;\n        }\n        flushIn(retryDelay);\n        retryDelay = Math.min(retryDelay * 2, MAX_DELAY);\n      }\n      async function send(envelope) {\n        try {\n          const result = await transport.send(envelope);\n          let delay = MIN_DELAY;\n          if (result) {\n            // If there's a retry-after header, use that as the next delay.\n            if (result.headers && result.headers['retry-after']) {\n              delay = (0, _sentryUtils.parseRetryAfterHeader)(result.headers['retry-after']);\n            } // If we have a server error, return now so we don't flush the queue.\n            else if ((result.statusCode || 0) >= 400) {\n              return result;\n            }\n          }\n          flushIn(delay);\n          retryDelay = START_DELAY;\n          return result;\n        } catch (e) {\n          if (store && (await shouldQueue(envelope, e, retryDelay))) {\n            await store.insert(envelope);\n            flushWithBackOff();\n            log('Error sending. Event queued', e);\n            return {};\n          } else {\n            throw e;\n          }\n        }\n      }\n      if (options.flushAtStartup) {\n        flushWithBackOff();\n      }\n      return {\n        send,\n        flush: t => transport.flush(t)\n      };\n    };\n  }\n});","lineCount":124,"map":[[7,2,121,0,"Object"],[7,8,121,0],[7,9,121,0,"defineProperty"],[7,23,121,0],[7,24,121,0,"exports"],[7,31,121,0],[8,4,121,0,"enumerable"],[8,14,121,0],[9,4,121,0,"get"],[9,7,121,0],[9,18,121,0,"get"],[9,19,121,0],[10,6,121,0],[10,13,121,9,"MIN_DELAY"],[10,22,121,18],[11,4,121,18],[12,2,121,18],[13,2,121,0,"Object"],[13,8,121,0],[13,9,121,0,"defineProperty"],[13,23,121,0],[13,24,121,0,"exports"],[13,31,121,0],[14,4,121,0,"enumerable"],[14,14,121,0],[15,4,121,0,"get"],[15,7,121,0],[15,18,121,0,"get"],[15,19,121,0],[16,6,121,0],[16,13,121,20,"START_DELAY"],[16,24,121,31],[17,4,121,31],[18,2,121,31],[19,2,121,0,"Object"],[19,8,121,0],[19,9,121,0,"defineProperty"],[19,23,121,0],[19,24,121,0,"exports"],[19,31,121,0],[20,4,121,0,"enumerable"],[20,14,121,0],[21,4,121,0,"get"],[21,7,121,0],[21,18,121,0,"get"],[21,19,121,0],[22,6,121,0],[22,13,121,33,"makeOfflineTransport"],[22,33,121,53],[23,4,121,53],[24,2,121,53],[25,2,1,0],[25,6,1,0,"_sentryUtils"],[25,18,1,0],[25,21,1,0,"require"],[25,28,1,0],[25,29,1,0,"_dependencyMap"],[25,43,1,0],[26,2,3,0],[26,8,3,6,"MIN_DELAY"],[26,17,3,15],[26,20,3,18],[26,23,3,21],[26,24,3,22],[26,25,3,23],[27,2,4,0],[27,8,4,6,"START_DELAY"],[27,19,4,17],[27,22,4,20],[27,26,4,24],[27,27,4,25],[27,28,4,26],[28,2,5,0],[28,8,5,6,"MAX_DELAY"],[28,17,5,15],[28,20,5,18],[28,25,5,23],[28,26,5,24],[28,27,5,25],[30,2,7,0],[30,11,7,9,"log"],[30,14,7,12,"log"],[30,15,7,13,"msg"],[30,18,7,16],[30,20,7,18,"error"],[30,25,7,23],[30,27,7,25],[31,4,8,2],[31,5,8,3],[31,12,8,10,"__SENTRY_DEBUG__"],[31,28,8,26],[31,33,8,31],[31,44,8,42],[31,48,8,46,"__SENTRY_DEBUG__"],[31,64,8,62],[31,69,8,67,"logger"],[31,81,8,73],[31,82,8,73,"logger"],[31,88,8,73],[31,89,8,74,"info"],[31,93,8,78],[31,94,8,79],[31,108,8,93,"msg"],[31,111,8,96],[31,113,8,98],[31,115,8,100,"error"],[31,120,8,105],[31,121,8,106],[32,2,9,0],[34,2,11,0],[35,0,12,0],[36,0,13,0],[37,0,14,0],[38,0,15,0],[39,2,16,0],[39,11,16,9,"makeOfflineTransport"],[39,31,16,29,"makeOfflineTransport"],[39,32,17,2,"createTransport"],[39,47,17,17],[39,49,18,2],[40,4,19,2],[40,11,19,9,"options"],[40,18,19,16],[40,22,19,20],[41,6,20,4],[41,12,20,10,"transport"],[41,21,20,19],[41,24,20,22,"createTransport"],[41,39,20,37],[41,40,20,38,"options"],[41,47,20,45],[41,48,20,46],[42,6,21,4],[42,12,21,10,"store"],[42,17,21,15],[42,20,21,18,"options"],[42,27,21,25],[42,28,21,26,"createStore"],[42,39,21,37],[42,42,21,40,"options"],[42,49,21,47],[42,50,21,48,"createStore"],[42,61,21,59],[42,62,21,60,"options"],[42,69,21,67],[42,70,21,68],[42,73,21,71,"undefined"],[42,82,21,80],[43,6,23,4],[43,10,23,8,"retryDelay"],[43,20,23,18],[43,23,23,21,"START_DELAY"],[43,34,23,32],[44,6,24,4],[44,10,24,8,"flushTimer"],[44,20,24,18],[45,6,26,4],[45,15,26,13,"shouldQueue"],[45,26,26,24,"shouldQueue"],[45,27,26,25,"env"],[45,30,26,28],[45,32,26,30,"error"],[45,37,26,35],[45,39,26,37,"retryDelay"],[45,49,26,47],[45,51,26,49],[46,8,27,6],[47,8,28,6],[48,8,29,6],[49,8,30,6],[50,8,31,6],[50,12,31,10],[50,16,31,10,"envelopeContainsItemType"],[50,28,31,34],[50,29,31,34,"envelopeContainsItemType"],[50,53,31,34],[50,55,31,35,"env"],[50,58,31,38],[50,60,31,40],[50,61,31,41],[50,75,31,55],[50,77,31,57],[50,95,31,75],[50,97,31,77],[50,112,31,92],[50,113,31,93],[50,114,31,94],[50,116,31,96],[51,10,32,8],[51,17,32,15],[51,22,32,20],[52,8,33,6],[53,8,35,6],[53,12,35,10,"options"],[53,19,35,17],[53,20,35,18,"shouldStore"],[53,31,35,29],[53,33,35,31],[54,10,36,8],[54,17,36,15,"options"],[54,24,36,22],[54,25,36,23,"shouldStore"],[54,36,36,34],[54,37,36,35,"env"],[54,40,36,38],[54,42,36,40,"error"],[54,47,36,45],[54,49,36,47,"retryDelay"],[54,59,36,57],[54,60,36,58],[55,8,37,6],[56,8,39,6],[56,15,39,13],[56,19,39,17],[57,6,40,4],[58,6,42,4],[58,15,42,13,"flushIn"],[58,22,42,20,"flushIn"],[58,23,42,21,"delay"],[58,28,42,26],[58,30,42,28],[59,8,43,6],[59,12,43,10],[59,13,43,11,"store"],[59,18,43,16],[59,20,43,18],[60,10,44,8],[61,8,45,6],[62,8,47,6],[62,12,47,10,"flushTimer"],[62,22,47,20],[62,24,47,22],[63,10,48,8,"clearTimeout"],[63,22,48,20],[63,23,48,21,"flushTimer"],[63,33,48,32],[63,34,48,33],[64,8,49,6],[65,8,51,6,"flushTimer"],[65,18,51,16],[65,21,51,19,"setTimeout"],[65,31,51,29],[65,32,51,30],[65,44,51,42],[66,10,52,8,"flushTimer"],[66,20,52,18],[66,23,52,21,"undefined"],[66,32,52,30],[67,10,54,8],[67,16,54,14,"found"],[67,21,54,19],[67,24,54,22],[67,30,54,28,"store"],[67,35,54,33],[67,36,54,34,"pop"],[67,39,54,37],[67,40,54,38],[67,41,54,39],[68,10,55,8],[68,14,55,12,"found"],[68,19,55,17],[68,21,55,19],[69,12,56,10,"log"],[69,15,56,13],[69,16,56,14],[69,60,56,58],[69,61,56,59],[70,12,57,10],[70,17,57,15,"send"],[70,21,57,19],[70,22,57,20,"found"],[70,27,57,25],[70,28,57,26],[70,29,57,27,"catch"],[70,34,57,32],[70,35,57,33,"e"],[70,36,57,34],[70,40,57,38],[71,14,58,12,"log"],[71,17,58,15],[71,18,58,16],[71,43,58,41],[71,45,58,43,"e"],[71,46,58,44],[71,47,58,45],[72,12,59,10],[72,13,59,11],[72,14,59,12],[73,10,60,8],[74,8,61,6],[74,9,61,7],[74,11,61,9,"delay"],[74,16,61,14],[74,17,61,15],[76,8,63,6],[77,8,64,6],[77,12,64,10],[77,19,64,17,"flushTimer"],[77,29,64,27],[77,34,64,32],[77,42,64,40],[77,46,64,44,"flushTimer"],[77,56,64,54],[77,57,64,55,"unref"],[77,62,64,60],[77,64,64,62],[78,10,65,8,"flushTimer"],[78,20,65,18],[78,21,65,19,"unref"],[78,26,65,24],[78,27,65,25],[78,28,65,26],[79,8,66,6],[80,6,67,4],[81,6,69,4],[81,15,69,13,"flushWithBackOff"],[81,31,69,29,"flushWithBackOff"],[81,32,69,29],[81,34,69,32],[82,8,70,6],[82,12,70,10,"flushTimer"],[82,22,70,20],[82,24,70,22],[83,10,71,8],[84,8,72,6],[85,8,74,6,"flushIn"],[85,15,74,13],[85,16,74,14,"retryDelay"],[85,26,74,24],[85,27,74,25],[86,8,76,6,"retryDelay"],[86,18,76,16],[86,21,76,19,"Math"],[86,25,76,23],[86,26,76,24,"min"],[86,29,76,27],[86,30,76,28,"retryDelay"],[86,40,76,38],[86,43,76,41],[86,44,76,42],[86,46,76,44,"MAX_DELAY"],[86,55,76,53],[86,56,76,54],[87,6,77,4],[88,6,79,4],[88,21,79,19,"send"],[88,25,79,23,"send"],[88,26,79,24,"envelope"],[88,34,79,32],[88,36,79,34],[89,8,80,6],[89,12,80,10],[90,10,81,8],[90,16,81,14,"result"],[90,22,81,20],[90,25,81,23],[90,31,81,29,"transport"],[90,40,81,38],[90,41,81,39,"send"],[90,45,81,43],[90,46,81,44,"envelope"],[90,54,81,52],[90,55,81,53],[91,10,83,8],[91,14,83,12,"delay"],[91,19,83,17],[91,22,83,20,"MIN_DELAY"],[91,31,83,29],[92,10,85,8],[92,14,85,12,"result"],[92,20,85,18],[92,22,85,20],[93,12,86,10],[94,12,87,10],[94,16,87,14,"result"],[94,22,87,20],[94,23,87,21,"headers"],[94,30,87,28],[94,34,87,32,"result"],[94,40,87,38],[94,41,87,39,"headers"],[94,48,87,46],[94,49,87,47],[94,62,87,60],[94,63,87,61],[94,65,87,63],[95,14,88,12,"delay"],[95,19,88,17],[95,22,88,20],[95,26,88,20,"parseRetryAfterHeader"],[95,38,88,41],[95,39,88,41,"parseRetryAfterHeader"],[95,60,88,41],[95,62,88,42,"result"],[95,68,88,48],[95,69,88,49,"headers"],[95,76,88,56],[95,77,88,57],[95,90,88,70],[95,91,88,71],[95,92,88,72],[96,12,89,10],[96,13,89,11],[96,14,89,12],[97,12,89,12],[97,17,90,15],[97,21,90,19],[97,22,90,20,"result"],[97,28,90,26],[97,29,90,27,"statusCode"],[97,39,90,37],[97,43,90,41],[97,44,90,42],[97,49,90,47],[97,52,90,50],[97,54,90,52],[98,14,91,12],[98,21,91,19,"result"],[98,27,91,25],[99,12,92,10],[100,10,93,8],[101,10,95,8,"flushIn"],[101,17,95,15],[101,18,95,16,"delay"],[101,23,95,21],[101,24,95,22],[102,10,96,8,"retryDelay"],[102,20,96,18],[102,23,96,21,"START_DELAY"],[102,34,96,32],[103,10,97,8],[103,17,97,15,"result"],[103,23,97,21],[104,8,98,6],[104,9,98,7],[104,10,98,8],[104,17,98,15,"e"],[104,18,98,16],[104,20,98,18],[105,10,99,8],[105,14,99,12,"store"],[105,19,99,17],[105,24,99,22],[105,30,99,28,"shouldQueue"],[105,41,99,39],[105,42,99,40,"envelope"],[105,50,99,48],[105,52,99,50,"e"],[105,53,99,51],[105,55,99,54,"retryDelay"],[105,65,99,64],[105,66,99,65],[105,67,99,66],[105,69,99,68],[106,12,100,10],[106,18,100,16,"store"],[106,23,100,21],[106,24,100,22,"insert"],[106,30,100,28],[106,31,100,29,"envelope"],[106,39,100,37],[106,40,100,38],[107,12,101,10,"flushWithBackOff"],[107,28,101,26],[107,29,101,27],[107,30,101,28],[108,12,102,10,"log"],[108,15,102,13],[108,16,102,14],[108,45,102,43],[108,47,102,45,"e"],[108,48,102,47],[108,49,102,48],[109,12,103,10],[109,19,103,17],[109,20,103,18],[109,21,103,19],[110,10,104,8],[110,11,104,9],[110,17,104,15],[111,12,105,10],[111,18,105,16,"e"],[111,19,105,17],[112,10,106,8],[113,8,107,6],[114,6,108,4],[115,6,110,4],[115,10,110,8,"options"],[115,17,110,15],[115,18,110,16,"flushAtStartup"],[115,32,110,30],[115,34,110,32],[116,8,111,6,"flushWithBackOff"],[116,24,111,22],[116,25,111,23],[116,26,111,24],[117,6,112,4],[118,6,114,4],[118,13,114,11],[119,8,115,6,"send"],[119,12,115,10],[120,8,116,6,"flush"],[120,13,116,11],[120,15,116,13,"t"],[120,16,116,14],[120,20,116,18,"transport"],[120,29,116,27],[120,30,116,28,"flush"],[120,35,116,33],[120,36,116,34,"t"],[120,37,116,35],[121,6,117,4],[121,7,117,5],[122,4,118,2],[122,5,118,3],[123,2,119,0],[124,0,119,1],[124,3]],"functionMap":{"names":["<global>","log","makeOfflineTransport","<anonymous>","shouldQueue","flushIn","setTimeout$argument_0","send._catch$argument_0","flushWithBackOff","send","flush"],"mappings":"AAA;ACM;CDE;AEO;SCG;ICO;KDc;IEE;8BCS;iCCM;WDE;ODE;KFM;IKE;KLQ;IME;KN6B;aOQ,uBP;GDE;CFC"},"hasCjsExports":false},"type":"js/module"}]}