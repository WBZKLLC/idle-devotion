{"dependencies":[{"name":"./is.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":11,"index":75},"end":{"line":3,"column":29,"index":93}}],"key":"7L+qE4U1JkzGTtK8kDgvAl12vZ8=","exportNames":["*"],"imports":1}},{"name":"./logger.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":15,"index":110},"end":{"line":4,"column":37,"index":132}}],"key":"OSXCW3dnRVSai6/mGt/zNQRtyzs=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  const is = require(_dependencyMap[0], \"./is.js\");\n  const logger = require(_dependencyMap[1], \"./logger.js\");\n  const BAGGAGE_HEADER_NAME = 'baggage';\n  const SENTRY_BAGGAGE_KEY_PREFIX = 'sentry-';\n  const SENTRY_BAGGAGE_KEY_PREFIX_REGEX = /^sentry-/;\n\n  /**\n   * Max length of a serialized baggage string\n   *\n   * https://www.w3.org/TR/baggage/#limits\n   */\n  const MAX_BAGGAGE_STRING_LENGTH = 8192;\n\n  /**\n   * Takes a baggage header and turns it into Dynamic Sampling Context, by extracting all the \"sentry-\" prefixed values\n   * from it.\n   *\n   * @param baggageHeader A very bread definition of a baggage header as it might appear in various frameworks.\n   * @returns The Dynamic Sampling Context that was found on `baggageHeader`, if there was any, `undefined` otherwise.\n   */\n  function baggageHeaderToDynamicSamplingContext(\n  // Very liberal definition of what any incoming header might look like\n  baggageHeader) {\n    if (!is.isString(baggageHeader) && !Array.isArray(baggageHeader)) {\n      return undefined;\n    }\n\n    // Intermediary object to store baggage key value pairs of incoming baggage headers on.\n    // It is later used to read Sentry-DSC-values from.\n    let baggageObject = {};\n    if (Array.isArray(baggageHeader)) {\n      // Combine all baggage headers into one object containing the baggage values so we can later read the Sentry-DSC-values from it\n      baggageObject = baggageHeader.reduce((acc, curr) => {\n        const currBaggageObject = baggageHeaderToObject(curr);\n        return {\n          ...acc,\n          ...currBaggageObject\n        };\n      }, {});\n    } else {\n      // Return undefined if baggage header is an empty string (technically an empty baggage header is not spec conform but\n      // this is how we choose to handle it)\n      if (!baggageHeader) {\n        return undefined;\n      }\n      baggageObject = baggageHeaderToObject(baggageHeader);\n    }\n\n    // Read all \"sentry-\" prefixed values out of the baggage object and put it onto a dynamic sampling context object.\n    const dynamicSamplingContext = Object.entries(baggageObject).reduce((acc, [key, value]) => {\n      if (key.match(SENTRY_BAGGAGE_KEY_PREFIX_REGEX)) {\n        const nonPrefixedKey = key.slice(SENTRY_BAGGAGE_KEY_PREFIX.length);\n        acc[nonPrefixedKey] = value;\n      }\n      return acc;\n    }, {});\n\n    // Only return a dynamic sampling context object if there are keys in it.\n    // A keyless object means there were no sentry values on the header, which means that there is no DSC.\n    if (Object.keys(dynamicSamplingContext).length > 0) {\n      return dynamicSamplingContext;\n    } else {\n      return undefined;\n    }\n  }\n\n  /**\n   * Turns a Dynamic Sampling Object into a baggage header by prefixing all the keys on the object with \"sentry-\".\n   *\n   * @param dynamicSamplingContext The Dynamic Sampling Context to turn into a header. For convenience and compatibility\n   * with the `getDynamicSamplingContext` method on the Transaction class ,this argument can also be `undefined`. If it is\n   * `undefined` the function will return `undefined`.\n   * @returns a baggage header, created from `dynamicSamplingContext`, or `undefined` either if `dynamicSamplingContext`\n   * was `undefined`, or if `dynamicSamplingContext` didn't contain any values.\n   */\n  function dynamicSamplingContextToSentryBaggageHeader(\n  // this also takes undefined for convenience and bundle size in other places\n  dynamicSamplingContext) {\n    if (!dynamicSamplingContext) {\n      return undefined;\n    }\n\n    // Prefix all DSC keys with \"sentry-\" and put them into a new object\n    const sentryPrefixedDSC = Object.entries(dynamicSamplingContext).reduce((acc, [dscKey, dscValue]) => {\n      if (dscValue) {\n        acc[`${SENTRY_BAGGAGE_KEY_PREFIX}${dscKey}`] = dscValue;\n      }\n      return acc;\n    }, {});\n    return objectToBaggageHeader(sentryPrefixedDSC);\n  }\n\n  /**\n   * Will parse a baggage header, which is a simple key-value map, into a flat object.\n   *\n   * @param baggageHeader The baggage header to parse.\n   * @returns a flat object containing all the key-value pairs from `baggageHeader`.\n   */\n  function baggageHeaderToObject(baggageHeader) {\n    return baggageHeader.split(',').map(baggageEntry => baggageEntry.split('=').map(keyOrValue => decodeURIComponent(keyOrValue.trim()))).reduce((acc, [key, value]) => {\n      acc[key] = value;\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Turns a flat object (key-value pairs) into a baggage header, which is also just key-value pairs.\n   *\n   * @param object The object to turn into a baggage header.\n   * @returns a baggage header string, or `undefined` if the object didn't have any values, since an empty baggage header\n   * is not spec compliant.\n   */\n  function objectToBaggageHeader(object) {\n    if (Object.keys(object).length === 0) {\n      // An empty baggage header is not spec compliant: We return undefined.\n      return undefined;\n    }\n    return Object.entries(object).reduce((baggageHeader, [objectKey, objectValue], currentIndex) => {\n      const baggageEntry = `${encodeURIComponent(objectKey)}=${encodeURIComponent(objectValue)}`;\n      const newBaggageHeader = currentIndex === 0 ? baggageEntry : `${baggageHeader},${baggageEntry}`;\n      if (newBaggageHeader.length > MAX_BAGGAGE_STRING_LENGTH) {\n        (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.logger.warn(`Not adding key: ${objectKey} with val: ${objectValue} to baggage header due to exceeding baggage size limits.`);\n        return baggageHeader;\n      } else {\n        return newBaggageHeader;\n      }\n    }, '');\n  }\n  exports.BAGGAGE_HEADER_NAME = BAGGAGE_HEADER_NAME;\n  exports.MAX_BAGGAGE_STRING_LENGTH = MAX_BAGGAGE_STRING_LENGTH;\n  exports.SENTRY_BAGGAGE_KEY_PREFIX = SENTRY_BAGGAGE_KEY_PREFIX;\n  exports.SENTRY_BAGGAGE_KEY_PREFIX_REGEX = SENTRY_BAGGAGE_KEY_PREFIX_REGEX;\n  exports.baggageHeaderToDynamicSamplingContext = baggageHeaderToDynamicSamplingContext;\n  exports.dynamicSamplingContextToSentryBaggageHeader = dynamicSamplingContextToSentryBaggageHeader;\n});","lineCount":139,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,8,3,6,"is"],[5,10,3,8],[5,13,3,11,"require"],[5,20,3,18],[5,21,3,18,"_dependencyMap"],[5,35,3,18],[5,49,3,28],[5,50,3,29],[6,2,4,0],[6,8,4,6,"logger"],[6,14,4,12],[6,17,4,15,"require"],[6,24,4,22],[6,25,4,22,"_dependencyMap"],[6,39,4,22],[6,57,4,36],[6,58,4,37],[7,2,6,0],[7,8,6,6,"BAGGAGE_HEADER_NAME"],[7,27,6,25],[7,30,6,28],[7,39,6,37],[8,2,8,0],[8,8,8,6,"SENTRY_BAGGAGE_KEY_PREFIX"],[8,33,8,31],[8,36,8,34],[8,45,8,43],[9,2,10,0],[9,8,10,6,"SENTRY_BAGGAGE_KEY_PREFIX_REGEX"],[9,39,10,37],[9,42,10,40],[9,52,10,50],[11,2,12,0],[12,0,13,0],[13,0,14,0],[14,0,15,0],[15,0,16,0],[16,2,17,0],[16,8,17,6,"MAX_BAGGAGE_STRING_LENGTH"],[16,33,17,31],[16,36,17,34],[16,40,17,38],[18,2,19,0],[19,0,20,0],[20,0,21,0],[21,0,22,0],[22,0,23,0],[23,0,24,0],[24,0,25,0],[25,2,26,0],[25,11,26,9,"baggageHeaderToDynamicSamplingContext"],[25,48,26,46,"baggageHeaderToDynamicSamplingContext"],[26,2,27,2],[27,2,28,2,"baggageHeader"],[27,15,28,15],[27,17,29,2],[28,4,30,2],[28,8,30,6],[28,9,30,7,"is"],[28,11,30,9],[28,12,30,10,"isString"],[28,20,30,18],[28,21,30,19,"baggageHeader"],[28,34,30,32],[28,35,30,33],[28,39,30,37],[28,40,30,38,"Array"],[28,45,30,43],[28,46,30,44,"isArray"],[28,53,30,51],[28,54,30,52,"baggageHeader"],[28,67,30,65],[28,68,30,66],[28,70,30,68],[29,6,31,4],[29,13,31,11,"undefined"],[29,22,31,20],[30,4,32,2],[32,4,34,2],[33,4,35,2],[34,4,36,2],[34,8,36,6,"baggageObject"],[34,21,36,19],[34,24,36,22],[34,25,36,23],[34,26,36,24],[35,4,38,2],[35,8,38,6,"Array"],[35,13,38,11],[35,14,38,12,"isArray"],[35,21,38,19],[35,22,38,20,"baggageHeader"],[35,35,38,33],[35,36,38,34],[35,38,38,36],[36,6,39,4],[37,6,40,4,"baggageObject"],[37,19,40,17],[37,22,40,20,"baggageHeader"],[37,35,40,33],[37,36,40,34,"reduce"],[37,42,40,40],[37,43,40,41],[37,44,40,42,"acc"],[37,47,40,45],[37,49,40,47,"curr"],[37,53,40,51],[37,58,40,56],[38,8,41,6],[38,14,41,12,"currBaggageObject"],[38,31,41,29],[38,34,41,32,"baggageHeaderToObject"],[38,55,41,53],[38,56,41,54,"curr"],[38,60,41,58],[38,61,41,59],[39,8,42,6],[39,15,42,13],[40,10,43,8],[40,13,43,11,"acc"],[40,16,43,14],[41,10,44,8],[41,13,44,11,"currBaggageObject"],[42,8,45,6],[42,9,45,7],[43,6,46,4],[43,7,46,5],[43,9,46,7],[43,10,46,8],[43,11,46,9],[43,12,46,10],[44,4,47,2],[44,5,47,3],[44,11,47,9],[45,6,48,4],[46,6,49,4],[47,6,50,4],[47,10,50,8],[47,11,50,9,"baggageHeader"],[47,24,50,22],[47,26,50,24],[48,8,51,6],[48,15,51,13,"undefined"],[48,24,51,22],[49,6,52,4],[50,6,54,4,"baggageObject"],[50,19,54,17],[50,22,54,20,"baggageHeaderToObject"],[50,43,54,41],[50,44,54,42,"baggageHeader"],[50,57,54,55],[50,58,54,56],[51,4,55,2],[53,4,57,2],[54,4,58,2],[54,10,58,8,"dynamicSamplingContext"],[54,32,58,30],[54,35,58,33,"Object"],[54,41,58,39],[54,42,58,40,"entries"],[54,49,58,47],[54,50,58,48,"baggageObject"],[54,63,58,61],[54,64,58,62],[54,65,58,63,"reduce"],[54,71,58,69],[54,72,58,70],[54,73,58,71,"acc"],[54,76,58,74],[54,78,58,76],[54,79,58,77,"key"],[54,82,58,80],[54,84,58,82,"value"],[54,89,58,87],[54,90,58,88],[54,95,58,93],[55,6,59,4],[55,10,59,8,"key"],[55,13,59,11],[55,14,59,12,"match"],[55,19,59,17],[55,20,59,18,"SENTRY_BAGGAGE_KEY_PREFIX_REGEX"],[55,51,59,49],[55,52,59,50],[55,54,59,52],[56,8,60,6],[56,14,60,12,"nonPrefixedKey"],[56,28,60,26],[56,31,60,29,"key"],[56,34,60,32],[56,35,60,33,"slice"],[56,40,60,38],[56,41,60,39,"SENTRY_BAGGAGE_KEY_PREFIX"],[56,66,60,64],[56,67,60,65,"length"],[56,73,60,71],[56,74,60,72],[57,8,61,6,"acc"],[57,11,61,9],[57,12,61,10,"nonPrefixedKey"],[57,26,61,24],[57,27,61,25],[57,30,61,28,"value"],[57,35,61,33],[58,6,62,4],[59,6,63,4],[59,13,63,11,"acc"],[59,16,63,14],[60,4,64,2],[60,5,64,3],[60,7,64,5],[60,8,64,6],[60,9,64,7],[60,10,64,8],[62,4,66,2],[63,4,67,2],[64,4,68,2],[64,8,68,6,"Object"],[64,14,68,12],[64,15,68,13,"keys"],[64,19,68,17],[64,20,68,18,"dynamicSamplingContext"],[64,42,68,40],[64,43,68,41],[64,44,68,42,"length"],[64,50,68,48],[64,53,68,51],[64,54,68,52],[64,56,68,54],[65,6,69,4],[65,13,69,11,"dynamicSamplingContext"],[65,35,69,33],[66,4,70,2],[66,5,70,3],[66,11,70,9],[67,6,71,4],[67,13,71,11,"undefined"],[67,22,71,20],[68,4,72,2],[69,2,73,0],[71,2,75,0],[72,0,76,0],[73,0,77,0],[74,0,78,0],[75,0,79,0],[76,0,80,0],[77,0,81,0],[78,0,82,0],[79,0,83,0],[80,2,84,0],[80,11,84,9,"dynamicSamplingContextToSentryBaggageHeader"],[80,54,84,52,"dynamicSamplingContextToSentryBaggageHeader"],[81,2,85,2],[82,2,86,2,"dynamicSamplingContext"],[82,24,86,24],[82,26,87,2],[83,4,88,2],[83,8,88,6],[83,9,88,7,"dynamicSamplingContext"],[83,31,88,29],[83,33,88,31],[84,6,89,4],[84,13,89,11,"undefined"],[84,22,89,20],[85,4,90,2],[87,4,92,2],[88,4,93,2],[88,10,93,8,"sentryPrefixedDSC"],[88,27,93,25],[88,30,93,28,"Object"],[88,36,93,34],[88,37,93,35,"entries"],[88,44,93,42],[88,45,93,43,"dynamicSamplingContext"],[88,67,93,65],[88,68,93,66],[88,69,93,67,"reduce"],[88,75,93,73],[88,76,94,4],[88,77,94,5,"acc"],[88,80,94,8],[88,82,94,10],[88,83,94,11,"dscKey"],[88,89,94,17],[88,91,94,19,"dscValue"],[88,99,94,27],[88,100,94,28],[88,105,94,33],[89,6,95,6],[89,10,95,10,"dscValue"],[89,18,95,18],[89,20,95,20],[90,8,96,8,"acc"],[90,11,96,11],[90,12,96,12],[90,15,96,15,"SENTRY_BAGGAGE_KEY_PREFIX"],[90,40,96,40],[90,43,96,43,"dscKey"],[90,49,96,49],[90,51,96,51],[90,52,96,52],[90,55,96,55,"dscValue"],[90,63,96,63],[91,6,97,6],[92,6,98,6],[92,13,98,13,"acc"],[92,16,98,16],[93,4,99,4],[93,5,99,5],[93,7,100,4],[93,8,100,5],[93,9,101,2],[93,10,101,3],[94,4,103,2],[94,11,103,9,"objectToBaggageHeader"],[94,32,103,30],[94,33,103,31,"sentryPrefixedDSC"],[94,50,103,48],[94,51,103,49],[95,2,104,0],[97,2,106,0],[98,0,107,0],[99,0,108,0],[100,0,109,0],[101,0,110,0],[102,0,111,0],[103,2,112,0],[103,11,112,9,"baggageHeaderToObject"],[103,32,112,30,"baggageHeaderToObject"],[103,33,112,31,"baggageHeader"],[103,46,112,44],[103,48,112,46],[104,4,113,2],[104,11,113,9,"baggageHeader"],[104,24,113,22],[104,25,114,5,"split"],[104,30,114,10],[104,31,114,11],[104,34,114,14],[104,35,114,15],[104,36,115,5,"map"],[104,39,115,8],[104,40,115,9,"baggageEntry"],[104,52,115,21],[104,56,115,25,"baggageEntry"],[104,68,115,37],[104,69,115,38,"split"],[104,74,115,43],[104,75,115,44],[104,78,115,47],[104,79,115,48],[104,80,115,49,"map"],[104,83,115,52],[104,84,115,53,"keyOrValue"],[104,94,115,63],[104,98,115,67,"decodeURIComponent"],[104,116,115,85],[104,117,115,86,"keyOrValue"],[104,127,115,96],[104,128,115,97,"trim"],[104,132,115,101],[104,133,115,102],[104,134,115,103],[104,135,115,104],[104,136,115,105],[104,137,115,106],[104,138,116,5,"reduce"],[104,144,116,11],[104,145,116,12],[104,146,116,13,"acc"],[104,149,116,16],[104,151,116,18],[104,152,116,19,"key"],[104,155,116,22],[104,157,116,24,"value"],[104,162,116,29],[104,163,116,30],[104,168,116,35],[105,6,117,6,"acc"],[105,9,117,9],[105,10,117,10,"key"],[105,13,117,13],[105,14,117,14],[105,17,117,17,"value"],[105,22,117,22],[106,6,118,6],[106,13,118,13,"acc"],[106,16,118,16],[107,4,119,4],[107,5,119,5],[107,7,119,7],[107,8,119,8],[107,9,119,9],[107,10,119,10],[108,2,120,0],[110,2,122,0],[111,0,123,0],[112,0,124,0],[113,0,125,0],[114,0,126,0],[115,0,127,0],[116,0,128,0],[117,2,129,0],[117,11,129,9,"objectToBaggageHeader"],[117,32,129,30,"objectToBaggageHeader"],[117,33,129,31,"object"],[117,39,129,37],[117,41,129,39],[118,4,130,2],[118,8,130,6,"Object"],[118,14,130,12],[118,15,130,13,"keys"],[118,19,130,17],[118,20,130,18,"object"],[118,26,130,24],[118,27,130,25],[118,28,130,26,"length"],[118,34,130,32],[118,39,130,37],[118,40,130,38],[118,42,130,40],[119,6,131,4],[120,6,132,4],[120,13,132,11,"undefined"],[120,22,132,20],[121,4,133,2],[122,4,135,2],[122,11,135,9,"Object"],[122,17,135,15],[122,18,135,16,"entries"],[122,25,135,23],[122,26,135,24,"object"],[122,32,135,30],[122,33,135,31],[122,34,135,32,"reduce"],[122,40,135,38],[122,41,135,39],[122,42,135,40,"baggageHeader"],[122,55,135,53],[122,57,135,55],[122,58,135,56,"objectKey"],[122,67,135,65],[122,69,135,67,"objectValue"],[122,80,135,78],[122,81,135,79],[122,83,135,81,"currentIndex"],[122,95,135,93],[122,100,135,98],[123,6,136,4],[123,12,136,10,"baggageEntry"],[123,24,136,22],[123,27,136,25],[123,30,136,28,"encodeURIComponent"],[123,48,136,46],[123,49,136,47,"objectKey"],[123,58,136,56],[123,59,136,57],[123,63,136,61,"encodeURIComponent"],[123,81,136,79],[123,82,136,80,"objectValue"],[123,93,136,91],[123,94,136,92],[123,96,136,94],[124,6,137,4],[124,12,137,10,"newBaggageHeader"],[124,28,137,26],[124,31,137,29,"currentIndex"],[124,43,137,41],[124,48,137,46],[124,49,137,47],[124,52,137,50,"baggageEntry"],[124,64,137,62],[124,67,137,65],[124,70,137,68,"baggageHeader"],[124,83,137,81],[124,87,137,85,"baggageEntry"],[124,99,137,97],[124,101,137,99],[125,6,138,4],[125,10,138,8,"newBaggageHeader"],[125,26,138,24],[125,27,138,25,"length"],[125,33,138,31],[125,36,138,34,"MAX_BAGGAGE_STRING_LENGTH"],[125,61,138,59],[125,63,138,61],[126,8,139,6],[126,9,139,7],[126,16,139,14,"__SENTRY_DEBUG__"],[126,32,139,30],[126,37,139,35],[126,48,139,46],[126,52,139,50,"__SENTRY_DEBUG__"],[126,68,139,66],[126,73,140,8,"logger"],[126,79,140,14],[126,80,140,15,"logger"],[126,86,140,21],[126,87,140,22,"warn"],[126,91,140,26],[126,92,141,10],[126,111,141,29,"objectKey"],[126,120,141,38],[126,134,141,52,"objectValue"],[126,145,141,63],[126,203,142,8],[126,204,142,9],[127,8,143,6],[127,15,143,13,"baggageHeader"],[127,28,143,26],[128,6,144,4],[128,7,144,5],[128,13,144,11],[129,8,145,6],[129,15,145,13,"newBaggageHeader"],[129,31,145,29],[130,6,146,4],[131,4,147,2],[131,5,147,3],[131,7,147,5],[131,9,147,7],[131,10,147,8],[132,2,148,0],[133,2,150,0,"exports"],[133,9,150,7],[133,10,150,8,"BAGGAGE_HEADER_NAME"],[133,29,150,27],[133,32,150,30,"BAGGAGE_HEADER_NAME"],[133,51,150,49],[134,2,151,0,"exports"],[134,9,151,7],[134,10,151,8,"MAX_BAGGAGE_STRING_LENGTH"],[134,35,151,33],[134,38,151,36,"MAX_BAGGAGE_STRING_LENGTH"],[134,63,151,61],[135,2,152,0,"exports"],[135,9,152,7],[135,10,152,8,"SENTRY_BAGGAGE_KEY_PREFIX"],[135,35,152,33],[135,38,152,36,"SENTRY_BAGGAGE_KEY_PREFIX"],[135,63,152,61],[136,2,153,0,"exports"],[136,9,153,7],[136,10,153,8,"SENTRY_BAGGAGE_KEY_PREFIX_REGEX"],[136,41,153,39],[136,44,153,42,"SENTRY_BAGGAGE_KEY_PREFIX_REGEX"],[136,75,153,73],[137,2,154,0,"exports"],[137,9,154,7],[137,10,154,8,"baggageHeaderToDynamicSamplingContext"],[137,47,154,45],[137,50,154,48,"baggageHeaderToDynamicSamplingContext"],[137,87,154,85],[138,2,155,0,"exports"],[138,9,155,7],[138,10,155,8,"dynamicSamplingContextToSentryBaggageHeader"],[138,53,155,51],[138,56,155,54,"dynamicSamplingContextToSentryBaggageHeader"],[138,99,155,97],[139,0,155,98],[139,3]],"functionMap":{"names":["<global>","baggageHeaderToDynamicSamplingContext","baggageHeader.reduce$argument_0","Object.entries.reduce$argument_0","dynamicSamplingContextToSentryBaggageHeader","baggageHeaderToObject","baggageHeader.split.map$argument_0","baggageEntry.split.map$argument_0","baggageHeader.split.map.reduce$argument_0","objectToBaggageHeader"],"mappings":"AAA;ACyB;yCCc;KDM;sEEY;GFM;CDS;AIW;IDU;KCK;CJK;AKQ;SCG,4CC,mDD,CD;YGC;KHG;CLC;ASS;uCNM;GMY;CTC"},"hasCjsExports":true},"type":"js/module"}]}