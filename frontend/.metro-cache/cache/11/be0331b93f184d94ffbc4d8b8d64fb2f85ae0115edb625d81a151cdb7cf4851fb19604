{"dependencies":[{"name":"./combatBonuses","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":13,"column":0,"index":427},"end":{"line":13,"column":83,"index":510}}],"key":"aNIGFi1xJSUR+87U6PdTo8zGYrM=","exportNames":["*"],"imports":1}},{"name":"./cinematicsAccess","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":511},"end":{"line":14,"column":66,"index":577}}],"key":"PaDawwzoTolULKHYkbZSbi1QB8Q=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.computeCombatStats = computeCombatStats;\n  exports.computeCombatStatsFromCalculated = computeCombatStatsFromCalculated;\n  var _combatBonuses = require(_dependencyMap[0], \"./combatBonuses\");\n  var _cinematicsAccess = require(_dependencyMap[1], \"./cinematicsAccess\");\n  /**\n   * Combat Stats - SINGLE SOURCE OF TRUTH\n   * \n   * This is the CANONICAL place where hero combat stats are computed for display.\n   * All UI screens MUST use this helper for HP/ATK/DEF/SPD display and power calculations.\n   * \n   * Applies all bonuses (currently: premium cinematic ownership).\n   * \n   * Later, when server-side verification is implemented, this logic can be\n   * mirrored on the backend for actual combat outcomes.\n   */\n\n  /**\n   * Clamp a number to integer within bounds\n   */\n  function clampInt(n, min, max) {\n    var x = Number.isFinite(Number(n)) ? Math.floor(Number(n)) : 0;\n    return Math.max(min, Math.min(max, x));\n  }\n\n  /**\n   * Combat stats structure returned by computeCombatStats\n   */\n\n  /**\n   * Extract hero ID from various hero object formats\n   */\n  function extractHeroId(hero) {\n    // Try various common field names\n    return String(hero?.hero_id ?? hero?.hero_key ?? hero?.stableId ?? hero?.stable_id ?? hero?.id ?? hero?.hero_data?.hero_id ?? hero?.hero_data?.stable_id ?? hero?.hero_data?.id ?? '');\n  }\n\n  /**\n   * Compute final combat stats for a hero with all bonuses applied.\n   * \n   * THIS IS THE ONLY PLACE WHERE PREMIUM CINEMATIC PERK IS APPLIED.\n   * All UI must use this function for consistency.\n   * \n   * @param hero - User's hero instance (with current_hp, current_atk, etc.)\n   * @param heroData - Hero base data (with base_hp, base_atk, etc.)\n   * @returns CombatStats with all bonuses applied\n   */\n  function computeCombatStats(hero, heroData) {\n    // Get base stats (prefer current_ from hero, fallback to base_ from heroData)\n    var baseHp = clampInt(hero?.current_hp ?? heroData?.base_hp ?? 0, 0, 999999999);\n    var baseAtk = clampInt(hero?.current_atk ?? heroData?.base_atk ?? 0, 0, 999999999);\n    var baseDef = clampInt(hero?.current_def ?? heroData?.base_def ?? 0, 0, 999999999);\n    var baseSpeed = clampInt(hero?.current_speed ?? heroData?.base_speed ?? 100, 0, 999999999);\n\n    // Get hero ID for per-hero bonuses\n    var heroId = extractHeroId(hero) || extractHeroId(heroData);\n\n    // Check premium cinematic ownership\n    var hasPremiumCinematicOwned = heroId ? (0, _cinematicsAccess.hasHeroPremiumCinematicOwned)(heroId) : false;\n    var bonus = (0, _combatBonuses.premiumCinematicOwnershipBonus)(hasPremiumCinematicOwned);\n\n    // Apply bonuses\n    return {\n      hp: Math.floor(baseHp * bonus.hpMult),\n      atk: Math.floor(baseAtk * bonus.atkMult),\n      def: Math.floor(baseDef * bonus.defMult),\n      speed: Math.floor(baseSpeed * bonus.speedMult),\n      hasPremiumCinematicBonus: hasPremiumCinematicOwned\n    };\n  }\n\n  /**\n   * Compute combat stats from pre-calculated stats (e.g., from backend).\n   * Applies premium cinematic bonus on top.\n   * \n   * @param stats - Pre-calculated stats object { hp, atk, def, speed }\n   * @param heroId - Hero ID for bonus lookup\n   * @returns CombatStats with all bonuses applied\n   */\n  function computeCombatStatsFromCalculated(stats, heroId) {\n    var baseHp = clampInt(stats?.hp ?? 0, 0, 999999999);\n    var baseAtk = clampInt(stats?.atk ?? 0, 0, 999999999);\n    var baseDef = clampInt(stats?.def ?? 0, 0, 999999999);\n    var baseSpeed = clampInt(stats?.speed ?? 100, 0, 999999999);\n    var hasPremiumCinematicOwned = heroId ? (0, _cinematicsAccess.hasHeroPremiumCinematicOwned)(heroId) : false;\n    var bonus = (0, _combatBonuses.premiumCinematicOwnershipBonus)(hasPremiumCinematicOwned);\n    return {\n      hp: Math.floor(baseHp * bonus.hpMult),\n      atk: Math.floor(baseAtk * bonus.atkMult),\n      def: Math.floor(baseDef * bonus.defMult),\n      speed: Math.floor(baseSpeed * bonus.speedMult),\n      hasPremiumCinematicBonus: hasPremiumCinematicOwned\n    };\n  }\n});","lineCount":100,"map":[[7,2,64,0,"exports"],[7,9,64,0],[7,10,64,0,"computeCombatStats"],[7,28,64,0],[7,31,64,0,"computeCombatStats"],[7,49,64,0],[8,2,96,0,"exports"],[8,9,96,0],[8,10,96,0,"computeCombatStatsFromCalculated"],[8,42,96,0],[8,45,96,0,"computeCombatStatsFromCalculated"],[8,77,96,0],[9,2,13,0],[9,6,13,0,"_combatBonuses"],[9,20,13,0],[9,23,13,0,"require"],[9,30,13,0],[9,31,13,0,"_dependencyMap"],[9,45,13,0],[10,2,14,0],[10,6,14,0,"_cinematicsAccess"],[10,23,14,0],[10,26,14,0,"require"],[10,33,14,0],[10,34,14,0,"_dependencyMap"],[10,48,14,0],[11,2,1,0],[12,0,2,0],[13,0,3,0],[14,0,4,0],[15,0,5,0],[16,0,6,0],[17,0,7,0],[18,0,8,0],[19,0,9,0],[20,0,10,0],[21,0,11,0],[23,2,16,0],[24,0,17,0],[25,0,18,0],[26,2,19,0],[26,11,19,9,"clampInt"],[26,19,19,17,"clampInt"],[26,20,19,18,"n"],[26,21,19,24],[26,23,19,26,"min"],[26,26,19,37],[26,28,19,39,"max"],[26,31,19,50],[26,33,19,60],[27,4,20,2],[27,8,20,8,"x"],[27,9,20,9],[27,12,20,12,"Number"],[27,18,20,18],[27,19,20,19,"isFinite"],[27,27,20,27],[27,28,20,28,"Number"],[27,34,20,34],[27,35,20,35,"n"],[27,36,20,36],[27,37,20,37],[27,38,20,38],[27,41,20,41,"Math"],[27,45,20,45],[27,46,20,46,"floor"],[27,51,20,51],[27,52,20,52,"Number"],[27,58,20,58],[27,59,20,59,"n"],[27,60,20,60],[27,61,20,61],[27,62,20,62],[27,65,20,65],[27,66,20,66],[28,4,21,2],[28,11,21,9,"Math"],[28,15,21,13],[28,16,21,14,"max"],[28,19,21,17],[28,20,21,18,"min"],[28,23,21,21],[28,25,21,23,"Math"],[28,29,21,27],[28,30,21,28,"min"],[28,33,21,31],[28,34,21,32,"max"],[28,37,21,35],[28,39,21,37,"x"],[28,40,21,38],[28,41,21,39],[28,42,21,40],[29,2,22,0],[31,2,24,0],[32,0,25,0],[33,0,26,0],[35,2,36,0],[36,0,37,0],[37,0,38,0],[38,2,39,0],[38,11,39,9,"extractHeroId"],[38,24,39,22,"extractHeroId"],[38,25,39,23,"hero"],[38,29,39,32],[38,31,39,42],[39,4,40,2],[40,4,41,2],[40,11,41,9,"String"],[40,17,41,15],[40,18,42,4,"hero"],[40,22,42,8],[40,24,42,10,"hero_id"],[40,31,42,17],[40,35,43,4,"hero"],[40,39,43,8],[40,41,43,10,"hero_key"],[40,49,43,18],[40,53,44,4,"hero"],[40,57,44,8],[40,59,44,10,"stableId"],[40,67,44,18],[40,71,45,4,"hero"],[40,75,45,8],[40,77,45,10,"stable_id"],[40,86,45,19],[40,90,46,4,"hero"],[40,94,46,8],[40,96,46,10,"id"],[40,98,46,12],[40,102,47,4,"hero"],[40,106,47,8],[40,108,47,10,"hero_data"],[40,117,47,19],[40,119,47,21,"hero_id"],[40,126,47,28],[40,130,48,4,"hero"],[40,134,48,8],[40,136,48,10,"hero_data"],[40,145,48,19],[40,147,48,21,"stable_id"],[40,156,48,30],[40,160,49,4,"hero"],[40,164,49,8],[40,166,49,10,"hero_data"],[40,175,49,19],[40,177,49,21,"id"],[40,179,49,23],[40,183,50,4],[40,185,51,2],[40,186,51,3],[41,2,52,0],[43,2,54,0],[44,0,55,0],[45,0,56,0],[46,0,57,0],[47,0,58,0],[48,0,59,0],[49,0,60,0],[50,0,61,0],[51,0,62,0],[52,0,63,0],[53,2,64,7],[53,11,64,16,"computeCombatStats"],[53,29,64,34,"computeCombatStats"],[53,30,64,35,"hero"],[53,34,64,44],[53,36,64,46,"heroData"],[53,44,64,59],[53,46,64,74],[54,4,65,2],[55,4,66,2],[55,8,66,8,"baseHp"],[55,14,66,14],[55,17,66,17,"clampInt"],[55,25,66,25],[55,26,66,26,"hero"],[55,30,66,30],[55,32,66,32,"current_hp"],[55,42,66,42],[55,46,66,46,"heroData"],[55,54,66,54],[55,56,66,56,"base_hp"],[55,63,66,63],[55,67,66,67],[55,68,66,68],[55,70,66,70],[55,71,66,71],[55,73,66,73],[55,82,66,82],[55,83,66,83],[56,4,67,2],[56,8,67,8,"baseAtk"],[56,15,67,15],[56,18,67,18,"clampInt"],[56,26,67,26],[56,27,67,27,"hero"],[56,31,67,31],[56,33,67,33,"current_atk"],[56,44,67,44],[56,48,67,48,"heroData"],[56,56,67,56],[56,58,67,58,"base_atk"],[56,66,67,66],[56,70,67,70],[56,71,67,71],[56,73,67,73],[56,74,67,74],[56,76,67,76],[56,85,67,85],[56,86,67,86],[57,4,68,2],[57,8,68,8,"baseDef"],[57,15,68,15],[57,18,68,18,"clampInt"],[57,26,68,26],[57,27,68,27,"hero"],[57,31,68,31],[57,33,68,33,"current_def"],[57,44,68,44],[57,48,68,48,"heroData"],[57,56,68,56],[57,58,68,58,"base_def"],[57,66,68,66],[57,70,68,70],[57,71,68,71],[57,73,68,73],[57,74,68,74],[57,76,68,76],[57,85,68,85],[57,86,68,86],[58,4,69,2],[58,8,69,8,"baseSpeed"],[58,17,69,17],[58,20,69,20,"clampInt"],[58,28,69,28],[58,29,69,29,"hero"],[58,33,69,33],[58,35,69,35,"current_speed"],[58,48,69,48],[58,52,69,52,"heroData"],[58,60,69,60],[58,62,69,62,"base_speed"],[58,72,69,72],[58,76,69,76],[58,79,69,79],[58,81,69,81],[58,82,69,82],[58,84,69,84],[58,93,69,93],[58,94,69,94],[60,4,71,2],[61,4,72,2],[61,8,72,8,"heroId"],[61,14,72,14],[61,17,72,17,"extractHeroId"],[61,30,72,30],[61,31,72,31,"hero"],[61,35,72,35],[61,36,72,36],[61,40,72,40,"extractHeroId"],[61,53,72,53],[61,54,72,54,"heroData"],[61,62,72,62],[61,63,72,63],[63,4,74,2],[64,4,75,2],[64,8,75,8,"hasPremiumCinematicOwned"],[64,32,75,32],[64,35,75,35,"heroId"],[64,41,75,41],[64,44,75,44],[64,48,75,44,"hasHeroPremiumCinematicOwned"],[64,65,75,72],[64,66,75,72,"hasHeroPremiumCinematicOwned"],[64,94,75,72],[64,96,75,73,"heroId"],[64,102,75,79],[64,103,75,80],[64,106,75,83],[64,111,75,88],[65,4,76,2],[65,8,76,8,"bonus"],[65,13,76,13],[65,16,76,16],[65,20,76,16,"premiumCinematicOwnershipBonus"],[65,34,76,46],[65,35,76,46,"premiumCinematicOwnershipBonus"],[65,65,76,46],[65,67,76,47,"hasPremiumCinematicOwned"],[65,91,76,71],[65,92,76,72],[67,4,78,2],[68,4,79,2],[68,11,79,9],[69,6,80,4,"hp"],[69,8,80,6],[69,10,80,8,"Math"],[69,14,80,12],[69,15,80,13,"floor"],[69,20,80,18],[69,21,80,19,"baseHp"],[69,27,80,25],[69,30,80,28,"bonus"],[69,35,80,33],[69,36,80,34,"hpMult"],[69,42,80,40],[69,43,80,41],[70,6,81,4,"atk"],[70,9,81,7],[70,11,81,9,"Math"],[70,15,81,13],[70,16,81,14,"floor"],[70,21,81,19],[70,22,81,20,"baseAtk"],[70,29,81,27],[70,32,81,30,"bonus"],[70,37,81,35],[70,38,81,36,"atkMult"],[70,45,81,43],[70,46,81,44],[71,6,82,4,"def"],[71,9,82,7],[71,11,82,9,"Math"],[71,15,82,13],[71,16,82,14,"floor"],[71,21,82,19],[71,22,82,20,"baseDef"],[71,29,82,27],[71,32,82,30,"bonus"],[71,37,82,35],[71,38,82,36,"defMult"],[71,45,82,43],[71,46,82,44],[72,6,83,4,"speed"],[72,11,83,9],[72,13,83,11,"Math"],[72,17,83,15],[72,18,83,16,"floor"],[72,23,83,21],[72,24,83,22,"baseSpeed"],[72,33,83,31],[72,36,83,34,"bonus"],[72,41,83,39],[72,42,83,40,"speedMult"],[72,51,83,49],[72,52,83,50],[73,6,84,4,"hasPremiumCinematicBonus"],[73,30,84,28],[73,32,84,30,"hasPremiumCinematicOwned"],[74,4,85,2],[74,5,85,3],[75,2,86,0],[77,2,88,0],[78,0,89,0],[79,0,90,0],[80,0,91,0],[81,0,92,0],[82,0,93,0],[83,0,94,0],[84,0,95,0],[85,2,96,7],[85,11,96,16,"computeCombatStatsFromCalculated"],[85,43,96,48,"computeCombatStatsFromCalculated"],[85,44,97,2,"stats"],[85,49,97,75],[85,51,98,2,"heroId"],[85,57,98,16],[85,59,99,15],[86,4,100,2],[86,8,100,8,"baseHp"],[86,14,100,14],[86,17,100,17,"clampInt"],[86,25,100,25],[86,26,100,26,"stats"],[86,31,100,31],[86,33,100,33,"hp"],[86,35,100,35],[86,39,100,39],[86,40,100,40],[86,42,100,42],[86,43,100,43],[86,45,100,45],[86,54,100,54],[86,55,100,55],[87,4,101,2],[87,8,101,8,"baseAtk"],[87,15,101,15],[87,18,101,18,"clampInt"],[87,26,101,26],[87,27,101,27,"stats"],[87,32,101,32],[87,34,101,34,"atk"],[87,37,101,37],[87,41,101,41],[87,42,101,42],[87,44,101,44],[87,45,101,45],[87,47,101,47],[87,56,101,56],[87,57,101,57],[88,4,102,2],[88,8,102,8,"baseDef"],[88,15,102,15],[88,18,102,18,"clampInt"],[88,26,102,26],[88,27,102,27,"stats"],[88,32,102,32],[88,34,102,34,"def"],[88,37,102,37],[88,41,102,41],[88,42,102,42],[88,44,102,44],[88,45,102,45],[88,47,102,47],[88,56,102,56],[88,57,102,57],[89,4,103,2],[89,8,103,8,"baseSpeed"],[89,17,103,17],[89,20,103,20,"clampInt"],[89,28,103,28],[89,29,103,29,"stats"],[89,34,103,34],[89,36,103,36,"speed"],[89,41,103,41],[89,45,103,45],[89,48,103,48],[89,50,103,50],[89,51,103,51],[89,53,103,53],[89,62,103,62],[89,63,103,63],[90,4,105,2],[90,8,105,8,"hasPremiumCinematicOwned"],[90,32,105,32],[90,35,105,35,"heroId"],[90,41,105,41],[90,44,105,44],[90,48,105,44,"hasHeroPremiumCinematicOwned"],[90,65,105,72],[90,66,105,72,"hasHeroPremiumCinematicOwned"],[90,94,105,72],[90,96,105,73,"heroId"],[90,102,105,79],[90,103,105,80],[90,106,105,83],[90,111,105,88],[91,4,106,2],[91,8,106,8,"bonus"],[91,13,106,13],[91,16,106,16],[91,20,106,16,"premiumCinematicOwnershipBonus"],[91,34,106,46],[91,35,106,46,"premiumCinematicOwnershipBonus"],[91,65,106,46],[91,67,106,47,"hasPremiumCinematicOwned"],[91,91,106,71],[91,92,106,72],[92,4,108,2],[92,11,108,9],[93,6,109,4,"hp"],[93,8,109,6],[93,10,109,8,"Math"],[93,14,109,12],[93,15,109,13,"floor"],[93,20,109,18],[93,21,109,19,"baseHp"],[93,27,109,25],[93,30,109,28,"bonus"],[93,35,109,33],[93,36,109,34,"hpMult"],[93,42,109,40],[93,43,109,41],[94,6,110,4,"atk"],[94,9,110,7],[94,11,110,9,"Math"],[94,15,110,13],[94,16,110,14,"floor"],[94,21,110,19],[94,22,110,20,"baseAtk"],[94,29,110,27],[94,32,110,30,"bonus"],[94,37,110,35],[94,38,110,36,"atkMult"],[94,45,110,43],[94,46,110,44],[95,6,111,4,"def"],[95,9,111,7],[95,11,111,9,"Math"],[95,15,111,13],[95,16,111,14,"floor"],[95,21,111,19],[95,22,111,20,"baseDef"],[95,29,111,27],[95,32,111,30,"bonus"],[95,37,111,35],[95,38,111,36,"defMult"],[95,45,111,43],[95,46,111,44],[96,6,112,4,"speed"],[96,11,112,9],[96,13,112,11,"Math"],[96,17,112,15],[96,18,112,16,"floor"],[96,23,112,21],[96,24,112,22,"baseSpeed"],[96,33,112,31],[96,36,112,34,"bonus"],[96,41,112,39],[96,42,112,40,"speedMult"],[96,51,112,49],[96,52,112,50],[97,6,113,4,"hasPremiumCinematicBonus"],[97,30,113,28],[97,32,113,30,"hasPremiumCinematicOwned"],[98,4,114,2],[98,5,114,3],[99,2,115,0],[100,0,115,1],[100,3]],"functionMap":{"names":["<global>","clampInt","extractHeroId","computeCombatStats","computeCombatStatsFromCalculated"],"mappings":"AAA;ACkB;CDG;AEiB;CFa;OGY;CHsB;OIU;CJmB"},"hasCjsExports":false},"type":"js/module"}]}