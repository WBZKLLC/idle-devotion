{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"../telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":252},"end":{"line":9,"column":52,"index":304}}],"key":"k7LZwhoWMWET/ud396YGvDlODrM=","exportNames":["*"],"imports":1}},{"name":"./config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":305},"end":{"line":10,"column":50,"index":355}}],"key":"apL7GyCxHQJfXSypmIMW0g+q+wo=","exportNames":["*"],"imports":1}},{"name":"../ids/sourceId","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":398},"end":{"line":12,"column":47,"index":445}}],"key":"8+/shoGzc074iuptzaKMztUCXgY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.isInsufficientShardsError = isInsufficientShardsError;\n  exports.getProgressionTable = getProgressionTable;\n  exports.getHeroStats = getHeroStats;\n  exports.promoteHero = promoteHero;\n  exports.generatePromotionSourceId = generatePromotionSourceId;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _telemetryEvents = require(_dependencyMap[1], \"../telemetry/events\");\n  var _config = require(_dependencyMap[2], \"./config\");\n  var _idsSourceId = require(_dependencyMap[3], \"../ids/sourceId\");\n  // /app/frontend/lib/api/heroProgression.ts\n  // Phase 3.39-3.41: Hero Progression API\n  //\n  // Server-authoritative hero star/stat system.\n  // All mutations go through canonical receipts.\n  // NO CLIENT-SIDE STAR/STAT MUTATIONS.\n\n  // Auth handled by config.ts\n\n  // Phase 3.49: Robust sourceId generation\n\n  // =============================================================================\n  // TYPES\n  // =============================================================================\n\n  function isInsufficientShardsError(error) {\n    if (!error || typeof error !== 'object') return false;\n    return error.code === 'INSUFFICIENT_SHARDS';\n  }\n\n  // =============================================================================\n  // API FUNCTIONS\n  // =============================================================================\n\n  /**\n   * Get the locked progression table (read-only)\n   */\n  function getProgressionTable() {\n    return _getProgressionTable.apply(this, arguments);\n  }\n  /**\n   * Get server-derived stats for a hero (Phase 3.41)\n   */\n  function _getProgressionTable() {\n    _getProgressionTable = (0, _asyncToGenerator.default)(function* () {\n      var res = yield fetch((0, _config.apiUrl)('/api/hero/progression-table'));\n      if (!res.ok) {\n        throw new Error('Failed to fetch progression table');\n      }\n      return yield res.json();\n    });\n    return _getProgressionTable.apply(this, arguments);\n  }\n  function getHeroStats(_x) {\n    return _getHeroStats.apply(this, arguments);\n  }\n  /**\n   * Promote hero to next star (Phase 3.39)\n   * \n   * @param heroId - Hero to promote\n   * @param sourceId - Client-generated ID for idempotency\n   */\n  function _getHeroStats() {\n    _getHeroStats = (0, _asyncToGenerator.default)(function* (heroId) {\n      var headers = yield (0, _config.getJsonHeaders)();\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_STATS_VIEWED, {\n        heroId\n      });\n      var res = yield fetch((0, _config.apiUrl)(`/api/hero/${heroId}/stats`), {\n        headers\n      });\n      if (!res.ok) {\n        throw new Error('Failed to fetch hero stats');\n      }\n      return yield res.json();\n    });\n    return _getHeroStats.apply(this, arguments);\n  }\n  function promoteHero(_x2, _x3) {\n    return _promoteHero.apply(this, arguments);\n  }\n  /**\n   * Generate a robust sourceId for hero promotion.\n   * Uses makeSourceId for collision-resistant idempotency.\n   */\n  function _promoteHero() {\n    _promoteHero = (0, _asyncToGenerator.default)(function* (heroId, sourceId) {\n      var headers = yield (0, _config.getJsonHeaders)();\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_SUBMITTED, {\n        heroId,\n        sourceId\n      });\n      var res = yield fetch((0, _config.apiUrl)('/api/hero/promote'), {\n        method: 'POST',\n        headers,\n        body: JSON.stringify({\n          hero_id: heroId,\n          source_id: sourceId\n        })\n      });\n      if (!res.ok) {\n        var errorData = yield res.json().catch(() => ({}));\n        if (errorData.code === 'INSUFFICIENT_SHARDS') {\n          (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_INSUFFICIENT_SHARDS, {\n            heroId,\n            required: errorData.required,\n            available: errorData.available\n          });\n        } else {\n          (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_FAILED, {\n            heroId,\n            error: errorData.code || errorData.detail || 'Unknown error'\n          });\n        }\n        throw errorData;\n      }\n      var receipt = yield res.json();\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.HERO_PROMOTION_SUCCESS, {\n        heroId,\n        starBefore: receipt.heroDelta.starBefore,\n        starAfter: receipt.heroDelta.starAfter,\n        shardsSpent: receipt.shardsSpent\n      });\n      return receipt;\n    });\n    return _promoteHero.apply(this, arguments);\n  }\n  function generatePromotionSourceId(heroId) {\n    return (0, _idsSourceId.makeSourceId)(`promote_${heroId}`);\n  }\n});","lineCount":142,"map":[[12,2,77,0,"exports"],[12,9,77,0],[12,10,77,0,"isInsufficientShardsError"],[12,35,77,0],[12,38,77,0,"isInsufficientShardsError"],[12,63,77,0],[13,2,89,0,"exports"],[13,9,89,0],[13,10,89,0,"getProgressionTable"],[13,29,89,0],[13,32,89,0,"getProgressionTable"],[13,51,89,0],[14,2,102,0,"exports"],[14,9,102,0],[14,10,102,0,"getHeroStats"],[14,22,102,0],[14,25,102,0,"getHeroStats"],[14,37,102,0],[15,2,122,0,"exports"],[15,9,122,0],[15,10,122,0,"promoteHero"],[15,21,122,0],[15,24,122,0,"promoteHero"],[15,35,122,0],[16,2,174,0,"exports"],[16,9,174,0],[16,10,174,0,"generatePromotionSourceId"],[16,35,174,0],[16,38,174,0,"generatePromotionSourceId"],[16,63,174,0],[17,2,176,1],[17,6,176,1,"_babelRuntimeHelpersAsyncToGenerator"],[17,42,176,1],[17,45,176,1,"require"],[17,52,176,1],[17,53,176,1,"_dependencyMap"],[17,67,176,1],[18,2,176,1],[18,6,176,1,"_asyncToGenerator"],[18,23,176,1],[18,26,176,1,"_interopDefault"],[18,41,176,1],[18,42,176,1,"_babelRuntimeHelpersAsyncToGenerator"],[18,78,176,1],[19,2,9,0],[19,6,9,0,"_telemetryEvents"],[19,22,9,0],[19,25,9,0,"require"],[19,32,9,0],[19,33,9,0,"_dependencyMap"],[19,47,9,0],[20,2,10,0],[20,6,10,0,"_config"],[20,13,10,0],[20,16,10,0,"require"],[20,23,10,0],[20,24,10,0,"_dependencyMap"],[20,38,10,0],[21,2,12,0],[21,6,12,0,"_idsSourceId"],[21,18,12,0],[21,21,12,0,"require"],[21,28,12,0],[21,29,12,0,"_dependencyMap"],[21,43,12,0],[22,2,1,0],[23,2,2,0],[24,2,3,0],[25,2,4,0],[26,2,5,0],[27,2,6,0],[29,2,8,0],[31,2,11,0],[33,2,14,0],[34,2,15,0],[35,2,16,0],[37,2,77,7],[37,11,77,16,"isInsufficientShardsError"],[37,36,77,41,"isInsufficientShardsError"],[37,37,77,42,"error"],[37,42,77,56],[37,44,77,92],[38,4,78,2],[38,8,78,6],[38,9,78,7,"error"],[38,14,78,12],[38,18,78,16],[38,25,78,23,"error"],[38,30,78,28],[38,35,78,33],[38,43,78,41],[38,45,78,43],[38,52,78,50],[38,57,78,55],[39,4,79,2],[39,11,79,10,"error"],[39,16,79,15],[39,17,79,44,"code"],[39,21,79,48],[39,26,79,53],[39,47,79,74],[40,2,80,0],[42,2,82,0],[43,2,83,0],[44,2,84,0],[46,2,86,0],[47,0,87,0],[48,0,88,0],[49,2,86,0],[49,11,89,22,"getProgressionTable"],[49,30,89,41,"getProgressionTable"],[49,31,89,41],[50,4,89,41],[50,11,89,41,"_getProgressionTable"],[50,31,89,41],[50,32,89,41,"apply"],[50,37,89,41],[50,44,89,41,"arguments"],[50,53,89,41],[51,2,89,41],[52,2,99,0],[53,0,100,0],[54,0,101,0],[55,2,99,0],[55,11,99,0,"_getProgressionTable"],[55,32,99,0],[56,4,99,0,"_getProgressionTable"],[56,24,99,0],[56,31,99,0,"_asyncToGenerator"],[56,48,99,0],[56,49,99,0,"default"],[56,56,99,0],[56,58,89,7],[56,71,89,71],[57,6,90,2],[57,10,90,8,"res"],[57,13,90,11],[57,22,90,20,"fetch"],[57,27,90,25],[57,28,90,26],[57,32,90,26,"apiUrl"],[57,39,90,32],[57,40,90,32,"apiUrl"],[57,46,90,32],[57,48,90,33],[57,77,90,62],[57,78,90,63],[57,79,90,64],[58,6,92,2],[58,10,92,6],[58,11,92,7,"res"],[58,14,92,10],[58,15,92,11,"ok"],[58,17,92,13],[58,19,92,15],[59,8,93,4],[59,14,93,10],[59,18,93,14,"Error"],[59,23,93,19],[59,24,93,20],[59,59,93,55],[59,60,93,56],[60,6,94,2],[61,6,96,2],[61,19,96,15,"res"],[61,22,96,18],[61,23,96,19,"json"],[61,27,96,23],[61,28,96,24],[61,29,96,25],[62,4,97,0],[62,5,97,1],[63,4,97,1],[63,11,97,1,"_getProgressionTable"],[63,31,97,1],[63,32,97,1,"apply"],[63,37,97,1],[63,44,97,1,"arguments"],[63,53,97,1],[64,2,97,1],[65,2,97,1],[65,11,102,22,"getHeroStats"],[65,23,102,34,"getHeroStats"],[65,24,102,34,"_x"],[65,26,102,34],[66,4,102,34],[66,11,102,34,"_getHeroStats"],[66,24,102,34],[66,25,102,34,"apply"],[66,30,102,34],[66,37,102,34,"arguments"],[66,46,102,34],[67,2,102,34],[68,2,116,0],[69,0,117,0],[70,0,118,0],[71,0,119,0],[72,0,120,0],[73,0,121,0],[74,2,116,0],[74,11,116,0,"_getHeroStats"],[74,25,116,0],[75,4,116,0,"_getHeroStats"],[75,17,116,0],[75,24,116,0,"_asyncToGenerator"],[75,41,116,0],[75,42,116,0,"default"],[75,49,116,0],[75,51,102,7],[75,62,102,35,"heroId"],[75,68,102,49],[75,70,102,79],[76,6,103,2],[76,10,103,8,"headers"],[76,17,103,15],[76,26,103,24],[76,30,103,24,"getJsonHeaders"],[76,37,103,38],[76,38,103,38,"getJsonHeaders"],[76,52,103,38],[76,54,103,39],[76,55,103,40],[77,6,105,2],[77,10,105,2,"track"],[77,26,105,7],[77,27,105,7,"track"],[77,32,105,7],[77,34,105,8,"Events"],[77,50,105,14],[77,51,105,14,"Events"],[77,57,105,14],[77,58,105,15,"HERO_STATS_VIEWED"],[77,75,105,32],[77,77,105,34],[78,8,105,36,"heroId"],[79,6,105,43],[79,7,105,44],[79,8,105,45],[80,6,107,2],[80,10,107,8,"res"],[80,13,107,11],[80,22,107,20,"fetch"],[80,27,107,25],[80,28,107,26],[80,32,107,26,"apiUrl"],[80,39,107,32],[80,40,107,32,"apiUrl"],[80,46,107,32],[80,48,107,33],[80,61,107,46,"heroId"],[80,67,107,52],[80,75,107,60],[80,76,107,61],[80,78,107,63],[81,8,107,65,"headers"],[82,6,107,73],[82,7,107,74],[82,8,107,75],[83,6,109,2],[83,10,109,6],[83,11,109,7,"res"],[83,14,109,10],[83,15,109,11,"ok"],[83,17,109,13],[83,19,109,15],[84,8,110,4],[84,14,110,10],[84,18,110,14,"Error"],[84,23,110,19],[84,24,110,20],[84,52,110,48],[84,53,110,49],[85,6,111,2],[86,6,113,2],[86,19,113,15,"res"],[86,22,113,18],[86,23,113,19,"json"],[86,27,113,23],[86,28,113,24],[86,29,113,25],[87,4,114,0],[87,5,114,1],[88,4,114,1],[88,11,114,1,"_getHeroStats"],[88,24,114,1],[88,25,114,1,"apply"],[88,30,114,1],[88,37,114,1,"arguments"],[88,46,114,1],[89,2,114,1],[90,2,114,1],[90,11,122,22,"promoteHero"],[90,22,122,33,"promoteHero"],[90,23,122,33,"_x2"],[90,26,122,33],[90,28,122,33,"_x3"],[90,31,122,33],[91,4,122,33],[91,11,122,33,"_promoteHero"],[91,23,122,33],[91,24,122,33,"apply"],[91,29,122,33],[91,36,122,33,"arguments"],[91,45,122,33],[92,2,122,33],[93,2,170,0],[94,0,171,0],[95,0,172,0],[96,0,173,0],[97,2,170,0],[97,11,170,0,"_promoteHero"],[97,24,170,0],[98,4,170,0,"_promoteHero"],[98,16,170,0],[98,23,170,0,"_asyncToGenerator"],[98,40,170,0],[98,41,170,0,"default"],[98,48,170,0],[98,50,122,7],[98,61,123,2,"heroId"],[98,67,123,16],[98,69,124,2,"sourceId"],[98,77,124,18],[98,79,125,29],[99,6,126,2],[99,10,126,8,"headers"],[99,17,126,15],[99,26,126,24],[99,30,126,24,"getJsonHeaders"],[99,37,126,38],[99,38,126,38,"getJsonHeaders"],[99,52,126,38],[99,54,126,39],[99,55,126,40],[100,6,128,2],[100,10,128,2,"track"],[100,26,128,7],[100,27,128,7,"track"],[100,32,128,7],[100,34,128,8,"Events"],[100,50,128,14],[100,51,128,14,"Events"],[100,57,128,14],[100,58,128,15,"HERO_PROMOTION_SUBMITTED"],[100,82,128,39],[100,84,128,41],[101,8,128,43,"heroId"],[101,14,128,49],[102,8,128,51,"sourceId"],[103,6,128,60],[103,7,128,61],[103,8,128,62],[104,6,130,2],[104,10,130,8,"res"],[104,13,130,11],[104,22,130,20,"fetch"],[104,27,130,25],[104,28,130,26],[104,32,130,26,"apiUrl"],[104,39,130,32],[104,40,130,32,"apiUrl"],[104,46,130,32],[104,48,130,33],[104,67,130,52],[104,68,130,53],[104,70,130,55],[105,8,131,4,"method"],[105,14,131,10],[105,16,131,12],[105,22,131,18],[106,8,132,4,"headers"],[106,15,132,11],[107,8,133,4,"body"],[107,12,133,8],[107,14,133,10,"JSON"],[107,18,133,14],[107,19,133,15,"stringify"],[107,28,133,24],[107,29,133,25],[108,10,134,6,"hero_id"],[108,17,134,13],[108,19,134,15,"heroId"],[108,25,134,21],[109,10,135,6,"source_id"],[109,19,135,15],[109,21,135,17,"sourceId"],[110,8,136,4],[110,9,136,5],[111,6,137,2],[111,7,137,3],[111,8,137,4],[112,6,139,2],[112,10,139,6],[112,11,139,7,"res"],[112,14,139,10],[112,15,139,11,"ok"],[112,17,139,13],[112,19,139,15],[113,8,140,4],[113,12,140,10,"errorData"],[113,21,140,19],[113,30,140,28,"res"],[113,33,140,31],[113,34,140,32,"json"],[113,38,140,36],[113,39,140,37],[113,40,140,38],[113,41,140,39,"catch"],[113,46,140,44],[113,47,140,45],[113,54,140,52],[113,55,140,53],[113,56,140,54],[113,57,140,55],[113,58,140,56],[114,8,142,4],[114,12,142,8,"errorData"],[114,21,142,17],[114,22,142,18,"code"],[114,26,142,22],[114,31,142,27],[114,52,142,48],[114,54,142,50],[115,10,143,6],[115,14,143,6,"track"],[115,30,143,11],[115,31,143,11,"track"],[115,36,143,11],[115,38,143,12,"Events"],[115,54,143,18],[115,55,143,18,"Events"],[115,61,143,18],[115,62,143,19,"HERO_PROMOTION_INSUFFICIENT_SHARDS"],[115,96,143,53],[115,98,143,55],[116,12,144,8,"heroId"],[116,18,144,14],[117,12,145,8,"required"],[117,20,145,16],[117,22,145,18,"errorData"],[117,31,145,27],[117,32,145,28,"required"],[117,40,145,36],[118,12,146,8,"available"],[118,21,146,17],[118,23,146,19,"errorData"],[118,32,146,28],[118,33,146,29,"available"],[119,10,147,6],[119,11,147,7],[119,12,147,8],[120,8,148,4],[120,9,148,5],[120,15,148,11],[121,10,149,6],[121,14,149,6,"track"],[121,30,149,11],[121,31,149,11,"track"],[121,36,149,11],[121,38,149,12,"Events"],[121,54,149,18],[121,55,149,18,"Events"],[121,61,149,18],[121,62,149,19,"HERO_PROMOTION_FAILED"],[121,83,149,40],[121,85,149,42],[122,12,150,8,"heroId"],[122,18,150,14],[123,12,151,8,"error"],[123,17,151,13],[123,19,151,15,"errorData"],[123,28,151,24],[123,29,151,25,"code"],[123,33,151,29],[123,37,151,33,"errorData"],[123,46,151,42],[123,47,151,43,"detail"],[123,53,151,49],[123,57,151,53],[124,10,152,6],[124,11,152,7],[124,12,152,8],[125,8,153,4],[126,8,155,4],[126,14,155,10,"errorData"],[126,23,155,19],[127,6,156,2],[128,6,158,2],[128,10,158,8,"receipt"],[128,17,158,15],[128,26,158,24,"res"],[128,29,158,27],[128,30,158,28,"json"],[128,34,158,32],[128,35,158,33],[128,36,158,34],[129,6,160,2],[129,10,160,2,"track"],[129,26,160,7],[129,27,160,7,"track"],[129,32,160,7],[129,34,160,8,"Events"],[129,50,160,14],[129,51,160,14,"Events"],[129,57,160,14],[129,58,160,15,"HERO_PROMOTION_SUCCESS"],[129,80,160,37],[129,82,160,39],[130,8,161,4,"heroId"],[130,14,161,10],[131,8,162,4,"starBefore"],[131,18,162,14],[131,20,162,16,"receipt"],[131,27,162,23],[131,28,162,24,"heroDelta"],[131,37,162,33],[131,38,162,34,"starBefore"],[131,48,162,44],[132,8,163,4,"starAfter"],[132,17,163,13],[132,19,163,15,"receipt"],[132,26,163,22],[132,27,163,23,"heroDelta"],[132,36,163,32],[132,37,163,33,"starAfter"],[132,46,163,42],[133,8,164,4,"shardsSpent"],[133,19,164,15],[133,21,164,17,"receipt"],[133,28,164,24],[133,29,164,25,"shardsSpent"],[134,6,165,2],[134,7,165,3],[134,8,165,4],[135,6,167,2],[135,13,167,9,"receipt"],[135,20,167,16],[136,4,168,0],[136,5,168,1],[137,4,168,1],[137,11,168,1,"_promoteHero"],[137,23,168,1],[137,24,168,1,"apply"],[137,29,168,1],[137,36,168,1,"arguments"],[137,45,168,1],[138,2,168,1],[139,2,174,7],[139,11,174,16,"generatePromotionSourceId"],[139,36,174,41,"generatePromotionSourceId"],[139,37,174,42,"heroId"],[139,43,174,56],[139,45,174,66],[140,4,175,2],[140,11,175,9],[140,15,175,9,"makeSourceId"],[140,27,175,21],[140,28,175,21,"makeSourceId"],[140,40,175,21],[140,42,175,22],[140,53,175,33,"heroId"],[140,59,175,39],[140,61,175,41],[140,62,175,42],[141,2,176,0],[142,0,176,1],[142,3]],"functionMap":{"names":["<global>","isInsufficientShardsError","getProgressionTable","getHeroStats","promoteHero","res.json._catch$argument_0","generatePromotionSourceId"],"mappings":"AAA;OC4E;CDG;OES;CFQ;OGK;CHY;OIQ;6CCkB,UD;CJ4B;OMM;CNE"},"hasCjsExports":false},"type":"js/module"}]}