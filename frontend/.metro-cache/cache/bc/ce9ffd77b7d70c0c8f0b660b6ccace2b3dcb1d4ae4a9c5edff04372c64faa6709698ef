{"dependencies":[{"name":"../authStorage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":157},"end":{"line":7,"column":47,"index":204}}],"key":"8h7N/7sKemAZqrgZg8dH/jTl5ys=","exportNames":["*"],"imports":1}},{"name":"../types/receipt","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":205},"end":{"line":8,"column":65,"index":270}}],"key":"W14jz77KoHdh2OnwnpYz6E6ocCQ=","exportNames":["*"],"imports":1}},{"name":"../telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":271},"end":{"line":9,"column":52,"index":323}}],"key":"k7LZwhoWMWET/ud396YGvDlODrM=","exportNames":["*"],"imports":1}},{"name":"./config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":324},"end":{"line":10,"column":36,"index":360}}],"key":"apL7GyCxHQJfXSypmIMW0g+q+wo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getStoreCatalog = getStoreCatalog;\n  exports.createPurchaseIntent = createPurchaseIntent;\n  exports.redeemIntent = redeemIntent;\n  var _authStorage = require(_dependencyMap[0], \"../authStorage\");\n  var _typesReceipt = require(_dependencyMap[1], \"../types/receipt\");\n  var _telemetryEvents = require(_dependencyMap[2], \"../telemetry/events\");\n  var _config = require(_dependencyMap[3], \"./config\");\n  // /app/frontend/lib/api/store.ts\n  // Phase 3.30: Store API Layer\n  //\n  // Catalog, purchase intent, and dev-only redeem.\n  // Uses canonical receipt for redeem.\n\n  // Auth header helper\n  async function getAuthHeaders() {\n    const token = await (0, _authStorage.loadAuthToken)();\n    if (!token) {\n      return {\n        'Content-Type': 'application/json'\n      };\n    }\n    return {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}`\n    };\n  }\n\n  // Store item from catalog\n\n  // Purchase intent response\n\n  /**\n   * Get store catalog\n   */\n  async function getStoreCatalog() {\n    try {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`${_config.API_BASE}/api/store/catalog`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch catalog');\n      const data = await res.json();\n      return data.catalog || [];\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Create purchase intent\n   */\n  async function createPurchaseIntent(sku) {\n    const headers = await getAuthHeaders();\n    const params = new URLSearchParams({\n      sku\n    });\n    const res = await fetch(`${_config.API_BASE}/api/store/purchase-intent?${params}`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) {\n      const error = await res.json().catch(() => ({\n        detail: 'Failed to create intent'\n      }));\n      throw new Error(error.detail || 'Failed to create intent');\n    }\n    const intent = await res.json();\n\n    // Emit telemetry\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_PURCHASE_INTENT_CREATED, {\n      intentId: intent.intentId,\n      sku: intent.sku\n    });\n    return intent;\n  }\n\n  /**\n   * DEV-ONLY: Redeem purchase intent without payment\n   * Returns canonical receipt.\n   */\n  async function redeemIntent(intentId) {\n    (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUBMITTED, {\n      intentId\n    });\n    const headers = await getAuthHeaders();\n    const params = new URLSearchParams({\n      intent_id: intentId\n    });\n    const res = await fetch(`${_config.API_BASE}/api/store/redeem-intent?${params}`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) {\n      (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ERROR, {\n        intentId,\n        status: res.status\n      });\n      const error = await res.json().catch(() => ({\n        detail: 'Failed to redeem'\n      }));\n      throw new Error(error.detail || 'Failed to redeem');\n    }\n    const receipt = await res.json();\n    if ((0, _typesReceipt.isValidReceipt)(receipt)) {\n      if (receipt.alreadyClaimed) {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_ALREADY_CLAIMED, {\n          intentId\n        });\n      } else {\n        (0, _telemetryEvents.track)(_telemetryEvents.Events.STORE_REDEEM_SUCCESS, {\n          intentId,\n          itemCount: receipt.items.length\n        });\n      }\n    }\n    return receipt;\n  }\n});","lineCount":124,"map":[[7,2,47,0,"exports"],[7,9,47,0],[7,10,47,0,"getStoreCatalog"],[7,25,47,0],[7,28,47,0,"getStoreCatalog"],[7,43,47,0],[8,2,62,0,"exports"],[8,9,62,0],[8,10,62,0,"createPurchaseIntent"],[8,30,62,0],[8,33,62,0,"createPurchaseIntent"],[8,53,62,0],[9,2,91,0,"exports"],[9,9,91,0],[9,10,91,0,"redeemIntent"],[9,22,91,0],[9,25,91,0,"redeemIntent"],[9,37,91,0],[10,2,7,0],[10,6,7,0,"_authStorage"],[10,18,7,0],[10,21,7,0,"require"],[10,28,7,0],[10,29,7,0,"_dependencyMap"],[10,43,7,0],[11,2,8,0],[11,6,8,0,"_typesReceipt"],[11,19,8,0],[11,22,8,0,"require"],[11,29,8,0],[11,30,8,0,"_dependencyMap"],[11,44,8,0],[12,2,9,0],[12,6,9,0,"_telemetryEvents"],[12,22,9,0],[12,25,9,0,"require"],[12,32,9,0],[12,33,9,0,"_dependencyMap"],[12,47,9,0],[13,2,10,0],[13,6,10,0,"_config"],[13,13,10,0],[13,16,10,0,"require"],[13,23,10,0],[13,24,10,0,"_dependencyMap"],[13,38,10,0],[14,2,1,0],[15,2,2,0],[16,2,3,0],[17,2,4,0],[18,2,5,0],[20,2,12,0],[21,2,13,0],[21,17,13,15,"getAuthHeaders"],[21,31,13,29,"getAuthHeaders"],[21,32,13,29],[21,34,13,65],[22,4,14,2],[22,10,14,8,"token"],[22,15,14,13],[22,18,14,16],[22,24,14,22],[22,28,14,22,"loadAuthToken"],[22,40,14,35],[22,41,14,35,"loadAuthToken"],[22,54,14,35],[22,56,14,36],[22,57,14,37],[23,4,15,2],[23,8,15,6],[23,9,15,7,"token"],[23,14,15,12],[23,16,15,14],[24,6,16,4],[24,13,16,11],[25,8,16,13],[25,22,16,27],[25,24,16,29],[26,6,16,48],[26,7,16,49],[27,4,17,2],[28,4,18,2],[28,11,18,9],[29,6,19,4],[29,20,19,18],[29,22,19,20],[29,40,19,38],[30,6,20,4],[30,21,20,19],[30,23,20,21],[30,33,20,31,"token"],[30,38,20,36],[31,4,21,2],[31,5,21,3],[32,2,22,0],[34,2,24,0],[36,2,34,0],[38,2,44,0],[39,0,45,0],[40,0,46,0],[41,2,47,7],[41,17,47,22,"getStoreCatalog"],[41,32,47,37,"getStoreCatalog"],[41,33,47,37],[41,35,47,62],[42,4,48,2],[42,8,48,6],[43,6,49,4],[43,12,49,10,"headers"],[43,19,49,17],[43,22,49,20],[43,28,49,26,"getAuthHeaders"],[43,42,49,40],[43,43,49,41],[43,44,49,42],[44,6,50,4],[44,12,50,10,"res"],[44,15,50,13],[44,18,50,16],[44,24,50,22,"fetch"],[44,29,50,27],[44,30,50,28],[44,33,50,31,"API_BASE"],[44,40,50,39],[44,41,50,39,"API_BASE"],[44,49,50,39],[44,69,50,59],[44,71,50,61],[45,8,50,63,"headers"],[46,6,50,71],[46,7,50,72],[46,8,50,73],[47,6,51,4],[47,10,51,8],[47,11,51,9,"res"],[47,14,51,12],[47,15,51,13,"ok"],[47,17,51,15],[47,19,51,17],[47,25,51,23],[47,29,51,27,"Error"],[47,34,51,32],[47,35,51,33],[47,60,51,58],[47,61,51,59],[48,6,52,4],[48,12,52,10,"data"],[48,16,52,14],[48,19,52,17],[48,25,52,23,"res"],[48,28,52,26],[48,29,52,27,"json"],[48,33,52,31],[48,34,52,32],[48,35,52,33],[49,6,53,4],[49,13,53,11,"data"],[49,17,53,15],[49,18,53,16,"catalog"],[49,25,53,23],[49,29,53,27],[49,31,53,29],[50,4,54,2],[50,5,54,3],[50,6,54,4],[50,12,54,10],[51,6,55,4],[51,13,55,11],[51,15,55,13],[52,4,56,2],[53,2,57,0],[55,2,59,0],[56,0,60,0],[57,0,61,0],[58,2,62,7],[58,17,62,22,"createPurchaseIntent"],[58,37,62,42,"createPurchaseIntent"],[58,38,62,43,"sku"],[58,41,62,54],[58,43,62,81],[59,4,63,2],[59,10,63,8,"headers"],[59,17,63,15],[59,20,63,18],[59,26,63,24,"getAuthHeaders"],[59,40,63,38],[59,41,63,39],[59,42,63,40],[60,4,64,2],[60,10,64,8,"params"],[60,16,64,14],[60,19,64,17],[60,23,64,21,"URLSearchParams"],[60,38,64,36],[60,39,64,37],[61,6,64,39,"sku"],[62,4,64,43],[62,5,64,44],[62,6,64,45],[63,4,66,2],[63,10,66,8,"res"],[63,13,66,11],[63,16,66,14],[63,22,66,20,"fetch"],[63,27,66,25],[63,28,66,26],[63,31,66,29,"API_BASE"],[63,38,66,37],[63,39,66,37,"API_BASE"],[63,47,66,37],[63,77,66,67,"params"],[63,83,66,73],[63,85,66,75],[63,87,66,77],[64,6,67,4,"method"],[64,12,67,10],[64,14,67,12],[64,20,67,18],[65,6,68,4,"headers"],[66,4,69,2],[66,5,69,3],[66,6,69,4],[67,4,71,2],[67,8,71,6],[67,9,71,7,"res"],[67,12,71,10],[67,13,71,11,"ok"],[67,15,71,13],[67,17,71,15],[68,6,72,4],[68,12,72,10,"error"],[68,17,72,15],[68,20,72,18],[68,26,72,24,"res"],[68,29,72,27],[68,30,72,28,"json"],[68,34,72,32],[68,35,72,33],[68,36,72,34],[68,37,72,35,"catch"],[68,42,72,40],[68,43,72,41],[68,50,72,48],[69,8,72,50,"detail"],[69,14,72,56],[69,16,72,58],[70,6,72,84],[70,7,72,85],[70,8,72,86],[70,9,72,87],[71,6,73,4],[71,12,73,10],[71,16,73,14,"Error"],[71,21,73,19],[71,22,73,20,"error"],[71,27,73,25],[71,28,73,26,"detail"],[71,34,73,32],[71,38,73,36],[71,63,73,61],[71,64,73,62],[72,4,74,2],[73,4,76,2],[73,10,76,8,"intent"],[73,16,76,14],[73,19,76,17],[73,25,76,23,"res"],[73,28,76,26],[73,29,76,27,"json"],[73,33,76,31],[73,34,76,32],[73,35,76,33],[75,4,78,2],[76,4,79,2],[76,8,79,2,"track"],[76,24,79,7],[76,25,79,7,"track"],[76,30,79,7],[76,32,79,8,"Events"],[76,48,79,14],[76,49,79,14,"Events"],[76,55,79,14],[76,56,79,15,"STORE_PURCHASE_INTENT_CREATED"],[76,85,79,44],[76,87,79,46],[77,6,80,4,"intentId"],[77,14,80,12],[77,16,80,14,"intent"],[77,22,80,20],[77,23,80,21,"intentId"],[77,31,80,29],[78,6,81,4,"sku"],[78,9,81,7],[78,11,81,9,"intent"],[78,17,81,15],[78,18,81,16,"sku"],[79,4,82,2],[79,5,82,3],[79,6,82,4],[80,4,84,2],[80,11,84,9,"intent"],[80,17,84,15],[81,2,85,0],[83,2,87,0],[84,0,88,0],[85,0,89,0],[86,0,90,0],[87,2,91,7],[87,17,91,22,"redeemIntent"],[87,29,91,34,"redeemIntent"],[87,30,91,35,"intentId"],[87,38,91,51],[87,40,91,77],[88,4,92,2],[88,8,92,2,"track"],[88,24,92,7],[88,25,92,7,"track"],[88,30,92,7],[88,32,92,8,"Events"],[88,48,92,14],[88,49,92,14,"Events"],[88,55,92,14],[88,56,92,15,"STORE_REDEEM_SUBMITTED"],[88,78,92,37],[88,80,92,39],[89,6,92,41,"intentId"],[90,4,92,50],[90,5,92,51],[90,6,92,52],[91,4,94,2],[91,10,94,8,"headers"],[91,17,94,15],[91,20,94,18],[91,26,94,24,"getAuthHeaders"],[91,40,94,38],[91,41,94,39],[91,42,94,40],[92,4,95,2],[92,10,95,8,"params"],[92,16,95,14],[92,19,95,17],[92,23,95,21,"URLSearchParams"],[92,38,95,36],[92,39,95,37],[93,6,95,39,"intent_id"],[93,15,95,48],[93,17,95,50,"intentId"],[94,4,95,59],[94,5,95,60],[94,6,95,61],[95,4,97,2],[95,10,97,8,"res"],[95,13,97,11],[95,16,97,14],[95,22,97,20,"fetch"],[95,27,97,25],[95,28,97,26],[95,31,97,29,"API_BASE"],[95,38,97,37],[95,39,97,37,"API_BASE"],[95,47,97,37],[95,75,97,65,"params"],[95,81,97,71],[95,83,97,73],[95,85,97,75],[96,6,98,4,"method"],[96,12,98,10],[96,14,98,12],[96,20,98,18],[97,6,99,4,"headers"],[98,4,100,2],[98,5,100,3],[98,6,100,4],[99,4,102,2],[99,8,102,6],[99,9,102,7,"res"],[99,12,102,10],[99,13,102,11,"ok"],[99,15,102,13],[99,17,102,15],[100,6,103,4],[100,10,103,4,"track"],[100,26,103,9],[100,27,103,9,"track"],[100,32,103,9],[100,34,103,10,"Events"],[100,50,103,16],[100,51,103,16,"Events"],[100,57,103,16],[100,58,103,17,"STORE_REDEEM_ERROR"],[100,76,103,35],[100,78,103,37],[101,8,103,39,"intentId"],[101,16,103,47],[102,8,103,49,"status"],[102,14,103,55],[102,16,103,57,"res"],[102,19,103,60],[102,20,103,61,"status"],[103,6,103,68],[103,7,103,69],[103,8,103,70],[104,6,104,4],[104,12,104,10,"error"],[104,17,104,15],[104,20,104,18],[104,26,104,24,"res"],[104,29,104,27],[104,30,104,28,"json"],[104,34,104,32],[104,35,104,33],[104,36,104,34],[104,37,104,35,"catch"],[104,42,104,40],[104,43,104,41],[104,50,104,48],[105,8,104,50,"detail"],[105,14,104,56],[105,16,104,58],[106,6,104,77],[106,7,104,78],[106,8,104,79],[106,9,104,80],[107,6,105,4],[107,12,105,10],[107,16,105,14,"Error"],[107,21,105,19],[107,22,105,20,"error"],[107,27,105,25],[107,28,105,26,"detail"],[107,34,105,32],[107,38,105,36],[107,56,105,54],[107,57,105,55],[108,4,106,2],[109,4,108,2],[109,10,108,8,"receipt"],[109,17,108,15],[109,20,108,18],[109,26,108,24,"res"],[109,29,108,27],[109,30,108,28,"json"],[109,34,108,32],[109,35,108,33],[109,36,108,34],[110,4,110,2],[110,8,110,6],[110,12,110,6,"isValidReceipt"],[110,25,110,20],[110,26,110,20,"isValidReceipt"],[110,40,110,20],[110,42,110,21,"receipt"],[110,49,110,28],[110,50,110,29],[110,52,110,31],[111,6,111,4],[111,10,111,8,"receipt"],[111,17,111,15],[111,18,111,16,"alreadyClaimed"],[111,32,111,30],[111,34,111,32],[112,8,112,6],[112,12,112,6,"track"],[112,28,112,11],[112,29,112,11,"track"],[112,34,112,11],[112,36,112,12,"Events"],[112,52,112,18],[112,53,112,18,"Events"],[112,59,112,18],[112,60,112,19,"STORE_REDEEM_ALREADY_CLAIMED"],[112,88,112,47],[112,90,112,49],[113,10,112,51,"intentId"],[114,8,112,60],[114,9,112,61],[114,10,112,62],[115,6,113,4],[115,7,113,5],[115,13,113,11],[116,8,114,6],[116,12,114,6,"track"],[116,28,114,11],[116,29,114,11,"track"],[116,34,114,11],[116,36,114,12,"Events"],[116,52,114,18],[116,53,114,18,"Events"],[116,59,114,18],[116,60,114,19,"STORE_REDEEM_SUCCESS"],[116,80,114,39],[116,82,114,41],[117,10,115,8,"intentId"],[117,18,115,16],[118,10,116,8,"itemCount"],[118,19,116,17],[118,21,116,19,"receipt"],[118,28,116,26],[118,29,116,27,"items"],[118,34,116,32],[118,35,116,33,"length"],[119,8,117,6],[119,9,117,7],[119,10,117,8],[120,6,118,4],[121,4,119,2],[122,4,121,2],[122,11,121,9,"receipt"],[122,18,121,16],[123,2,122,0],[124,0,122,1],[124,3]],"functionMap":{"names":["<global>","getAuthHeaders","getStoreCatalog","createPurchaseIntent","res.json._catch$argument_0","redeemIntent"],"mappings":"AAA;ACY;CDS;OEyB;CFU;OGK;yCCU,6CD;CHa;OKM;yCDa,sCC;CLkB"},"hasCjsExports":false},"type":"js/module"}]}