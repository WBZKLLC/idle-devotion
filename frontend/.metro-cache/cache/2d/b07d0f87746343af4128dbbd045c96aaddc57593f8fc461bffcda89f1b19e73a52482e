{"dependencies":[{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":66,"index":66}}],"key":"m+kcirlwHAgMIuUoyR2vCxbhWD4=","exportNames":["*"],"imports":1}},{"name":"../helpers.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":67},"end":{"line":2,"column":39,"index":106}}],"key":"xGB1RU1bemGAHq3E44EIR7oSA2c=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":107},"end":{"line":3,"column":156,"index":263}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"onProfilingStartRouteTransaction\", {\n    enumerable: true,\n    get: function () {\n      return onProfilingStartRouteTransaction;\n    }\n  });\n  Object.defineProperty(exports, \"startProfileForTransaction\", {\n    enumerable: true,\n    get: function () {\n      return startProfileForTransaction;\n    }\n  });\n  var _sentryUtils = require(_dependencyMap[0], \"@sentry/utils\");\n  var _helpersJs = require(_dependencyMap[1], \"../helpers.js\");\n  var _utilsJs = require(_dependencyMap[2], \"./utils.js\");\n  /**\n   * Safety wrapper for startTransaction for the unlikely case that transaction starts before tracing is imported -\n   * if that happens we want to avoid throwing an error from profiling code.\n   * see https://github.com/getsentry/sentry-javascript/issues/4731.\n   *\n   * @experimental\n   */\n  function onProfilingStartRouteTransaction(transaction) {\n    if (!transaction) {\n      if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n        _sentryUtils.logger.log('[Profiling] Transaction is undefined, skipping profiling');\n      }\n      return transaction;\n    }\n    if ((0, _utilsJs.shouldProfileTransaction)(transaction)) {\n      return startProfileForTransaction(transaction);\n    }\n    return transaction;\n  }\n\n  /**\n   * Wraps startTransaction and stopTransaction with profiling related logic.\n   * startProfileForTransaction is called after the call to startTransaction in order to avoid our own code from\n   * being profiled. Because of that same reason, stopProfiling is called before the call to stopTransaction.\n   */\n  function startProfileForTransaction(transaction) {\n    // Start the profiler and get the profiler instance.\n    let startTimestamp;\n    if ((0, _utilsJs.isAutomatedPageLoadTransaction)(transaction)) {\n      startTimestamp = (0, _sentryUtils.timestampInSeconds)() * 1000;\n    }\n    const profiler = (0, _utilsJs.startJSSelfProfile)();\n\n    // We failed to construct the profiler, fallback to original transaction.\n    // No need to log anything as this has already been logged in startProfile.\n    if (!profiler) {\n      return transaction;\n    }\n    if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n      _sentryUtils.logger.log(`[Profiling] started profiling transaction: ${transaction.name || transaction.description}`);\n    }\n\n    // We create \"unique\" transaction names to avoid concurrent transactions with same names\n    // from being ignored by the profiler. From here on, only this transaction name should be used when\n    // calling the profiler methods. Note: we log the original name to the user to avoid confusion.\n    const profileId = (0, _sentryUtils.uuid4)();\n\n    /**\n     * Idempotent handler for profile stop\n     */\n    async function onProfileHandler() {\n      // Check if the profile exists and return it the behavior has to be idempotent as users may call transaction.finish multiple times.\n      if (!transaction) {\n        return null;\n      }\n      // Satisfy the type checker, but profiler will always be defined here.\n      if (!profiler) {\n        return null;\n      }\n      return profiler.stop().then(profile => {\n        if (maxDurationTimeoutID) {\n          _helpersJs.WINDOW.clearTimeout(maxDurationTimeoutID);\n          maxDurationTimeoutID = undefined;\n        }\n        if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n          _sentryUtils.logger.log(`[Profiling] stopped profiling of transaction: ${transaction.name || transaction.description}`);\n        }\n\n        // In case of an overlapping transaction, stopProfiling may return null and silently ignore the overlapping profile.\n        if (!profile) {\n          if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n            _sentryUtils.logger.log(`[Profiling] profiler returned null profile for: ${transaction.name || transaction.description}`, 'this may indicate an overlapping transaction or a call to stopProfiling with a profile title that was never started');\n          }\n          return null;\n        }\n        (0, _utilsJs.addProfileToGlobalCache)(profileId, profile);\n        return null;\n      }).catch(error => {\n        if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n          _sentryUtils.logger.log('[Profiling] error while stopping profiler:', error);\n        }\n        return null;\n      });\n    }\n\n    // Enqueue a timeout to prevent profiles from running over max duration.\n    let maxDurationTimeoutID = _helpersJs.WINDOW.setTimeout(() => {\n      if (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) {\n        _sentryUtils.logger.log('[Profiling] max profile duration elapsed, stopping profiling for:', transaction.name || transaction.description);\n      }\n      // If the timeout exceeds, we want to stop profiling, but not finish the transaction\n      void onProfileHandler();\n    }, _utilsJs.MAX_PROFILE_DURATION_MS);\n\n    // We need to reference the original finish call to avoid creating an infinite loop\n    const originalFinish = transaction.finish.bind(transaction);\n\n    /**\n     * Wraps startTransaction and stopTransaction with profiling related logic.\n     * startProfiling is called after the call to startTransaction in order to avoid our own code from\n     * being profiled. Because of that same reason, stopProfiling is called before the call to stopTransaction.\n     */\n    function profilingWrappedTransactionFinish() {\n      if (!transaction) {\n        return originalFinish();\n      }\n      // onProfileHandler should always return the same profile even if this is called multiple times.\n      // Always call onProfileHandler to ensure stopProfiling is called and the timeout is cleared.\n      void onProfileHandler().then(() => {\n        transaction.setContext('profile', {\n          profile_id: profileId,\n          start_timestamp: startTimestamp\n        });\n        originalFinish();\n      }, () => {\n        // If onProfileHandler fails, we still want to call the original finish method.\n        originalFinish();\n      });\n      return transaction;\n    }\n    transaction.finish = profilingWrappedTransactionFinish;\n    return transaction;\n  }\n});","lineCount":145,"map":[[7,2,147,0,"Object"],[7,8,147,0],[7,9,147,0,"defineProperty"],[7,23,147,0],[7,24,147,0,"exports"],[7,31,147,0],[8,4,147,0,"enumerable"],[8,14,147,0],[9,4,147,0,"get"],[9,7,147,0],[9,18,147,0,"get"],[9,19,147,0],[10,6,147,0],[10,13,147,9,"onProfilingStartRouteTransaction"],[10,45,147,41],[11,4,147,41],[12,2,147,41],[13,2,147,0,"Object"],[13,8,147,0],[13,9,147,0,"defineProperty"],[13,23,147,0],[13,24,147,0,"exports"],[13,31,147,0],[14,4,147,0,"enumerable"],[14,14,147,0],[15,4,147,0,"get"],[15,7,147,0],[15,18,147,0,"get"],[15,19,147,0],[16,6,147,0],[16,13,147,43,"startProfileForTransaction"],[16,39,147,69],[17,4,147,69],[18,2,147,69],[19,2,1,0],[19,6,1,0,"_sentryUtils"],[19,18,1,0],[19,21,1,0,"require"],[19,28,1,0],[19,29,1,0,"_dependencyMap"],[19,43,1,0],[20,2,2,0],[20,6,2,0,"_helpersJs"],[20,16,2,0],[20,19,2,0,"require"],[20,26,2,0],[20,27,2,0,"_dependencyMap"],[20,41,2,0],[21,2,3,0],[21,6,3,0,"_utilsJs"],[21,14,3,0],[21,17,3,0,"require"],[21,24,3,0],[21,25,3,0,"_dependencyMap"],[21,39,3,0],[22,2,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[26,0,9,0],[27,0,10,0],[28,0,11,0],[29,2,12,0],[29,11,12,9,"onProfilingStartRouteTransaction"],[29,43,12,41,"onProfilingStartRouteTransaction"],[29,44,12,42,"transaction"],[29,55,12,53],[29,57,12,55],[30,4,13,2],[30,8,13,6],[30,9,13,7,"transaction"],[30,20,13,18],[30,22,13,20],[31,6,14,4],[31,10,14,9],[31,17,14,16,"__SENTRY_DEBUG__"],[31,33,14,32],[31,38,14,37],[31,49,14,48],[31,53,14,52,"__SENTRY_DEBUG__"],[31,69,14,68],[31,71,14,71],[32,8,15,6,"logger"],[32,20,15,12],[32,21,15,12,"logger"],[32,27,15,12],[32,28,15,13,"log"],[32,31,15,16],[32,32,15,17],[32,90,15,75],[32,91,15,76],[33,6,16,4],[34,6,17,4],[34,13,17,11,"transaction"],[34,24,17,22],[35,4,18,2],[36,4,20,2],[36,8,20,6],[36,12,20,6,"shouldProfileTransaction"],[36,20,20,30],[36,21,20,30,"shouldProfileTransaction"],[36,45,20,30],[36,47,20,31,"transaction"],[36,58,20,42],[36,59,20,43],[36,61,20,45],[37,6,21,4],[37,13,21,11,"startProfileForTransaction"],[37,39,21,37],[37,40,21,38,"transaction"],[37,51,21,49],[37,52,21,50],[38,4,22,2],[39,4,24,2],[39,11,24,9,"transaction"],[39,22,24,20],[40,2,25,0],[42,2,27,0],[43,0,28,0],[44,0,29,0],[45,0,30,0],[46,0,31,0],[47,2,32,0],[47,11,32,9,"startProfileForTransaction"],[47,37,32,35,"startProfileForTransaction"],[47,38,32,36,"transaction"],[47,49,32,47],[47,51,32,49],[48,4,33,2],[49,4,34,2],[49,8,34,6,"startTimestamp"],[49,22,34,20],[50,4,35,2],[50,8,35,6],[50,12,35,6,"isAutomatedPageLoadTransaction"],[50,20,35,36],[50,21,35,36,"isAutomatedPageLoadTransaction"],[50,51,35,36],[50,53,35,37,"transaction"],[50,64,35,48],[50,65,35,49],[50,67,35,51],[51,6,36,4,"startTimestamp"],[51,20,36,18],[51,23,36,21],[51,27,36,21,"timestampInSeconds"],[51,39,36,39],[51,40,36,39,"timestampInSeconds"],[51,58,36,39],[51,60,36,40],[51,61,36,41],[51,64,36,44],[51,68,36,48],[52,4,37,2],[53,4,39,2],[53,10,39,8,"profiler"],[53,18,39,16],[53,21,39,19],[53,25,39,19,"startJSSelfProfile"],[53,33,39,37],[53,34,39,37,"startJSSelfProfile"],[53,52,39,37],[53,54,39,38],[53,55,39,39],[55,4,41,2],[56,4,42,2],[57,4,43,2],[57,8,43,6],[57,9,43,7,"profiler"],[57,17,43,15],[57,19,43,17],[58,6,44,4],[58,13,44,11,"transaction"],[58,24,44,22],[59,4,45,2],[60,4,47,2],[60,8,47,7],[60,15,47,14,"__SENTRY_DEBUG__"],[60,31,47,30],[60,36,47,35],[60,47,47,46],[60,51,47,50,"__SENTRY_DEBUG__"],[60,67,47,66],[60,69,47,69],[61,6,48,4,"logger"],[61,18,48,10],[61,19,48,10,"logger"],[61,25,48,10],[61,26,48,11,"log"],[61,29,48,14],[61,30,48,15],[61,76,48,61,"transaction"],[61,87,48,72],[61,88,48,73,"name"],[61,92,48,77],[61,96,48,81,"transaction"],[61,107,48,92],[61,108,48,93,"description"],[61,119,48,104],[61,121,48,106],[61,122,48,107],[62,4,49,2],[64,4,51,2],[65,4,52,2],[66,4,53,2],[67,4,54,2],[67,10,54,8,"profileId"],[67,19,54,17],[67,22,54,20],[67,26,54,20,"uuid4"],[67,38,54,25],[67,39,54,25,"uuid4"],[67,44,54,25],[67,46,54,26],[67,47,54,27],[69,4,56,2],[70,0,57,0],[71,0,58,0],[72,4,59,2],[72,19,59,17,"onProfileHandler"],[72,35,59,33,"onProfileHandler"],[72,36,59,33],[72,38,59,36],[73,6,60,4],[74,6,61,4],[74,10,61,8],[74,11,61,9,"transaction"],[74,22,61,20],[74,24,61,22],[75,8,62,6],[75,15,62,13],[75,19,62,17],[76,6,63,4],[77,6,64,4],[78,6,65,4],[78,10,65,8],[78,11,65,9,"profiler"],[78,19,65,17],[78,21,65,19],[79,8,66,6],[79,15,66,13],[79,19,66,17],[80,6,67,4],[81,6,69,4],[81,13,69,11,"profiler"],[81,21,69,19],[81,22,70,7,"stop"],[81,26,70,11],[81,27,70,12],[81,28,70,13],[81,29,71,7,"then"],[81,33,71,11],[81,34,71,13,"profile"],[81,41,71,20],[81,45,71,25],[82,8,72,8],[82,12,72,12,"maxDurationTimeoutID"],[82,32,72,32],[82,34,72,34],[83,10,73,10,"WINDOW"],[83,20,73,16],[83,21,73,16,"WINDOW"],[83,27,73,16],[83,28,73,17,"clearTimeout"],[83,40,73,29],[83,41,73,30,"maxDurationTimeoutID"],[83,61,73,50],[83,62,73,51],[84,10,74,10,"maxDurationTimeoutID"],[84,30,74,30],[84,33,74,33,"undefined"],[84,42,74,42],[85,8,75,8],[86,8,77,8],[86,12,77,13],[86,19,77,20,"__SENTRY_DEBUG__"],[86,35,77,36],[86,40,77,41],[86,51,77,52],[86,55,77,56,"__SENTRY_DEBUG__"],[86,71,77,72],[86,73,77,75],[87,10,78,10,"logger"],[87,22,78,16],[87,23,78,16,"logger"],[87,29,78,16],[87,30,78,17,"log"],[87,33,78,20],[87,34,78,21],[87,83,78,70,"transaction"],[87,94,78,81],[87,95,78,82,"name"],[87,99,78,86],[87,103,78,90,"transaction"],[87,114,78,101],[87,115,78,102,"description"],[87,126,78,113],[87,128,78,115],[87,129,78,116],[88,8,79,8],[90,8,81,8],[91,8,82,8],[91,12,82,12],[91,13,82,13,"profile"],[91,20,82,20],[91,22,82,22],[92,10,83,10],[92,14,83,15],[92,21,83,22,"__SENTRY_DEBUG__"],[92,37,83,38],[92,42,83,43],[92,53,83,54],[92,57,83,58,"__SENTRY_DEBUG__"],[92,73,83,74],[92,75,83,77],[93,12,84,12,"logger"],[93,24,84,18],[93,25,84,18,"logger"],[93,31,84,18],[93,32,84,19,"log"],[93,35,84,22],[93,36,85,14],[93,87,85,65,"transaction"],[93,98,85,76],[93,99,85,77,"name"],[93,103,85,81],[93,107,85,85,"transaction"],[93,118,85,96],[93,119,85,97,"description"],[93,130,85,108],[93,132,85,110],[93,134,86,14],[93,251,87,12],[93,252,87,13],[94,10,88,10],[95,10,89,10],[95,17,89,17],[95,21,89,21],[96,8,90,8],[97,8,92,8],[97,12,92,8,"addProfileToGlobalCache"],[97,20,92,31],[97,21,92,31,"addProfileToGlobalCache"],[97,44,92,31],[97,46,92,32,"profileId"],[97,55,92,41],[97,57,92,43,"profile"],[97,64,92,50],[97,65,92,51],[98,8,93,8],[98,15,93,15],[98,19,93,19],[99,6,94,6],[99,7,94,7],[99,8,94,8],[99,9,95,7,"catch"],[99,14,95,12],[99,15,95,13,"error"],[99,20,95,18],[99,24,95,22],[100,8,96,8],[100,12,96,13],[100,19,96,20,"__SENTRY_DEBUG__"],[100,35,96,36],[100,40,96,41],[100,51,96,52],[100,55,96,56,"__SENTRY_DEBUG__"],[100,71,96,72],[100,73,96,75],[101,10,97,10,"logger"],[101,22,97,16],[101,23,97,16,"logger"],[101,29,97,16],[101,30,97,17,"log"],[101,33,97,20],[101,34,97,21],[101,78,97,65],[101,80,97,67,"error"],[101,85,97,72],[101,86,97,73],[102,8,98,8],[103,8,99,8],[103,15,99,15],[103,19,99,19],[104,6,100,6],[104,7,100,7],[104,8,100,8],[105,4,101,2],[107,4,103,2],[108,4,104,2],[108,8,104,6,"maxDurationTimeoutID"],[108,28,104,26],[108,31,104,29,"WINDOW"],[108,41,104,35],[108,42,104,35,"WINDOW"],[108,48,104,35],[108,49,104,36,"setTimeout"],[108,59,104,46],[108,60,104,47],[108,66,104,53],[109,6,105,4],[109,10,105,9],[109,17,105,16,"__SENTRY_DEBUG__"],[109,33,105,32],[109,38,105,37],[109,49,105,48],[109,53,105,52,"__SENTRY_DEBUG__"],[109,69,105,68],[109,71,105,71],[110,8,106,6,"logger"],[110,20,106,12],[110,21,106,12,"logger"],[110,27,106,12],[110,28,106,13,"log"],[110,31,106,16],[110,32,107,8],[110,99,107,75],[110,101,108,8,"transaction"],[110,112,108,19],[110,113,108,20,"name"],[110,117,108,24],[110,121,108,28,"transaction"],[110,132,108,39],[110,133,108,40,"description"],[110,144,109,6],[110,145,109,7],[111,6,110,4],[112,6,111,4],[113,6,112,4],[113,11,112,9,"onProfileHandler"],[113,27,112,25],[113,28,112,26],[113,29,112,27],[114,4,113,2],[114,5,113,3],[114,7,113,5,"MAX_PROFILE_DURATION_MS"],[114,15,113,28],[114,16,113,28,"MAX_PROFILE_DURATION_MS"],[114,39,113,28],[114,40,113,29],[116,4,115,2],[117,4,116,2],[117,10,116,8,"originalFinish"],[117,24,116,22],[117,27,116,25,"transaction"],[117,38,116,36],[117,39,116,37,"finish"],[117,45,116,43],[117,46,116,44,"bind"],[117,50,116,48],[117,51,116,49,"transaction"],[117,62,116,60],[117,63,116,61],[119,4,118,2],[120,0,119,0],[121,0,120,0],[122,0,121,0],[123,0,122,0],[124,4,123,2],[124,13,123,11,"profilingWrappedTransactionFinish"],[124,46,123,44,"profilingWrappedTransactionFinish"],[124,47,123,44],[124,49,123,47],[125,6,124,4],[125,10,124,8],[125,11,124,9,"transaction"],[125,22,124,20],[125,24,124,22],[126,8,125,6],[126,15,125,13,"originalFinish"],[126,29,125,27],[126,30,125,28],[126,31,125,29],[127,6,126,4],[128,6,127,4],[129,6,128,4],[130,6,129,4],[130,11,129,9,"onProfileHandler"],[130,27,129,25],[130,28,129,26],[130,29,129,27],[130,30,129,28,"then"],[130,34,129,32],[130,35,130,6],[130,41,130,12],[131,8,131,8,"transaction"],[131,19,131,19],[131,20,131,20,"setContext"],[131,30,131,30],[131,31,131,31],[131,40,131,40],[131,42,131,42],[132,10,131,44,"profile_id"],[132,20,131,54],[132,22,131,56,"profileId"],[132,31,131,65],[133,10,131,67,"start_timestamp"],[133,25,131,82],[133,27,131,84,"startTimestamp"],[134,8,131,99],[134,9,131,100],[134,10,131,101],[135,8,132,8,"originalFinish"],[135,22,132,22],[135,23,132,23],[135,24,132,24],[136,6,133,6],[136,7,133,7],[136,9,134,6],[136,15,134,12],[137,8,135,8],[138,8,136,8,"originalFinish"],[138,22,136,22],[138,23,136,23],[138,24,136,24],[139,6,137,6],[139,7,138,4],[139,8,138,5],[140,6,140,4],[140,13,140,11,"transaction"],[140,24,140,22],[141,4,141,2],[142,4,143,2,"transaction"],[142,15,143,13],[142,16,143,14,"finish"],[142,22,143,20],[142,25,143,23,"profilingWrappedTransactionFinish"],[142,58,143,56],[143,4,144,2],[143,11,144,9,"transaction"],[143,22,144,20],[144,2,145,0],[145,0,145,1],[145,3]],"functionMap":{"names":["<global>","onProfilingStartRouteTransaction","startProfileForTransaction","onProfileHandler","profiler.stop.then$argument_0","profiler.stop.then._catch$argument_0","WINDOW.setTimeout$argument_0","profilingWrappedTransactionFinish","onProfileHandler.then$argument_0","onProfileHandler.then$argument_1"],"mappings":"AAA;ACW;CDa;AEO;EC2B;YCY;ODuB;aEC;OFK;GDC;+CIG;GJS;EKU;MCO;ODG;MEC;OFG;GLI;CFI"},"hasCjsExports":false},"type":"js/module"}]}