{"dependencies":[{"name":"zustand","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":173},"end":{"line":5,"column":33,"index":206}}],"key":"POPvx7yS3Y3wz+S/9OAefiXNs0Q=","exportNames":["*"],"imports":1}},{"name":"../lib/telemetry/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":207},"end":{"line":6,"column":56,"index":263}}],"key":"j0wJDu3zbUGF7WArrpsULhFTytY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"usePurchaseStore\", {\n    enumerable: true,\n    get: function () {\n      return usePurchaseStore;\n    }\n  });\n  exports.generateIdempotencyKey = generateIdempotencyKey;\n  var _zustand = require(_dependencyMap[0], \"zustand\");\n  var _libTelemetryEvents = require(_dependencyMap[1], \"../lib/telemetry/events\");\n  // /app/frontend/stores/purchaseStore.ts\n  // Purchase State Machine - single source of truth for purchase flow\n  // NO ad-hoc flags in screens - all purchase state lives here\n\n  /**\n   * Purchase states - strict state machine\n   */\n\n  // Previously owned, now revoked\n\n  /**\n   * Purchase error types for consistent handling\n   */\n\n  const usePurchaseStore = (0, _zustand.create)((set, get) => ({\n    state: 'idle',\n    activeProductId: null,\n    activeIdempotencyKey: null,\n    error: null,\n    errorMessage: null,\n    viewPaywall: () => {\n      set({\n        state: 'paywall_viewed',\n        error: null,\n        errorMessage: null\n      });\n    },\n    startPurchase: (productId, idempotencyKey) => {\n      const current = get().state;\n\n      // Can only start from idle or paywall_viewed\n      if (current !== 'idle' && current !== 'paywall_viewed' && current !== 'purchase_failed' && current !== 'purchase_cancelled') {\n        console.warn(`[purchaseStore] Cannot start purchase in state: ${current}`);\n        return;\n      }\n      (0, _libTelemetryEvents.track)(_libTelemetryEvents.Events.PURCHASE_ATTEMPT, {\n        productId\n      });\n      set({\n        state: 'purchase_started',\n        activeProductId: productId,\n        activeIdempotencyKey: idempotencyKey,\n        error: null,\n        errorMessage: null\n      });\n    },\n    setPending: () => {\n      const current = get().state;\n      if (current !== 'purchase_started') {\n        console.warn(`[purchaseStore] Cannot set pending in state: ${current}`);\n        return;\n      }\n      set({\n        state: 'purchase_pending'\n      });\n    },\n    setVerified: () => {\n      const {\n        activeProductId\n      } = get();\n      (0, _libTelemetryEvents.track)(_libTelemetryEvents.Events.PURCHASE_SUCCESS, {\n        productId: activeProductId\n      });\n      set({\n        state: 'purchase_verified',\n        error: null,\n        errorMessage: null\n      });\n    },\n    setFailed: (error, message) => {\n      const {\n        activeProductId\n      } = get();\n      (0, _libTelemetryEvents.track)(_libTelemetryEvents.Events.PURCHASE_FAILURE, {\n        productId: activeProductId,\n        error\n      });\n      set({\n        state: 'purchase_failed',\n        error,\n        errorMessage: message || getDefaultErrorMessage(error)\n      });\n    },\n    setCancelled: () => {\n      set({\n        state: 'purchase_cancelled',\n        error: 'CANCELLED',\n        errorMessage: null\n      });\n    },\n    reset: () => {\n      set({\n        state: 'idle',\n        activeProductId: null,\n        activeIdempotencyKey: null,\n        error: null,\n        errorMessage: null\n      });\n    },\n    isProcessing: () => {\n      const {\n        state\n      } = get();\n      return state === 'purchase_started' || state === 'purchase_pending';\n    },\n    canStartPurchase: () => {\n      const {\n        state\n      } = get();\n      return state === 'idle' || state === 'paywall_viewed' || state === 'purchase_failed' || state === 'purchase_cancelled';\n    }\n  }));\n  function getDefaultErrorMessage(error) {\n    switch (error) {\n      case 'CANCELLED':\n        return 'Purchase was cancelled';\n      case 'NETWORK_ERROR':\n        return 'Network error. Please check your connection and try again.';\n      case 'VERIFICATION_FAILED':\n        return 'Purchase verification failed. Please contact support if you were charged.';\n      case 'ALREADY_OWNED':\n        return 'You already own this item';\n      case 'NOT_AVAILABLE':\n        return 'This item is not available for purchase';\n      case 'INSUFFICIENT_FUNDS':\n        return 'Insufficient funds';\n      default:\n        return 'An unexpected error occurred. Please try again.';\n    }\n  }\n\n  /**\n   * Generate idempotency key for purchase\n   */\n  function generateIdempotencyKey() {\n    return `purchase_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;\n  }\n});","lineCount":153,"map":[[7,2,59,0,"Object"],[7,8,59,0],[7,9,59,0,"defineProperty"],[7,23,59,0],[7,24,59,0,"exports"],[7,31,59,0],[8,4,59,0,"enumerable"],[8,14,59,0],[9,4,59,0,"get"],[9,7,59,0],[9,18,59,0,"get"],[9,19,59,0],[10,6,59,0],[10,13,59,0,"usePurchaseStore"],[10,29,59,0],[11,4,59,0],[12,2,59,0],[13,2,174,0,"exports"],[13,9,174,0],[13,10,174,0,"generateIdempotencyKey"],[13,32,174,0],[13,35,174,0,"generateIdempotencyKey"],[13,57,174,0],[14,2,5,0],[14,6,5,0,"_zustand"],[14,14,5,0],[14,17,5,0,"require"],[14,24,5,0],[14,25,5,0,"_dependencyMap"],[14,39,5,0],[15,2,6,0],[15,6,6,0,"_libTelemetryEvents"],[15,25,6,0],[15,28,6,0,"require"],[15,35,6,0],[15,36,6,0,"_dependencyMap"],[15,50,6,0],[16,2,1,0],[17,2,2,0],[18,2,3,0],[20,2,8,0],[21,0,9,0],[22,0,10,0],[24,2,19,28],[26,2,21,0],[27,0,22,0],[28,0,23,0],[30,2,59,7],[30,8,59,13,"usePurchaseStore"],[30,24,59,29],[30,27,59,32],[30,31,59,32,"create"],[30,39,59,38],[30,40,59,38,"create"],[30,46,59,38],[30,48,59,59],[30,49,59,60,"set"],[30,52,59,63],[30,54,59,65,"get"],[30,57,59,68],[30,63,59,74],[31,4,60,2,"state"],[31,9,60,7],[31,11,60,9],[31,17,60,15],[32,4,61,2,"activeProductId"],[32,19,61,17],[32,21,61,19],[32,25,61,23],[33,4,62,2,"activeIdempotencyKey"],[33,24,62,22],[33,26,62,24],[33,30,62,28],[34,4,63,2,"error"],[34,9,63,7],[34,11,63,9],[34,15,63,13],[35,4,64,2,"errorMessage"],[35,16,64,14],[35,18,64,16],[35,22,64,20],[36,4,66,2,"viewPaywall"],[36,15,66,13],[36,17,66,15,"viewPaywall"],[36,18,66,15],[36,23,66,21],[37,6,67,4,"set"],[37,9,67,7],[37,10,67,8],[38,8,67,10,"state"],[38,13,67,15],[38,15,67,17],[38,31,67,33],[39,8,67,35,"error"],[39,13,67,40],[39,15,67,42],[39,19,67,46],[40,8,67,48,"errorMessage"],[40,20,67,60],[40,22,67,62],[41,6,67,67],[41,7,67,68],[41,8,67,69],[42,4,68,2],[42,5,68,3],[43,4,70,2,"startPurchase"],[43,17,70,15],[43,19,70,17,"startPurchase"],[43,20,70,18,"productId"],[43,29,70,35],[43,31,70,37,"idempotencyKey"],[43,45,70,59],[43,50,70,64],[44,6,71,4],[44,12,71,10,"current"],[44,19,71,17],[44,22,71,20,"get"],[44,25,71,23],[44,26,71,24],[44,27,71,25],[44,28,71,26,"state"],[44,33,71,31],[46,6,73,4],[47,6,74,4],[47,10,74,8,"current"],[47,17,74,15],[47,22,74,20],[47,28,74,26],[47,32,74,30,"current"],[47,39,74,37],[47,44,74,42],[47,60,74,58],[47,64,74,62,"current"],[47,71,74,69],[47,76,74,74],[47,93,74,91],[47,97,74,95,"current"],[47,104,74,102],[47,109,74,107],[47,129,74,127],[47,131,74,129],[48,8,75,6,"console"],[48,15,75,13],[48,16,75,14,"warn"],[48,20,75,18],[48,21,75,19],[48,72,75,70,"current"],[48,79,75,77],[48,81,75,79],[48,82,75,80],[49,8,76,6],[50,6,77,4],[51,6,79,4],[51,10,79,4,"track"],[51,29,79,9],[51,30,79,9,"track"],[51,35,79,9],[51,37,79,10,"Events"],[51,56,79,16],[51,57,79,16,"Events"],[51,63,79,16],[51,64,79,17,"PURCHASE_ATTEMPT"],[51,80,79,33],[51,82,79,35],[52,8,79,37,"productId"],[53,6,79,47],[53,7,79,48],[53,8,79,49],[54,6,81,4,"set"],[54,9,81,7],[54,10,81,8],[55,8,82,6,"state"],[55,13,82,11],[55,15,82,13],[55,33,82,31],[56,8,83,6,"activeProductId"],[56,23,83,21],[56,25,83,23,"productId"],[56,34,83,32],[57,8,84,6,"activeIdempotencyKey"],[57,28,84,26],[57,30,84,28,"idempotencyKey"],[57,44,84,42],[58,8,85,6,"error"],[58,13,85,11],[58,15,85,13],[58,19,85,17],[59,8,86,6,"errorMessage"],[59,20,86,18],[59,22,86,20],[60,6,87,4],[60,7,87,5],[60,8,87,6],[61,4,88,2],[61,5,88,3],[62,4,90,2,"setPending"],[62,14,90,12],[62,16,90,14,"setPending"],[62,17,90,14],[62,22,90,20],[63,6,91,4],[63,12,91,10,"current"],[63,19,91,17],[63,22,91,20,"get"],[63,25,91,23],[63,26,91,24],[63,27,91,25],[63,28,91,26,"state"],[63,33,91,31],[64,6,92,4],[64,10,92,8,"current"],[64,17,92,15],[64,22,92,20],[64,40,92,38],[64,42,92,40],[65,8,93,6,"console"],[65,15,93,13],[65,16,93,14,"warn"],[65,20,93,18],[65,21,93,19],[65,69,93,67,"current"],[65,76,93,74],[65,78,93,76],[65,79,93,77],[66,8,94,6],[67,6,95,4],[68,6,96,4,"set"],[68,9,96,7],[68,10,96,8],[69,8,96,10,"state"],[69,13,96,15],[69,15,96,17],[70,6,96,36],[70,7,96,37],[70,8,96,38],[71,4,97,2],[71,5,97,3],[72,4,99,2,"setVerified"],[72,15,99,13],[72,17,99,15,"setVerified"],[72,18,99,15],[72,23,99,21],[73,6,100,4],[73,12,100,10],[74,8,100,12,"activeProductId"],[75,6,100,28],[75,7,100,29],[75,10,100,32,"get"],[75,13,100,35],[75,14,100,36],[75,15,100,37],[76,6,102,4],[76,10,102,4,"track"],[76,29,102,9],[76,30,102,9,"track"],[76,35,102,9],[76,37,102,10,"Events"],[76,56,102,16],[76,57,102,16,"Events"],[76,63,102,16],[76,64,102,17,"PURCHASE_SUCCESS"],[76,80,102,33],[76,82,102,35],[77,8,102,37,"productId"],[77,17,102,46],[77,19,102,48,"activeProductId"],[78,6,102,64],[78,7,102,65],[78,8,102,66],[79,6,104,4,"set"],[79,9,104,7],[79,10,104,8],[80,8,105,6,"state"],[80,13,105,11],[80,15,105,13],[80,34,105,32],[81,8,106,6,"error"],[81,13,106,11],[81,15,106,13],[81,19,106,17],[82,8,107,6,"errorMessage"],[82,20,107,18],[82,22,107,20],[83,6,108,4],[83,7,108,5],[83,8,108,6],[84,4,109,2],[84,5,109,3],[85,4,111,2,"setFailed"],[85,13,111,11],[85,15,111,13,"setFailed"],[85,16,111,14,"error"],[85,21,111,34],[85,23,111,36,"message"],[85,30,111,52],[85,35,111,57],[86,6,112,4],[86,12,112,10],[87,8,112,12,"activeProductId"],[88,6,112,28],[88,7,112,29],[88,10,112,32,"get"],[88,13,112,35],[88,14,112,36],[88,15,112,37],[89,6,114,4],[89,10,114,4,"track"],[89,29,114,9],[89,30,114,9,"track"],[89,35,114,9],[89,37,114,10,"Events"],[89,56,114,16],[89,57,114,16,"Events"],[89,63,114,16],[89,64,114,17,"PURCHASE_FAILURE"],[89,80,114,33],[89,82,114,35],[90,8,114,37,"productId"],[90,17,114,46],[90,19,114,48,"activeProductId"],[90,34,114,63],[91,8,114,65,"error"],[92,6,114,71],[92,7,114,72],[92,8,114,73],[93,6,116,4,"set"],[93,9,116,7],[93,10,116,8],[94,8,117,6,"state"],[94,13,117,11],[94,15,117,13],[94,32,117,30],[95,8,118,6,"error"],[95,13,118,11],[96,8,119,6,"errorMessage"],[96,20,119,18],[96,22,119,20,"message"],[96,29,119,27],[96,33,119,31,"getDefaultErrorMessage"],[96,55,119,53],[96,56,119,54,"error"],[96,61,119,59],[97,6,120,4],[97,7,120,5],[97,8,120,6],[98,4,121,2],[98,5,121,3],[99,4,123,2,"setCancelled"],[99,16,123,14],[99,18,123,16,"setCancelled"],[99,19,123,16],[99,24,123,22],[100,6,124,4,"set"],[100,9,124,7],[100,10,124,8],[101,8,125,6,"state"],[101,13,125,11],[101,15,125,13],[101,35,125,33],[102,8,126,6,"error"],[102,13,126,11],[102,15,126,13],[102,26,126,24],[103,8,127,6,"errorMessage"],[103,20,127,18],[103,22,127,20],[104,6,128,4],[104,7,128,5],[104,8,128,6],[105,4,129,2],[105,5,129,3],[106,4,131,2,"reset"],[106,9,131,7],[106,11,131,9,"reset"],[106,12,131,9],[106,17,131,15],[107,6,132,4,"set"],[107,9,132,7],[107,10,132,8],[108,8,133,6,"state"],[108,13,133,11],[108,15,133,13],[108,21,133,19],[109,8,134,6,"activeProductId"],[109,23,134,21],[109,25,134,23],[109,29,134,27],[110,8,135,6,"activeIdempotencyKey"],[110,28,135,26],[110,30,135,28],[110,34,135,32],[111,8,136,6,"error"],[111,13,136,11],[111,15,136,13],[111,19,136,17],[112,8,137,6,"errorMessage"],[112,20,137,18],[112,22,137,20],[113,6,138,4],[113,7,138,5],[113,8,138,6],[114,4,139,2],[114,5,139,3],[115,4,141,2,"isProcessing"],[115,16,141,14],[115,18,141,16,"isProcessing"],[115,19,141,16],[115,24,141,22],[116,6,142,4],[116,12,142,10],[117,8,142,12,"state"],[118,6,142,18],[118,7,142,19],[118,10,142,22,"get"],[118,13,142,25],[118,14,142,26],[118,15,142,27],[119,6,143,4],[119,13,143,11,"state"],[119,18,143,16],[119,23,143,21],[119,41,143,39],[119,45,143,43,"state"],[119,50,143,48],[119,55,143,53],[119,73,143,71],[120,4,144,2],[120,5,144,3],[121,4,146,2,"canStartPurchase"],[121,20,146,18],[121,22,146,20,"canStartPurchase"],[121,23,146,20],[121,28,146,26],[122,6,147,4],[122,12,147,10],[123,8,147,12,"state"],[124,6,147,18],[124,7,147,19],[124,10,147,22,"get"],[124,13,147,25],[124,14,147,26],[124,15,147,27],[125,6,148,4],[125,13,148,11,"state"],[125,18,148,16],[125,23,148,21],[125,29,148,27],[125,33,148,31,"state"],[125,38,148,36],[125,43,148,41],[125,59,148,57],[125,63,148,61,"state"],[125,68,148,66],[125,73,148,71],[125,90,148,88],[125,94,148,92,"state"],[125,99,148,97],[125,104,148,102],[125,124,148,122],[126,4,149,2],[127,2,150,0],[127,3,150,1],[127,4,150,2],[127,5,150,3],[128,2,152,0],[128,11,152,9,"getDefaultErrorMessage"],[128,33,152,31,"getDefaultErrorMessage"],[128,34,152,32,"error"],[128,39,152,52],[128,41,152,62],[129,4,153,2],[129,12,153,10,"error"],[129,17,153,15],[130,6,154,4],[130,11,154,9],[130,22,154,20],[131,8,155,6],[131,15,155,13],[131,39,155,37],[132,6,156,4],[132,11,156,9],[132,26,156,24],[133,8,157,6],[133,15,157,13],[133,75,157,73],[134,6,158,4],[134,11,158,9],[134,32,158,30],[135,8,159,6],[135,15,159,13],[135,90,159,88],[136,6,160,4],[136,11,160,9],[136,26,160,24],[137,8,161,6],[137,15,161,13],[137,42,161,40],[138,6,162,4],[138,11,162,9],[138,26,162,24],[139,8,163,6],[139,15,163,13],[139,56,163,54],[140,6,164,4],[140,11,164,9],[140,31,164,29],[141,8,165,6],[141,15,165,13],[141,35,165,33],[142,6,166,4],[143,8,167,6],[143,15,167,13],[143,64,167,62],[144,4,168,2],[145,2,169,0],[147,2,171,0],[148,0,172,0],[149,0,173,0],[150,2,174,7],[150,11,174,16,"generateIdempotencyKey"],[150,33,174,38,"generateIdempotencyKey"],[150,34,174,38],[150,36,174,49],[151,4,175,2],[151,11,175,9],[151,23,175,21,"Date"],[151,27,175,25],[151,28,175,26,"now"],[151,31,175,29],[151,32,175,30],[151,33,175,31],[151,37,175,35,"Math"],[151,41,175,39],[151,42,175,40,"random"],[151,48,175,46],[151,49,175,47],[151,50,175,48],[151,51,175,49,"toString"],[151,59,175,57],[151,60,175,58],[151,62,175,60],[151,63,175,61],[151,64,175,62,"substring"],[151,73,175,71],[151,74,175,72],[151,75,175,73],[151,77,175,75],[151,79,175,77],[151,80,175,78],[151,82,175,80],[152,2,176,0],[153,0,176,1],[153,3]],"functionMap":{"names":["<global>","create$argument_0","viewPaywall","startPurchase","setPending","setVerified","setFailed","setCancelled","reset","isProcessing","canStartPurchase","getDefaultErrorMessage","generateIdempotencyKey"],"mappings":"AAA;2DC0D;eCO;GDE;iBEE;GFkB;cGE;GHO;eIE;GJU;aKE;GLU;gBME;GNM;SOE;GPQ;gBQE;GRG;oBSE;GTG;EDC;AWE;CXiB;OYK;CZE"},"hasCjsExports":false},"type":"js/module"}]}