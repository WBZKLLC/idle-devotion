{"dependencies":[{"name":"./featureUtils","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":34},"end":{"line":8,"column":24,"index":162}}],"key":"FACoi85IMzpe+kZO3DG9/H6Umsk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"DEFAULT_FLAGS\", {\n    enumerable: true,\n    get: function () {\n      return DEFAULT_FLAGS;\n    }\n  });\n  exports.setDevFeatureOverride = setDevFeatureOverride;\n  exports.clearDevFeatureOverride = clearDevFeatureOverride;\n  exports.clearAllDevFeatureOverrides = clearAllDevFeatureOverrides;\n  exports.setRemoteFeatures = setRemoteFeatures;\n  exports.clearRemoteFeatures = clearRemoteFeatures;\n  exports.getRemoteFeaturesSnapshot = getRemoteFeaturesSnapshot;\n  exports.isFeatureEnabled = isFeatureEnabled;\n  var _featureUtils = require(_dependencyMap[0], \"./featureUtils\");\n  // /app/frontend/lib/features.ts\n\n  /**\n   * Single source of truth for KNOWN flags (compile-time defaults).\n   * Add new flags here first.\n   */\n  const DEFAULT_FLAGS = {\n    AWAKENING_PREVIEW_UI: false,\n    GACHA_PITY_UI: true,\n    NEW_LOGIN_FLOW: false,\n    MAINTENANCE_MODE: false,\n    CAMPAIGN_SWEEP: true,\n    HERO_CINEMATICS: false,\n    // safe-off locally, enabled via remote\n    HERO_PROGRESSION_ENABLED: true\n  };\n  let remoteFlags = {};\n  let remoteVersion = null;\n\n  /**\n   * Dev overrides: ONLY applied in __DEV__.\n   * Stored in-memory; you can optionally add persistence later.\n   */\n  const devOverrides = {};\n  function setDevFeatureOverride(flag, enabled) {\n    if (!__DEV__) return;\n    devOverrides[flag] = enabled;\n  }\n  function clearDevFeatureOverride(flag) {\n    if (!__DEV__) return;\n    delete devOverrides[flag];\n  }\n  function clearAllDevFeatureOverrides() {\n    if (!__DEV__) return;\n    for (const k of Object.keys(devOverrides)) delete devOverrides[k];\n  }\n\n  /**\n   * Called by the feature store after hydration/fetch.\n   */\n  function setRemoteFeatures(payload) {\n    remoteVersion = payload.version ?? null;\n    remoteFlags = (0, _featureUtils.normalizeRemoteFlags)(payload.flags);\n  }\n  function clearRemoteFeatures() {\n    remoteVersion = null;\n    remoteFlags = {};\n  }\n  function getRemoteFeaturesSnapshot() {\n    return {\n      version: remoteVersion,\n      flags: remoteFlags\n    };\n  }\n\n  /**\n   * Main entrypoint used by UI.\n   * Keep usage standardized: isFeatureEnabled('FLAG', { stableId: userId })\n   */\n\n  function isFeatureEnabled(flag, ctx) {\n    // 1) dev override wins (dev-only)\n    if (__DEV__ && Object.prototype.hasOwnProperty.call(devOverrides, flag)) {\n      return !!devOverrides[flag];\n    }\n\n    // 2) remote override next\n    const r = remoteFlags[flag];\n    if (r) {\n      if (!r.enabled) return false;\n      if (typeof r.rollout === 'number') {\n        const stableId = ctx?.stableId;\n        if (!stableId) return true; // enabled but no stableId => treat as on\n        const b = (0, _featureUtils.bucket01)(`${flag}:${stableId}`);\n        return b < r.rollout;\n      }\n      return true;\n    }\n\n    // 3) local default fallback (known flags)\n    if (Object.prototype.hasOwnProperty.call(DEFAULT_FLAGS, flag)) {\n      return !!DEFAULT_FLAGS[flag];\n    }\n\n    // 4) unknown flag => safe off\n    return false;\n  }\n});","lineCount":108,"map":[[7,2,14,0,"Object"],[7,8,14,0],[7,9,14,0,"defineProperty"],[7,23,14,0],[7,24,14,0,"exports"],[7,31,14,0],[8,4,14,0,"enumerable"],[8,14,14,0],[9,4,14,0,"get"],[9,7,14,0],[9,18,14,0,"get"],[9,19,14,0],[10,6,14,0],[10,13,14,0,"DEFAULT_FLAGS"],[10,26,14,0],[11,4,14,0],[12,2,14,0],[13,2,43,0,"exports"],[13,9,43,0],[13,10,43,0,"setDevFeatureOverride"],[13,31,43,0],[13,34,43,0,"setDevFeatureOverride"],[13,55,43,0],[14,2,48,0,"exports"],[14,9,48,0],[14,10,48,0,"clearDevFeatureOverride"],[14,33,48,0],[14,36,48,0,"clearDevFeatureOverride"],[14,59,48,0],[15,2,53,0,"exports"],[15,9,53,0],[15,10,53,0,"clearAllDevFeatureOverrides"],[15,37,53,0],[15,40,53,0,"clearAllDevFeatureOverrides"],[15,67,53,0],[16,2,61,0,"exports"],[16,9,61,0],[16,10,61,0,"setRemoteFeatures"],[16,27,61,0],[16,30,61,0,"setRemoteFeatures"],[16,47,61,0],[17,2,66,0,"exports"],[17,9,66,0],[17,10,66,0,"clearRemoteFeatures"],[17,29,66,0],[17,32,66,0,"clearRemoteFeatures"],[17,51,66,0],[18,2,71,0,"exports"],[18,9,71,0],[18,10,71,0,"getRemoteFeaturesSnapshot"],[18,35,71,0],[18,38,71,0,"getRemoteFeaturesSnapshot"],[18,63,71,0],[19,2,84,0,"exports"],[19,9,84,0],[19,10,84,0,"isFeatureEnabled"],[19,26,84,0],[19,29,84,0,"isFeatureEnabled"],[19,45,84,0],[20,2,3,0],[20,6,3,0,"_featureUtils"],[20,19,3,0],[20,22,3,0,"require"],[20,29,3,0],[20,30,3,0,"_dependencyMap"],[20,44,3,0],[21,2,1,0],[23,2,10,0],[24,0,11,0],[25,0,12,0],[26,0,13,0],[27,2,14,7],[27,8,14,13,"DEFAULT_FLAGS"],[27,21,14,26],[27,24,14,29],[28,4,15,2,"AWAKENING_PREVIEW_UI"],[28,24,15,22],[28,26,15,24],[28,31,15,29],[29,4,16,2,"GACHA_PITY_UI"],[29,17,16,15],[29,19,16,17],[29,23,16,21],[30,4,17,2,"NEW_LOGIN_FLOW"],[30,18,17,16],[30,20,17,18],[30,25,17,23],[31,4,18,2,"MAINTENANCE_MODE"],[31,20,18,18],[31,22,18,20],[31,27,18,25],[32,4,19,2,"CAMPAIGN_SWEEP"],[32,18,19,16],[32,20,19,18],[32,24,19,22],[33,4,20,2,"HERO_CINEMATICS"],[33,19,20,17],[33,21,20,19],[33,26,20,24],[34,4,20,27],[35,4,21,2,"HERO_PROGRESSION_ENABLED"],[35,28,21,26],[35,30,21,28],[36,2,22,0],[36,3,22,10],[37,2,34,0],[37,6,34,4,"remoteFlags"],[37,17,34,53],[37,20,34,56],[37,21,34,57],[37,22,34,58],[38,2,35,0],[38,6,35,4,"remoteVersion"],[38,19,35,32],[38,22,35,35],[38,26,35,39],[40,2,37,0],[41,0,38,0],[42,0,39,0],[43,0,40,0],[44,2,41,0],[44,8,41,6,"devOverrides"],[44,20,41,43],[44,23,41,46],[44,24,41,47],[44,25,41,48],[45,2,43,7],[45,11,43,16,"setDevFeatureOverride"],[45,32,43,37,"setDevFeatureOverride"],[45,33,43,38,"flag"],[45,37,43,50],[45,39,43,52,"enabled"],[45,46,43,68],[45,48,43,76],[46,4,44,2],[46,8,44,6],[46,9,44,7,"__DEV__"],[46,16,44,14],[46,18,44,16],[47,4,45,2,"devOverrides"],[47,16,45,14],[47,17,45,15,"flag"],[47,21,45,19],[47,22,45,20],[47,25,45,23,"enabled"],[47,32,45,30],[48,2,46,0],[49,2,48,7],[49,11,48,16,"clearDevFeatureOverride"],[49,34,48,39,"clearDevFeatureOverride"],[49,35,48,40,"flag"],[49,39,48,52],[49,41,48,60],[50,4,49,2],[50,8,49,6],[50,9,49,7,"__DEV__"],[50,16,49,14],[50,18,49,16],[51,4,50,2],[51,11,50,9,"devOverrides"],[51,23,50,21],[51,24,50,22,"flag"],[51,28,50,26],[51,29,50,27],[52,2,51,0],[53,2,53,7],[53,11,53,16,"clearAllDevFeatureOverrides"],[53,38,53,43,"clearAllDevFeatureOverrides"],[53,39,53,43],[53,41,53,52],[54,4,54,2],[54,8,54,6],[54,9,54,7,"__DEV__"],[54,16,54,14],[54,18,54,16],[55,4,55,2],[55,9,55,7],[55,15,55,13,"k"],[55,16,55,14],[55,20,55,18,"Object"],[55,26,55,24],[55,27,55,25,"keys"],[55,31,55,29],[55,32,55,30,"devOverrides"],[55,44,55,42],[55,45,55,43],[55,47,55,45],[55,54,55,52,"devOverrides"],[55,66,55,64],[55,67,55,65,"k"],[55,68,55,66],[55,69,55,67],[56,2,56,0],[58,2,58,0],[59,0,59,0],[60,0,60,0],[61,2,61,7],[61,11,61,16,"setRemoteFeatures"],[61,28,61,33,"setRemoteFeatures"],[61,29,61,34,"payload"],[61,36,61,64],[61,38,61,72],[62,4,62,2,"remoteVersion"],[62,17,62,15],[62,20,62,18,"payload"],[62,27,62,25],[62,28,62,26,"version"],[62,35,62,33],[62,39,62,37],[62,43,62,41],[63,4,63,2,"remoteFlags"],[63,15,63,13],[63,18,63,16],[63,22,63,16,"normalizeRemoteFlags"],[63,35,63,36],[63,36,63,36,"normalizeRemoteFlags"],[63,56,63,36],[63,58,63,37,"payload"],[63,65,63,44],[63,66,63,45,"flags"],[63,71,63,50],[63,72,63,51],[64,2,64,0],[65,2,66,7],[65,11,66,16,"clearRemoteFeatures"],[65,30,66,35,"clearRemoteFeatures"],[65,31,66,35],[65,33,66,44],[66,4,67,2,"remoteVersion"],[66,17,67,15],[66,20,67,18],[66,24,67,22],[67,4,68,2,"remoteFlags"],[67,15,68,13],[67,18,68,16],[67,19,68,17],[67,20,68,18],[68,2,69,0],[69,2,71,7],[69,11,71,16,"getRemoteFeaturesSnapshot"],[69,36,71,41,"getRemoteFeaturesSnapshot"],[69,37,71,41],[69,39,74,2],[70,4,75,2],[70,11,75,9],[71,6,75,11,"version"],[71,13,75,18],[71,15,75,20,"remoteVersion"],[71,28,75,33],[72,6,75,35,"flags"],[72,11,75,40],[72,13,75,42,"remoteFlags"],[73,4,75,54],[73,5,75,55],[74,2,76,0],[76,2,78,0],[77,0,79,0],[78,0,80,0],[79,0,81,0],[81,2,84,7],[81,11,84,16,"isFeatureEnabled"],[81,27,84,32,"isFeatureEnabled"],[81,28,84,33,"flag"],[81,32,84,45],[81,34,84,47,"ctx"],[81,37,84,71],[81,39,84,82],[82,4,85,2],[83,4,86,2],[83,8,86,6,"__DEV__"],[83,15,86,13],[83,19,86,17,"Object"],[83,25,86,23],[83,26,86,24,"prototype"],[83,35,86,33],[83,36,86,34,"hasOwnProperty"],[83,50,86,48],[83,51,86,49,"call"],[83,55,86,53],[83,56,86,54,"devOverrides"],[83,68,86,66],[83,70,86,68,"flag"],[83,74,86,72],[83,75,86,73],[83,77,86,75],[84,6,87,4],[84,13,87,11],[84,14,87,12],[84,15,87,13,"devOverrides"],[84,27,87,25],[84,28,87,26,"flag"],[84,32,87,30],[84,33,87,31],[85,4,88,2],[87,4,90,2],[88,4,91,2],[88,10,91,8,"r"],[88,11,91,9],[88,14,91,12,"remoteFlags"],[88,25,91,23],[88,26,91,24,"flag"],[88,30,91,28],[88,31,91,29],[89,4,92,2],[89,8,92,6,"r"],[89,9,92,7],[89,11,92,9],[90,6,93,4],[90,10,93,8],[90,11,93,9,"r"],[90,12,93,10],[90,13,93,11,"enabled"],[90,20,93,18],[90,22,93,20],[90,29,93,27],[90,34,93,32],[91,6,94,4],[91,10,94,8],[91,17,94,15,"r"],[91,18,94,16],[91,19,94,17,"rollout"],[91,26,94,24],[91,31,94,29],[91,39,94,37],[91,41,94,39],[92,8,95,6],[92,14,95,12,"stableId"],[92,22,95,20],[92,25,95,23,"ctx"],[92,28,95,26],[92,30,95,28,"stableId"],[92,38,95,36],[93,8,96,6],[93,12,96,10],[93,13,96,11,"stableId"],[93,21,96,19],[93,23,96,21],[93,30,96,28],[93,34,96,32],[93,35,96,33],[93,36,96,34],[94,8,97,6],[94,14,97,12,"b"],[94,15,97,13],[94,18,97,16],[94,22,97,16,"bucket01"],[94,35,97,24],[94,36,97,24,"bucket01"],[94,44,97,24],[94,46,97,25],[94,49,97,28,"flag"],[94,53,97,32],[94,57,97,36,"stableId"],[94,65,97,44],[94,67,97,46],[94,68,97,47],[95,8,98,6],[95,15,98,13,"b"],[95,16,98,14],[95,19,98,17,"r"],[95,20,98,18],[95,21,98,19,"rollout"],[95,28,98,26],[96,6,99,4],[97,6,100,4],[97,13,100,11],[97,17,100,15],[98,4,101,2],[100,4,103,2],[101,4,104,2],[101,8,104,6,"Object"],[101,14,104,12],[101,15,104,13,"prototype"],[101,24,104,22],[101,25,104,23,"hasOwnProperty"],[101,39,104,37],[101,40,104,38,"call"],[101,44,104,42],[101,45,104,43,"DEFAULT_FLAGS"],[101,58,104,56],[101,60,104,58,"flag"],[101,64,104,62],[101,65,104,63],[101,67,104,65],[102,6,105,4],[102,13,105,11],[102,14,105,12],[102,15,105,14,"DEFAULT_FLAGS"],[102,28,105,27],[102,29,105,56,"flag"],[102,33,105,60],[102,34,105,61],[103,4,106,2],[105,4,108,2],[106,4,109,2],[106,11,109,9],[106,16,109,14],[107,2,110,0],[108,0,110,1],[108,3]],"functionMap":{"names":["<global>","setDevFeatureOverride","clearDevFeatureOverride","clearAllDevFeatureOverrides","setRemoteFeatures","clearRemoteFeatures","getRemoteFeaturesSnapshot","isFeatureEnabled"],"mappings":"AAA;OC0C;CDG;OEE;CFG;OGE;CHG;OIK;CJG;OKE;CLG;OME;CNK;OOQ;CP0B"},"hasCjsExports":false},"type":"js/module"}]}