{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":14,"index":78},"end":{"line":3,"column":38,"index":102}}],"key":"ud8OE6Lg8Q81+bS6ynZj2uyMPdA=","exportNames":["*"],"imports":1}},{"name":"./hub.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":12,"index":116},"end":{"line":4,"column":31,"index":135}}],"key":"17NUtVIQT6VGY1RVn8kjoC2kMVI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _classCallCheck = require(_dependencyMap[0], \"@babel/runtime/helpers/classCallCheck\").default;\n  var _createClass = require(_dependencyMap[1], \"@babel/runtime/helpers/createClass\").default;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  var utils = require(_dependencyMap[2], \"@sentry/utils\");\n  var hub = require(_dependencyMap[3], \"./hub.js\");\n\n  /**\n   * @inheritdoc\n   */\n  var SessionFlusher = /*#__PURE__*/function () {\n    \"use strict\";\n\n    function SessionFlusher(client, attrs) {\n      _classCallCheck(this, SessionFlusher);\n      this._client = client;\n      this.flushTimeout = 60;\n      this._pendingAggregates = {};\n      this._isEnabled = true;\n\n      // Call to setInterval, so that flush is called every 60 seconds\n      this._intervalId = setInterval(() => this.flush(), this.flushTimeout * 1000);\n      this._sessionAttrs = attrs;\n    }\n\n    /** Checks if `pendingAggregates` has entries, and if it does flushes them by calling `sendSession` */\n    return _createClass(SessionFlusher, [{\n      key: \"flush\",\n      value: function flush() {\n        var sessionAggregates = this.getSessionAggregates();\n        if (sessionAggregates.aggregates.length === 0) {\n          return;\n        }\n        this._pendingAggregates = {};\n        this._client.sendSession(sessionAggregates);\n      }\n\n      /** Massages the entries in `pendingAggregates` and returns aggregated sessions */\n    }, {\n      key: \"getSessionAggregates\",\n      value: function getSessionAggregates() {\n        var aggregates = Object.keys(this._pendingAggregates).map(key => {\n          return this._pendingAggregates[parseInt(key)];\n        });\n        var sessionAggregates = {\n          attrs: this._sessionAttrs,\n          aggregates\n        };\n        return utils.dropUndefinedKeys(sessionAggregates);\n      }\n\n      /** JSDoc */\n    }, {\n      key: \"close\",\n      value: function close() {\n        clearInterval(this._intervalId);\n        this._isEnabled = false;\n        this.flush();\n      }\n\n      /**\n       * Wrapper function for _incrementSessionStatusCount that checks if the instance of SessionFlusher is enabled then\n       * fetches the session status of the request from `Scope.getRequestSession().status` on the scope and passes them to\n       * `_incrementSessionStatusCount` along with the start date\n       */\n    }, {\n      key: \"incrementSessionStatusCount\",\n      value: function incrementSessionStatusCount() {\n        if (!this._isEnabled) {\n          return;\n        }\n        var scope = hub.getCurrentHub().getScope();\n        var requestSession = scope.getRequestSession();\n        if (requestSession && requestSession.status) {\n          this._incrementSessionStatusCount(requestSession.status, new Date());\n          // This is not entirely necessarily but is added as a safe guard to indicate the bounds of a request and so in\n          // case captureRequestSession is called more than once to prevent double count\n          scope.setRequestSession(undefined);\n          /* eslint-enable @typescript-eslint/no-unsafe-member-access */\n        }\n      }\n\n      /**\n       * Increments status bucket in pendingAggregates buffer (internal state) corresponding to status of\n       * the session received\n       */\n    }, {\n      key: \"_incrementSessionStatusCount\",\n      value: function _incrementSessionStatusCount(status, date) {\n        // Truncate minutes and seconds on Session Started attribute to have one minute bucket keys\n        var sessionStartedTrunc = new Date(date).setSeconds(0, 0);\n        this._pendingAggregates[sessionStartedTrunc] = this._pendingAggregates[sessionStartedTrunc] || {};\n\n        // corresponds to aggregated sessions in one specific minute bucket\n        // for example, {\"started\":\"2021-03-16T08:00:00.000Z\",\"exited\":4, \"errored\": 1}\n        var aggregationCounts = this._pendingAggregates[sessionStartedTrunc];\n        if (!aggregationCounts.started) {\n          aggregationCounts.started = new Date(sessionStartedTrunc).toISOString();\n        }\n        switch (status) {\n          case 'errored':\n            aggregationCounts.errored = (aggregationCounts.errored || 0) + 1;\n            return aggregationCounts.errored;\n          case 'ok':\n            aggregationCounts.exited = (aggregationCounts.exited || 0) + 1;\n            return aggregationCounts.exited;\n          default:\n            aggregationCounts.crashed = (aggregationCounts.crashed || 0) + 1;\n            return aggregationCounts.crashed;\n        }\n      }\n    }]);\n  }();\n  exports.SessionFlusher = SessionFlusher;\n});","lineCount":117,"map":[[4,2,1,0,"Object"],[4,8,1,6],[4,9,1,7,"defineProperty"],[4,23,1,21],[4,24,1,22,"exports"],[4,31,1,29],[4,33,1,31],[4,45,1,43],[4,47,1,45],[5,4,1,47,"value"],[5,9,1,52],[5,11,1,54],[6,2,1,59],[6,3,1,60],[6,4,1,61],[7,2,3,0],[7,6,3,6,"utils"],[7,11,3,11],[7,14,3,14,"require"],[7,21,3,21],[7,22,3,21,"_dependencyMap"],[7,36,3,21],[7,56,3,37],[7,57,3,38],[8,2,4,0],[8,6,4,6,"hub"],[8,9,4,9],[8,12,4,12,"require"],[8,19,4,19],[8,20,4,19,"_dependencyMap"],[8,34,4,19],[8,49,4,30],[8,50,4,31],[10,2,6,0],[11,0,7,0],[12,0,8,0],[13,2,6,0],[13,6,9,6,"SessionFlusher"],[13,20,9,20],[14,4,9,20],[16,4,11,3],[16,13,11,3,"SessionFlusher"],[16,28,11,15,"client"],[16,34,11,21],[16,36,11,23,"attrs"],[16,41,11,28],[16,43,11,30],[17,6,11,30,"_classCallCheck"],[17,21,11,30],[17,28,11,30,"SessionFlusher"],[17,42,11,30],[18,6,12,4],[18,10,12,8],[18,11,12,9,"_client"],[18,18,12,16],[18,21,12,19,"client"],[18,27,12,25],[19,6,13,4],[19,10,13,8],[19,11,13,9,"flushTimeout"],[19,23,13,21],[19,26,13,24],[19,28,13,26],[20,6,14,4],[20,10,14,8],[20,11,14,9,"_pendingAggregates"],[20,29,14,27],[20,32,14,30],[20,33,14,31],[20,34,14,32],[21,6,15,4],[21,10,15,8],[21,11,15,9,"_isEnabled"],[21,21,15,19],[21,24,15,22],[21,28,15,26],[23,6,17,4],[24,6,18,4],[24,10,18,8],[24,11,18,9,"_intervalId"],[24,22,18,20],[24,25,18,23,"setInterval"],[24,36,18,34],[24,37,18,35],[24,43,18,41],[24,47,18,45],[24,48,18,46,"flush"],[24,53,18,51],[24,54,18,52],[24,55,18,53],[24,57,18,55],[24,61,18,59],[24,62,18,60,"flushTimeout"],[24,74,18,72],[24,77,18,75],[24,81,18,79],[24,82,18,80],[25,6,19,4],[25,10,19,8],[25,11,19,9,"_sessionAttrs"],[25,24,19,22],[25,27,19,25,"attrs"],[25,32,19,30],[26,4,20,2],[28,4,22,2],[29,4,22,2],[29,11,22,2,"_createClass"],[29,23,22,2],[29,24,22,2,"SessionFlusher"],[29,38,22,2],[30,6,22,2,"key"],[30,9,22,2],[31,6,22,2,"value"],[31,11,22,2],[31,13,23,3],[31,22,23,3,"flush"],[31,27,23,8,"flush"],[31,28,23,8],[31,30,23,11],[32,8,24,4],[32,12,24,10,"sessionAggregates"],[32,29,24,27],[32,32,24,30],[32,36,24,34],[32,37,24,35,"getSessionAggregates"],[32,57,24,55],[32,58,24,56],[32,59,24,57],[33,8,25,4],[33,12,25,8,"sessionAggregates"],[33,29,25,25],[33,30,25,26,"aggregates"],[33,40,25,36],[33,41,25,37,"length"],[33,47,25,43],[33,52,25,48],[33,53,25,49],[33,55,25,51],[34,10,26,6],[35,8,27,4],[36,8,28,4],[36,12,28,8],[36,13,28,9,"_pendingAggregates"],[36,31,28,27],[36,34,28,30],[36,35,28,31],[36,36,28,32],[37,8,29,4],[37,12,29,8],[37,13,29,9,"_client"],[37,20,29,16],[37,21,29,17,"sendSession"],[37,32,29,28],[37,33,29,29,"sessionAggregates"],[37,50,29,46],[37,51,29,47],[38,6,30,2],[40,6,32,2],[41,4,32,2],[42,6,32,2,"key"],[42,9,32,2],[43,6,32,2,"value"],[43,11,32,2],[43,13,33,3],[43,22,33,3,"getSessionAggregates"],[43,42,33,23,"getSessionAggregates"],[43,43,33,23],[43,45,33,26],[44,8,34,4],[44,12,34,10,"aggregates"],[44,22,34,20],[44,25,34,23,"Object"],[44,31,34,29],[44,32,34,30,"keys"],[44,36,34,34],[44,37,34,35],[44,41,34,39],[44,42,34,40,"_pendingAggregates"],[44,60,34,58],[44,61,34,59],[44,62,34,60,"map"],[44,65,34,63],[44,66,34,65,"key"],[44,69,34,68],[44,73,34,73],[45,10,35,6],[45,17,35,13],[45,21,35,17],[45,22,35,18,"_pendingAggregates"],[45,40,35,36],[45,41,35,37,"parseInt"],[45,49,35,45],[45,50,35,46,"key"],[45,53,35,49],[45,54,35,50],[45,55,35,51],[46,8,36,4],[46,9,36,5],[46,10,36,6],[47,8,38,4],[47,12,38,10,"sessionAggregates"],[47,29,38,27],[47,32,38,30],[48,10,39,6,"attrs"],[48,15,39,11],[48,17,39,13],[48,21,39,17],[48,22,39,18,"_sessionAttrs"],[48,35,39,31],[49,10,40,6,"aggregates"],[50,8,41,4],[50,9,41,5],[51,8,42,4],[51,15,42,11,"utils"],[51,20,42,16],[51,21,42,17,"dropUndefinedKeys"],[51,38,42,34],[51,39,42,35,"sessionAggregates"],[51,56,42,52],[51,57,42,53],[52,6,43,2],[54,6,45,2],[55,4,45,2],[56,6,45,2,"key"],[56,9,45,2],[57,6,45,2,"value"],[57,11,45,2],[57,13,46,3],[57,22,46,3,"close"],[57,27,46,8,"close"],[57,28,46,8],[57,30,46,11],[58,8,47,4,"clearInterval"],[58,21,47,17],[58,22,47,18],[58,26,47,22],[58,27,47,23,"_intervalId"],[58,38,47,34],[58,39,47,35],[59,8,48,4],[59,12,48,8],[59,13,48,9,"_isEnabled"],[59,23,48,19],[59,26,48,22],[59,31,48,27],[60,8,49,4],[60,12,49,8],[60,13,49,9,"flush"],[60,18,49,14],[60,19,49,15],[60,20,49,16],[61,6,50,2],[63,6,52,2],[64,0,53,0],[65,0,54,0],[66,0,55,0],[67,0,56,0],[68,4,52,2],[69,6,52,2,"key"],[69,9,52,2],[70,6,52,2,"value"],[70,11,52,2],[70,13,57,3],[70,22,57,3,"incrementSessionStatusCount"],[70,49,57,30,"incrementSessionStatusCount"],[70,50,57,30],[70,52,57,33],[71,8,58,4],[71,12,58,8],[71,13,58,9],[71,17,58,13],[71,18,58,14,"_isEnabled"],[71,28,58,24],[71,30,58,26],[72,10,59,6],[73,8,60,4],[74,8,61,4],[74,12,61,10,"scope"],[74,17,61,15],[74,20,61,18,"hub"],[74,23,61,21],[74,24,61,22,"getCurrentHub"],[74,37,61,35],[74,38,61,36],[74,39,61,37],[74,40,61,38,"getScope"],[74,48,61,46],[74,49,61,47],[74,50,61,48],[75,8,62,4],[75,12,62,10,"requestSession"],[75,26,62,24],[75,29,62,27,"scope"],[75,34,62,32],[75,35,62,33,"getRequestSession"],[75,52,62,50],[75,53,62,51],[75,54,62,52],[76,8,64,4],[76,12,64,8,"requestSession"],[76,26,64,22],[76,30,64,26,"requestSession"],[76,44,64,40],[76,45,64,41,"status"],[76,51,64,47],[76,53,64,49],[77,10,65,6],[77,14,65,10],[77,15,65,11,"_incrementSessionStatusCount"],[77,43,65,39],[77,44,65,40,"requestSession"],[77,58,65,54],[77,59,65,55,"status"],[77,65,65,61],[77,67,65,63],[77,71,65,67,"Date"],[77,75,65,71],[77,76,65,72],[77,77,65,73],[77,78,65,74],[78,10,66,6],[79,10,67,6],[80,10,68,6,"scope"],[80,15,68,11],[80,16,68,12,"setRequestSession"],[80,33,68,29],[80,34,68,30,"undefined"],[80,43,68,39],[80,44,68,40],[81,10,69,6],[82,8,70,4],[83,6,71,2],[85,6,73,2],[86,0,74,0],[87,0,75,0],[88,0,76,0],[89,4,73,2],[90,6,73,2,"key"],[90,9,73,2],[91,6,73,2,"value"],[91,11,73,2],[91,13,77,3],[91,22,77,3,"_incrementSessionStatusCount"],[91,50,77,31,"_incrementSessionStatusCount"],[91,51,77,32,"status"],[91,57,77,38],[91,59,77,40,"date"],[91,63,77,44],[91,65,77,46],[92,8,78,4],[93,8,79,4],[93,12,79,10,"sessionStartedTrunc"],[93,31,79,29],[93,34,79,32],[93,38,79,36,"Date"],[93,42,79,40],[93,43,79,41,"date"],[93,47,79,45],[93,48,79,46],[93,49,79,47,"setSeconds"],[93,59,79,57],[93,60,79,58],[93,61,79,59],[93,63,79,61],[93,64,79,62],[93,65,79,63],[94,8,80,4],[94,12,80,8],[94,13,80,9,"_pendingAggregates"],[94,31,80,27],[94,32,80,28,"sessionStartedTrunc"],[94,51,80,47],[94,52,80,48],[94,55,80,51],[94,59,80,55],[94,60,80,56,"_pendingAggregates"],[94,78,80,74],[94,79,80,75,"sessionStartedTrunc"],[94,98,80,94],[94,99,80,95],[94,103,80,99],[94,104,80,100],[94,105,80,101],[96,8,82,4],[97,8,83,4],[98,8,84,4],[98,12,84,10,"aggregationCounts"],[98,29,84,27],[98,32,84,30],[98,36,84,34],[98,37,84,35,"_pendingAggregates"],[98,55,84,53],[98,56,84,54,"sessionStartedTrunc"],[98,75,84,73],[98,76,84,74],[99,8,85,4],[99,12,85,8],[99,13,85,9,"aggregationCounts"],[99,30,85,26],[99,31,85,27,"started"],[99,38,85,34],[99,40,85,36],[100,10,86,6,"aggregationCounts"],[100,27,86,23],[100,28,86,24,"started"],[100,35,86,31],[100,38,86,34],[100,42,86,38,"Date"],[100,46,86,42],[100,47,86,43,"sessionStartedTrunc"],[100,66,86,62],[100,67,86,63],[100,68,86,64,"toISOString"],[100,79,86,75],[100,80,86,76],[100,81,86,77],[101,8,87,4],[102,8,89,4],[102,16,89,12,"status"],[102,22,89,18],[103,10,90,6],[103,15,90,11],[103,24,90,20],[104,12,91,8,"aggregationCounts"],[104,29,91,25],[104,30,91,26,"errored"],[104,37,91,33],[104,40,91,36],[104,41,91,37,"aggregationCounts"],[104,58,91,54],[104,59,91,55,"errored"],[104,66,91,62],[104,70,91,66],[104,71,91,67],[104,75,91,71],[104,76,91,72],[105,12,92,8],[105,19,92,15,"aggregationCounts"],[105,36,92,32],[105,37,92,33,"errored"],[105,44,92,40],[106,10,93,6],[106,15,93,11],[106,19,93,15],[107,12,94,8,"aggregationCounts"],[107,29,94,25],[107,30,94,26,"exited"],[107,36,94,32],[107,39,94,35],[107,40,94,36,"aggregationCounts"],[107,57,94,53],[107,58,94,54,"exited"],[107,64,94,60],[107,68,94,64],[107,69,94,65],[107,73,94,69],[107,74,94,70],[108,12,95,8],[108,19,95,15,"aggregationCounts"],[108,36,95,32],[108,37,95,33,"exited"],[108,43,95,39],[109,10,96,6],[110,12,97,8,"aggregationCounts"],[110,29,97,25],[110,30,97,26,"crashed"],[110,37,97,33],[110,40,97,36],[110,41,97,37,"aggregationCounts"],[110,58,97,54],[110,59,97,55,"crashed"],[110,66,97,62],[110,70,97,66],[110,71,97,67],[110,75,97,71],[110,76,97,72],[111,12,98,8],[111,19,98,15,"aggregationCounts"],[111,36,98,32],[111,37,98,33,"crashed"],[111,44,98,40],[112,8,99,4],[113,6,100,2],[114,4,100,3],[115,2,100,3],[116,2,103,0,"exports"],[116,9,103,7],[116,10,103,8,"SessionFlusher"],[116,24,103,22],[116,27,103,25,"SessionFlusher"],[116,41,103,39],[117,0,103,40],[117,3]],"functionMap":{"names":["<global>","SessionFlusher","SessionFlusher#constructor","setInterval$argument_0","SessionFlusher#flush","SessionFlusher#getSessionAggregates","Object.keys.map$argument_0","SessionFlusher#close","SessionFlusher#incrementSessionStatusCount","SessionFlusher#_incrementSessionStatusCount"],"mappings":"AAA;ACQ;GCE;mCCO,kBD;GDE;GGG;GHO;GIG;gECC;KDE;GJO;GMG;GNI;GOO;GPc;GQM;GRuB;CDC"},"hasCjsExports":true},"type":"js/module"}]}