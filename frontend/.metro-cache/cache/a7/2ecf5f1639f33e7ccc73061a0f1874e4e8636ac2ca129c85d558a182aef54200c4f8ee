{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"../authStorage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":234},"end":{"line":8,"column":47,"index":281}}],"key":"8h7N/7sKemAZqrgZg8dH/jTl5ys=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getMailSummary = getMailSummary;\n  exports.getMailRewards = getMailRewards;\n  exports.getMailMessages = getMailMessages;\n  exports.getMailGifts = getMailGifts;\n  exports.claimMailReward = claimMailReward;\n  exports.claimMailGift = claimMailGift;\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _authStorage = require(_dependencyMap[1], \"../authStorage\");\n  // /app/frontend/lib/api/mail.ts\n  // Phase 3.23.2.P: Mail API Layer with Auth\n  //\n  // Canonical API calls for mail system.\n  // Uses auth token from gameStore for server identity.\n  // Graceful error handling â€” returns defaults on failure.\n\n  const API_BASE = _expoVirtualEnv.env.EXPO_PUBLIC_API_URL || '';\n\n  /**\n   * Get auth headers for API calls\n   */\n  async function getAuthHeaders() {\n    const token = await (0, _authStorage.loadAuthToken)();\n    if (token) {\n      return {\n        Authorization: `Bearer ${token}`\n      };\n    }\n    return {};\n  }\n\n  /**\n   * Get mail summary (badge counts) - uses auth token\n   */\n  async function getMailSummary(username) {\n    try {\n      const headers = await getAuthHeaders();\n      // Use legacy route for compatibility, but server uses auth token for identity\n      const res = await fetch(`${API_BASE}/api/mail/summary/${username}`, {\n        headers\n      });\n      if (res.status === 401) {\n        // Token invalid - return defaults, let auth layer handle logout\n        return {\n          rewardsAvailable: 0,\n          unreadMessages: 0,\n          giftsAvailable: 0\n        };\n      }\n      if (!res.ok) throw new Error('Failed to fetch mail summary');\n      return await res.json();\n    } catch {\n      return {\n        rewardsAvailable: 0,\n        unreadMessages: 0,\n        giftsAvailable: 0\n      };\n    }\n  }\n\n  /**\n   * Get mail rewards list\n   */\n  async function getMailRewards(username) {\n    try {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`${API_BASE}/api/mail/rewards/${username}`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch rewards');\n      return await res.json();\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Get mail messages list\n   */\n  async function getMailMessages(username) {\n    try {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`${API_BASE}/api/mail/messages/${username}`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch messages');\n      return await res.json();\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Get mail gifts list\n   */\n  async function getMailGifts(username) {\n    try {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`${API_BASE}/api/mail/gifts/${username}`, {\n        headers\n      });\n      if (!res.ok) throw new Error('Failed to fetch gifts');\n      return await res.json();\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Claim a mail reward (idempotent)\n   */\n  async function claimMailReward(username, rewardId) {\n    const headers = await getAuthHeaders();\n    const res = await fetch(`${API_BASE}/api/mail/rewards/${username}/${rewardId}/claim`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) throw new Error('Failed to claim reward');\n    return await res.json();\n  }\n\n  /**\n   * Claim a mail gift (idempotent)\n   */\n  async function claimMailGift(username, giftId) {\n    const headers = await getAuthHeaders();\n    const res = await fetch(`${API_BASE}/api/mail/gifts/${username}/${giftId}/claim`, {\n      method: 'POST',\n      headers\n    });\n    if (!res.ok) throw new Error('Failed to claim gift');\n    return await res.json();\n  }\n});","lineCount":139,"map":[[7,2,26,0,"exports"],[7,9,26,0],[7,10,26,0,"getMailSummary"],[7,24,26,0],[7,27,26,0,"getMailSummary"],[7,41,26,0],[8,2,49,0,"exports"],[8,9,49,0],[8,10,49,0,"getMailRewards"],[8,24,49,0],[8,27,49,0,"getMailRewards"],[8,41,49,0],[9,2,70,0,"exports"],[9,9,70,0],[9,10,70,0,"getMailMessages"],[9,25,70,0],[9,28,70,0,"getMailMessages"],[9,43,70,0],[10,2,90,0,"exports"],[10,9,90,0],[10,10,90,0,"getMailGifts"],[10,22,90,0],[10,25,90,0,"getMailGifts"],[10,37,90,0],[11,2,110,0,"exports"],[11,9,110,0],[11,10,110,0,"claimMailReward"],[11,25,110,0],[11,28,110,0,"claimMailReward"],[11,43,110,0],[12,2,123,0,"exports"],[12,9,123,0],[12,10,123,0,"claimMailGift"],[12,23,123,0],[12,26,123,0,"claimMailGift"],[12,39,123,0],[13,2,131,1],[13,6,131,1,"_expoVirtualEnv"],[13,21,131,1],[13,24,131,1,"require"],[13,31,131,1],[13,32,131,1,"_dependencyMap"],[13,46,131,1],[14,2,8,0],[14,6,8,0,"_authStorage"],[14,18,8,0],[14,21,8,0,"require"],[14,28,8,0],[14,29,8,0,"_dependencyMap"],[14,43,8,0],[15,2,1,0],[16,2,2,0],[17,2,3,0],[18,2,4,0],[19,2,5,0],[20,2,6,0],[22,2,10,0],[22,8,10,6,"API_BASE"],[22,16,10,14],[22,19,10,17,"_expoVirtualEnv"],[22,34,10,17],[22,35,10,17,"env"],[22,38,10,17],[22,39,10,17,"EXPO_PUBLIC_API_URL"],[22,58,10,17],[22,62,10,52],[22,64,10,54],[24,2,12,0],[25,0,13,0],[26,0,14,0],[27,2,15,0],[27,17,15,15,"getAuthHeaders"],[27,31,15,29,"getAuthHeaders"],[27,32,15,29],[27,34,15,65],[28,4,16,2],[28,10,16,8,"token"],[28,15,16,13],[28,18,16,16],[28,24,16,22],[28,28,16,22,"loadAuthToken"],[28,40,16,35],[28,41,16,35,"loadAuthToken"],[28,54,16,35],[28,56,16,36],[28,57,16,37],[29,4,17,2],[29,8,17,6,"token"],[29,13,17,11],[29,15,17,13],[30,6,18,4],[30,13,18,11],[31,8,18,13,"Authorization"],[31,21,18,26],[31,23,18,28],[31,33,18,38,"token"],[31,38,18,43],[32,6,18,46],[32,7,18,47],[33,4,19,2],[34,4,20,2],[34,11,20,9],[34,12,20,10],[34,13,20,11],[35,2,21,0],[37,2,23,0],[38,0,24,0],[39,0,25,0],[40,2,26,7],[40,17,26,22,"getMailSummary"],[40,31,26,36,"getMailSummary"],[40,32,26,37,"username"],[40,40,26,53],[40,42,30,3],[41,4,31,2],[41,8,31,6],[42,6,32,4],[42,12,32,10,"headers"],[42,19,32,17],[42,22,32,20],[42,28,32,26,"getAuthHeaders"],[42,42,32,40],[42,43,32,41],[42,44,32,42],[43,6,33,4],[44,6,34,4],[44,12,34,10,"res"],[44,15,34,13],[44,18,34,16],[44,24,34,22,"fetch"],[44,29,34,27],[44,30,34,28],[44,33,34,31,"API_BASE"],[44,41,34,39],[44,62,34,60,"username"],[44,70,34,68],[44,72,34,70],[44,74,34,72],[45,8,34,74,"headers"],[46,6,34,82],[46,7,34,83],[46,8,34,84],[47,6,35,4],[47,10,35,8,"res"],[47,13,35,11],[47,14,35,12,"status"],[47,20,35,18],[47,25,35,23],[47,28,35,26],[47,30,35,28],[48,8,36,6],[49,8,37,6],[49,15,37,13],[50,10,37,15,"rewardsAvailable"],[50,26,37,31],[50,28,37,33],[50,29,37,34],[51,10,37,36,"unreadMessages"],[51,24,37,50],[51,26,37,52],[51,27,37,53],[52,10,37,55,"giftsAvailable"],[52,24,37,69],[52,26,37,71],[53,8,37,73],[53,9,37,74],[54,6,38,4],[55,6,39,4],[55,10,39,8],[55,11,39,9,"res"],[55,14,39,12],[55,15,39,13,"ok"],[55,17,39,15],[55,19,39,17],[55,25,39,23],[55,29,39,27,"Error"],[55,34,39,32],[55,35,39,33],[55,65,39,63],[55,66,39,64],[56,6,40,4],[56,13,40,11],[56,19,40,17,"res"],[56,22,40,20],[56,23,40,21,"json"],[56,27,40,25],[56,28,40,26],[56,29,40,27],[57,4,41,2],[57,5,41,3],[57,6,41,4],[57,12,41,10],[58,6,42,4],[58,13,42,11],[59,8,42,13,"rewardsAvailable"],[59,24,42,29],[59,26,42,31],[59,27,42,32],[60,8,42,34,"unreadMessages"],[60,22,42,48],[60,24,42,50],[60,25,42,51],[61,8,42,53,"giftsAvailable"],[61,22,42,67],[61,24,42,69],[62,6,42,71],[62,7,42,72],[63,4,43,2],[64,2,44,0],[66,2,46,0],[67,0,47,0],[68,0,48,0],[69,2,49,7],[69,17,49,22,"getMailRewards"],[69,31,49,36,"getMailRewards"],[69,32,49,37,"username"],[69,40,49,53],[69,42,56,4],[70,4,57,2],[70,8,57,6],[71,6,58,4],[71,12,58,10,"headers"],[71,19,58,17],[71,22,58,20],[71,28,58,26,"getAuthHeaders"],[71,42,58,40],[71,43,58,41],[71,44,58,42],[72,6,59,4],[72,12,59,10,"res"],[72,15,59,13],[72,18,59,16],[72,24,59,22,"fetch"],[72,29,59,27],[72,30,59,28],[72,33,59,31,"API_BASE"],[72,41,59,39],[72,62,59,60,"username"],[72,70,59,68],[72,72,59,70],[72,74,59,72],[73,8,59,74,"headers"],[74,6,59,82],[74,7,59,83],[74,8,59,84],[75,6,60,4],[75,10,60,8],[75,11,60,9,"res"],[75,14,60,12],[75,15,60,13,"ok"],[75,17,60,15],[75,19,60,17],[75,25,60,23],[75,29,60,27,"Error"],[75,34,60,32],[75,35,60,33],[75,60,60,58],[75,61,60,59],[76,6,61,4],[76,13,61,11],[76,19,61,17,"res"],[76,22,61,20],[76,23,61,21,"json"],[76,27,61,25],[76,28,61,26],[76,29,61,27],[77,4,62,2],[77,5,62,3],[77,6,62,4],[77,12,62,10],[78,6,63,4],[78,13,63,11],[78,15,63,13],[79,4,64,2],[80,2,65,0],[82,2,67,0],[83,0,68,0],[84,0,69,0],[85,2,70,7],[85,17,70,22,"getMailMessages"],[85,32,70,37,"getMailMessages"],[85,33,70,38,"username"],[85,41,70,54],[85,43,76,4],[86,4,77,2],[86,8,77,6],[87,6,78,4],[87,12,78,10,"headers"],[87,19,78,17],[87,22,78,20],[87,28,78,26,"getAuthHeaders"],[87,42,78,40],[87,43,78,41],[87,44,78,42],[88,6,79,4],[88,12,79,10,"res"],[88,15,79,13],[88,18,79,16],[88,24,79,22,"fetch"],[88,29,79,27],[88,30,79,28],[88,33,79,31,"API_BASE"],[88,41,79,39],[88,63,79,61,"username"],[88,71,79,69],[88,73,79,71],[88,75,79,73],[89,8,79,75,"headers"],[90,6,79,83],[90,7,79,84],[90,8,79,85],[91,6,80,4],[91,10,80,8],[91,11,80,9,"res"],[91,14,80,12],[91,15,80,13,"ok"],[91,17,80,15],[91,19,80,17],[91,25,80,23],[91,29,80,27,"Error"],[91,34,80,32],[91,35,80,33],[91,61,80,59],[91,62,80,60],[92,6,81,4],[92,13,81,11],[92,19,81,17,"res"],[92,22,81,20],[92,23,81,21,"json"],[92,27,81,25],[92,28,81,26],[92,29,81,27],[93,4,82,2],[93,5,82,3],[93,6,82,4],[93,12,82,10],[94,6,83,4],[94,13,83,11],[94,15,83,13],[95,4,84,2],[96,2,85,0],[98,2,87,0],[99,0,88,0],[100,0,89,0],[101,2,90,7],[101,17,90,22,"getMailGifts"],[101,29,90,34,"getMailGifts"],[101,30,90,35,"username"],[101,38,90,51],[101,40,96,4],[102,4,97,2],[102,8,97,6],[103,6,98,4],[103,12,98,10,"headers"],[103,19,98,17],[103,22,98,20],[103,28,98,26,"getAuthHeaders"],[103,42,98,40],[103,43,98,41],[103,44,98,42],[104,6,99,4],[104,12,99,10,"res"],[104,15,99,13],[104,18,99,16],[104,24,99,22,"fetch"],[104,29,99,27],[104,30,99,28],[104,33,99,31,"API_BASE"],[104,41,99,39],[104,60,99,58,"username"],[104,68,99,66],[104,70,99,68],[104,72,99,70],[105,8,99,72,"headers"],[106,6,99,80],[106,7,99,81],[106,8,99,82],[107,6,100,4],[107,10,100,8],[107,11,100,9,"res"],[107,14,100,12],[107,15,100,13,"ok"],[107,17,100,15],[107,19,100,17],[107,25,100,23],[107,29,100,27,"Error"],[107,34,100,32],[107,35,100,33],[107,58,100,56],[107,59,100,57],[108,6,101,4],[108,13,101,11],[108,19,101,17,"res"],[108,22,101,20],[108,23,101,21,"json"],[108,27,101,25],[108,28,101,26],[108,29,101,27],[109,4,102,2],[109,5,102,3],[109,6,102,4],[109,12,102,10],[110,6,103,4],[110,13,103,11],[110,15,103,13],[111,4,104,2],[112,2,105,0],[114,2,107,0],[115,0,108,0],[116,0,109,0],[117,2,110,7],[117,17,110,22,"claimMailReward"],[117,32,110,37,"claimMailReward"],[117,33,110,38,"username"],[117,41,110,54],[117,43,110,56,"rewardId"],[117,51,110,72],[117,53,110,113],[118,4,111,2],[118,10,111,8,"headers"],[118,17,111,15],[118,20,111,18],[118,26,111,24,"getAuthHeaders"],[118,40,111,38],[118,41,111,39],[118,42,111,40],[119,4,112,2],[119,10,112,8,"res"],[119,13,112,11],[119,16,112,14],[119,22,112,20,"fetch"],[119,27,112,25],[119,28,112,26],[119,31,112,29,"API_BASE"],[119,39,112,37],[119,60,112,58,"username"],[119,68,112,66],[119,72,112,70,"rewardId"],[119,80,112,78],[119,88,112,86],[119,90,112,88],[120,6,113,4,"method"],[120,12,113,10],[120,14,113,12],[120,20,113,18],[121,6,114,4,"headers"],[122,4,115,2],[122,5,115,3],[122,6,115,4],[123,4,116,2],[123,8,116,6],[123,9,116,7,"res"],[123,12,116,10],[123,13,116,11,"ok"],[123,15,116,13],[123,17,116,15],[123,23,116,21],[123,27,116,25,"Error"],[123,32,116,30],[123,33,116,31],[123,57,116,55],[123,58,116,56],[124,4,117,2],[124,11,117,9],[124,17,117,15,"res"],[124,20,117,18],[124,21,117,19,"json"],[124,25,117,23],[124,26,117,24],[124,27,117,25],[125,2,118,0],[127,2,120,0],[128,0,121,0],[129,0,122,0],[130,2,123,7],[130,17,123,22,"claimMailGift"],[130,30,123,35,"claimMailGift"],[130,31,123,36,"username"],[130,39,123,52],[130,41,123,54,"giftId"],[130,47,123,68],[130,49,123,109],[131,4,124,2],[131,10,124,8,"headers"],[131,17,124,15],[131,20,124,18],[131,26,124,24,"getAuthHeaders"],[131,40,124,38],[131,41,124,39],[131,42,124,40],[132,4,125,2],[132,10,125,8,"res"],[132,13,125,11],[132,16,125,14],[132,22,125,20,"fetch"],[132,27,125,25],[132,28,125,26],[132,31,125,29,"API_BASE"],[132,39,125,37],[132,58,125,56,"username"],[132,66,125,64],[132,70,125,68,"giftId"],[132,76,125,74],[132,84,125,82],[132,86,125,84],[133,6,126,4,"method"],[133,12,126,10],[133,14,126,12],[133,20,126,18],[134,6,127,4,"headers"],[135,4,128,2],[135,5,128,3],[135,6,128,4],[136,4,129,2],[136,8,129,6],[136,9,129,7,"res"],[136,12,129,10],[136,13,129,11,"ok"],[136,15,129,13],[136,17,129,15],[136,23,129,21],[136,27,129,25,"Error"],[136,32,129,30],[136,33,129,31],[136,55,129,53],[136,56,129,54],[137,4,130,2],[137,11,130,9],[137,17,130,15,"res"],[137,20,130,18],[137,21,130,19,"json"],[137,25,130,23],[137,26,130,24],[137,27,130,25],[138,2,131,0],[139,0,131,1],[139,3]],"functionMap":{"names":["<global>","getAuthHeaders","getMailSummary","getMailRewards","getMailMessages","getMailGifts","claimMailReward","claimMailGift"],"mappings":"AAA;ACc;CDM;OEK;CFkB;OGK;CHgB;OIK;CJe;OKK;CLe;OMK;CNQ;OOK;CPQ"},"hasCjsExports":false},"type":"js/module"}]}