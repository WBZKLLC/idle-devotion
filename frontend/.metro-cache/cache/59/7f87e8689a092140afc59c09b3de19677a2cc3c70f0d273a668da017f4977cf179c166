{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n\n  // Intentionally keeping the key broad, as we don't know for sure what rate limit headers get returned from backend\n\n  const DEFAULT_RETRY_AFTER = 60 * 1000; // 60 seconds\n\n  /**\n   * Extracts Retry-After value from the request header or returns default value\n   * @param header string representation of 'Retry-After' header\n   * @param now current unix timestamp\n   *\n   */\n  function parseRetryAfterHeader(header, now = Date.now()) {\n    const headerDelay = parseInt(`${header}`, 10);\n    if (!isNaN(headerDelay)) {\n      return headerDelay * 1000;\n    }\n    const headerDate = Date.parse(`${header}`);\n    if (!isNaN(headerDate)) {\n      return headerDate - now;\n    }\n    return DEFAULT_RETRY_AFTER;\n  }\n\n  /**\n   * Gets the time that the given category is disabled until for rate limiting.\n   * In case no category-specific limit is set but a general rate limit across all categories is active,\n   * that time is returned.\n   *\n   * @return the time in ms that the category is disabled until or 0 if there's no active rate limit.\n   */\n  function disabledUntil(limits, category) {\n    return limits[category] || limits.all || 0;\n  }\n\n  /**\n   * Checks if a category is rate limited\n   */\n  function isRateLimited(limits, category, now = Date.now()) {\n    return disabledUntil(limits, category) > now;\n  }\n\n  /**\n   * Update ratelimits from incoming headers.\n   *\n   * @return the updated RateLimits object.\n   */\n  function updateRateLimits(limits, {\n    statusCode,\n    headers\n  }, now = Date.now()) {\n    const updatedRateLimits = {\n      ...limits\n    };\n\n    // \"The name is case-insensitive.\"\n    // https://developer.mozilla.org/en-US/docs/Web/API/Headers/get\n    const rateLimitHeader = headers && headers['x-sentry-rate-limits'];\n    const retryAfterHeader = headers && headers['retry-after'];\n    if (rateLimitHeader) {\n      /**\n       * rate limit headers are of the form\n       *     <header>,<header>,..\n       * where each <header> is of the form\n       *     <retry_after>: <categories>: <scope>: <reason_code>\n       * where\n       *     <retry_after> is a delay in seconds\n       *     <categories> is the event type(s) (error, transaction, etc) being rate limited and is of the form\n       *         <category>;<category>;...\n       *     <scope> is what's being limited (org, project, or key) - ignored by SDK\n       *     <reason_code> is an arbitrary string like \"org_quota\" - ignored by SDK\n       */\n      for (const limit of rateLimitHeader.trim().split(',')) {\n        const [retryAfter, categories] = limit.split(':', 2);\n        const headerDelay = parseInt(retryAfter, 10);\n        const delay = (!isNaN(headerDelay) ? headerDelay : 60) * 1000; // 60sec default\n        if (!categories) {\n          updatedRateLimits.all = now + delay;\n        } else {\n          for (const category of categories.split(';')) {\n            updatedRateLimits[category] = now + delay;\n          }\n        }\n      }\n    } else if (retryAfterHeader) {\n      updatedRateLimits.all = now + parseRetryAfterHeader(retryAfterHeader, now);\n    } else if (statusCode === 429) {\n      updatedRateLimits.all = now + 60 * 1000;\n    }\n    return updatedRateLimits;\n  }\n  exports.DEFAULT_RETRY_AFTER = DEFAULT_RETRY_AFTER;\n  exports.disabledUntil = disabledUntil;\n  exports.isRateLimited = isRateLimited;\n  exports.parseRetryAfterHeader = parseRetryAfterHeader;\n  exports.updateRateLimits = updateRateLimits;\n});","lineCount":100,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[6,2,3,0],[8,2,5,0],[8,8,5,6,"DEFAULT_RETRY_AFTER"],[8,27,5,25],[8,30,5,28],[8,32,5,30],[8,35,5,33],[8,39,5,37],[8,40,5,38],[8,41,5,39],[10,2,7,0],[11,0,8,0],[12,0,9,0],[13,0,10,0],[14,0,11,0],[15,0,12,0],[16,2,13,0],[16,11,13,9,"parseRetryAfterHeader"],[16,32,13,30,"parseRetryAfterHeader"],[16,33,13,31,"header"],[16,39,13,37],[16,41,13,39,"now"],[16,44,13,42],[16,47,13,45,"Date"],[16,51,13,49],[16,52,13,50,"now"],[16,55,13,53],[16,56,13,54],[16,57,13,55],[16,59,13,57],[17,4,14,2],[17,10,14,8,"headerDelay"],[17,21,14,19],[17,24,14,22,"parseInt"],[17,32,14,30],[17,33,14,31],[17,36,14,34,"header"],[17,42,14,40],[17,44,14,42],[17,46,14,44],[17,48,14,46],[17,49,14,47],[18,4,15,2],[18,8,15,6],[18,9,15,7,"isNaN"],[18,14,15,12],[18,15,15,13,"headerDelay"],[18,26,15,24],[18,27,15,25],[18,29,15,27],[19,6,16,4],[19,13,16,11,"headerDelay"],[19,24,16,22],[19,27,16,25],[19,31,16,29],[20,4,17,2],[21,4,19,2],[21,10,19,8,"headerDate"],[21,20,19,18],[21,23,19,21,"Date"],[21,27,19,25],[21,28,19,26,"parse"],[21,33,19,31],[21,34,19,32],[21,37,19,35,"header"],[21,43,19,41],[21,45,19,43],[21,46,19,44],[22,4,20,2],[22,8,20,6],[22,9,20,7,"isNaN"],[22,14,20,12],[22,15,20,13,"headerDate"],[22,25,20,23],[22,26,20,24],[22,28,20,26],[23,6,21,4],[23,13,21,11,"headerDate"],[23,23,21,21],[23,26,21,24,"now"],[23,29,21,27],[24,4,22,2],[25,4,24,2],[25,11,24,9,"DEFAULT_RETRY_AFTER"],[25,30,24,28],[26,2,25,0],[28,2,27,0],[29,0,28,0],[30,0,29,0],[31,0,30,0],[32,0,31,0],[33,0,32,0],[34,0,33,0],[35,2,34,0],[35,11,34,9,"disabledUntil"],[35,24,34,22,"disabledUntil"],[35,25,34,23,"limits"],[35,31,34,29],[35,33,34,31,"category"],[35,41,34,39],[35,43,34,41],[36,4,35,2],[36,11,35,9,"limits"],[36,17,35,15],[36,18,35,16,"category"],[36,26,35,24],[36,27,35,25],[36,31,35,29,"limits"],[36,37,35,35],[36,38,35,36,"all"],[36,41,35,39],[36,45,35,43],[36,46,35,44],[37,2,36,0],[39,2,38,0],[40,0,39,0],[41,0,40,0],[42,2,41,0],[42,11,41,9,"isRateLimited"],[42,24,41,22,"isRateLimited"],[42,25,41,23,"limits"],[42,31,41,29],[42,33,41,31,"category"],[42,41,41,39],[42,43,41,41,"now"],[42,46,41,44],[42,49,41,47,"Date"],[42,53,41,51],[42,54,41,52,"now"],[42,57,41,55],[42,58,41,56],[42,59,41,57],[42,61,41,59],[43,4,42,2],[43,11,42,9,"disabledUntil"],[43,24,42,22],[43,25,42,23,"limits"],[43,31,42,29],[43,33,42,31,"category"],[43,41,42,39],[43,42,42,40],[43,45,42,43,"now"],[43,48,42,46],[44,2,43,0],[46,2,45,0],[47,0,46,0],[48,0,47,0],[49,0,48,0],[50,0,49,0],[51,2,50,0],[51,11,50,9,"updateRateLimits"],[51,27,50,25,"updateRateLimits"],[51,28,51,2,"limits"],[51,34,51,8],[51,36,52,2],[52,4,52,4,"statusCode"],[52,14,52,14],[53,4,52,16,"headers"],[54,2,52,24],[54,3,52,25],[54,5,53,2,"now"],[54,8,53,5],[54,11,53,8,"Date"],[54,15,53,12],[54,16,53,13,"now"],[54,19,53,16],[54,20,53,17],[54,21,53,18],[54,23,54,2],[55,4,55,2],[55,10,55,8,"updatedRateLimits"],[55,27,55,25],[55,30,55,28],[56,6,56,4],[56,9,56,7,"limits"],[57,4,57,2],[57,5,57,3],[59,4,59,2],[60,4,60,2],[61,4,61,2],[61,10,61,8,"rateLimitHeader"],[61,25,61,23],[61,28,61,26,"headers"],[61,35,61,33],[61,39,61,37,"headers"],[61,46,61,44],[61,47,61,45],[61,69,61,67],[61,70,61,68],[62,4,62,2],[62,10,62,8,"retryAfterHeader"],[62,26,62,24],[62,29,62,27,"headers"],[62,36,62,34],[62,40,62,38,"headers"],[62,47,62,45],[62,48,62,46],[62,61,62,59],[62,62,62,60],[63,4,64,2],[63,8,64,6,"rateLimitHeader"],[63,23,64,21],[63,25,64,23],[64,6,65,4],[65,0,66,0],[66,0,67,0],[67,0,68,0],[68,0,69,0],[69,0,70,0],[70,0,71,0],[71,0,72,0],[72,0,73,0],[73,0,74,0],[74,0,75,0],[75,0,76,0],[76,6,77,4],[76,11,77,9],[76,17,77,15,"limit"],[76,22,77,20],[76,26,77,24,"rateLimitHeader"],[76,41,77,39],[76,42,77,40,"trim"],[76,46,77,44],[76,47,77,45],[76,48,77,46],[76,49,77,47,"split"],[76,54,77,52],[76,55,77,53],[76,58,77,56],[76,59,77,57],[76,61,77,59],[77,8,78,6],[77,14,78,12],[77,15,78,13,"retryAfter"],[77,25,78,23],[77,27,78,25,"categories"],[77,37,78,35],[77,38,78,36],[77,41,78,39,"limit"],[77,46,78,44],[77,47,78,45,"split"],[77,52,78,50],[77,53,78,51],[77,56,78,54],[77,58,78,56],[77,59,78,57],[77,60,78,58],[78,8,79,6],[78,14,79,12,"headerDelay"],[78,25,79,23],[78,28,79,26,"parseInt"],[78,36,79,34],[78,37,79,35,"retryAfter"],[78,47,79,45],[78,49,79,47],[78,51,79,49],[78,52,79,50],[79,8,80,6],[79,14,80,12,"delay"],[79,19,80,17],[79,22,80,20],[79,23,80,21],[79,24,80,22,"isNaN"],[79,29,80,27],[79,30,80,28,"headerDelay"],[79,41,80,39],[79,42,80,40],[79,45,80,43,"headerDelay"],[79,56,80,54],[79,59,80,57],[79,61,80,59],[79,65,80,63],[79,69,80,67],[79,70,80,68],[79,71,80,69],[80,8,81,6],[80,12,81,10],[80,13,81,11,"categories"],[80,23,81,21],[80,25,81,23],[81,10,82,8,"updatedRateLimits"],[81,27,82,25],[81,28,82,26,"all"],[81,31,82,29],[81,34,82,32,"now"],[81,37,82,35],[81,40,82,38,"delay"],[81,45,82,43],[82,8,83,6],[82,9,83,7],[82,15,83,13],[83,10,84,8],[83,15,84,13],[83,21,84,19,"category"],[83,29,84,27],[83,33,84,31,"categories"],[83,43,84,41],[83,44,84,42,"split"],[83,49,84,47],[83,50,84,48],[83,53,84,51],[83,54,84,52],[83,56,84,54],[84,12,85,10,"updatedRateLimits"],[84,29,85,27],[84,30,85,28,"category"],[84,38,85,36],[84,39,85,37],[84,42,85,40,"now"],[84,45,85,43],[84,48,85,46,"delay"],[84,53,85,51],[85,10,86,8],[86,8,87,6],[87,6,88,4],[88,4,89,2],[88,5,89,3],[88,11,89,9],[88,15,89,13,"retryAfterHeader"],[88,31,89,29],[88,33,89,31],[89,6,90,4,"updatedRateLimits"],[89,23,90,21],[89,24,90,22,"all"],[89,27,90,25],[89,30,90,28,"now"],[89,33,90,31],[89,36,90,34,"parseRetryAfterHeader"],[89,57,90,55],[89,58,90,56,"retryAfterHeader"],[89,74,90,72],[89,76,90,74,"now"],[89,79,90,77],[89,80,90,78],[90,4,91,2],[90,5,91,3],[90,11,91,9],[90,15,91,13,"statusCode"],[90,25,91,23],[90,30,91,28],[90,33,91,31],[90,35,91,33],[91,6,92,4,"updatedRateLimits"],[91,23,92,21],[91,24,92,22,"all"],[91,27,92,25],[91,30,92,28,"now"],[91,33,92,31],[91,36,92,34],[91,38,92,36],[91,41,92,39],[91,45,92,43],[92,4,93,2],[93,4,95,2],[93,11,95,9,"updatedRateLimits"],[93,28,95,26],[94,2,96,0],[95,2,98,0,"exports"],[95,9,98,7],[95,10,98,8,"DEFAULT_RETRY_AFTER"],[95,29,98,27],[95,32,98,30,"DEFAULT_RETRY_AFTER"],[95,51,98,49],[96,2,99,0,"exports"],[96,9,99,7],[96,10,99,8,"disabledUntil"],[96,23,99,21],[96,26,99,24,"disabledUntil"],[96,39,99,37],[97,2,100,0,"exports"],[97,9,100,7],[97,10,100,8,"isRateLimited"],[97,23,100,21],[97,26,100,24,"isRateLimited"],[97,39,100,37],[98,2,101,0,"exports"],[98,9,101,7],[98,10,101,8,"parseRetryAfterHeader"],[98,31,101,29],[98,34,101,32,"parseRetryAfterHeader"],[98,55,101,53],[99,2,102,0,"exports"],[99,9,102,7],[99,10,102,8,"updateRateLimits"],[99,26,102,24],[99,29,102,27,"updateRateLimits"],[99,45,102,43],[100,0,102,44],[100,3]],"functionMap":{"names":["<global>","parseRetryAfterHeader","disabledUntil","isRateLimited","updateRateLimits"],"mappings":"AAA;ACY;CDY;AES;CFE;AGK;CHE;AIO;CJ8C"},"hasCjsExports":true},"type":"js/module"}]}