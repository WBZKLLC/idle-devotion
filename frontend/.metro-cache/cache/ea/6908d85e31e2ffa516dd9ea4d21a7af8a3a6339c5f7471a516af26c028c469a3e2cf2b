{"dependencies":[{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":41},"end":{"line":3,"column":69,"index":110}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"zustand","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":111},"end":{"line":4,"column":33,"index":144}}],"key":"POPvx7yS3Y3wz+S/9OAefiXNs0Q=","exportNames":["*"],"imports":1}},{"name":"../lib/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":146},"end":{"line":6,"column":49,"index":195}}],"key":"+Oh+VyeK103zLsUwT5Mv/nxNndY=","exportNames":["*"],"imports":1}},{"name":"../lib/featureUtils","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":196},"end":{"line":11,"column":29,"index":307}}],"key":"d6R8R5Y1i+tLPaGAwsEQjgzLUHc=","exportNames":["*"],"imports":1}},{"name":"../lib/features","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":308},"end":{"line":12,"column":52,"index":360}}],"key":"La/kRIQ3RRuKSVB+F06aeb3RE9Y=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useFeatureStore\", {\n    enumerable: true,\n    get: function () {\n      return useFeatureStore;\n    }\n  });\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[0], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _zustand = require(_dependencyMap[1], \"zustand\");\n  var _libApi = require(_dependencyMap[2], \"../lib/api\");\n  var _libFeatureUtils = require(_dependencyMap[3], \"../lib/featureUtils\");\n  var _libFeatures = require(_dependencyMap[4], \"../lib/features\");\n  // /app/frontend/stores/featureStore.ts\n\n  async function readCache() {\n    const raw = await AsyncStorage.default.getItem(_libFeatureUtils.FEATURES_STORAGE_KEY);\n    if (!raw) return null;\n    try {\n      const parsed = JSON.parse(raw);\n      if (!parsed?.payload?.flags || typeof parsed?.payload?.version !== 'number') return null;\n      if (typeof parsed.savedAt !== 'number' || typeof parsed.nextFetchAt !== 'number') return null;\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n  async function writeCache(payload, ttlSeconds) {\n    const now = Date.now();\n    const nextFetchAt = now + ttlSeconds * 1000;\n    const stored = {\n      savedAt: now,\n      nextFetchAt,\n      payload\n    };\n    await AsyncStorage.default.setItem(_libFeatureUtils.FEATURES_STORAGE_KEY, JSON.stringify(stored));\n    return stored;\n  }\n  const useFeatureStore = (0, _zustand.create)((set, get) => ({\n    featuresReady: false,\n    lastError: null,\n    remoteVersion: null,\n    nextFetchAt: null,\n    savedAt: null,\n    hydrateRemoteFeatures: async () => {\n      // 1) apply cached payload immediately (if present)\n      const cached = await readCache();\n      if (cached) {\n        (0, _libFeatures.setRemoteFeatures)(cached.payload);\n        set({\n          remoteVersion: cached.payload.version ?? null,\n          nextFetchAt: cached.nextFetchAt,\n          savedAt: cached.savedAt\n        });\n      }\n\n      // Mark ready after cache apply (or even if none)\n      set({\n        featuresReady: true\n      });\n\n      // 2) refresh if expired (don't block UI)\n      const now = Date.now();\n      const shouldFetch = !cached || cached.nextFetchAt <= now;\n      if (shouldFetch) {\n        await get().refreshRemoteFeatures({\n          force: true\n        });\n      }\n    },\n    refreshRemoteFeatures: async opts => {\n      const force = !!opts?.force;\n      const now = Date.now();\n      if (!force) {\n        const nextFetchAt = get().nextFetchAt;\n        if (typeof nextFetchAt === 'number' && nextFetchAt > now) return;\n      }\n      try {\n        const payload = await (0, _libApi.fetchRemoteFeatures)();\n\n        // TTL clamp protects you from backend mistakes\n        const ttlSeconds = (0, _libFeatureUtils.clampTtlSeconds)(payload.ttlSeconds);\n\n        // Apply remote in-memory first\n        (0, _libFeatures.setRemoteFeatures)(payload);\n\n        // Persist + update store metadata\n        const stored = await writeCache(payload, ttlSeconds);\n        set({\n          lastError: null,\n          remoteVersion: payload.version ?? null,\n          nextFetchAt: stored.nextFetchAt,\n          savedAt: stored.savedAt\n        });\n      } catch (e) {\n        set({\n          lastError: e?.message ? String(e.message) : 'Failed to refresh remote feature flags'\n        });\n        // Do NOT clear remote features here; keep cached/default behavior stable.\n      }\n    },\n    clearCachedFeatures: async () => {\n      await AsyncStorage.default.removeItem(_libFeatureUtils.FEATURES_STORAGE_KEY);\n      set({\n        remoteVersion: null,\n        nextFetchAt: null,\n        savedAt: null,\n        lastError: null\n      });\n    }\n  }));\n});","lineCount":122,"map":[[12,2,65,0,"Object"],[12,8,65,0],[12,9,65,0,"defineProperty"],[12,23,65,0],[12,24,65,0,"exports"],[12,31,65,0],[13,4,65,0,"enumerable"],[13,14,65,0],[14,4,65,0,"get"],[14,7,65,0],[14,18,65,0,"get"],[14,19,65,0],[15,6,65,0],[15,13,65,0,"useFeatureStore"],[15,28,65,0],[16,4,65,0],[17,2,65,0],[18,2,3,0],[18,6,3,0,"_reactNativeAsyncStorageAsyncStorage"],[18,42,3,0],[18,45,3,0,"require"],[18,52,3,0],[18,53,3,0,"_dependencyMap"],[18,67,3,0],[19,2,3,0],[19,6,3,0,"AsyncStorage"],[19,18,3,0],[19,21,3,0,"_interopDefault"],[19,36,3,0],[19,37,3,0,"_reactNativeAsyncStorageAsyncStorage"],[19,73,3,0],[20,2,4,0],[20,6,4,0,"_zustand"],[20,14,4,0],[20,17,4,0,"require"],[20,24,4,0],[20,25,4,0,"_dependencyMap"],[20,39,4,0],[21,2,6,0],[21,6,6,0,"_libApi"],[21,13,6,0],[21,16,6,0,"require"],[21,23,6,0],[21,24,6,0,"_dependencyMap"],[21,38,6,0],[22,2,7,0],[22,6,7,0,"_libFeatureUtils"],[22,22,7,0],[22,25,7,0,"require"],[22,32,7,0],[22,33,7,0,"_dependencyMap"],[22,47,7,0],[23,2,12,0],[23,6,12,0,"_libFeatures"],[23,18,12,0],[23,21,12,0,"require"],[23,28,12,0],[23,29,12,0,"_dependencyMap"],[23,43,12,0],[24,2,1,0],[26,2,38,0],[26,17,38,15,"readCache"],[26,26,38,24,"readCache"],[26,27,38,24],[26,29,38,63],[27,4,39,2],[27,10,39,8,"raw"],[27,13,39,11],[27,16,39,14],[27,22,39,20,"AsyncStorage"],[27,34,39,32],[27,35,39,32,"default"],[27,42,39,32],[27,43,39,33,"getItem"],[27,50,39,40],[27,51,39,41,"FEATURES_STORAGE_KEY"],[27,67,39,61],[27,68,39,61,"FEATURES_STORAGE_KEY"],[27,88,39,61],[27,89,39,62],[28,4,40,2],[28,8,40,6],[28,9,40,7,"raw"],[28,12,40,10],[28,14,40,12],[28,21,40,19],[28,25,40,23],[29,4,41,2],[29,8,41,6],[30,6,42,4],[30,12,42,10,"parsed"],[30,18,42,16],[30,21,42,19,"JSON"],[30,25,42,23],[30,26,42,24,"parse"],[30,31,42,29],[30,32,42,30,"raw"],[30,35,42,33],[30,36,42,56],[31,6,43,4],[31,10,43,8],[31,11,43,9,"parsed"],[31,17,43,15],[31,19,43,17,"payload"],[31,26,43,24],[31,28,43,26,"flags"],[31,33,43,31],[31,37,43,35],[31,44,43,42,"parsed"],[31,50,43,48],[31,52,43,50,"payload"],[31,59,43,57],[31,61,43,59,"version"],[31,68,43,66],[31,73,43,71],[31,81,43,79],[31,83,43,81],[31,90,43,88],[31,94,43,92],[32,6,44,4],[32,10,44,8],[32,17,44,15,"parsed"],[32,23,44,21],[32,24,44,22,"savedAt"],[32,31,44,29],[32,36,44,34],[32,44,44,42],[32,48,44,46],[32,55,44,53,"parsed"],[32,61,44,59],[32,62,44,60,"nextFetchAt"],[32,73,44,71],[32,78,44,76],[32,86,44,84],[32,88,44,86],[32,95,44,93],[32,99,44,97],[33,6,45,4],[33,13,45,11,"parsed"],[33,19,45,17],[34,4,46,2],[34,5,46,3],[34,6,46,4],[34,12,46,10],[35,6,47,4],[35,13,47,11],[35,17,47,15],[36,4,48,2],[37,2,49,0],[38,2,51,0],[38,17,51,15,"writeCache"],[38,27,51,25,"writeCache"],[38,28,51,26,"payload"],[38,35,51,56],[38,37,51,58,"ttlSeconds"],[38,47,51,76],[38,49,51,107],[39,4,52,2],[39,10,52,8,"now"],[39,13,52,11],[39,16,52,14,"Date"],[39,20,52,18],[39,21,52,19,"now"],[39,24,52,22],[39,25,52,23],[39,26,52,24],[40,4,53,2],[40,10,53,8,"nextFetchAt"],[40,21,53,19],[40,24,53,22,"now"],[40,27,53,25],[40,30,53,28,"ttlSeconds"],[40,40,53,38],[40,43,53,41],[40,47,53,45],[41,4,55,2],[41,10,55,8,"stored"],[41,16,55,34],[41,19,55,37],[42,6,56,4,"savedAt"],[42,13,56,11],[42,15,56,13,"now"],[42,18,56,16],[43,6,57,4,"nextFetchAt"],[43,17,57,15],[44,6,58,4,"payload"],[45,4,59,2],[45,5,59,3],[46,4,61,2],[46,10,61,8,"AsyncStorage"],[46,22,61,20],[46,23,61,20,"default"],[46,30,61,20],[46,31,61,21,"setItem"],[46,38,61,28],[46,39,61,29,"FEATURES_STORAGE_KEY"],[46,55,61,49],[46,56,61,49,"FEATURES_STORAGE_KEY"],[46,76,61,49],[46,78,61,51,"JSON"],[46,82,61,55],[46,83,61,56,"stringify"],[46,92,61,65],[46,93,61,66,"stored"],[46,99,61,72],[46,100,61,73],[46,101,61,74],[47,4,62,2],[47,11,62,9,"stored"],[47,17,62,15],[48,2,63,0],[49,2,65,7],[49,8,65,13,"useFeatureStore"],[49,23,65,28],[49,26,65,31],[49,30,65,31,"create"],[49,38,65,37],[49,39,65,37,"create"],[49,45,65,37],[49,47,65,57],[49,48,65,58,"set"],[49,51,65,61],[49,53,65,63,"get"],[49,56,65,66],[49,62,65,72],[50,4,66,2,"featuresReady"],[50,17,66,15],[50,19,66,17],[50,24,66,22],[51,4,67,2,"lastError"],[51,13,67,11],[51,15,67,13],[51,19,67,17],[52,4,69,2,"remoteVersion"],[52,17,69,15],[52,19,69,17],[52,23,69,21],[53,4,70,2,"nextFetchAt"],[53,15,70,13],[53,17,70,15],[53,21,70,19],[54,4,71,2,"savedAt"],[54,11,71,9],[54,13,71,11],[54,17,71,15],[55,4,73,2,"hydrateRemoteFeatures"],[55,25,73,23],[55,27,73,25],[55,33,73,25,"hydrateRemoteFeatures"],[55,34,73,25],[55,39,73,37],[56,6,74,4],[57,6,75,4],[57,12,75,10,"cached"],[57,18,75,16],[57,21,75,19],[57,27,75,25,"readCache"],[57,36,75,34],[57,37,75,35],[57,38,75,36],[58,6,76,4],[58,10,76,8,"cached"],[58,16,76,14],[58,18,76,16],[59,8,77,6],[59,12,77,6,"setRemoteFeatures"],[59,24,77,23],[59,25,77,23,"setRemoteFeatures"],[59,42,77,23],[59,44,77,24,"cached"],[59,50,77,30],[59,51,77,31,"payload"],[59,58,77,38],[59,59,77,39],[60,8,78,6,"set"],[60,11,78,9],[60,12,78,10],[61,10,79,8,"remoteVersion"],[61,23,79,21],[61,25,79,23,"cached"],[61,31,79,29],[61,32,79,30,"payload"],[61,39,79,37],[61,40,79,38,"version"],[61,47,79,45],[61,51,79,49],[61,55,79,53],[62,10,80,8,"nextFetchAt"],[62,21,80,19],[62,23,80,21,"cached"],[62,29,80,27],[62,30,80,28,"nextFetchAt"],[62,41,80,39],[63,10,81,8,"savedAt"],[63,17,81,15],[63,19,81,17,"cached"],[63,25,81,23],[63,26,81,24,"savedAt"],[64,8,82,6],[64,9,82,7],[64,10,82,8],[65,6,83,4],[67,6,85,4],[68,6,86,4,"set"],[68,9,86,7],[68,10,86,8],[69,8,86,10,"featuresReady"],[69,21,86,23],[69,23,86,25],[70,6,86,30],[70,7,86,31],[70,8,86,32],[72,6,88,4],[73,6,89,4],[73,12,89,10,"now"],[73,15,89,13],[73,18,89,16,"Date"],[73,22,89,20],[73,23,89,21,"now"],[73,26,89,24],[73,27,89,25],[73,28,89,26],[74,6,90,4],[74,12,90,10,"shouldFetch"],[74,23,90,21],[74,26,90,24],[74,27,90,25,"cached"],[74,33,90,31],[74,37,90,35,"cached"],[74,43,90,41],[74,44,90,42,"nextFetchAt"],[74,55,90,53],[74,59,90,57,"now"],[74,62,90,60],[75,6,91,4],[75,10,91,8,"shouldFetch"],[75,21,91,19],[75,23,91,21],[76,8,92,6],[76,14,92,12,"get"],[76,17,92,15],[76,18,92,16],[76,19,92,17],[76,20,92,18,"refreshRemoteFeatures"],[76,41,92,39],[76,42,92,40],[77,10,92,42,"force"],[77,15,92,47],[77,17,92,49],[78,8,92,54],[78,9,92,55],[78,10,92,56],[79,6,93,4],[80,4,94,2],[80,5,94,3],[81,4,96,2,"refreshRemoteFeatures"],[81,25,96,23],[81,27,96,25],[81,33,96,32,"opts"],[81,37,96,50],[81,41,96,55],[82,6,97,4],[82,12,97,10,"force"],[82,17,97,15],[82,20,97,18],[82,21,97,19],[82,22,97,20,"opts"],[82,26,97,24],[82,28,97,26,"force"],[82,33,97,31],[83,6,98,4],[83,12,98,10,"now"],[83,15,98,13],[83,18,98,16,"Date"],[83,22,98,20],[83,23,98,21,"now"],[83,26,98,24],[83,27,98,25],[83,28,98,26],[84,6,100,4],[84,10,100,8],[84,11,100,9,"force"],[84,16,100,14],[84,18,100,16],[85,8,101,6],[85,14,101,12,"nextFetchAt"],[85,25,101,23],[85,28,101,26,"get"],[85,31,101,29],[85,32,101,30],[85,33,101,31],[85,34,101,32,"nextFetchAt"],[85,45,101,43],[86,8,102,6],[86,12,102,10],[86,19,102,17,"nextFetchAt"],[86,30,102,28],[86,35,102,33],[86,43,102,41],[86,47,102,45,"nextFetchAt"],[86,58,102,56],[86,61,102,59,"now"],[86,64,102,62],[86,66,102,64],[87,6,103,4],[88,6,105,4],[88,10,105,8],[89,8,106,6],[89,14,106,12,"payload"],[89,21,106,19],[89,24,106,22],[89,30,106,28],[89,34,106,28,"fetchRemoteFeatures"],[89,41,106,47],[89,42,106,47,"fetchRemoteFeatures"],[89,61,106,47],[89,63,106,48],[89,64,106,49],[91,8,108,6],[92,8,109,6],[92,14,109,12,"ttlSeconds"],[92,24,109,22],[92,27,109,25],[92,31,109,25,"clampTtlSeconds"],[92,47,109,40],[92,48,109,40,"clampTtlSeconds"],[92,63,109,40],[92,65,109,41,"payload"],[92,72,109,48],[92,73,109,49,"ttlSeconds"],[92,83,109,59],[92,84,109,60],[94,8,111,6],[95,8,112,6],[95,12,112,6,"setRemoteFeatures"],[95,24,112,23],[95,25,112,23,"setRemoteFeatures"],[95,42,112,23],[95,44,112,24,"payload"],[95,51,112,31],[95,52,112,32],[97,8,114,6],[98,8,115,6],[98,14,115,12,"stored"],[98,20,115,18],[98,23,115,21],[98,29,115,27,"writeCache"],[98,39,115,37],[98,40,115,38,"payload"],[98,47,115,45],[98,49,115,47,"ttlSeconds"],[98,59,115,57],[98,60,115,58],[99,8,117,6,"set"],[99,11,117,9],[99,12,117,10],[100,10,118,8,"lastError"],[100,19,118,17],[100,21,118,19],[100,25,118,23],[101,10,119,8,"remoteVersion"],[101,23,119,21],[101,25,119,23,"payload"],[101,32,119,30],[101,33,119,31,"version"],[101,40,119,38],[101,44,119,42],[101,48,119,46],[102,10,120,8,"nextFetchAt"],[102,21,120,19],[102,23,120,21,"stored"],[102,29,120,27],[102,30,120,28,"nextFetchAt"],[102,41,120,39],[103,10,121,8,"savedAt"],[103,17,121,15],[103,19,121,17,"stored"],[103,25,121,23],[103,26,121,24,"savedAt"],[104,8,122,6],[104,9,122,7],[104,10,122,8],[105,6,123,4],[105,7,123,5],[105,8,123,6],[105,15,123,13,"e"],[105,16,123,19],[105,18,123,21],[106,8,124,6,"set"],[106,11,124,9],[106,12,124,10],[107,10,125,8,"lastError"],[107,19,125,17],[107,21,125,19,"e"],[107,22,125,20],[107,24,125,22,"message"],[107,31,125,29],[107,34,125,32,"String"],[107,40,125,38],[107,41,125,39,"e"],[107,42,125,40],[107,43,125,41,"message"],[107,50,125,48],[107,51,125,49],[107,54,125,52],[108,8,126,6],[108,9,126,7],[108,10,126,8],[109,8,127,6],[110,6,128,4],[111,4,129,2],[111,5,129,3],[112,4,131,2,"clearCachedFeatures"],[112,23,131,21],[112,25,131,23],[112,31,131,23,"clearCachedFeatures"],[112,32,131,23],[112,37,131,35],[113,6,132,4],[113,12,132,10,"AsyncStorage"],[113,24,132,22],[113,25,132,22,"default"],[113,32,132,22],[113,33,132,23,"removeItem"],[113,43,132,33],[113,44,132,34,"FEATURES_STORAGE_KEY"],[113,60,132,54],[113,61,132,54,"FEATURES_STORAGE_KEY"],[113,81,132,54],[113,82,132,55],[114,6,133,4,"set"],[114,9,133,7],[114,10,133,8],[115,8,134,6,"remoteVersion"],[115,21,134,19],[115,23,134,21],[115,27,134,25],[116,8,135,6,"nextFetchAt"],[116,19,135,17],[116,21,135,19],[116,25,135,23],[117,8,136,6,"savedAt"],[117,15,136,13],[117,17,136,15],[117,21,136,19],[118,8,137,6,"lastError"],[118,17,137,15],[118,19,137,17],[119,6,138,4],[119,7,138,5],[119,8,138,6],[120,4,139,2],[121,2,140,0],[121,3,140,1],[121,4,140,2],[121,5,140,3],[122,0,140,4],[122,3]],"functionMap":{"names":["<global>","readCache","writeCache","create$argument_0","hydrateRemoteFeatures","refreshRemoteFeatures","clearCachedFeatures"],"mappings":"AAA;ACqC;CDW;AEE;CFY;yDGE;yBCQ;GDqB;yBEE;GFiC;uBGE;GHQ;EHC"},"hasCjsExports":false},"type":"js/module"}]}