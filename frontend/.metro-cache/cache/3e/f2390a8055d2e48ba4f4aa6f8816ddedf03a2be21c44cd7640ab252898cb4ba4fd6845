{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.makeSourceId = makeSourceId;\n  exports.isValidSourceIdFormat = isValidSourceIdFormat;\n  // /app/frontend/lib/ids/sourceId.ts\n  // Phase 3.49: Robust sourceId generation for idempotent endpoints\n  //\n  // Prevents collisions from:\n  // - Multi-tap\n  // - Retry storms\n  // - Device clock weirdness\n  //\n  // Format: ${prefix}_${timestamp}_${random}\n\n  /**\n   * Generate a cryptographically-strong random hex string.\n   * Uses crypto.getRandomValues if available, falls back to Math.random.\n   */\n  function getRandomHex() {\n    var length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 8;\n    // Try crypto.getRandomValues (available in most modern runtimes)\n    if (typeof crypto !== 'undefined' && crypto.getRandomValues) {\n      var bytes = new Uint8Array(length);\n      crypto.getRandomValues(bytes);\n      return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('').slice(0, length);\n    }\n\n    // Fallback to Math.random (still better than timestamp alone)\n    // Note: This is NOT cryptographically secure, but sufficient for sourceId uniqueness\n    return Math.random().toString(16).slice(2, 2 + length);\n  }\n\n  /**\n   * Create a robust sourceId for idempotent API calls.\n   * \n   * @param prefix - Action identifier (e.g., 'summon', 'promote', 'claim')\n   * @returns Unique sourceId in format: prefix_timestamp_random\n   * \n   * @example\n   * makeSourceId('summon')  // 'summon_1705555555555_a3f2b8c1'\n   * makeSourceId('promote') // 'promote_1705555555555_9d4e6f2a'\n   */\n  function makeSourceId(prefix) {\n    var timestamp = Date.now();\n    var random = getRandomHex(8);\n    return `${prefix}_${timestamp}_${random}`;\n  }\n\n  /**\n   * Validate that a sourceId has the expected format.\n   * Useful for debugging and guards.\n   * \n   * @param sourceId - The sourceId to validate\n   * @returns true if format matches prefix_timestamp_random\n   */\n  function isValidSourceIdFormat(sourceId) {\n    // Format: prefix_timestamp_random\n    var pattern = /^[a-z]+_\\d{13}_[a-f0-9]{8}$/i;\n    return pattern.test(sourceId);\n  }\n});","lineCount":65,"map":[[7,2,41,0,"exports"],[7,9,41,0],[7,10,41,0,"makeSourceId"],[7,22,41,0],[7,25,41,0,"makeSourceId"],[7,37,41,0],[8,2,54,0,"exports"],[8,9,54,0],[8,10,54,0,"isValidSourceIdFormat"],[8,31,54,0],[8,34,54,0,"isValidSourceIdFormat"],[8,55,54,0],[9,2,1,0],[10,2,2,0],[11,2,3,0],[12,2,4,0],[13,2,5,0],[14,2,6,0],[15,2,7,0],[16,2,8,0],[17,2,9,0],[19,2,11,0],[20,0,12,0],[21,0,13,0],[22,0,14,0],[23,2,15,0],[23,11,15,9,"getRandomHex"],[23,23,15,21,"getRandomHex"],[23,24,15,21],[23,26,15,50],[24,4,15,50],[24,8,15,22,"length"],[24,14,15,36],[24,17,15,36,"arguments"],[24,26,15,36],[24,27,15,36,"length"],[24,33,15,36],[24,41,15,36,"arguments"],[24,50,15,36],[24,58,15,36,"undefined"],[24,67,15,36],[24,70,15,36,"arguments"],[24,79,15,36],[24,85,15,39],[24,86,15,40],[25,4,16,2],[26,4,17,2],[26,8,17,6],[26,15,17,13,"crypto"],[26,21,17,19],[26,26,17,24],[26,37,17,35],[26,41,17,39,"crypto"],[26,47,17,45],[26,48,17,46,"getRandomValues"],[26,63,17,61],[26,65,17,63],[27,6,18,4],[27,10,18,10,"bytes"],[27,15,18,15],[27,18,18,18],[27,22,18,22,"Uint8Array"],[27,32,18,32],[27,33,18,33,"length"],[27,39,18,39],[27,40,18,40],[28,6,19,4,"crypto"],[28,12,19,10],[28,13,19,11,"getRandomValues"],[28,28,19,26],[28,29,19,27,"bytes"],[28,34,19,32],[28,35,19,33],[29,6,20,4],[29,13,20,11,"Array"],[29,18,20,16],[29,19,20,17,"from"],[29,23,20,21],[29,24,20,22,"bytes"],[29,29,20,27],[29,30,20,28],[29,31,21,7,"map"],[29,34,21,10],[29,35,21,11,"b"],[29,36,21,12],[29,40,21,16,"b"],[29,41,21,17],[29,42,21,18,"toString"],[29,50,21,26],[29,51,21,27],[29,53,21,29],[29,54,21,30],[29,55,21,31,"padStart"],[29,63,21,39],[29,64,21,40],[29,65,21,41],[29,67,21,43],[29,70,21,46],[29,71,21,47],[29,72,21,48],[29,73,22,7,"join"],[29,77,22,11],[29,78,22,12],[29,80,22,14],[29,81,22,15],[29,82,23,7,"slice"],[29,87,23,12],[29,88,23,13],[29,89,23,14],[29,91,23,16,"length"],[29,97,23,22],[29,98,23,23],[30,4,24,2],[32,4,26,2],[33,4,27,2],[34,4,28,2],[34,11,28,9,"Math"],[34,15,28,13],[34,16,28,14,"random"],[34,22,28,20],[34,23,28,21],[34,24,28,22],[34,25,28,23,"toString"],[34,33,28,31],[34,34,28,32],[34,36,28,34],[34,37,28,35],[34,38,28,36,"slice"],[34,43,28,41],[34,44,28,42],[34,45,28,43],[34,47,28,45],[34,48,28,46],[34,51,28,49,"length"],[34,57,28,55],[34,58,28,56],[35,2,29,0],[37,2,31,0],[38,0,32,0],[39,0,33,0],[40,0,34,0],[41,0,35,0],[42,0,36,0],[43,0,37,0],[44,0,38,0],[45,0,39,0],[46,0,40,0],[47,2,41,7],[47,11,41,16,"makeSourceId"],[47,23,41,28,"makeSourceId"],[47,24,41,29,"prefix"],[47,30,41,43],[47,32,41,53],[48,4,42,2],[48,8,42,8,"timestamp"],[48,17,42,17],[48,20,42,20,"Date"],[48,24,42,24],[48,25,42,25,"now"],[48,28,42,28],[48,29,42,29],[48,30,42,30],[49,4,43,2],[49,8,43,8,"random"],[49,14,43,14],[49,17,43,17,"getRandomHex"],[49,29,43,29],[49,30,43,30],[49,31,43,31],[49,32,43,32],[50,4,44,2],[50,11,44,9],[50,14,44,12,"prefix"],[50,20,44,18],[50,24,44,22,"timestamp"],[50,33,44,31],[50,37,44,35,"random"],[50,43,44,41],[50,45,44,43],[51,2,45,0],[53,2,47,0],[54,0,48,0],[55,0,49,0],[56,0,50,0],[57,0,51,0],[58,0,52,0],[59,0,53,0],[60,2,54,7],[60,11,54,16,"isValidSourceIdFormat"],[60,32,54,37,"isValidSourceIdFormat"],[60,33,54,38,"sourceId"],[60,41,54,54],[60,43,54,65],[61,4,55,2],[62,4,56,2],[62,8,56,8,"pattern"],[62,15,56,15],[62,18,56,18],[62,48,56,48],[63,4,57,2],[63,11,57,9,"pattern"],[63,18,57,16],[63,19,57,17,"test"],[63,23,57,21],[63,24,57,22,"sourceId"],[63,32,57,30],[63,33,57,31],[64,2,58,0],[65,0,58,1],[65,3]],"functionMap":{"names":["<global>","getRandomHex","Array.from.map$argument_0","makeSourceId","isValidSourceIdFormat"],"mappings":"AAA;ACc;WCM,oCD;CDQ;OGY;CHI;OIS;CJI"},"hasCjsExports":false},"type":"js/module"}]}