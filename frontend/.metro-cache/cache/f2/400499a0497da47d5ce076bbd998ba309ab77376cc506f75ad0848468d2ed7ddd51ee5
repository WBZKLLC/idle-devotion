{"dependencies":[{"name":"./is.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":39,"index":39}}],"key":"C6fLnEQPNIdj7xXbougAJ0zoinA=","exportNames":["*"],"imports":1}},{"name":"./string.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":40},"end":{"line":2,"column":39,"index":79}}],"key":"4SgKKWBRWk0zxI3arZcISee7pnU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"applyAggregateErrorsToEvent\", {\n    enumerable: true,\n    get: function () {\n      return applyAggregateErrorsToEvent;\n    }\n  });\n  var _isJs = require(_dependencyMap[0], \"./is.js\");\n  var _stringJs = require(_dependencyMap[1], \"./string.js\");\n  /**\n   * Creates exceptions inside `event.exception.values` for errors that are nested on properties based on the `key` parameter.\n   */\n  function applyAggregateErrorsToEvent(exceptionFromErrorImplementation, parser, maxValueLimit = 250, key, limit, event, hint) {\n    if (!event.exception || !event.exception.values || !hint || !(0, _isJs.isInstanceOf)(hint.originalException, Error)) {\n      return;\n    }\n\n    // Generally speaking the last item in `event.exception.values` is the exception originating from the original Error\n    const originalException = event.exception.values.length > 0 ? event.exception.values[event.exception.values.length - 1] : undefined;\n\n    // We only create exception grouping if there is an exception in the event.\n    if (originalException) {\n      event.exception.values = truncateAggregateExceptions(aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, hint.originalException, key, event.exception.values, originalException, 0), maxValueLimit);\n    }\n  }\n  function aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, error, key, prevExceptions, exception, exceptionId) {\n    if (prevExceptions.length >= limit + 1) {\n      return prevExceptions;\n    }\n    let newExceptions = [...prevExceptions];\n    if ((0, _isJs.isInstanceOf)(error[key], Error)) {\n      applyExceptionGroupFieldsForParentException(exception, exceptionId);\n      const newException = exceptionFromErrorImplementation(parser, error[key]);\n      const newExceptionId = newExceptions.length;\n      applyExceptionGroupFieldsForChildException(newException, key, newExceptionId, exceptionId);\n      newExceptions = aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, error[key], key, [newException, ...newExceptions], newException, newExceptionId);\n    }\n\n    // This will create exception grouping for AggregateErrors\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AggregateError\n    if (Array.isArray(error.errors)) {\n      error.errors.forEach((childError, i) => {\n        if ((0, _isJs.isInstanceOf)(childError, Error)) {\n          applyExceptionGroupFieldsForParentException(exception, exceptionId);\n          const newException = exceptionFromErrorImplementation(parser, childError);\n          const newExceptionId = newExceptions.length;\n          applyExceptionGroupFieldsForChildException(newException, `errors[${i}]`, newExceptionId, exceptionId);\n          newExceptions = aggregateExceptionsFromError(exceptionFromErrorImplementation, parser, limit, childError, key, [newException, ...newExceptions], newException, newExceptionId);\n        }\n      });\n    }\n    return newExceptions;\n  }\n  function applyExceptionGroupFieldsForParentException(exception, exceptionId) {\n    // Don't know if this default makes sense. The protocol requires us to set these values so we pick *some* default.\n    exception.mechanism = exception.mechanism || {\n      type: 'generic',\n      handled: true\n    };\n    exception.mechanism = {\n      ...exception.mechanism,\n      is_exception_group: true,\n      exception_id: exceptionId\n    };\n  }\n  function applyExceptionGroupFieldsForChildException(exception, source, exceptionId, parentId) {\n    // Don't know if this default makes sense. The protocol requires us to set these values so we pick *some* default.\n    exception.mechanism = exception.mechanism || {\n      type: 'generic',\n      handled: true\n    };\n    exception.mechanism = {\n      ...exception.mechanism,\n      type: 'chained',\n      source,\n      exception_id: exceptionId,\n      parent_id: parentId\n    };\n  }\n\n  /**\n   * Truncate the message (exception.value) of all exceptions in the event.\n   * Because this event processor is ran after `applyClientOptions`,\n   * we need to truncate the message of the added exceptions here.\n   */\n  function truncateAggregateExceptions(exceptions, maxValueLength) {\n    return exceptions.map(exception => {\n      if (exception.value) {\n        exception.value = (0, _stringJs.truncate)(exception.value, maxValueLength);\n      }\n      return exception;\n    });\n  }\n});","lineCount":99,"map":[[7,2,144,0,"Object"],[7,8,144,0],[7,9,144,0,"defineProperty"],[7,23,144,0],[7,24,144,0,"exports"],[7,31,144,0],[8,4,144,0,"enumerable"],[8,14,144,0],[9,4,144,0,"get"],[9,7,144,0],[9,18,144,0,"get"],[9,19,144,0],[10,6,144,0],[10,13,144,9,"applyAggregateErrorsToEvent"],[10,40,144,36],[11,4,144,36],[12,2,144,36],[13,2,1,0],[13,6,1,0,"_isJs"],[13,11,1,0],[13,14,1,0,"require"],[13,21,1,0],[13,22,1,0,"_dependencyMap"],[13,36,1,0],[14,2,2,0],[14,6,2,0,"_stringJs"],[14,15,2,0],[14,18,2,0,"require"],[14,25,2,0],[14,26,2,0,"_dependencyMap"],[14,40,2,0],[15,2,4,0],[16,0,5,0],[17,0,6,0],[18,2,7,0],[18,11,7,9,"applyAggregateErrorsToEvent"],[18,38,7,36,"applyAggregateErrorsToEvent"],[18,39,8,2,"exceptionFromErrorImplementation"],[18,71,8,34],[18,73,9,2,"parser"],[18,79,9,8],[18,81,10,2,"maxValueLimit"],[18,94,10,15],[18,97,10,18],[18,100,10,21],[18,102,11,2,"key"],[18,105,11,5],[18,107,12,2,"limit"],[18,112,12,7],[18,114,13,2,"event"],[18,119,13,7],[18,121,14,2,"hint"],[18,125,14,6],[18,127,15,2],[19,4,16,2],[19,8,16,6],[19,9,16,7,"event"],[19,14,16,12],[19,15,16,13,"exception"],[19,24,16,22],[19,28,16,26],[19,29,16,27,"event"],[19,34,16,32],[19,35,16,33,"exception"],[19,44,16,42],[19,45,16,43,"values"],[19,51,16,49],[19,55,16,53],[19,56,16,54,"hint"],[19,60,16,58],[19,64,16,62],[19,65,16,63],[19,69,16,63,"isInstanceOf"],[19,74,16,75],[19,75,16,75,"isInstanceOf"],[19,87,16,75],[19,89,16,76,"hint"],[19,93,16,80],[19,94,16,81,"originalException"],[19,111,16,98],[19,113,16,100,"Error"],[19,118,16,105],[19,119,16,106],[19,121,16,108],[20,6,17,4],[21,4,18,2],[23,4,20,2],[24,4,21,2],[24,10,21,8,"originalException"],[24,27,21,25],[24,30,22,4,"event"],[24,35,22,9],[24,36,22,10,"exception"],[24,45,22,19],[24,46,22,20,"values"],[24,52,22,26],[24,53,22,27,"length"],[24,59,22,33],[24,62,22,36],[24,63,22,37],[24,66,22,40,"event"],[24,71,22,45],[24,72,22,46,"exception"],[24,81,22,55],[24,82,22,56,"values"],[24,88,22,62],[24,89,22,63,"event"],[24,94,22,68],[24,95,22,69,"exception"],[24,104,22,78],[24,105,22,79,"values"],[24,111,22,85],[24,112,22,86,"length"],[24,118,22,92],[24,121,22,95],[24,122,22,96],[24,123,22,97],[24,126,22,100,"undefined"],[24,135,22,109],[26,4,24,2],[27,4,25,2],[27,8,25,6,"originalException"],[27,25,25,23],[27,27,25,25],[28,6,26,4,"event"],[28,11,26,9],[28,12,26,10,"exception"],[28,21,26,19],[28,22,26,20,"values"],[28,28,26,26],[28,31,26,29,"truncateAggregateExceptions"],[28,58,26,56],[28,59,27,6,"aggregateExceptionsFromError"],[28,87,27,34],[28,88,28,8,"exceptionFromErrorImplementation"],[28,120,28,40],[28,122,29,8,"parser"],[28,128,29,14],[28,130,30,8,"limit"],[28,135,30,13],[28,137,31,8,"hint"],[28,141,31,12],[28,142,31,13,"originalException"],[28,159,31,30],[28,161,32,8,"key"],[28,164,32,11],[28,166,33,8,"event"],[28,171,33,13],[28,172,33,14,"exception"],[28,181,33,23],[28,182,33,24,"values"],[28,188,33,30],[28,190,34,8,"originalException"],[28,207,34,25],[28,209,35,8],[28,210,36,6],[28,211,36,7],[28,213,37,6,"maxValueLimit"],[28,226,38,4],[28,227,38,5],[29,4,39,2],[30,2,40,0],[31,2,42,0],[31,11,42,9,"aggregateExceptionsFromError"],[31,39,42,37,"aggregateExceptionsFromError"],[31,40,43,2,"exceptionFromErrorImplementation"],[31,72,43,34],[31,74,44,2,"parser"],[31,80,44,8],[31,82,45,2,"limit"],[31,87,45,7],[31,89,46,2,"error"],[31,94,46,7],[31,96,47,2,"key"],[31,99,47,5],[31,101,48,2,"prevExceptions"],[31,115,48,16],[31,117,49,2,"exception"],[31,126,49,11],[31,128,50,2,"exceptionId"],[31,139,50,13],[31,141,51,2],[32,4,52,2],[32,8,52,6,"prevExceptions"],[32,22,52,20],[32,23,52,21,"length"],[32,29,52,27],[32,33,52,31,"limit"],[32,38,52,36],[32,41,52,39],[32,42,52,40],[32,44,52,42],[33,6,53,4],[33,13,53,11,"prevExceptions"],[33,27,53,25],[34,4,54,2],[35,4,56,2],[35,8,56,6,"newExceptions"],[35,21,56,19],[35,24,56,22],[35,25,56,23],[35,28,56,26,"prevExceptions"],[35,42,56,40],[35,43,56,41],[36,4,58,2],[36,8,58,6],[36,12,58,6,"isInstanceOf"],[36,17,58,18],[36,18,58,18,"isInstanceOf"],[36,30,58,18],[36,32,58,19,"error"],[36,37,58,24],[36,38,58,25,"key"],[36,41,58,28],[36,42,58,29],[36,44,58,31,"Error"],[36,49,58,36],[36,50,58,37],[36,52,58,39],[37,6,59,4,"applyExceptionGroupFieldsForParentException"],[37,49,59,47],[37,50,59,48,"exception"],[37,59,59,57],[37,61,59,59,"exceptionId"],[37,72,59,70],[37,73,59,71],[38,6,60,4],[38,12,60,10,"newException"],[38,24,60,22],[38,27,60,25,"exceptionFromErrorImplementation"],[38,59,60,57],[38,60,60,58,"parser"],[38,66,60,64],[38,68,60,66,"error"],[38,73,60,71],[38,74,60,72,"key"],[38,77,60,75],[38,78,60,76],[38,79,60,77],[39,6,61,4],[39,12,61,10,"newExceptionId"],[39,26,61,24],[39,29,61,27,"newExceptions"],[39,42,61,40],[39,43,61,41,"length"],[39,49,61,47],[40,6,62,4,"applyExceptionGroupFieldsForChildException"],[40,48,62,46],[40,49,62,47,"newException"],[40,61,62,59],[40,63,62,61,"key"],[40,66,62,64],[40,68,62,66,"newExceptionId"],[40,82,62,80],[40,84,62,82,"exceptionId"],[40,95,62,93],[40,96,62,94],[41,6,63,4,"newExceptions"],[41,19,63,17],[41,22,63,20,"aggregateExceptionsFromError"],[41,50,63,48],[41,51,64,6,"exceptionFromErrorImplementation"],[41,83,64,38],[41,85,65,6,"parser"],[41,91,65,12],[41,93,66,6,"limit"],[41,98,66,11],[41,100,67,6,"error"],[41,105,67,11],[41,106,67,12,"key"],[41,109,67,15],[41,110,67,16],[41,112,68,6,"key"],[41,115,68,9],[41,117,69,6],[41,118,69,7,"newException"],[41,130,69,19],[41,132,69,21],[41,135,69,24,"newExceptions"],[41,148,69,37],[41,149,69,38],[41,151,70,6,"newException"],[41,163,70,18],[41,165,71,6,"newExceptionId"],[41,179,72,4],[41,180,72,5],[42,4,73,2],[44,4,75,2],[45,4,76,2],[46,4,77,2],[46,8,77,6,"Array"],[46,13,77,11],[46,14,77,12,"isArray"],[46,21,77,19],[46,22,77,20,"error"],[46,27,77,25],[46,28,77,26,"errors"],[46,34,77,32],[46,35,77,33],[46,37,77,35],[47,6,78,4,"error"],[47,11,78,9],[47,12,78,10,"errors"],[47,18,78,16],[47,19,78,17,"forEach"],[47,26,78,24],[47,27,78,25],[47,28,78,26,"childError"],[47,38,78,36],[47,40,78,38,"i"],[47,41,78,39],[47,46,78,44],[48,8,79,6],[48,12,79,10],[48,16,79,10,"isInstanceOf"],[48,21,79,22],[48,22,79,22,"isInstanceOf"],[48,34,79,22],[48,36,79,23,"childError"],[48,46,79,33],[48,48,79,35,"Error"],[48,53,79,40],[48,54,79,41],[48,56,79,43],[49,10,80,8,"applyExceptionGroupFieldsForParentException"],[49,53,80,51],[49,54,80,52,"exception"],[49,63,80,61],[49,65,80,63,"exceptionId"],[49,76,80,74],[49,77,80,75],[50,10,81,8],[50,16,81,14,"newException"],[50,28,81,26],[50,31,81,29,"exceptionFromErrorImplementation"],[50,63,81,61],[50,64,81,62,"parser"],[50,70,81,68],[50,72,81,70,"childError"],[50,82,81,80],[50,83,81,81],[51,10,82,8],[51,16,82,14,"newExceptionId"],[51,30,82,28],[51,33,82,31,"newExceptions"],[51,46,82,44],[51,47,82,45,"length"],[51,53,82,51],[52,10,83,8,"applyExceptionGroupFieldsForChildException"],[52,52,83,50],[52,53,83,51,"newException"],[52,65,83,63],[52,67,83,65],[52,77,83,75,"i"],[52,78,83,76],[52,81,83,79],[52,83,83,81,"newExceptionId"],[52,97,83,95],[52,99,83,97,"exceptionId"],[52,110,83,108],[52,111,83,109],[53,10,84,8,"newExceptions"],[53,23,84,21],[53,26,84,24,"aggregateExceptionsFromError"],[53,54,84,52],[53,55,85,10,"exceptionFromErrorImplementation"],[53,87,85,42],[53,89,86,10,"parser"],[53,95,86,16],[53,97,87,10,"limit"],[53,102,87,15],[53,104,88,10,"childError"],[53,114,88,20],[53,116,89,10,"key"],[53,119,89,13],[53,121,90,10],[53,122,90,11,"newException"],[53,134,90,23],[53,136,90,25],[53,139,90,28,"newExceptions"],[53,152,90,41],[53,153,90,42],[53,155,91,10,"newException"],[53,167,91,22],[53,169,92,10,"newExceptionId"],[53,183,93,8],[53,184,93,9],[54,8,94,6],[55,6,95,4],[55,7,95,5],[55,8,95,6],[56,4,96,2],[57,4,98,2],[57,11,98,9,"newExceptions"],[57,24,98,22],[58,2,99,0],[59,2,101,0],[59,11,101,9,"applyExceptionGroupFieldsForParentException"],[59,54,101,52,"applyExceptionGroupFieldsForParentException"],[59,55,101,53,"exception"],[59,64,101,62],[59,66,101,64,"exceptionId"],[59,77,101,75],[59,79,101,77],[60,4,102,2],[61,4,103,2,"exception"],[61,13,103,11],[61,14,103,12,"mechanism"],[61,23,103,21],[61,26,103,24,"exception"],[61,35,103,33],[61,36,103,34,"mechanism"],[61,45,103,43],[61,49,103,47],[62,6,103,49,"type"],[62,10,103,53],[62,12,103,55],[62,21,103,64],[63,6,103,66,"handled"],[63,13,103,73],[63,15,103,75],[64,4,103,80],[64,5,103,81],[65,4,105,2,"exception"],[65,13,105,11],[65,14,105,12,"mechanism"],[65,23,105,21],[65,26,105,24],[66,6,106,4],[66,9,106,7,"exception"],[66,18,106,16],[66,19,106,17,"mechanism"],[66,28,106,26],[67,6,107,4,"is_exception_group"],[67,24,107,22],[67,26,107,24],[67,30,107,28],[68,6,108,4,"exception_id"],[68,18,108,16],[68,20,108,18,"exceptionId"],[69,4,109,2],[69,5,109,3],[70,2,110,0],[71,2,112,0],[71,11,112,9,"applyExceptionGroupFieldsForChildException"],[71,53,112,51,"applyExceptionGroupFieldsForChildException"],[71,54,113,2,"exception"],[71,63,113,11],[71,65,114,2,"source"],[71,71,114,8],[71,73,115,2,"exceptionId"],[71,84,115,13],[71,86,116,2,"parentId"],[71,94,116,10],[71,96,117,2],[72,4,118,2],[73,4,119,2,"exception"],[73,13,119,11],[73,14,119,12,"mechanism"],[73,23,119,21],[73,26,119,24,"exception"],[73,35,119,33],[73,36,119,34,"mechanism"],[73,45,119,43],[73,49,119,47],[74,6,119,49,"type"],[74,10,119,53],[74,12,119,55],[74,21,119,64],[75,6,119,66,"handled"],[75,13,119,73],[75,15,119,75],[76,4,119,80],[76,5,119,81],[77,4,121,2,"exception"],[77,13,121,11],[77,14,121,12,"mechanism"],[77,23,121,21],[77,26,121,24],[78,6,122,4],[78,9,122,7,"exception"],[78,18,122,16],[78,19,122,17,"mechanism"],[78,28,122,26],[79,6,123,4,"type"],[79,10,123,8],[79,12,123,10],[79,21,123,19],[80,6,124,4,"source"],[80,12,124,10],[81,6,125,4,"exception_id"],[81,18,125,16],[81,20,125,18,"exceptionId"],[81,31,125,29],[82,6,126,4,"parent_id"],[82,15,126,13],[82,17,126,15,"parentId"],[83,4,127,2],[83,5,127,3],[84,2,128,0],[86,2,130,0],[87,0,131,0],[88,0,132,0],[89,0,133,0],[90,0,134,0],[91,2,135,0],[91,11,135,9,"truncateAggregateExceptions"],[91,38,135,36,"truncateAggregateExceptions"],[91,39,135,37,"exceptions"],[91,49,135,47],[91,51,135,49,"maxValueLength"],[91,65,135,63],[91,67,135,65],[92,4,136,2],[92,11,136,9,"exceptions"],[92,21,136,19],[92,22,136,20,"map"],[92,25,136,23],[92,26,136,24,"exception"],[92,35,136,33],[92,39,136,37],[93,6,137,4],[93,10,137,8,"exception"],[93,19,137,17],[93,20,137,18,"value"],[93,25,137,23],[93,27,137,25],[94,8,138,6,"exception"],[94,17,138,15],[94,18,138,16,"value"],[94,23,138,21],[94,26,138,24],[94,30,138,24,"truncate"],[94,39,138,32],[94,40,138,32,"truncate"],[94,48,138,32],[94,50,138,33,"exception"],[94,59,138,42],[94,60,138,43,"value"],[94,65,138,48],[94,67,138,50,"maxValueLength"],[94,81,138,64],[94,82,138,65],[95,6,139,4],[96,6,140,4],[96,13,140,11,"exception"],[96,22,140,20],[97,4,141,2],[97,5,141,3],[97,6,141,4],[98,2,142,0],[99,0,142,1],[99,3]],"functionMap":{"names":["<global>","applyAggregateErrorsToEvent","aggregateExceptionsFromError","error.errors.forEach$argument_0","applyExceptionGroupFieldsForParentException","applyExceptionGroupFieldsForChildException","truncateAggregateExceptions","exceptions.map$argument_0"],"mappings":"AAA;ACM;CDiC;AEE;yBCoC;KDiB;CFI;AIE;CJS;AKE;CLgB;AMO;wBCC;GDK;CNC"},"hasCjsExports":false},"type":"js/module"}]}