{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.makeSourceId = makeSourceId;\n  exports.isValidSourceIdFormat = isValidSourceIdFormat;\n  // /app/frontend/lib/ids/sourceId.ts\n  // Phase 3.49: Robust sourceId generation for idempotent endpoints\n  //\n  // Prevents collisions from:\n  // - Multi-tap\n  // - Retry storms\n  // - Device clock weirdness\n  //\n  // Format: ${prefix}_${timestamp}_${random}\n\n  /**\n   * Generate a cryptographically-strong random hex string.\n   * Uses crypto.getRandomValues if available, falls back to Math.random.\n   */\n  function getRandomHex(length = 8) {\n    // Try crypto.getRandomValues (available in most modern runtimes)\n    if (typeof crypto !== 'undefined' && crypto.getRandomValues) {\n      const bytes = new Uint8Array(length);\n      crypto.getRandomValues(bytes);\n      return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('').slice(0, length);\n    }\n\n    // Fallback to Math.random (still better than timestamp alone)\n    // Note: This is NOT cryptographically secure, but sufficient for sourceId uniqueness\n    return Math.random().toString(16).slice(2, 2 + length);\n  }\n\n  /**\n   * Create a robust sourceId for idempotent API calls.\n   * \n   * @param prefix - Action identifier (e.g., 'summon', 'promote', 'claim')\n   * @returns Unique sourceId in format: prefix_timestamp_random\n   * \n   * @example\n   * makeSourceId('summon')  // 'summon_1705555555555_a3f2b8c1'\n   * makeSourceId('promote') // 'promote_1705555555555_9d4e6f2a'\n   */\n  function makeSourceId(prefix) {\n    const timestamp = Date.now();\n    const random = getRandomHex(8);\n    return `${prefix}_${timestamp}_${random}`;\n  }\n\n  /**\n   * Validate that a sourceId has the expected format.\n   * Useful for debugging and guards.\n   * \n   * @param sourceId - The sourceId to validate\n   * @returns true if format matches prefix_timestamp_random\n   */\n  function isValidSourceIdFormat(sourceId) {\n    // Format: prefix_timestamp_random\n    const pattern = /^[a-z]+_\\d{13}_[a-f0-9]{8}$/i;\n    return pattern.test(sourceId);\n  }\n});","lineCount":64,"map":[[7,2,41,0,"exports"],[7,9,41,0],[7,10,41,0,"makeSourceId"],[7,22,41,0],[7,25,41,0,"makeSourceId"],[7,37,41,0],[8,2,54,0,"exports"],[8,9,54,0],[8,10,54,0,"isValidSourceIdFormat"],[8,31,54,0],[8,34,54,0,"isValidSourceIdFormat"],[8,55,54,0],[9,2,1,0],[10,2,2,0],[11,2,3,0],[12,2,4,0],[13,2,5,0],[14,2,6,0],[15,2,7,0],[16,2,8,0],[17,2,9,0],[19,2,11,0],[20,0,12,0],[21,0,13,0],[22,0,14,0],[23,2,15,0],[23,11,15,9,"getRandomHex"],[23,23,15,21,"getRandomHex"],[23,24,15,22,"length"],[23,30,15,36],[23,33,15,39],[23,34,15,40],[23,36,15,50],[24,4,16,2],[25,4,17,2],[25,8,17,6],[25,15,17,13,"crypto"],[25,21,17,19],[25,26,17,24],[25,37,17,35],[25,41,17,39,"crypto"],[25,47,17,45],[25,48,17,46,"getRandomValues"],[25,63,17,61],[25,65,17,63],[26,6,18,4],[26,12,18,10,"bytes"],[26,17,18,15],[26,20,18,18],[26,24,18,22,"Uint8Array"],[26,34,18,32],[26,35,18,33,"length"],[26,41,18,39],[26,42,18,40],[27,6,19,4,"crypto"],[27,12,19,10],[27,13,19,11,"getRandomValues"],[27,28,19,26],[27,29,19,27,"bytes"],[27,34,19,32],[27,35,19,33],[28,6,20,4],[28,13,20,11,"Array"],[28,18,20,16],[28,19,20,17,"from"],[28,23,20,21],[28,24,20,22,"bytes"],[28,29,20,27],[28,30,20,28],[28,31,21,7,"map"],[28,34,21,10],[28,35,21,11,"b"],[28,36,21,12],[28,40,21,16,"b"],[28,41,21,17],[28,42,21,18,"toString"],[28,50,21,26],[28,51,21,27],[28,53,21,29],[28,54,21,30],[28,55,21,31,"padStart"],[28,63,21,39],[28,64,21,40],[28,65,21,41],[28,67,21,43],[28,70,21,46],[28,71,21,47],[28,72,21,48],[28,73,22,7,"join"],[28,77,22,11],[28,78,22,12],[28,80,22,14],[28,81,22,15],[28,82,23,7,"slice"],[28,87,23,12],[28,88,23,13],[28,89,23,14],[28,91,23,16,"length"],[28,97,23,22],[28,98,23,23],[29,4,24,2],[31,4,26,2],[32,4,27,2],[33,4,28,2],[33,11,28,9,"Math"],[33,15,28,13],[33,16,28,14,"random"],[33,22,28,20],[33,23,28,21],[33,24,28,22],[33,25,28,23,"toString"],[33,33,28,31],[33,34,28,32],[33,36,28,34],[33,37,28,35],[33,38,28,36,"slice"],[33,43,28,41],[33,44,28,42],[33,45,28,43],[33,47,28,45],[33,48,28,46],[33,51,28,49,"length"],[33,57,28,55],[33,58,28,56],[34,2,29,0],[36,2,31,0],[37,0,32,0],[38,0,33,0],[39,0,34,0],[40,0,35,0],[41,0,36,0],[42,0,37,0],[43,0,38,0],[44,0,39,0],[45,0,40,0],[46,2,41,7],[46,11,41,16,"makeSourceId"],[46,23,41,28,"makeSourceId"],[46,24,41,29,"prefix"],[46,30,41,43],[46,32,41,53],[47,4,42,2],[47,10,42,8,"timestamp"],[47,19,42,17],[47,22,42,20,"Date"],[47,26,42,24],[47,27,42,25,"now"],[47,30,42,28],[47,31,42,29],[47,32,42,30],[48,4,43,2],[48,10,43,8,"random"],[48,16,43,14],[48,19,43,17,"getRandomHex"],[48,31,43,29],[48,32,43,30],[48,33,43,31],[48,34,43,32],[49,4,44,2],[49,11,44,9],[49,14,44,12,"prefix"],[49,20,44,18],[49,24,44,22,"timestamp"],[49,33,44,31],[49,37,44,35,"random"],[49,43,44,41],[49,45,44,43],[50,2,45,0],[52,2,47,0],[53,0,48,0],[54,0,49,0],[55,0,50,0],[56,0,51,0],[57,0,52,0],[58,0,53,0],[59,2,54,7],[59,11,54,16,"isValidSourceIdFormat"],[59,32,54,37,"isValidSourceIdFormat"],[59,33,54,38,"sourceId"],[59,41,54,54],[59,43,54,65],[60,4,55,2],[61,4,56,2],[61,10,56,8,"pattern"],[61,17,56,15],[61,20,56,18],[61,50,56,48],[62,4,57,2],[62,11,57,9,"pattern"],[62,18,57,16],[62,19,57,17,"test"],[62,23,57,21],[62,24,57,22,"sourceId"],[62,32,57,30],[62,33,57,31],[63,2,58,0],[64,0,58,1],[64,3]],"functionMap":{"names":["<global>","getRandomHex","Array.from.map$argument_0","makeSourceId","isValidSourceIdFormat"],"mappings":"AAA;ACc;WCM,oCD;CDQ;OGY;CHI;OIS;CJI"},"hasCjsExports":false},"type":"js/module"}]}