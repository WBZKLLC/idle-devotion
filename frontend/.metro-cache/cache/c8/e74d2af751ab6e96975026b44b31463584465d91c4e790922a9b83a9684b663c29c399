{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":15,"column":0,"index":470},"end":{"line":15,"column":42,"index":512}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/AppState","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"JfCM6WRyn2619+pzBJhEHd1+SSw=","exportNames":["*"],"imports":1}},{"name":"../stores/entitlementStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":575},"end":{"line":17,"column":65,"index":640}}],"key":"zpvG3AWVhfkzof5ZAFPvPaVLiPY=","exportNames":["*"],"imports":1}},{"name":"../stores/gameStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":641},"end":{"line":18,"column":51,"index":692}}],"key":"88DACCakTvhUP715XDIJ2LVpqh0=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.useAppResumeReconcile = useAppResumeReconcile;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeWebDistExportsAppState = require(_dependencyMap[1], \"react-native-web/dist/exports/AppState\");\n  var AppState = _interopDefault(_reactNativeWebDistExportsAppState);\n  var _storesEntitlementStore = require(_dependencyMap[2], \"../stores/entitlementStore\");\n  var _storesGameStore = require(_dependencyMap[3], \"../stores/gameStore\");\n  // /app/frontend/hooks/useAppResumeReconcile.ts\n  // Phase 3.14: App resume reconciliation hook\n  //\n  // CANONICAL ENTRY POINT for app resume freshness checks.\n  // This hook MUST be the ONLY place that listens to AppState for entitlements.\n  //\n  // STRICT RULES:\n  // - Do nothing if no user\n  // - Do nothing if already refreshing  \n  // - Do nothing if not stale (ensureFreshEntitlements handles this)\n  // - Never show alerts/toasts\n  // - Never block render\n  // - Fire and forget ONLY\n\n  // Debug logging\n  const dlog = (...args) => {\n    if (__DEV__) console.log('[useAppResumeReconcile]', ...args);\n  };\n\n  /**\n   * Hook that reconciles entitlements when app returns to foreground.\n   * \n   * MUST be called from _layout.tsx SessionProvider ONLY.\n   * Guards enforce this is the only place using AppState for entitlements.\n   * \n   * Uses ensureFreshEntitlements('app_resume') which:\n   * - No-ops if no user\n   * - No-ops if already refreshing\n   * - No-ops if not stale (server-time TTL)\n   * - Silent background refresh otherwise\n   */\n  function useAppResumeReconcile() {\n    const user = (0, _storesGameStore.useGameStore)(s => s.user);\n    const ensureFreshEntitlements = (0, _storesEntitlementStore.useEntitlementStore)(s => s.ensureFreshEntitlements);\n\n    // Track previous app state to detect background -> active transition\n    const appStateRef = (0, _react.useRef)(AppState.default.currentState);\n    (0, _react.useEffect)(() => {\n      // Don't set up listener if no user logged in\n      // (listener will be set up when user logs in via component re-render)\n      if (!user) {\n        dlog('No user, skipping AppState listener setup');\n        return;\n      }\n      const handleAppStateChange = nextAppState => {\n        const previousState = appStateRef.current;\n        appStateRef.current = nextAppState;\n\n        // Only trigger on background/inactive -> active transition\n        if (previousState.match(/inactive|background/) && nextAppState === 'active') {\n          dlog('App resumed from background, triggering entitlements freshness check');\n\n          // Fire and forget - ensureFreshEntitlements handles all guards internally:\n          // - No-ops if already refreshing\n          // - No-ops if not stale (server-time TTL)\n          // - Silent refresh otherwise\n          ensureFreshEntitlements('app_resume').catch(() => {\n            // Silently ignore errors - never block or alert\n          });\n        }\n      };\n      dlog('Setting up AppState listener for user:', user.username);\n      const subscription = AppState.default.addEventListener('change', handleAppStateChange);\n      return () => {\n        dlog('Cleaning up AppState listener');\n        subscription.remove();\n      };\n    }, [user, ensureFreshEntitlements]);\n  }\n});","lineCount":87,"map":[[12,2,35,0,"exports"],[12,9,35,0],[12,10,35,0,"useAppResumeReconcile"],[12,31,35,0],[12,34,35,0,"useAppResumeReconcile"],[12,55,35,0],[13,2,15,0],[13,6,15,0,"_react"],[13,12,15,0],[13,15,15,0,"require"],[13,22,15,0],[13,23,15,0,"_dependencyMap"],[13,37,15,0],[14,2,15,42],[14,6,15,42,"_reactNativeWebDistExportsAppState"],[14,40,15,42],[14,43,15,42,"require"],[14,50,15,42],[14,51,15,42,"_dependencyMap"],[14,65,15,42],[15,2,15,42],[15,6,15,42,"AppState"],[15,14,15,42],[15,17,15,42,"_interopDefault"],[15,32,15,42],[15,33,15,42,"_reactNativeWebDistExportsAppState"],[15,67,15,42],[16,2,17,0],[16,6,17,0,"_storesEntitlementStore"],[16,29,17,0],[16,32,17,0,"require"],[16,39,17,0],[16,40,17,0,"_dependencyMap"],[16,54,17,0],[17,2,18,0],[17,6,18,0,"_storesGameStore"],[17,22,18,0],[17,25,18,0,"require"],[17,32,18,0],[17,33,18,0,"_dependencyMap"],[17,47,18,0],[18,2,1,0],[19,2,2,0],[20,2,3,0],[21,2,4,0],[22,2,5,0],[23,2,6,0],[24,2,7,0],[25,2,8,0],[26,2,9,0],[27,2,10,0],[28,2,11,0],[29,2,12,0],[30,2,13,0],[32,2,20,0],[33,2,21,0],[33,8,21,6,"dlog"],[33,12,21,10],[33,15,21,13,"dlog"],[33,16,21,14],[33,19,21,17,"args"],[33,23,21,28],[33,28,21,33],[34,4,21,35],[34,8,21,39,"__DEV__"],[34,15,21,46],[34,17,21,48,"console"],[34,24,21,55],[34,25,21,56,"log"],[34,28,21,59],[34,29,21,60],[34,54,21,85],[34,56,21,87],[34,59,21,90,"args"],[34,63,21,94],[34,64,21,95],[35,2,21,97],[35,3,21,98],[37,2,23,0],[38,0,24,0],[39,0,25,0],[40,0,26,0],[41,0,27,0],[42,0,28,0],[43,0,29,0],[44,0,30,0],[45,0,31,0],[46,0,32,0],[47,0,33,0],[48,0,34,0],[49,2,35,7],[49,11,35,16,"useAppResumeReconcile"],[49,32,35,37,"useAppResumeReconcile"],[49,33,35,37],[49,35,35,46],[50,4,36,2],[50,10,36,8,"user"],[50,14,36,12],[50,17,36,15],[50,21,36,15,"useGameStore"],[50,37,36,27],[50,38,36,27,"useGameStore"],[50,50,36,27],[50,52,36,28,"s"],[50,53,36,29],[50,57,36,33,"s"],[50,58,36,34],[50,59,36,35,"user"],[50,63,36,39],[50,64,36,40],[51,4,37,2],[51,10,37,8,"ensureFreshEntitlements"],[51,33,37,31],[51,36,37,34],[51,40,37,34,"useEntitlementStore"],[51,63,37,53],[51,64,37,53,"useEntitlementStore"],[51,83,37,53],[51,85,37,54,"s"],[51,86,37,55],[51,90,37,59,"s"],[51,91,37,60],[51,92,37,61,"ensureFreshEntitlements"],[51,115,37,84],[51,116,37,85],[53,4,39,2],[54,4,40,2],[54,10,40,8,"appStateRef"],[54,21,40,19],[54,24,40,22],[54,28,40,22,"useRef"],[54,34,40,28],[54,35,40,28,"useRef"],[54,41,40,28],[54,43,40,45,"AppState"],[54,51,40,53],[54,52,40,53,"default"],[54,59,40,53],[54,60,40,54,"currentState"],[54,72,40,66],[54,73,40,67],[55,4,42,2],[55,8,42,2,"useEffect"],[55,14,42,11],[55,15,42,11,"useEffect"],[55,24,42,11],[55,26,42,12],[55,32,42,18],[56,6,43,4],[57,6,44,4],[58,6,45,4],[58,10,45,8],[58,11,45,9,"user"],[58,15,45,13],[58,17,45,15],[59,8,46,6,"dlog"],[59,12,46,10],[59,13,46,11],[59,56,46,54],[59,57,46,55],[60,8,47,6],[61,6,48,4],[62,6,50,4],[62,12,50,10,"handleAppStateChange"],[62,32,50,30],[62,35,50,34,"nextAppState"],[62,47,50,62],[62,51,50,67],[63,8,51,6],[63,14,51,12,"previousState"],[63,27,51,25],[63,30,51,28,"appStateRef"],[63,41,51,39],[63,42,51,40,"current"],[63,49,51,47],[64,8,52,6,"appStateRef"],[64,19,52,17],[64,20,52,18,"current"],[64,27,52,25],[64,30,52,28,"nextAppState"],[64,42,52,40],[66,8,54,6],[67,8,55,6],[67,12,56,8,"previousState"],[67,25,56,21],[67,26,56,22,"match"],[67,31,56,27],[67,32,56,28],[67,53,56,49],[67,54,56,50],[67,58,57,8,"nextAppState"],[67,70,57,20],[67,75,57,25],[67,83,57,33],[67,85,58,8],[68,10,59,8,"dlog"],[68,14,59,12],[68,15,59,13],[68,85,59,83],[68,86,59,84],[70,10,61,8],[71,10,62,8],[72,10,63,8],[73,10,64,8],[74,10,65,8,"ensureFreshEntitlements"],[74,33,65,31],[74,34,65,32],[74,46,65,44],[74,47,65,45],[74,48,65,46,"catch"],[74,53,65,51],[74,54,65,52],[74,60,65,58],[75,12,66,10],[76,10,66,10],[76,11,67,9],[76,12,67,10],[77,8,68,6],[78,6,69,4],[78,7,69,5],[79,6,71,4,"dlog"],[79,10,71,8],[79,11,71,9],[79,51,71,49],[79,53,71,51,"user"],[79,57,71,55],[79,58,71,56,"username"],[79,66,71,64],[79,67,71,65],[80,6,72,4],[80,12,72,10,"subscription"],[80,24,72,22],[80,27,72,25,"AppState"],[80,35,72,33],[80,36,72,33,"default"],[80,43,72,33],[80,44,72,34,"addEventListener"],[80,60,72,50],[80,61,72,51],[80,69,72,59],[80,71,72,61,"handleAppStateChange"],[80,91,72,81],[80,92,72,82],[81,6,74,4],[81,13,74,11],[81,19,74,17],[82,8,75,6,"dlog"],[82,12,75,10],[82,13,75,11],[82,44,75,42],[82,45,75,43],[83,8,76,6,"subscription"],[83,20,76,18],[83,21,76,19,"remove"],[83,27,76,25],[83,28,76,26],[83,29,76,27],[84,6,77,4],[84,7,77,5],[85,4,78,2],[85,5,78,3],[85,7,78,5],[85,8,78,6,"user"],[85,12,78,10],[85,14,78,12,"ensureFreshEntitlements"],[85,37,78,35],[85,38,78,36],[85,39,78,37],[86,2,79,0],[87,0,79,1],[87,3]],"functionMap":{"names":["<global>","dlog","useAppResumeReconcile","useGameStore$argument_0","useEntitlementStore$argument_0","useEffect$argument_0","handleAppStateChange","ensureFreshEntitlements._catch$argument_0","<anonymous>"],"mappings":"AAA;aCoB,qFD;OEc;4BCC,WD;sDEC,8BF;YGK;iCCQ;oDCe;SDE;KDE;WGK;KHG;GHC;CFC"},"hasCjsExports":false},"type":"js/module"}]}