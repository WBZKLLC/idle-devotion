{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":149},"end":{"line":5,"column":26,"index":175}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"api\", {\n    enumerable: true,\n    get: function () {\n      return api;\n    }\n  });\n  exports.requireUsername = requireUsername;\n  exports.fetchUserHeroes = fetchUserHeroes;\n  exports.promoteHeroStar = promoteHeroStar;\n  exports.getHeroProgression = getHeroProgression;\n  exports.getUserHeroById = getUserHeroById;\n  exports.getUserHeroes = getUserHeroes;\n  exports.fetchUser = fetchUser;\n  exports.pullGacha = pullGacha;\n  exports.performSummon = performSummon;\n  exports.upgradeHero = upgradeHero;\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _axios = require(_dependencyMap[1], \"axios\");\n  var axios = _interopDefault(_axios);\n  // /app/frontend/lib/api.ts\n  // SINGLE SOURCE OF TRUTH for all backend API calls\n  // Screens should import from here to prevent endpoint string drift\n\n  const API_BASE = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL ? `${_expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL}/api` : '/api';\n  const api = axios.default.create({\n    baseURL: API_BASE,\n    timeout: 20000\n  });\n  function requireUsername(username) {\n    if (!username) throw new Error('Missing username');\n    return username;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // USER HEROES\n  // ─────────────────────────────────────────────────────────────\n\n  async function fetchUserHeroes(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // STAR PROMOTION (canonical endpoint)\n  // POST /api/hero/{user_hero_id}/promote-star?username=...\n  // ─────────────────────────────────────────────────────────────\n\n  async function promoteHeroStar(userHeroId, username) {\n    const u = requireUsername(username);\n    const res = await api.post(`/hero/${encodeURIComponent(userHeroId)}/promote-star`, null, {\n      params: {\n        username: u\n      }\n    });\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // HERO PROGRESSION (read model for hero-progression screen)\n  // GET /api/hero/{username}/hero/{heroId}/progression\n  // NOTE: Falls back gracefully if endpoint doesn't exist\n  // ─────────────────────────────────────────────────────────────\n\n  async function getHeroProgression(username, heroId) {\n    const u = requireUsername(username);\n    const res = await api.get(`/hero/${encodeURIComponent(u)}/hero/${encodeURIComponent(heroId)}/progression`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // SINGLE HERO FETCH (fallback when hero not in store cache)\n  // NOTE: Temporary implementation - fetches full list and filters.\n  // Replace with GET /user/{username}/heroes/{userHeroId} once backend exists.\n  // Screens call getUserHeroById() and never hit list endpoints directly.\n  // ─────────────────────────────────────────────────────────────\n\n  async function getUserHeroById(username, userHeroId) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    const list = Array.isArray(res.data) ? res.data : res.data?.heroes ?? res.data ?? [];\n    const found = list.find(h => String(h?.id) === String(userHeroId));\n    if (!found) throw new Error('Hero not found');\n    return found;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // FULL HERO LIST (centralized; screens must not call axios/fetch directly)\n  // Rule: screens import getUserHeroes()/getUserHeroById() — never hit /user/:username/heroes directly.\n  // ─────────────────────────────────────────────────────────────\n\n  async function getUserHeroes(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    return Array.isArray(res.data) ? res.data : res.data?.heroes ?? res.data ?? [];\n  }\n\n  // RULE: All hero endpoints live here.\n  // Screens should not build URLs manually (prevents drift).\n\n  // ─────────────────────────────────────────────────────────────\n  // USER AUTH / PROFILE\n  // ─────────────────────────────────────────────────────────────\n\n  async function fetchUser(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // GACHA / SUMMON\n  // POST /api/gacha/pull?username=...\n  // ─────────────────────────────────────────────────────────────\n\n  async function pullGacha(username, pullType, currencyType) {\n    const u = requireUsername(username);\n    const res = await api.post(`/gacha/pull`, {\n      pull_type: pullType,\n      currency_type: currencyType\n    }, {\n      params: {\n        username: u\n      }\n    });\n    return res.data;\n  }\n\n  // Legacy alias for backwards compatibility\n  async function performSummon(username, summonType) {\n    return pullGacha(username, summonType, 'gems');\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // HERO UPGRADE\n  // POST /api/user/{username}/heroes/{heroInstanceId}/upgrade\n  // ─────────────────────────────────────────────────────────────\n\n  async function upgradeHero(username, heroInstanceId) {\n    const u = requireUsername(username);\n    const res = await api.post(`/user/${encodeURIComponent(u)}/heroes/${encodeURIComponent(heroInstanceId)}/upgrade`);\n    return res.data;\n  }\n\n  // Add more hero endpoints here ONLY.\n  // Screens should import from lib/api.ts so route strings never drift again.\n});","lineCount":158,"map":[[12,2,11,0,"Object"],[12,8,11,0],[12,9,11,0,"defineProperty"],[12,23,11,0],[12,24,11,0,"exports"],[12,31,11,0],[13,4,11,0,"enumerable"],[13,14,11,0],[14,4,11,0,"get"],[14,7,11,0],[14,18,11,0,"get"],[14,19,11,0],[15,6,11,0],[15,13,11,0,"api"],[15,16,11,0],[16,4,11,0],[17,2,11,0],[18,2,16,0,"exports"],[18,9,16,0],[18,10,16,0,"requireUsername"],[18,25,16,0],[18,28,16,0,"requireUsername"],[18,43,16,0],[19,2,25,0,"exports"],[19,9,25,0],[19,10,25,0,"fetchUserHeroes"],[19,25,25,0],[19,28,25,0,"fetchUserHeroes"],[19,43,25,0],[20,2,36,0,"exports"],[20,9,36,0],[20,10,36,0,"promoteHeroStar"],[20,25,36,0],[20,28,36,0,"promoteHeroStar"],[20,43,36,0],[21,2,57,0,"exports"],[21,9,57,0],[21,10,57,0,"getHeroProgression"],[21,28,57,0],[21,31,57,0,"getHeroProgression"],[21,49,57,0],[22,2,70,0,"exports"],[22,9,70,0],[22,10,70,0,"getUserHeroById"],[22,25,70,0],[22,28,70,0,"getUserHeroById"],[22,43,70,0],[23,2,84,0,"exports"],[23,9,84,0],[23,10,84,0,"getUserHeroes"],[23,23,84,0],[23,26,84,0,"getUserHeroes"],[23,39,84,0],[24,2,97,0,"exports"],[24,9,97,0],[24,10,97,0,"fetchUser"],[24,19,97,0],[24,22,97,0,"fetchUser"],[24,31,97,0],[25,2,108,0,"exports"],[25,9,108,0],[25,10,108,0,"pullGacha"],[25,19,108,0],[25,22,108,0,"pullGacha"],[25,31,108,0],[26,2,123,0,"exports"],[26,9,123,0],[26,10,123,0,"performSummon"],[26,23,123,0],[26,26,123,0,"performSummon"],[26,39,123,0],[27,2,132,0,"exports"],[27,9,132,0],[27,10,132,0,"upgradeHero"],[27,21,132,0],[27,24,132,0,"upgradeHero"],[27,35,132,0],[28,2,136,1],[28,6,136,1,"_expoVirtualEnv"],[28,21,136,1],[28,24,136,1,"require"],[28,31,136,1],[28,32,136,1,"_dependencyMap"],[28,46,136,1],[29,2,5,0],[29,6,5,0,"_axios"],[29,12,5,0],[29,15,5,0,"require"],[29,22,5,0],[29,23,5,0,"_dependencyMap"],[29,37,5,0],[30,2,5,0],[30,6,5,0,"axios"],[30,11,5,0],[30,14,5,0,"_interopDefault"],[30,29,5,0],[30,30,5,0,"_axios"],[30,36,5,0],[31,2,1,0],[32,2,2,0],[33,2,3,0],[35,2,7,0],[35,8,7,6,"API_BASE"],[35,16,7,14],[35,19,7,17,"_expoVirtualEnv"],[35,34,7,17],[35,35,7,17,"env"],[35,38,7,17],[35,39,7,17,"EXPO_PUBLIC_BACKEND_URL"],[35,62,7,17],[35,65,8,4],[35,68,8,4,"_expoVirtualEnv"],[35,83,8,4],[35,84,8,4,"env"],[35,87,8,4],[35,88,8,4,"EXPO_PUBLIC_BACKEND_URL"],[35,111,8,4],[35,117,8,48],[35,120,9,4],[35,126,9,10],[36,2,11,7],[36,8,11,13,"api"],[36,11,11,16],[36,14,11,19,"axios"],[36,19,11,24],[36,20,11,24,"default"],[36,27,11,24],[36,28,11,25,"create"],[36,34,11,31],[36,35,11,32],[37,4,12,2,"baseURL"],[37,11,12,9],[37,13,12,11,"API_BASE"],[37,21,12,19],[38,4,13,2,"timeout"],[38,11,13,9],[38,13,13,11],[39,2,14,0],[39,3,14,1],[39,4,14,2],[40,2,16,7],[40,11,16,16,"requireUsername"],[40,26,16,31,"requireUsername"],[40,27,16,32,"username"],[40,35,16,49],[40,37,16,51],[41,4,17,2],[41,8,17,6],[41,9,17,7,"username"],[41,17,17,15],[41,19,17,17],[41,25,17,23],[41,29,17,27,"Error"],[41,34,17,32],[41,35,17,33],[41,53,17,51],[41,54,17,52],[42,4,18,2],[42,11,18,9,"username"],[42,19,18,17],[43,2,19,0],[45,2,21,0],[46,2,22,0],[47,2,23,0],[49,2,25,7],[49,17,25,22,"fetchUserHeroes"],[49,32,25,37,"fetchUserHeroes"],[49,33,25,38,"username"],[49,41,25,54],[49,43,25,56],[50,4,26,2],[50,10,26,8,"u"],[50,11,26,9],[50,14,26,12,"requireUsername"],[50,29,26,27],[50,30,26,28,"username"],[50,38,26,36],[50,39,26,37],[51,4,27,2],[51,10,27,8,"res"],[51,13,27,11],[51,16,27,14],[51,22,27,20,"api"],[51,25,27,23],[51,26,27,24,"get"],[51,29,27,27],[51,30,27,28],[51,39,27,37,"encodeURIComponent"],[51,57,27,55],[51,58,27,56,"u"],[51,59,27,57],[51,60,27,58],[51,69,27,67],[51,70,27,68],[52,4,28,2],[52,11,28,9,"res"],[52,14,28,12],[52,15,28,13,"data"],[52,19,28,17],[53,2,29,0],[55,2,31,0],[56,2,32,0],[57,2,33,0],[58,2,34,0],[60,2,36,7],[60,17,36,22,"promoteHeroStar"],[60,32,36,37,"promoteHeroStar"],[60,33,36,38,"userHeroId"],[60,43,36,56],[60,45,36,58,"username"],[60,53,36,74],[60,55,36,76],[61,4,37,2],[61,10,37,8,"u"],[61,11,37,9],[61,14,37,12,"requireUsername"],[61,29,37,27],[61,30,37,28,"username"],[61,38,37,36],[61,39,37,37],[62,4,38,2],[62,10,38,8,"res"],[62,13,38,11],[62,16,38,14],[62,22,38,20,"api"],[62,25,38,23],[62,26,38,24,"post"],[62,30,38,28],[62,31,39,4],[62,40,39,13,"encodeURIComponent"],[62,58,39,31],[62,59,39,32,"userHeroId"],[62,69,39,42],[62,70,39,43],[62,85,39,58],[62,87,40,4],[62,91,40,8],[62,93,41,4],[63,6,41,6,"params"],[63,12,41,12],[63,14,41,14],[64,8,41,16,"username"],[64,16,41,24],[64,18,41,26,"u"],[65,6,41,28],[66,4,41,30],[66,5,42,2],[66,6,42,3],[67,4,43,2],[67,11,43,9,"res"],[67,14,43,12],[67,15,43,13,"data"],[67,19,43,17],[68,2,49,0],[70,2,51,0],[71,2,52,0],[72,2,53,0],[73,2,54,0],[74,2,55,0],[76,2,57,7],[76,17,57,22,"getHeroProgression"],[76,35,57,40,"getHeroProgression"],[76,36,57,41,"username"],[76,44,57,57],[76,46,57,59,"heroId"],[76,52,57,73],[76,54,57,75],[77,4,58,2],[77,10,58,8,"u"],[77,11,58,9],[77,14,58,12,"requireUsername"],[77,29,58,27],[77,30,58,28,"username"],[77,38,58,36],[77,39,58,37],[78,4,59,2],[78,10,59,8,"res"],[78,13,59,11],[78,16,59,14],[78,22,59,20,"api"],[78,25,59,23],[78,26,59,24,"get"],[78,29,59,27],[78,30,59,28],[78,39,59,37,"encodeURIComponent"],[78,57,59,55],[78,58,59,56,"u"],[78,59,59,57],[78,60,59,58],[78,69,59,67,"encodeURIComponent"],[78,87,59,85],[78,88,59,86,"heroId"],[78,94,59,92],[78,95,59,93],[78,109,59,107],[78,110,59,108],[79,4,60,2],[79,11,60,9,"res"],[79,14,60,12],[79,15,60,13,"data"],[79,19,60,17],[80,2,61,0],[82,2,63,0],[83,2,64,0],[84,2,65,0],[85,2,66,0],[86,2,67,0],[87,2,68,0],[89,2,70,7],[89,17,70,22,"getUserHeroById"],[89,32,70,37,"getUserHeroById"],[89,33,70,38,"username"],[89,41,70,54],[89,43,70,56,"userHeroId"],[89,53,70,74],[89,55,70,76],[90,4,71,2],[90,10,71,8,"u"],[90,11,71,9],[90,14,71,12,"requireUsername"],[90,29,71,27],[90,30,71,28,"username"],[90,38,71,36],[90,39,71,37],[91,4,72,2],[91,10,72,8,"res"],[91,13,72,11],[91,16,72,14],[91,22,72,20,"api"],[91,25,72,23],[91,26,72,24,"get"],[91,29,72,27],[91,30,72,28],[91,39,72,37,"encodeURIComponent"],[91,57,72,55],[91,58,72,56,"u"],[91,59,72,57],[91,60,72,58],[91,69,72,67],[91,70,72,68],[92,4,73,2],[92,10,73,8,"list"],[92,14,73,12],[92,17,73,15,"Array"],[92,22,73,20],[92,23,73,21,"isArray"],[92,30,73,28],[92,31,73,29,"res"],[92,34,73,32],[92,35,73,33,"data"],[92,39,73,37],[92,40,73,38],[92,43,73,41,"res"],[92,46,73,44],[92,47,73,45,"data"],[92,51,73,49],[92,54,73,53,"res"],[92,57,73,56],[92,58,73,57,"data"],[92,62,73,61],[92,64,73,63,"heroes"],[92,70,73,69],[92,74,73,73,"res"],[92,77,73,76],[92,78,73,77,"data"],[92,82,73,81],[92,86,73,85],[92,88,73,88],[93,4,74,2],[93,10,74,8,"found"],[93,15,74,13],[93,18,74,16,"list"],[93,22,74,20],[93,23,74,21,"find"],[93,27,74,25],[93,28,74,27,"h"],[93,29,74,33],[93,33,74,38,"String"],[93,39,74,44],[93,40,74,45,"h"],[93,41,74,46],[93,43,74,48,"id"],[93,45,74,50],[93,46,74,51],[93,51,74,56,"String"],[93,57,74,62],[93,58,74,63,"userHeroId"],[93,68,74,73],[93,69,74,74],[93,70,74,75],[94,4,75,2],[94,8,75,6],[94,9,75,7,"found"],[94,14,75,12],[94,16,75,14],[94,22,75,20],[94,26,75,24,"Error"],[94,31,75,29],[94,32,75,30],[94,48,75,46],[94,49,75,47],[95,4,76,2],[95,11,76,9,"found"],[95,16,76,14],[96,2,77,0],[98,2,79,0],[99,2,80,0],[100,2,81,0],[101,2,82,0],[103,2,84,7],[103,17,84,22,"getUserHeroes"],[103,30,84,35,"getUserHeroes"],[103,31,84,36,"username"],[103,39,84,52],[103,41,84,54],[104,4,85,2],[104,10,85,8,"u"],[104,11,85,9],[104,14,85,12,"requireUsername"],[104,29,85,27],[104,30,85,28,"username"],[104,38,85,36],[104,39,85,37],[105,4,86,2],[105,10,86,8,"res"],[105,13,86,11],[105,16,86,14],[105,22,86,20,"api"],[105,25,86,23],[105,26,86,24,"get"],[105,29,86,27],[105,30,86,28],[105,39,86,37,"encodeURIComponent"],[105,57,86,55],[105,58,86,56,"u"],[105,59,86,57],[105,60,86,58],[105,69,86,67],[105,70,86,68],[106,4,87,2],[106,11,87,9,"Array"],[106,16,87,14],[106,17,87,15,"isArray"],[106,24,87,22],[106,25,87,23,"res"],[106,28,87,26],[106,29,87,27,"data"],[106,33,87,31],[106,34,87,32],[106,37,87,35,"res"],[106,40,87,38],[106,41,87,39,"data"],[106,45,87,43],[106,48,87,47,"res"],[106,51,87,50],[106,52,87,51,"data"],[106,56,87,55],[106,58,87,57,"heroes"],[106,64,87,63],[106,68,87,67,"res"],[106,71,87,70],[106,72,87,71,"data"],[106,76,87,75],[106,80,87,79],[106,82,87,82],[107,2,88,0],[109,2,90,0],[110,2,91,0],[112,2,93,0],[113,2,94,0],[114,2,95,0],[116,2,97,7],[116,17,97,22,"fetchUser"],[116,26,97,31,"fetchUser"],[116,27,97,32,"username"],[116,35,97,48],[116,37,97,50],[117,4,98,2],[117,10,98,8,"u"],[117,11,98,9],[117,14,98,12,"requireUsername"],[117,29,98,27],[117,30,98,28,"username"],[117,38,98,36],[117,39,98,37],[118,4,99,2],[118,10,99,8,"res"],[118,13,99,11],[118,16,99,14],[118,22,99,20,"api"],[118,25,99,23],[118,26,99,24,"get"],[118,29,99,27],[118,30,99,28],[118,39,99,37,"encodeURIComponent"],[118,57,99,55],[118,58,99,56,"u"],[118,59,99,57],[118,60,99,58],[118,62,99,60],[118,63,99,61],[119,4,100,2],[119,11,100,9,"res"],[119,14,100,12],[119,15,100,13,"data"],[119,19,100,17],[120,2,101,0],[122,2,103,0],[123,2,104,0],[124,2,105,0],[125,2,106,0],[127,2,108,7],[127,17,108,22,"pullGacha"],[127,26,108,31,"pullGacha"],[127,27,109,2,"username"],[127,35,109,18],[127,37,110,2,"pullType"],[127,45,110,30],[127,47,111,2,"currencyType"],[127,59,111,32],[127,61,112,2],[128,4,113,2],[128,10,113,8,"u"],[128,11,113,9],[128,14,113,12,"requireUsername"],[128,29,113,27],[128,30,113,28,"username"],[128,38,113,36],[128,39,113,37],[129,4,114,2],[129,10,114,8,"res"],[129,13,114,11],[129,16,114,14],[129,22,114,20,"api"],[129,25,114,23],[129,26,114,24,"post"],[129,30,114,28],[129,31,115,4],[129,44,115,17],[129,46,116,4],[130,6,116,6,"pull_type"],[130,15,116,15],[130,17,116,17,"pullType"],[130,25,116,25],[131,6,116,27,"currency_type"],[131,19,116,40],[131,21,116,42,"currencyType"],[132,4,116,55],[132,5,116,56],[132,7,117,4],[133,6,117,6,"params"],[133,12,117,12],[133,14,117,14],[134,8,117,16,"username"],[134,16,117,24],[134,18,117,26,"u"],[135,6,117,28],[136,4,117,30],[136,5,118,2],[136,6,118,3],[137,4,119,2],[137,11,119,9,"res"],[137,14,119,12],[137,15,119,13,"data"],[137,19,119,17],[138,2,120,0],[140,2,122,0],[141,2,123,7],[141,17,123,22,"performSummon"],[141,30,123,35,"performSummon"],[141,31,123,36,"username"],[141,39,123,52],[141,41,123,54,"summonType"],[141,51,123,84],[141,53,123,86],[142,4,124,2],[142,11,124,9,"pullGacha"],[142,20,124,18],[142,21,124,19,"username"],[142,29,124,27],[142,31,124,29,"summonType"],[142,41,124,39],[142,43,124,41],[142,49,124,47],[142,50,124,48],[143,2,125,0],[145,2,127,0],[146,2,128,0],[147,2,129,0],[148,2,130,0],[150,2,132,7],[150,17,132,22,"upgradeHero"],[150,28,132,33,"upgradeHero"],[150,29,132,34,"username"],[150,37,132,50],[150,39,132,52,"heroInstanceId"],[150,53,132,74],[150,55,132,76],[151,4,133,2],[151,10,133,8,"u"],[151,11,133,9],[151,14,133,12,"requireUsername"],[151,29,133,27],[151,30,133,28,"username"],[151,38,133,36],[151,39,133,37],[152,4,134,2],[152,10,134,8,"res"],[152,13,134,11],[152,16,134,14],[152,22,134,20,"api"],[152,25,134,23],[152,26,134,24,"post"],[152,30,134,28],[152,31,134,29],[152,40,134,38,"encodeURIComponent"],[152,58,134,56],[152,59,134,57,"u"],[152,60,134,58],[152,61,134,59],[152,72,134,70,"encodeURIComponent"],[152,90,134,88],[152,91,134,89,"heroInstanceId"],[152,105,134,103],[152,106,134,104],[152,116,134,114],[152,117,134,115],[153,4,135,2],[153,11,135,9,"res"],[153,14,135,12],[153,15,135,13,"data"],[153,19,135,17],[154,2,136,0],[156,2,138,0],[157,2,139,0],[158,0,139,0],[158,3]],"functionMap":{"names":["<global>","requireUsername","fetchUserHeroes","promoteHeroStar","getHeroProgression","getUserHeroById","list.find$argument_0","getUserHeroes","fetchUser","pullGacha","performSummon","upgradeHero"],"mappings":"AAA;OCe;CDG;OEM;CFI;OGO;CHa;OIQ;CJI;OKS;0BCI,gDD;CLG;OOO;CPI;OQS;CRI;OSO;CTY;OUG;CVE;OWO;CXI"},"hasCjsExports":false},"type":"js/module"}]}