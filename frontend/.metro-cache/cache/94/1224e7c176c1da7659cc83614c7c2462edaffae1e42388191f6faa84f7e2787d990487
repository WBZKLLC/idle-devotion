{"dependencies":[{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":747},"end":{"line":18,"column":37,"index":784}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}},{"name":"./products","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":785},"end":{"line":19,"column":57,"index":842}}],"key":"QLsEbhN001YxKPoY7MJ1qVaW9gw=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.goToPaywall = goToPaywall;\n  exports.goToStore = goToStore;\n  exports.goToPurchaseSuccess = goToPurchaseSuccess;\n  exports.getPaywallRoute = getPaywallRoute;\n  exports.getStoreRoute = getStoreRoute;\n  var _expoRouter = require(_dependencyMap[0], \"expo-router\");\n  var _products = require(_dependencyMap[1], \"./products\");\n  // /app/frontend/lib/entitlements/navigation.ts\n  // CANONICAL Premium Navigation - single entry point for all paywall routing\n  //\n  // STRICT INVARIANTS:\n  // 1. All premium navigation MUST go through these helpers\n  // 2. Direct router.push('/paid-features') or router.push('/store') is FORBIDDEN\n  // 3. If productKey is omitted, defaults to PAYWALL_HUB (documented policy)\n  // 4. source MUST be a known PaywallSource (no arbitrary strings in prod)\n  // 5. returnTo is sanitized (must start with /, max 256 chars)\n  //\n  // This ensures:\n  // - Analytics/telemetry for all premium funnels\n  // - Single place to change paywall route\n  // - Consistent UX for premium denial flows\n  // - Easy debugging of purchase funnels\n  // - No silent misroutes from implicit defaults\n\n  // Debug logging\n  const dlog = (...args) => {\n    if (__DEV__) console.log('[navigation]', ...args);\n  };\n\n  /**\n   * Source of the paywall navigation (for analytics + debugging)\n   * \n   * STRICT: Only these known values are allowed.\n   * Adding a new source requires updating this type.\n   */\n\n  // Fallback (should be rare, logged as warning)\n\n  // Known sources for validation\n  const KNOWN_SOURCES = new Set(['cinematic_gate', 'battle_pass', 'store', 'profile', 'hero_detail', 'gating_alert', 'equipment', 'gacha', 'campaign', 'unknown']);\n\n  /**\n   * Options for paywall navigation\n   */\n\n  /**\n   * The ONE route for premium purchases\n   * Change this ONLY here to update all premium navigation\n   */\n  const PAYWALL_ROUTE = '/paid-features';\n  const STORE_ROUTE = '/store';\n\n  // Constraints\n  const MAX_RETURN_TO_LENGTH = 256;\n\n  /**\n   * Sanitize returnTo path to prevent weird routing state\n   * - Must start with '/'\n   * - Strip query fragments\n   * - Clamp length to MAX_RETURN_TO_LENGTH\n   */\n  function sanitizeReturnTo(returnTo) {\n    if (!returnTo) return undefined;\n\n    // Must start with /\n    if (!returnTo.startsWith('/')) {\n      if (__DEV__) console.warn('[navigation] returnTo must start with /, got:', returnTo);\n      return undefined;\n    }\n\n    // Strip query params and fragments (keep clean path only)\n    let cleaned = returnTo.split('?')[0].split('#')[0];\n\n    // Clamp length\n    if (cleaned.length > MAX_RETURN_TO_LENGTH) {\n      if (__DEV__) console.warn('[navigation] returnTo too long, truncating');\n      cleaned = cleaned.substring(0, MAX_RETURN_TO_LENGTH);\n    }\n    return cleaned;\n  }\n\n  /**\n   * Validate and normalize source\n   */\n  function normalizeSource(source) {\n    if (KNOWN_SOURCES.has(source)) {\n      return source;\n    }\n    if (__DEV__) {\n      console.warn('[navigation] Unknown PaywallSource:', source, '- defaulting to \"unknown\"');\n    }\n    return 'unknown';\n  }\n\n  /**\n   * Canonical entry point for all paywall/premium navigation\n   * \n   * USE THIS instead of router.push('/paid-features') or router.push('/store')\n   * \n   * POLICY: If productKey is omitted, routes to general paywall hub.\n   * This is deterministic and documented - Paywall component shows all products.\n   * \n   * @example\n   * // From cinematic gate (specific product)\n   * goToPaywall({ productKey: 'PREMIUM_CINEMATICS_PACK', source: 'cinematic_gate', heroId: hero.id });\n   * \n   * // From battle pass (specific product)\n   * goToPaywall({ productKey: 'PREMIUM_SUBSCRIPTION', source: 'battle_pass' });\n   * \n   * // Generic premium denial (no specific product - shows all options)\n   * goToPaywall({ source: 'gating_alert' });\n   */\n  function goToPaywall(opts) {\n    const {\n      productKey,\n      heroId,\n      returnTo\n    } = opts;\n\n    // Normalize source (strict validation)\n    const source = normalizeSource(opts.source);\n\n    // Sanitize returnTo\n    const cleanReturnTo = sanitizeReturnTo(returnTo);\n    dlog('goToPaywall:', {\n      productKey,\n      source,\n      heroId,\n      returnTo: cleanReturnTo\n    });\n\n    // Build query params\n    const params = new URLSearchParams();\n    if (productKey) {\n      params.set('productKey', productKey);\n      // Also include productId for convenience\n      const product = (0, _products.getProduct)(productKey);\n      if (product) {\n        params.set('productId', product.productId);\n      }\n    }\n    // NOTE: If productKey is omitted, Paywall shows general hub (all products)\n    // This is documented policy, not an implicit default\n\n    // Source is always set (normalized above)\n    params.set('source', source);\n    if (heroId) {\n      params.set('heroId', heroId);\n    }\n    if (cleanReturnTo) {\n      params.set('returnTo', cleanReturnTo);\n    }\n\n    // Build final route\n    const queryString = params.toString();\n    const route = queryString ? `${PAYWALL_ROUTE}?${queryString}` : PAYWALL_ROUTE;\n\n    // TODO: Add telemetry/analytics event here\n    // track(Events.PAYWALL_VIEWED, { productKey, source, heroId });\n\n    _expoRouter.router.push(route);\n  }\n\n  /**\n   * Navigate to the general store/shop screen\n   * Use this for browsing, not for specific premium denial flows\n   */\n  function goToStore(source) {\n    const normalizedSource = source ? normalizeSource(source) : 'store';\n    dlog('goToStore:', {\n      source: normalizedSource\n    });\n    _expoRouter.router.push(`${STORE_ROUTE}?source=${normalizedSource}`);\n  }\n\n  /**\n   * Navigate to purchase success screen (optional, for post-purchase UX)\n   */\n  function goToPurchaseSuccess(opts) {\n    dlog('goToPurchaseSuccess:', opts);\n\n    // Sanitize returnTo\n    const cleanReturnTo = sanitizeReturnTo(opts?.returnTo);\n\n    // For now, just go back or to a success route\n    // This can be expanded to show a dedicated success screen\n    if (cleanReturnTo) {\n      _expoRouter.router.replace(cleanReturnTo);\n    } else {\n      _expoRouter.router.back();\n    }\n  }\n\n  /**\n   * Get the paywall route for use in gating helpers\n   * (Internal use - screens should use goToPaywall instead)\n   */\n  function getPaywallRoute() {\n    return PAYWALL_ROUTE;\n  }\n\n  /**\n   * Get the store route\n   * (Internal use - screens should use goToStore instead)\n   */\n  function getStoreRoute() {\n    return STORE_ROUTE;\n  }\n});","lineCount":215,"map":[[7,2,140,0,"exports"],[7,9,140,0],[7,10,140,0,"goToPaywall"],[7,21,140,0],[7,24,140,0,"goToPaywall"],[7,35,140,0],[8,2,192,0,"exports"],[8,9,192,0],[8,10,192,0,"goToStore"],[8,19,192,0],[8,22,192,0,"goToStore"],[8,31,192,0],[9,2,202,0,"exports"],[9,9,202,0],[9,10,202,0,"goToPurchaseSuccess"],[9,29,202,0],[9,32,202,0,"goToPurchaseSuccess"],[9,51,202,0],[10,2,224,0,"exports"],[10,9,224,0],[10,10,224,0,"getPaywallRoute"],[10,25,224,0],[10,28,224,0,"getPaywallRoute"],[10,43,224,0],[11,2,232,0,"exports"],[11,9,232,0],[11,10,232,0,"getStoreRoute"],[11,23,232,0],[11,26,232,0,"getStoreRoute"],[11,39,232,0],[12,2,18,0],[12,6,18,0,"_expoRouter"],[12,17,18,0],[12,20,18,0,"require"],[12,27,18,0],[12,28,18,0,"_dependencyMap"],[12,42,18,0],[13,2,19,0],[13,6,19,0,"_products"],[13,15,19,0],[13,18,19,0,"require"],[13,25,19,0],[13,26,19,0,"_dependencyMap"],[13,40,19,0],[14,2,1,0],[15,2,2,0],[16,2,3,0],[17,2,4,0],[18,2,5,0],[19,2,6,0],[20,2,7,0],[21,2,8,0],[22,2,9,0],[23,2,10,0],[24,2,11,0],[25,2,12,0],[26,2,13,0],[27,2,14,0],[28,2,15,0],[29,2,16,0],[31,2,21,0],[32,2,22,0],[32,8,22,6,"dlog"],[32,12,22,10],[32,15,22,13,"dlog"],[32,16,22,14],[32,19,22,17,"args"],[32,23,22,28],[32,28,22,33],[33,4,22,35],[33,8,22,39,"__DEV__"],[33,15,22,46],[33,17,22,48,"console"],[33,24,22,55],[33,25,22,56,"log"],[33,28,22,59],[33,29,22,60],[33,43,22,74],[33,45,22,76],[33,48,22,79,"args"],[33,52,22,83],[33,53,22,84],[34,2,22,86],[34,3,22,87],[36,2,24,0],[37,0,25,0],[38,0,26,0],[39,0,27,0],[40,0,28,0],[41,0,29,0],[43,2,40,27],[45,2,42,0],[46,2,43,0],[46,8,43,6,"KNOWN_SOURCES"],[46,21,43,19],[46,24,43,22],[46,28,43,26,"Set"],[46,31,43,29],[46,32,43,45],[46,33,44,2],[46,49,44,18],[46,51,44,20],[46,64,44,33],[46,66,44,35],[46,73,44,42],[46,75,44,44],[46,84,44,53],[46,86,44,55],[46,99,44,68],[46,101,45,2],[46,115,45,16],[46,117,45,18],[46,128,45,29],[46,130,45,31],[46,137,45,38],[46,139,45,40],[46,149,45,50],[46,151,45,52],[46,160,45,61],[46,161,46,1],[46,162,46,2],[48,2,48,0],[49,0,49,0],[50,0,50,0],[52,2,71,0],[53,0,72,0],[54,0,73,0],[55,0,74,0],[56,2,75,0],[56,8,75,6,"PAYWALL_ROUTE"],[56,21,75,19],[56,24,75,22],[56,40,75,47],[57,2,76,0],[57,8,76,6,"STORE_ROUTE"],[57,19,76,17],[57,22,76,20],[57,30,76,37],[59,2,78,0],[60,2,79,0],[60,8,79,6,"MAX_RETURN_TO_LENGTH"],[60,28,79,26],[60,31,79,29],[60,34,79,32],[62,2,81,0],[63,0,82,0],[64,0,83,0],[65,0,84,0],[66,0,85,0],[67,0,86,0],[68,2,87,0],[68,11,87,9,"sanitizeReturnTo"],[68,27,87,25,"sanitizeReturnTo"],[68,28,87,26,"returnTo"],[68,36,87,54],[68,38,87,76],[69,4,88,2],[69,8,88,6],[69,9,88,7,"returnTo"],[69,17,88,15],[69,19,88,17],[69,26,88,24,"undefined"],[69,35,88,33],[71,4,90,2],[72,4,91,2],[72,8,91,6],[72,9,91,7,"returnTo"],[72,17,91,15],[72,18,91,16,"startsWith"],[72,28,91,26],[72,29,91,27],[72,32,91,30],[72,33,91,31],[72,35,91,33],[73,6,92,4],[73,10,92,8,"__DEV__"],[73,17,92,15],[73,19,92,17,"console"],[73,26,92,24],[73,27,92,25,"warn"],[73,31,92,29],[73,32,92,30],[73,79,92,77],[73,81,92,79,"returnTo"],[73,89,92,87],[73,90,92,88],[74,6,93,4],[74,13,93,11,"undefined"],[74,22,93,20],[75,4,94,2],[77,4,96,2],[78,4,97,2],[78,8,97,6,"cleaned"],[78,15,97,13],[78,18,97,16,"returnTo"],[78,26,97,24],[78,27,97,25,"split"],[78,32,97,30],[78,33,97,31],[78,36,97,34],[78,37,97,35],[78,38,97,36],[78,39,97,37],[78,40,97,38],[78,41,97,39,"split"],[78,46,97,44],[78,47,97,45],[78,50,97,48],[78,51,97,49],[78,52,97,50],[78,53,97,51],[78,54,97,52],[80,4,99,2],[81,4,100,2],[81,8,100,6,"cleaned"],[81,15,100,13],[81,16,100,14,"length"],[81,22,100,20],[81,25,100,23,"MAX_RETURN_TO_LENGTH"],[81,45,100,43],[81,47,100,45],[82,6,101,4],[82,10,101,8,"__DEV__"],[82,17,101,15],[82,19,101,17,"console"],[82,26,101,24],[82,27,101,25,"warn"],[82,31,101,29],[82,32,101,30],[82,76,101,74],[82,77,101,75],[83,6,102,4,"cleaned"],[83,13,102,11],[83,16,102,14,"cleaned"],[83,23,102,21],[83,24,102,22,"substring"],[83,33,102,31],[83,34,102,32],[83,35,102,33],[83,37,102,35,"MAX_RETURN_TO_LENGTH"],[83,57,102,55],[83,58,102,56],[84,4,103,2],[85,4,105,2],[85,11,105,9,"cleaned"],[85,18,105,16],[86,2,106,0],[88,2,108,0],[89,0,109,0],[90,0,110,0],[91,2,111,0],[91,11,111,9,"normalizeSource"],[91,26,111,24,"normalizeSource"],[91,27,111,25,"source"],[91,33,111,46],[91,35,111,63],[92,4,112,2],[92,8,112,6,"KNOWN_SOURCES"],[92,21,112,19],[92,22,112,20,"has"],[92,25,112,23],[92,26,112,24,"source"],[92,32,112,30],[92,33,112,31],[92,35,112,33],[93,6,113,4],[93,13,113,11,"source"],[93,19,113,17],[94,4,114,2],[95,4,116,2],[95,8,116,6,"__DEV__"],[95,15,116,13],[95,17,116,15],[96,6,117,4,"console"],[96,13,117,11],[96,14,117,12,"warn"],[96,18,117,16],[96,19,117,17],[96,56,117,54],[96,58,117,56,"source"],[96,64,117,62],[96,66,117,64],[96,93,117,91],[96,94,117,92],[97,4,118,2],[98,4,119,2],[98,11,119,9],[98,20,119,18],[99,2,120,0],[101,2,122,0],[102,0,123,0],[103,0,124,0],[104,0,125,0],[105,0,126,0],[106,0,127,0],[107,0,128,0],[108,0,129,0],[109,0,130,0],[110,0,131,0],[111,0,132,0],[112,0,133,0],[113,0,134,0],[114,0,135,0],[115,0,136,0],[116,0,137,0],[117,0,138,0],[118,0,139,0],[119,2,140,7],[119,11,140,16,"goToPaywall"],[119,22,140,27,"goToPaywall"],[119,23,140,28,"opts"],[119,27,140,52],[119,29,140,60],[120,4,141,2],[120,10,141,8],[121,6,141,10,"productKey"],[121,16,141,20],[122,6,141,22,"heroId"],[122,12,141,28],[123,6,141,30,"returnTo"],[124,4,141,39],[124,5,141,40],[124,8,141,43,"opts"],[124,12,141,47],[126,4,143,2],[127,4,144,2],[127,10,144,8,"source"],[127,16,144,14],[127,19,144,17,"normalizeSource"],[127,34,144,32],[127,35,144,33,"opts"],[127,39,144,37],[127,40,144,38,"source"],[127,46,144,44],[127,47,144,45],[129,4,146,2],[130,4,147,2],[130,10,147,8,"cleanReturnTo"],[130,23,147,21],[130,26,147,24,"sanitizeReturnTo"],[130,42,147,40],[130,43,147,41,"returnTo"],[130,51,147,49],[130,52,147,50],[131,4,149,2,"dlog"],[131,8,149,6],[131,9,149,7],[131,23,149,21],[131,25,149,23],[132,6,149,25,"productKey"],[132,16,149,35],[133,6,149,37,"source"],[133,12,149,43],[134,6,149,45,"heroId"],[134,12,149,51],[135,6,149,53,"returnTo"],[135,14,149,61],[135,16,149,63,"cleanReturnTo"],[136,4,149,77],[136,5,149,78],[136,6,149,79],[138,4,151,2],[139,4,152,2],[139,10,152,8,"params"],[139,16,152,14],[139,19,152,17],[139,23,152,21,"URLSearchParams"],[139,38,152,36],[139,39,152,37],[139,40,152,38],[140,4,154,2],[140,8,154,6,"productKey"],[140,18,154,16],[140,20,154,18],[141,6,155,4,"params"],[141,12,155,10],[141,13,155,11,"set"],[141,16,155,14],[141,17,155,15],[141,29,155,27],[141,31,155,29,"productKey"],[141,41,155,39],[141,42,155,40],[142,6,156,4],[143,6,157,4],[143,12,157,10,"product"],[143,19,157,17],[143,22,157,20],[143,26,157,20,"getProduct"],[143,35,157,30],[143,36,157,30,"getProduct"],[143,46,157,30],[143,48,157,31,"productKey"],[143,58,157,41],[143,59,157,42],[144,6,158,4],[144,10,158,8,"product"],[144,17,158,15],[144,19,158,17],[145,8,159,6,"params"],[145,14,159,12],[145,15,159,13,"set"],[145,18,159,16],[145,19,159,17],[145,30,159,28],[145,32,159,30,"product"],[145,39,159,37],[145,40,159,38,"productId"],[145,49,159,47],[145,50,159,48],[146,6,160,4],[147,4,161,2],[148,4,162,2],[149,4,163,2],[151,4,165,2],[152,4,166,2,"params"],[152,10,166,8],[152,11,166,9,"set"],[152,14,166,12],[152,15,166,13],[152,23,166,21],[152,25,166,23,"source"],[152,31,166,29],[152,32,166,30],[153,4,168,2],[153,8,168,6,"heroId"],[153,14,168,12],[153,16,168,14],[154,6,169,4,"params"],[154,12,169,10],[154,13,169,11,"set"],[154,16,169,14],[154,17,169,15],[154,25,169,23],[154,27,169,25,"heroId"],[154,33,169,31],[154,34,169,32],[155,4,170,2],[156,4,172,2],[156,8,172,6,"cleanReturnTo"],[156,21,172,19],[156,23,172,21],[157,6,173,4,"params"],[157,12,173,10],[157,13,173,11,"set"],[157,16,173,14],[157,17,173,15],[157,27,173,25],[157,29,173,27,"cleanReturnTo"],[157,42,173,40],[157,43,173,41],[158,4,174,2],[160,4,176,2],[161,4,177,2],[161,10,177,8,"queryString"],[161,21,177,19],[161,24,177,22,"params"],[161,30,177,28],[161,31,177,29,"toString"],[161,39,177,37],[161,40,177,38],[161,41,177,39],[162,4,178,2],[162,10,178,8,"route"],[162,15,178,13],[162,18,178,16,"queryString"],[162,29,178,27],[162,32,179,6],[162,35,179,9,"PAYWALL_ROUTE"],[162,48,179,22],[162,52,179,26,"queryString"],[162,63,179,37],[162,65,179,39],[162,68,180,6,"PAYWALL_ROUTE"],[162,81,180,19],[164,4,182,2],[165,4,183,2],[167,4,185,2,"router"],[167,15,185,8],[167,16,185,8,"router"],[167,22,185,8],[167,23,185,9,"push"],[167,27,185,13],[167,28,185,14,"route"],[167,33,185,26],[167,34,185,27],[168,2,186,0],[170,2,188,0],[171,0,189,0],[172,0,190,0],[173,0,191,0],[174,2,192,7],[174,11,192,16,"goToStore"],[174,20,192,25,"goToStore"],[174,21,192,26,"source"],[174,27,192,48],[174,29,192,56],[175,4,193,2],[175,10,193,8,"normalizedSource"],[175,26,193,24],[175,29,193,27,"source"],[175,35,193,33],[175,38,193,36,"normalizeSource"],[175,53,193,51],[175,54,193,52,"source"],[175,60,193,58],[175,61,193,59],[175,64,193,62],[175,71,193,69],[176,4,194,2,"dlog"],[176,8,194,6],[176,9,194,7],[176,21,194,19],[176,23,194,21],[177,6,194,23,"source"],[177,12,194,29],[177,14,194,31,"normalizedSource"],[178,4,194,48],[178,5,194,49],[178,6,194,50],[179,4,196,2,"router"],[179,15,196,8],[179,16,196,8,"router"],[179,22,196,8],[179,23,196,9,"push"],[179,27,196,13],[179,28,196,14],[179,31,196,17,"STORE_ROUTE"],[179,42,196,28],[179,53,196,39,"normalizedSource"],[179,69,196,55],[179,71,196,64],[179,72,196,65],[180,2,197,0],[182,2,199,0],[183,0,200,0],[184,0,201,0],[185,2,202,7],[185,11,202,16,"goToPurchaseSuccess"],[185,30,202,35,"goToPurchaseSuccess"],[185,31,202,36,"opts"],[185,35,205,1],[185,37,205,9],[186,4,206,2,"dlog"],[186,8,206,6],[186,9,206,7],[186,31,206,29],[186,33,206,31,"opts"],[186,37,206,35],[186,38,206,36],[188,4,208,2],[189,4,209,2],[189,10,209,8,"cleanReturnTo"],[189,23,209,21],[189,26,209,24,"sanitizeReturnTo"],[189,42,209,40],[189,43,209,41,"opts"],[189,47,209,45],[189,49,209,47,"returnTo"],[189,57,209,55],[189,58,209,56],[191,4,211,2],[192,4,212,2],[193,4,213,2],[193,8,213,6,"cleanReturnTo"],[193,21,213,19],[193,23,213,21],[194,6,214,4,"router"],[194,17,214,10],[194,18,214,10,"router"],[194,24,214,10],[194,25,214,11,"replace"],[194,32,214,18],[194,33,214,19,"cleanReturnTo"],[194,46,214,39],[194,47,214,40],[195,4,215,2],[195,5,215,3],[195,11,215,9],[196,6,216,4,"router"],[196,17,216,10],[196,18,216,10,"router"],[196,24,216,10],[196,25,216,11,"back"],[196,29,216,15],[196,30,216,16],[196,31,216,17],[197,4,217,2],[198,2,218,0],[200,2,220,0],[201,0,221,0],[202,0,222,0],[203,0,223,0],[204,2,224,7],[204,11,224,16,"getPaywallRoute"],[204,26,224,31,"getPaywallRoute"],[204,27,224,31],[204,29,224,42],[205,4,225,2],[205,11,225,9,"PAYWALL_ROUTE"],[205,24,225,22],[206,2,226,0],[208,2,228,0],[209,0,229,0],[210,0,230,0],[211,0,231,0],[212,2,232,7],[212,11,232,16,"getStoreRoute"],[212,24,232,29,"getStoreRoute"],[212,25,232,29],[212,27,232,40],[213,4,233,2],[213,11,233,9,"STORE_ROUTE"],[213,22,233,20],[214,2,234,0],[215,0,234,1],[215,3]],"functionMap":{"names":["<global>","dlog","sanitizeReturnTo","normalizeSource","goToPaywall","goToStore","goToPurchaseSuccess","getPaywallRoute","getStoreRoute"],"mappings":"AAA;aCqB,0ED;AEiE;CFmB;AGK;CHS;OIoB;CJ8C;OKM;CLK;OMK;CNgB;OOM;CPE;OQM;CRE"},"hasCjsExports":false},"type":"js/module"}]}