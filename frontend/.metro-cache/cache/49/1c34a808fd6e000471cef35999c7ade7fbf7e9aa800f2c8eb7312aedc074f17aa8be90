{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"DEFAULT_RETRY_AFTER\", {\n    enumerable: true,\n    get: function () {\n      return DEFAULT_RETRY_AFTER;\n    }\n  });\n  Object.defineProperty(exports, \"disabledUntil\", {\n    enumerable: true,\n    get: function () {\n      return disabledUntil;\n    }\n  });\n  Object.defineProperty(exports, \"isRateLimited\", {\n    enumerable: true,\n    get: function () {\n      return isRateLimited;\n    }\n  });\n  Object.defineProperty(exports, \"parseRetryAfterHeader\", {\n    enumerable: true,\n    get: function () {\n      return parseRetryAfterHeader;\n    }\n  });\n  Object.defineProperty(exports, \"updateRateLimits\", {\n    enumerable: true,\n    get: function () {\n      return updateRateLimits;\n    }\n  });\n  // Intentionally keeping the key broad, as we don't know for sure what rate limit headers get returned from backend\n\n  const DEFAULT_RETRY_AFTER = 60 * 1000; // 60 seconds\n\n  /**\n   * Extracts Retry-After value from the request header or returns default value\n   * @param header string representation of 'Retry-After' header\n   * @param now current unix timestamp\n   *\n   */\n  function parseRetryAfterHeader(header, now = Date.now()) {\n    const headerDelay = parseInt(`${header}`, 10);\n    if (!isNaN(headerDelay)) {\n      return headerDelay * 1000;\n    }\n    const headerDate = Date.parse(`${header}`);\n    if (!isNaN(headerDate)) {\n      return headerDate - now;\n    }\n    return DEFAULT_RETRY_AFTER;\n  }\n\n  /**\n   * Gets the time that the given category is disabled until for rate limiting.\n   * In case no category-specific limit is set but a general rate limit across all categories is active,\n   * that time is returned.\n   *\n   * @return the time in ms that the category is disabled until or 0 if there's no active rate limit.\n   */\n  function disabledUntil(limits, category) {\n    return limits[category] || limits.all || 0;\n  }\n\n  /**\n   * Checks if a category is rate limited\n   */\n  function isRateLimited(limits, category, now = Date.now()) {\n    return disabledUntil(limits, category) > now;\n  }\n\n  /**\n   * Update ratelimits from incoming headers.\n   *\n   * @return the updated RateLimits object.\n   */\n  function updateRateLimits(limits, {\n    statusCode,\n    headers\n  }, now = Date.now()) {\n    const updatedRateLimits = Object.assign({}, limits);\n\n    // \"The name is case-insensitive.\"\n    // https://developer.mozilla.org/en-US/docs/Web/API/Headers/get\n    const rateLimitHeader = headers && headers['x-sentry-rate-limits'];\n    const retryAfterHeader = headers && headers['retry-after'];\n    if (rateLimitHeader) {\n      /**\n       * rate limit headers are of the form\n       *     <header>,<header>,..\n       * where each <header> is of the form\n       *     <retry_after>: <categories>: <scope>: <reason_code>\n       * where\n       *     <retry_after> is a delay in seconds\n       *     <categories> is the event type(s) (error, transaction, etc) being rate limited and is of the form\n       *         <category>;<category>;...\n       *     <scope> is what's being limited (org, project, or key) - ignored by SDK\n       *     <reason_code> is an arbitrary string like \"org_quota\" - ignored by SDK\n       */\n      for (const limit of rateLimitHeader.trim().split(',')) {\n        const [retryAfter, categories] = limit.split(':', 2);\n        const headerDelay = parseInt(retryAfter, 10);\n        const delay = (!isNaN(headerDelay) ? headerDelay : 60) * 1000; // 60sec default\n        if (!categories) {\n          updatedRateLimits.all = now + delay;\n        } else {\n          for (const category of categories.split(';')) {\n            updatedRateLimits[category] = now + delay;\n          }\n        }\n      }\n    } else if (retryAfterHeader) {\n      updatedRateLimits.all = now + parseRetryAfterHeader(retryAfterHeader, now);\n    } else if (statusCode === 429) {\n      updatedRateLimits.all = now + 60 * 1000;\n    }\n    return updatedRateLimits;\n  }\n});","lineCount":124,"map":[[7,2,96,0,"Object"],[7,8,96,0],[7,9,96,0,"defineProperty"],[7,23,96,0],[7,24,96,0,"exports"],[7,31,96,0],[8,4,96,0,"enumerable"],[8,14,96,0],[9,4,96,0,"get"],[9,7,96,0],[9,18,96,0,"get"],[9,19,96,0],[10,6,96,0],[10,13,96,9,"DEFAULT_RETRY_AFTER"],[10,32,96,28],[11,4,96,28],[12,2,96,28],[13,2,96,0,"Object"],[13,8,96,0],[13,9,96,0,"defineProperty"],[13,23,96,0],[13,24,96,0,"exports"],[13,31,96,0],[14,4,96,0,"enumerable"],[14,14,96,0],[15,4,96,0,"get"],[15,7,96,0],[15,18,96,0,"get"],[15,19,96,0],[16,6,96,0],[16,13,96,30,"disabledUntil"],[16,26,96,43],[17,4,96,43],[18,2,96,43],[19,2,96,0,"Object"],[19,8,96,0],[19,9,96,0,"defineProperty"],[19,23,96,0],[19,24,96,0,"exports"],[19,31,96,0],[20,4,96,0,"enumerable"],[20,14,96,0],[21,4,96,0,"get"],[21,7,96,0],[21,18,96,0,"get"],[21,19,96,0],[22,6,96,0],[22,13,96,45,"isRateLimited"],[22,26,96,58],[23,4,96,58],[24,2,96,58],[25,2,96,0,"Object"],[25,8,96,0],[25,9,96,0,"defineProperty"],[25,23,96,0],[25,24,96,0,"exports"],[25,31,96,0],[26,4,96,0,"enumerable"],[26,14,96,0],[27,4,96,0,"get"],[27,7,96,0],[27,18,96,0,"get"],[27,19,96,0],[28,6,96,0],[28,13,96,60,"parseRetryAfterHeader"],[28,34,96,81],[29,4,96,81],[30,2,96,81],[31,2,96,0,"Object"],[31,8,96,0],[31,9,96,0,"defineProperty"],[31,23,96,0],[31,24,96,0,"exports"],[31,31,96,0],[32,4,96,0,"enumerable"],[32,14,96,0],[33,4,96,0,"get"],[33,7,96,0],[33,18,96,0,"get"],[33,19,96,0],[34,6,96,0],[34,13,96,83,"updateRateLimits"],[34,29,96,99],[35,4,96,99],[36,2,96,99],[37,2,1,0],[39,2,3,0],[39,8,3,6,"DEFAULT_RETRY_AFTER"],[39,27,3,25],[39,30,3,28],[39,32,3,30],[39,35,3,33],[39,39,3,37],[39,40,3,38],[39,41,3,39],[41,2,5,0],[42,0,6,0],[43,0,7,0],[44,0,8,0],[45,0,9,0],[46,0,10,0],[47,2,11,0],[47,11,11,9,"parseRetryAfterHeader"],[47,32,11,30,"parseRetryAfterHeader"],[47,33,11,31,"header"],[47,39,11,37],[47,41,11,39,"now"],[47,44,11,42],[47,47,11,45,"Date"],[47,51,11,49],[47,52,11,50,"now"],[47,55,11,53],[47,56,11,54],[47,57,11,55],[47,59,11,57],[48,4,12,2],[48,10,12,8,"headerDelay"],[48,21,12,19],[48,24,12,22,"parseInt"],[48,32,12,30],[48,33,12,31],[48,36,12,34,"header"],[48,42,12,40],[48,44,12,42],[48,46,12,44],[48,48,12,46],[48,49,12,47],[49,4,13,2],[49,8,13,6],[49,9,13,7,"isNaN"],[49,14,13,12],[49,15,13,13,"headerDelay"],[49,26,13,24],[49,27,13,25],[49,29,13,27],[50,6,14,4],[50,13,14,11,"headerDelay"],[50,24,14,22],[50,27,14,25],[50,31,14,29],[51,4,15,2],[52,4,17,2],[52,10,17,8,"headerDate"],[52,20,17,18],[52,23,17,21,"Date"],[52,27,17,25],[52,28,17,26,"parse"],[52,33,17,31],[52,34,17,32],[52,37,17,35,"header"],[52,43,17,41],[52,45,17,43],[52,46,17,44],[53,4,18,2],[53,8,18,6],[53,9,18,7,"isNaN"],[53,14,18,12],[53,15,18,13,"headerDate"],[53,25,18,23],[53,26,18,24],[53,28,18,26],[54,6,19,4],[54,13,19,11,"headerDate"],[54,23,19,21],[54,26,19,24,"now"],[54,29,19,27],[55,4,20,2],[56,4,22,2],[56,11,22,9,"DEFAULT_RETRY_AFTER"],[56,30,22,28],[57,2,23,0],[59,2,25,0],[60,0,26,0],[61,0,27,0],[62,0,28,0],[63,0,29,0],[64,0,30,0],[65,0,31,0],[66,2,32,0],[66,11,32,9,"disabledUntil"],[66,24,32,22,"disabledUntil"],[66,25,32,23,"limits"],[66,31,32,29],[66,33,32,31,"category"],[66,41,32,39],[66,43,32,41],[67,4,33,2],[67,11,33,9,"limits"],[67,17,33,15],[67,18,33,16,"category"],[67,26,33,24],[67,27,33,25],[67,31,33,29,"limits"],[67,37,33,35],[67,38,33,36,"all"],[67,41,33,39],[67,45,33,43],[67,46,33,44],[68,2,34,0],[70,2,36,0],[71,0,37,0],[72,0,38,0],[73,2,39,0],[73,11,39,9,"isRateLimited"],[73,24,39,22,"isRateLimited"],[73,25,39,23,"limits"],[73,31,39,29],[73,33,39,31,"category"],[73,41,39,39],[73,43,39,41,"now"],[73,46,39,44],[73,49,39,47,"Date"],[73,53,39,51],[73,54,39,52,"now"],[73,57,39,55],[73,58,39,56],[73,59,39,57],[73,61,39,59],[74,4,40,2],[74,11,40,9,"disabledUntil"],[74,24,40,22],[74,25,40,23,"limits"],[74,31,40,29],[74,33,40,31,"category"],[74,41,40,39],[74,42,40,40],[74,45,40,43,"now"],[74,48,40,46],[75,2,41,0],[77,2,43,0],[78,0,44,0],[79,0,45,0],[80,0,46,0],[81,0,47,0],[82,2,48,0],[82,11,48,9,"updateRateLimits"],[82,27,48,25,"updateRateLimits"],[82,28,49,2,"limits"],[82,34,49,8],[82,36,50,2],[83,4,50,4,"statusCode"],[83,14,50,14],[84,4,50,16,"headers"],[85,2,50,24],[85,3,50,25],[85,5,51,2,"now"],[85,8,51,5],[85,11,51,8,"Date"],[85,15,51,12],[85,16,51,13,"now"],[85,19,51,16],[85,20,51,17],[85,21,51,18],[85,23,52,2],[86,4,53,2],[86,10,53,8,"updatedRateLimits"],[86,27,53,25],[86,30,53,25,"Object"],[86,36,53,25],[86,37,53,25,"assign"],[86,43,53,25],[86,48,54,7,"limits"],[86,54,54,13],[86,55,55,3],[88,4,57,2],[89,4,58,2],[90,4,59,2],[90,10,59,8,"rateLimitHeader"],[90,25,59,23],[90,28,59,26,"headers"],[90,35,59,33],[90,39,59,37,"headers"],[90,46,59,44],[90,47,59,45],[90,69,59,67],[90,70,59,68],[91,4,60,2],[91,10,60,8,"retryAfterHeader"],[91,26,60,24],[91,29,60,27,"headers"],[91,36,60,34],[91,40,60,38,"headers"],[91,47,60,45],[91,48,60,46],[91,61,60,59],[91,62,60,60],[92,4,62,2],[92,8,62,6,"rateLimitHeader"],[92,23,62,21],[92,25,62,23],[93,6,63,4],[94,0,64,0],[95,0,65,0],[96,0,66,0],[97,0,67,0],[98,0,68,0],[99,0,69,0],[100,0,70,0],[101,0,71,0],[102,0,72,0],[103,0,73,0],[104,0,74,0],[105,6,75,4],[105,11,75,9],[105,17,75,15,"limit"],[105,22,75,20],[105,26,75,24,"rateLimitHeader"],[105,41,75,39],[105,42,75,40,"trim"],[105,46,75,44],[105,47,75,45],[105,48,75,46],[105,49,75,47,"split"],[105,54,75,52],[105,55,75,53],[105,58,75,56],[105,59,75,57],[105,61,75,59],[106,8,76,6],[106,14,76,12],[106,15,76,13,"retryAfter"],[106,25,76,23],[106,27,76,25,"categories"],[106,37,76,35],[106,38,76,36],[106,41,76,39,"limit"],[106,46,76,44],[106,47,76,45,"split"],[106,52,76,50],[106,53,76,51],[106,56,76,54],[106,58,76,56],[106,59,76,57],[106,60,76,58],[107,8,77,6],[107,14,77,12,"headerDelay"],[107,25,77,23],[107,28,77,26,"parseInt"],[107,36,77,34],[107,37,77,35,"retryAfter"],[107,47,77,45],[107,49,77,47],[107,51,77,49],[107,52,77,50],[108,8,78,6],[108,14,78,12,"delay"],[108,19,78,17],[108,22,78,20],[108,23,78,21],[108,24,78,22,"isNaN"],[108,29,78,27],[108,30,78,28,"headerDelay"],[108,41,78,39],[108,42,78,40],[108,45,78,43,"headerDelay"],[108,56,78,54],[108,59,78,57],[108,61,78,59],[108,65,78,63],[108,69,78,67],[108,70,78,68],[108,71,78,69],[109,8,79,6],[109,12,79,10],[109,13,79,11,"categories"],[109,23,79,21],[109,25,79,23],[110,10,80,8,"updatedRateLimits"],[110,27,80,25],[110,28,80,26,"all"],[110,31,80,29],[110,34,80,32,"now"],[110,37,80,35],[110,40,80,38,"delay"],[110,45,80,43],[111,8,81,6],[111,9,81,7],[111,15,81,13],[112,10,82,8],[112,15,82,13],[112,21,82,19,"category"],[112,29,82,27],[112,33,82,31,"categories"],[112,43,82,41],[112,44,82,42,"split"],[112,49,82,47],[112,50,82,48],[112,53,82,51],[112,54,82,52],[112,56,82,54],[113,12,83,10,"updatedRateLimits"],[113,29,83,27],[113,30,83,28,"category"],[113,38,83,36],[113,39,83,37],[113,42,83,40,"now"],[113,45,83,43],[113,48,83,46,"delay"],[113,53,83,51],[114,10,84,8],[115,8,85,6],[116,6,86,4],[117,4,87,2],[117,5,87,3],[117,11,87,9],[117,15,87,13,"retryAfterHeader"],[117,31,87,29],[117,33,87,31],[118,6,88,4,"updatedRateLimits"],[118,23,88,21],[118,24,88,22,"all"],[118,27,88,25],[118,30,88,28,"now"],[118,33,88,31],[118,36,88,34,"parseRetryAfterHeader"],[118,57,88,55],[118,58,88,56,"retryAfterHeader"],[118,74,88,72],[118,76,88,74,"now"],[118,79,88,77],[118,80,88,78],[119,4,89,2],[119,5,89,3],[119,11,89,9],[119,15,89,13,"statusCode"],[119,25,89,23],[119,30,89,28],[119,33,89,31],[119,35,89,33],[120,6,90,4,"updatedRateLimits"],[120,23,90,21],[120,24,90,22,"all"],[120,27,90,25],[120,30,90,28,"now"],[120,33,90,31],[120,36,90,34],[120,38,90,36],[120,41,90,39],[120,45,90,43],[121,4,91,2],[122,4,93,2],[122,11,93,9,"updatedRateLimits"],[122,28,93,26],[123,2,94,0],[124,0,94,1],[124,3]],"functionMap":{"names":["<global>","parseRetryAfterHeader","disabledUntil","isRateLimited","updateRateLimits"],"mappings":"AAA;ACU;CDY;AES;CFE;AGK;CHE;AIO;CJ8C"},"hasCjsExports":false},"type":"js/module"}]}