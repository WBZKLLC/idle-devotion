{"dependencies":[{"name":"./lib/bindReporter.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":21,"index":85},"end":{"line":3,"column":53,"index":117}}],"key":"xKmA94sAhtZQYO98ftMHq88nPKQ=","exportNames":["*"],"imports":1}},{"name":"./lib/initMetric.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":19,"index":138},"end":{"line":4,"column":49,"index":168}}],"key":"njevEqeFK+/xQTCDa0xtuGux8DY=","exportNames":["*"],"imports":1}},{"name":"./lib/observe.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":16,"index":186},"end":{"line":5,"column":43,"index":213}}],"key":"QDJQmviNIvdbbOYvTEjZYzZJeJI=","exportNames":["*"],"imports":1}},{"name":"./lib/onHidden.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":17,"index":232},"end":{"line":6,"column":45,"index":260}}],"key":"AB9tXPaqUfoJhofw95m1PM+P+Oo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  const bindReporter = require(_dependencyMap[0], \"./lib/bindReporter.js\");\n  const initMetric = require(_dependencyMap[1], \"./lib/initMetric.js\");\n  const observe = require(_dependencyMap[2], \"./lib/observe.js\");\n  const onHidden = require(_dependencyMap[3], \"./lib/onHidden.js\");\n\n  /*\n   * Copyright 2020 Google LLC\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *     https://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  /**\n   * Calculates the [CLS](https://web.dev/cls/) value for the current page and\n   * calls the `callback` function once the value is ready to be reported, along\n   * with all `layout-shift` performance entries that were used in the metric\n   * value calculation. The reported value is a `double` (corresponding to a\n   * [layout shift score](https://web.dev/cls/#layout-shift-score)).\n   *\n   * If the `reportAllChanges` configuration option is set to `true`, the\n   * `callback` function will be called as soon as the value is initially\n   * determined as well as any time the value changes throughout the page\n   * lifespan.\n   *\n   * _**Important:** CLS should be continually monitored for changes throughout\n   * the entire lifespan of a pageâ€”including if the user returns to the page after\n   * it's been hidden/backgrounded. However, since browsers often [will not fire\n   * additional callbacks once the user has backgrounded a\n   * page](https://developer.chrome.com/blog/page-lifecycle-api/#advice-hidden),\n   * `callback` is always called when the page's visibility state changes to\n   * hidden. As a result, the `callback` function might be called multiple times\n   * during the same page load._\n   */\n  const onCLS = onReport => {\n    const metric = initMetric.initMetric('CLS', 0);\n    let report;\n    let sessionValue = 0;\n    let sessionEntries = [];\n\n    // const handleEntries = (entries: Metric['entries']) => {\n    const handleEntries = entries => {\n      entries.forEach(entry => {\n        // Only count layout shifts without recent user input.\n        if (!entry.hadRecentInput) {\n          const firstSessionEntry = sessionEntries[0];\n          const lastSessionEntry = sessionEntries[sessionEntries.length - 1];\n\n          // If the entry occurred less than 1 second after the previous entry and\n          // less than 5 seconds after the first entry in the session, include the\n          // entry in the current session. Otherwise, start a new session.\n          if (sessionValue && sessionEntries.length !== 0 && entry.startTime - lastSessionEntry.startTime < 1000 && entry.startTime - firstSessionEntry.startTime < 5000) {\n            sessionValue += entry.value;\n            sessionEntries.push(entry);\n          } else {\n            sessionValue = entry.value;\n            sessionEntries = [entry];\n          }\n\n          // If the current session value is larger than the current CLS value,\n          // update CLS and the entries contributing to it.\n          if (sessionValue > metric.value) {\n            metric.value = sessionValue;\n            metric.entries = sessionEntries;\n            if (report) {\n              report();\n            }\n          }\n        }\n      });\n    };\n    const po = observe.observe('layout-shift', handleEntries);\n    if (po) {\n      report = bindReporter.bindReporter(onReport, metric);\n      const stopListening = () => {\n        handleEntries(po.takeRecords());\n        report(true);\n      };\n      onHidden.onHidden(stopListening);\n      return stopListening;\n    }\n    return;\n  };\n  exports.onCLS = onCLS;\n});","lineCount":97,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,8,3,6,"bindReporter"],[5,20,3,18],[5,23,3,21,"require"],[5,30,3,28],[5,31,3,28,"_dependencyMap"],[5,45,3,28],[5,73,3,52],[5,74,3,53],[6,2,4,0],[6,8,4,6,"initMetric"],[6,18,4,16],[6,21,4,19,"require"],[6,28,4,26],[6,29,4,26,"_dependencyMap"],[6,43,4,26],[6,69,4,48],[6,70,4,49],[7,2,5,0],[7,8,5,6,"observe"],[7,15,5,13],[7,18,5,16,"require"],[7,25,5,23],[7,26,5,23,"_dependencyMap"],[7,40,5,23],[7,63,5,42],[7,64,5,43],[8,2,6,0],[8,8,6,6,"onHidden"],[8,16,6,14],[8,19,6,17,"require"],[8,26,6,24],[8,27,6,24,"_dependencyMap"],[8,41,6,24],[8,65,6,44],[8,66,6,45],[10,2,8,0],[11,0,9,0],[12,0,10,0],[13,0,11,0],[14,0,12,0],[15,0,13,0],[16,0,14,0],[17,0,15,0],[18,0,16,0],[19,0,17,0],[20,0,18,0],[21,0,19,0],[22,0,20,0],[23,0,21,0],[24,0,22,0],[26,2,24,0],[27,0,25,0],[28,0,26,0],[29,0,27,0],[30,0,28,0],[31,0,29,0],[32,0,30,0],[33,0,31,0],[34,0,32,0],[35,0,33,0],[36,0,34,0],[37,0,35,0],[38,0,36,0],[39,0,37,0],[40,0,38,0],[41,0,39,0],[42,0,40,0],[43,0,41,0],[44,0,42,0],[45,0,43,0],[46,0,44,0],[47,2,45,0],[47,8,45,6,"onCLS"],[47,13,45,11],[47,16,45,15,"onReport"],[47,24,45,23],[47,28,45,28],[48,4,46,2],[48,10,46,8,"metric"],[48,16,46,14],[48,19,46,17,"initMetric"],[48,29,46,27],[48,30,46,28,"initMetric"],[48,40,46,38],[48,41,46,39],[48,46,46,44],[48,48,46,46],[48,49,46,47],[48,50,46,48],[49,4,47,2],[49,8,47,6,"report"],[49,14,47,12],[50,4,49,2],[50,8,49,6,"sessionValue"],[50,20,49,18],[50,23,49,21],[50,24,49,22],[51,4,50,2],[51,8,50,6,"sessionEntries"],[51,22,50,20],[51,25,50,23],[51,27,50,25],[53,4,52,2],[54,4,53,2],[54,10,53,8,"handleEntries"],[54,23,53,21],[54,26,53,25,"entries"],[54,33,53,32],[54,37,53,37],[55,6,54,4,"entries"],[55,13,54,11],[55,14,54,12,"forEach"],[55,21,54,19],[55,22,54,20,"entry"],[55,27,54,25],[55,31,54,29],[56,8,55,6],[57,8,56,6],[57,12,56,10],[57,13,56,11,"entry"],[57,18,56,16],[57,19,56,17,"hadRecentInput"],[57,33,56,31],[57,35,56,33],[58,10,57,8],[58,16,57,14,"firstSessionEntry"],[58,33,57,31],[58,36,57,34,"sessionEntries"],[58,50,57,48],[58,51,57,49],[58,52,57,50],[58,53,57,51],[59,10,58,8],[59,16,58,14,"lastSessionEntry"],[59,32,58,30],[59,35,58,33,"sessionEntries"],[59,49,58,47],[59,50,58,48,"sessionEntries"],[59,64,58,62],[59,65,58,63,"length"],[59,71,58,69],[59,74,58,72],[59,75,58,73],[59,76,58,74],[61,10,60,8],[62,10,61,8],[63,10,62,8],[64,10,63,8],[64,14,64,10,"sessionValue"],[64,26,64,22],[64,30,65,10,"sessionEntries"],[64,44,65,24],[64,45,65,25,"length"],[64,51,65,31],[64,56,65,36],[64,57,65,37],[64,61,66,10,"entry"],[64,66,66,15],[64,67,66,16,"startTime"],[64,76,66,25],[64,79,66,28,"lastSessionEntry"],[64,95,66,44],[64,96,66,45,"startTime"],[64,105,66,54],[64,108,66,57],[64,112,66,61],[64,116,67,10,"entry"],[64,121,67,15],[64,122,67,16,"startTime"],[64,131,67,25],[64,134,67,28,"firstSessionEntry"],[64,151,67,45],[64,152,67,46,"startTime"],[64,161,67,55],[64,164,67,58],[64,168,67,62],[64,170,68,10],[65,12,69,10,"sessionValue"],[65,24,69,22],[65,28,69,26,"entry"],[65,33,69,31],[65,34,69,32,"value"],[65,39,69,37],[66,12,70,10,"sessionEntries"],[66,26,70,24],[66,27,70,25,"push"],[66,31,70,29],[66,32,70,30,"entry"],[66,37,70,35],[66,38,70,36],[67,10,71,8],[67,11,71,9],[67,17,71,15],[68,12,72,10,"sessionValue"],[68,24,72,22],[68,27,72,25,"entry"],[68,32,72,30],[68,33,72,31,"value"],[68,38,72,36],[69,12,73,10,"sessionEntries"],[69,26,73,24],[69,29,73,27],[69,30,73,28,"entry"],[69,35,73,33],[69,36,73,34],[70,10,74,8],[72,10,76,8],[73,10,77,8],[74,10,78,8],[74,14,78,12,"sessionValue"],[74,26,78,24],[74,29,78,27,"metric"],[74,35,78,33],[74,36,78,34,"value"],[74,41,78,39],[74,43,78,41],[75,12,79,10,"metric"],[75,18,79,16],[75,19,79,17,"value"],[75,24,79,22],[75,27,79,25,"sessionValue"],[75,39,79,37],[76,12,80,10,"metric"],[76,18,80,16],[76,19,80,17,"entries"],[76,26,80,24],[76,29,80,27,"sessionEntries"],[76,43,80,41],[77,12,81,10],[77,16,81,14,"report"],[77,22,81,20],[77,24,81,22],[78,14,82,12,"report"],[78,20,82,18],[78,21,82,19],[78,22,82,20],[79,12,83,10],[80,10,84,8],[81,8,85,6],[82,6,86,4],[82,7,86,5],[82,8,86,6],[83,4,87,2],[83,5,87,3],[84,4,89,2],[84,10,89,8,"po"],[84,12,89,10],[84,15,89,13,"observe"],[84,22,89,20],[84,23,89,21,"observe"],[84,30,89,28],[84,31,89,29],[84,45,89,43],[84,47,89,45,"handleEntries"],[84,60,89,58],[84,61,89,59],[85,4,90,2],[85,8,90,6,"po"],[85,10,90,8],[85,12,90,10],[86,6,91,4,"report"],[86,12,91,10],[86,15,91,13,"bindReporter"],[86,27,91,25],[86,28,91,26,"bindReporter"],[86,40,91,38],[86,41,91,39,"onReport"],[86,49,91,47],[86,51,91,49,"metric"],[86,57,91,55],[86,58,91,56],[87,6,93,4],[87,12,93,10,"stopListening"],[87,25,93,23],[87,28,93,26,"stopListening"],[87,29,93,26],[87,34,93,32],[88,8,94,6,"handleEntries"],[88,21,94,19],[88,22,94,20,"po"],[88,24,94,22],[88,25,94,23,"takeRecords"],[88,36,94,34],[88,37,94,35],[88,38,94,37],[88,39,94,38],[89,8,95,6,"report"],[89,14,95,12],[89,15,95,13],[89,19,95,17],[89,20,95,18],[90,6,96,4],[90,7,96,5],[91,6,98,4,"onHidden"],[91,14,98,12],[91,15,98,13,"onHidden"],[91,23,98,21],[91,24,98,22,"stopListening"],[91,37,98,35],[91,38,98,36],[92,6,100,4],[92,13,100,11,"stopListening"],[92,26,100,24],[93,4,101,2],[94,4,103,2],[95,2,104,0],[95,3,104,1],[96,2,106,0,"exports"],[96,9,106,7],[96,10,106,8,"onCLS"],[96,15,106,13],[96,18,106,16,"onCLS"],[96,23,106,21],[97,0,106,22],[97,3]],"functionMap":{"names":["<global>","onCLS","handleEntries","entries.forEach$argument_0","stopListening"],"mappings":"AAA;cC4C;wBCQ;oBCC;KDgC;GDC;0BGM;KHG;CDQ"},"hasCjsExports":true},"type":"js/module"}]}