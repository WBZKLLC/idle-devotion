{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":14,"index":78},"end":{"line":3,"column":38,"index":102}}],"key":"ud8OE6Lg8Q81+bS6ynZj2uyMPdA=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _asyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\").default;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  var utils = require(_dependencyMap[1], \"@sentry/utils\");\n  var MIN_DELAY = 100; // 100 ms\n  var START_DELAY = 5000; // 5 seconds\n  var MAX_DELAY = 3.6e6; // 1 hour\n\n  function log(msg, error) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && utils.logger.info(`[Offline]: ${msg}`, error);\n  }\n\n  /**\n   * Wraps a transport and stores and retries events when they fail to send.\n   *\n   * @param createTransport The transport to wrap.\n   */\n  function makeOfflineTransport(createTransport) {\n    return options => {\n      var transport = createTransport(options);\n      var store = options.createStore ? options.createStore(options) : undefined;\n      var retryDelay = START_DELAY;\n      var flushTimer;\n      function shouldQueue(env, error, retryDelay) {\n        // We don't queue Session Replay envelopes because they are:\n        // - Ordered and Replay relies on the response status to know when they're successfully sent.\n        // - Likely to fill the queue quickly and block other events from being sent.\n        // We also want to drop client reports because they can be generated when we retry sending events while offline.\n        if (utils.envelopeContainsItemType(env, ['replay_event', 'replay_recording', 'client_report'])) {\n          return false;\n        }\n        if (options.shouldStore) {\n          return options.shouldStore(env, error, retryDelay);\n        }\n        return true;\n      }\n      function flushIn(delay) {\n        if (!store) {\n          return;\n        }\n        if (flushTimer) {\n          clearTimeout(flushTimer);\n        }\n        flushTimer = setTimeout(/*#__PURE__*/_asyncToGenerator(function* () {\n          flushTimer = undefined;\n          var found = yield store.pop();\n          if (found) {\n            log('Attempting to send previously queued event');\n            void send(found).catch(e => {\n              log('Failed to retry sending', e);\n            });\n          }\n        }), delay);\n\n        // We need to unref the timer in node.js, otherwise the node process never exit.\n        if (typeof flushTimer !== 'number' && flushTimer.unref) {\n          flushTimer.unref();\n        }\n      }\n      function flushWithBackOff() {\n        if (flushTimer) {\n          return;\n        }\n        flushIn(retryDelay);\n        retryDelay = Math.min(retryDelay * 2, MAX_DELAY);\n      }\n      function send(_x) {\n        return _send.apply(this, arguments);\n      }\n      function _send() {\n        _send = _asyncToGenerator(function* (envelope) {\n          try {\n            var result = yield transport.send(envelope);\n            var delay = MIN_DELAY;\n            if (result) {\n              // If there's a retry-after header, use that as the next delay.\n              if (result.headers && result.headers['retry-after']) {\n                delay = utils.parseRetryAfterHeader(result.headers['retry-after']);\n              } // If we have a server error, return now so we don't flush the queue.\n              else if ((result.statusCode || 0) >= 400) {\n                return result;\n              }\n            }\n            flushIn(delay);\n            retryDelay = START_DELAY;\n            return result;\n          } catch (e) {\n            if (store && (yield shouldQueue(envelope, e, retryDelay))) {\n              yield store.insert(envelope);\n              flushWithBackOff();\n              log('Error sending. Event queued', e);\n              return {};\n            } else {\n              throw e;\n            }\n          }\n        });\n        return _send.apply(this, arguments);\n      }\n      if (options.flushAtStartup) {\n        flushWithBackOff();\n      }\n      return {\n        send,\n        flush: t => transport.flush(t)\n      };\n    };\n  }\n  exports.MIN_DELAY = MIN_DELAY;\n  exports.START_DELAY = START_DELAY;\n  exports.makeOfflineTransport = makeOfflineTransport;\n});","lineCount":114,"map":[[3,2,1,0,"Object"],[3,8,1,6],[3,9,1,7,"defineProperty"],[3,23,1,21],[3,24,1,22,"exports"],[3,31,1,29],[3,33,1,31],[3,45,1,43],[3,47,1,45],[4,4,1,47,"value"],[4,9,1,52],[4,11,1,54],[5,2,1,59],[5,3,1,60],[5,4,1,61],[6,2,3,0],[6,6,3,6,"utils"],[6,11,3,11],[6,14,3,14,"require"],[6,21,3,21],[6,22,3,21,"_dependencyMap"],[6,36,3,21],[6,56,3,37],[6,57,3,38],[7,2,5,0],[7,6,5,6,"MIN_DELAY"],[7,15,5,15],[7,18,5,18],[7,21,5,21],[7,22,5,22],[7,23,5,23],[8,2,6,0],[8,6,6,6,"START_DELAY"],[8,17,6,17],[8,20,6,20],[8,24,6,24],[8,25,6,25],[8,26,6,26],[9,2,7,0],[9,6,7,6,"MAX_DELAY"],[9,15,7,15],[9,18,7,18],[9,23,7,23],[9,24,7,24],[9,25,7,25],[11,2,9,0],[11,11,9,9,"log"],[11,14,9,12,"log"],[11,15,9,13,"msg"],[11,18,9,16],[11,20,9,18,"error"],[11,25,9,23],[11,27,9,25],[12,4,10,2],[12,5,10,3],[12,12,10,10,"__SENTRY_DEBUG__"],[12,28,10,26],[12,33,10,31],[12,44,10,42],[12,48,10,46,"__SENTRY_DEBUG__"],[12,64,10,62],[12,69,10,67,"utils"],[12,74,10,72],[12,75,10,73,"logger"],[12,81,10,79],[12,82,10,80,"info"],[12,86,10,84],[12,87,10,85],[12,101,10,99,"msg"],[12,104,10,102],[12,106,10,104],[12,108,10,106,"error"],[12,113,10,111],[12,114,10,112],[13,2,11,0],[15,2,13,0],[16,0,14,0],[17,0,15,0],[18,0,16,0],[19,0,17,0],[20,2,18,0],[20,11,18,9,"makeOfflineTransport"],[20,31,18,29,"makeOfflineTransport"],[20,32,19,2,"createTransport"],[20,47,19,17],[20,49,20,2],[21,4,21,2],[21,11,21,9,"options"],[21,18,21,16],[21,22,21,20],[22,6,22,4],[22,10,22,10,"transport"],[22,19,22,19],[22,22,22,22,"createTransport"],[22,37,22,37],[22,38,22,38,"options"],[22,45,22,45],[22,46,22,46],[23,6,23,4],[23,10,23,10,"store"],[23,15,23,15],[23,18,23,18,"options"],[23,25,23,25],[23,26,23,26,"createStore"],[23,37,23,37],[23,40,23,40,"options"],[23,47,23,47],[23,48,23,48,"createStore"],[23,59,23,59],[23,60,23,60,"options"],[23,67,23,67],[23,68,23,68],[23,71,23,71,"undefined"],[23,80,23,80],[24,6,25,4],[24,10,25,8,"retryDelay"],[24,20,25,18],[24,23,25,21,"START_DELAY"],[24,34,25,32],[25,6,26,4],[25,10,26,8,"flushTimer"],[25,20,26,18],[26,6,28,4],[26,15,28,13,"shouldQueue"],[26,26,28,24,"shouldQueue"],[26,27,28,25,"env"],[26,30,28,28],[26,32,28,30,"error"],[26,37,28,35],[26,39,28,37,"retryDelay"],[26,49,28,47],[26,51,28,49],[27,8,29,6],[28,8,30,6],[29,8,31,6],[30,8,32,6],[31,8,33,6],[31,12,33,10,"utils"],[31,17,33,15],[31,18,33,16,"envelopeContainsItemType"],[31,42,33,40],[31,43,33,41,"env"],[31,46,33,44],[31,48,33,46],[31,49,33,47],[31,63,33,61],[31,65,33,63],[31,83,33,81],[31,85,33,83],[31,100,33,98],[31,101,33,99],[31,102,33,100],[31,104,33,102],[32,10,34,8],[32,17,34,15],[32,22,34,20],[33,8,35,6],[34,8,37,6],[34,12,37,10,"options"],[34,19,37,17],[34,20,37,18,"shouldStore"],[34,31,37,29],[34,33,37,31],[35,10,38,8],[35,17,38,15,"options"],[35,24,38,22],[35,25,38,23,"shouldStore"],[35,36,38,34],[35,37,38,35,"env"],[35,40,38,38],[35,42,38,40,"error"],[35,47,38,45],[35,49,38,47,"retryDelay"],[35,59,38,57],[35,60,38,58],[36,8,39,6],[37,8,41,6],[37,15,41,13],[37,19,41,17],[38,6,42,4],[39,6,44,4],[39,15,44,13,"flushIn"],[39,22,44,20,"flushIn"],[39,23,44,21,"delay"],[39,28,44,26],[39,30,44,28],[40,8,45,6],[40,12,45,10],[40,13,45,11,"store"],[40,18,45,16],[40,20,45,18],[41,10,46,8],[42,8,47,6],[43,8,49,6],[43,12,49,10,"flushTimer"],[43,22,49,20],[43,24,49,22],[44,10,50,8,"clearTimeout"],[44,22,50,20],[44,23,50,21,"flushTimer"],[44,33,50,32],[44,34,50,33],[45,8,51,6],[46,8,53,6,"flushTimer"],[46,18,53,16],[46,21,53,19,"setTimeout"],[46,31,53,29],[46,45,53,29,"_asyncToGenerator"],[46,62,53,29],[46,63,53,30],[46,76,53,42],[47,10,54,8,"flushTimer"],[47,20,54,18],[47,23,54,21,"undefined"],[47,32,54,30],[48,10,56,8],[48,14,56,14,"found"],[48,19,56,19],[48,28,56,28,"store"],[48,33,56,33],[48,34,56,34,"pop"],[48,37,56,37],[48,38,56,38],[48,39,56,39],[49,10,57,8],[49,14,57,12,"found"],[49,19,57,17],[49,21,57,19],[50,12,58,10,"log"],[50,15,58,13],[50,16,58,14],[50,60,58,58],[50,61,58,59],[51,12,59,10],[51,17,59,15,"send"],[51,21,59,19],[51,22,59,20,"found"],[51,27,59,25],[51,28,59,26],[51,29,59,27,"catch"],[51,34,59,32],[51,35,59,33,"e"],[51,36,59,34],[51,40,59,38],[52,14,60,12,"log"],[52,17,60,15],[52,18,60,16],[52,43,60,41],[52,45,60,43,"e"],[52,46,60,44],[52,47,60,45],[53,12,61,10],[53,13,61,11],[53,14,61,12],[54,10,62,8],[55,8,63,6],[55,9,63,7],[55,12,63,9,"delay"],[55,17,63,14],[55,18,63,15],[57,8,65,6],[58,8,66,6],[58,12,66,10],[58,19,66,17,"flushTimer"],[58,29,66,27],[58,34,66,32],[58,42,66,40],[58,46,66,44,"flushTimer"],[58,56,66,54],[58,57,66,55,"unref"],[58,62,66,60],[58,64,66,62],[59,10,67,8,"flushTimer"],[59,20,67,18],[59,21,67,19,"unref"],[59,26,67,24],[59,27,67,25],[59,28,67,26],[60,8,68,6],[61,6,69,4],[62,6,71,4],[62,15,71,13,"flushWithBackOff"],[62,31,71,29,"flushWithBackOff"],[62,32,71,29],[62,34,71,32],[63,8,72,6],[63,12,72,10,"flushTimer"],[63,22,72,20],[63,24,72,22],[64,10,73,8],[65,8,74,6],[66,8,76,6,"flushIn"],[66,15,76,13],[66,16,76,14,"retryDelay"],[66,26,76,24],[66,27,76,25],[67,8,78,6,"retryDelay"],[67,18,78,16],[67,21,78,19,"Math"],[67,25,78,23],[67,26,78,24,"min"],[67,29,78,27],[67,30,78,28,"retryDelay"],[67,40,78,38],[67,43,78,41],[67,44,78,42],[67,46,78,44,"MAX_DELAY"],[67,55,78,53],[67,56,78,54],[68,6,79,4],[69,6,79,5],[69,15,81,19,"send"],[69,19,81,23,"send"],[69,20,81,23,"_x"],[69,22,81,23],[70,8,81,23],[70,15,81,23,"_send"],[70,20,81,23],[70,21,81,23,"apply"],[70,26,81,23],[70,33,81,23,"arguments"],[70,42,81,23],[71,6,81,23],[72,6,81,23],[72,15,81,23,"_send"],[72,21,81,23],[73,8,81,23,"_send"],[73,13,81,23],[73,16,81,23,"_asyncToGenerator"],[73,33,81,23],[73,34,81,4],[73,45,81,24,"envelope"],[73,53,81,32],[73,55,81,34],[74,10,82,6],[74,14,82,10],[75,12,83,8],[75,16,83,14,"result"],[75,22,83,20],[75,31,83,29,"transport"],[75,40,83,38],[75,41,83,39,"send"],[75,45,83,43],[75,46,83,44,"envelope"],[75,54,83,52],[75,55,83,53],[76,12,85,8],[76,16,85,12,"delay"],[76,21,85,17],[76,24,85,20,"MIN_DELAY"],[76,33,85,29],[77,12,87,8],[77,16,87,12,"result"],[77,22,87,18],[77,24,87,20],[78,14,88,10],[79,14,89,10],[79,18,89,14,"result"],[79,24,89,20],[79,25,89,21,"headers"],[79,32,89,28],[79,36,89,32,"result"],[79,42,89,38],[79,43,89,39,"headers"],[79,50,89,46],[79,51,89,47],[79,64,89,60],[79,65,89,61],[79,67,89,63],[80,16,90,12,"delay"],[80,21,90,17],[80,24,90,20,"utils"],[80,29,90,25],[80,30,90,26,"parseRetryAfterHeader"],[80,51,90,47],[80,52,90,48,"result"],[80,58,90,54],[80,59,90,55,"headers"],[80,66,90,62],[80,67,90,63],[80,80,90,76],[80,81,90,77],[80,82,90,78],[81,14,91,10],[81,15,91,11],[81,16,91,12],[82,14,91,12],[82,19,92,15],[82,23,92,19],[82,24,92,20,"result"],[82,30,92,26],[82,31,92,27,"statusCode"],[82,41,92,37],[82,45,92,41],[82,46,92,42],[82,51,92,47],[82,54,92,50],[82,56,92,52],[83,16,93,12],[83,23,93,19,"result"],[83,29,93,25],[84,14,94,10],[85,12,95,8],[86,12,97,8,"flushIn"],[86,19,97,15],[86,20,97,16,"delay"],[86,25,97,21],[86,26,97,22],[87,12,98,8,"retryDelay"],[87,22,98,18],[87,25,98,21,"START_DELAY"],[87,36,98,32],[88,12,99,8],[88,19,99,15,"result"],[88,25,99,21],[89,10,100,6],[89,11,100,7],[89,12,100,8],[89,19,100,15,"e"],[89,20,100,16],[89,22,100,18],[90,12,101,8],[90,16,101,12,"store"],[90,21,101,17],[90,32,101,28,"shouldQueue"],[90,43,101,39],[90,44,101,40,"envelope"],[90,52,101,48],[90,54,101,50,"e"],[90,55,101,51],[90,57,101,54,"retryDelay"],[90,67,101,64],[90,68,101,65],[90,69,101,66],[90,71,101,68],[91,14,102,10],[91,20,102,16,"store"],[91,25,102,21],[91,26,102,22,"insert"],[91,32,102,28],[91,33,102,29,"envelope"],[91,41,102,37],[91,42,102,38],[92,14,103,10,"flushWithBackOff"],[92,30,103,26],[92,31,103,27],[92,32,103,28],[93,14,104,10,"log"],[93,17,104,13],[93,18,104,14],[93,47,104,43],[93,49,104,45,"e"],[93,50,104,47],[93,51,104,48],[94,14,105,10],[94,21,105,17],[94,22,105,18],[94,23,105,19],[95,12,106,8],[95,13,106,9],[95,19,106,15],[96,14,107,10],[96,20,107,16,"e"],[96,21,107,17],[97,12,108,8],[98,10,109,6],[99,8,110,4],[99,9,110,5],[100,8,110,5],[100,15,110,5,"_send"],[100,20,110,5],[100,21,110,5,"apply"],[100,26,110,5],[100,33,110,5,"arguments"],[100,42,110,5],[101,6,110,5],[102,6,112,4],[102,10,112,8,"options"],[102,17,112,15],[102,18,112,16,"flushAtStartup"],[102,32,112,30],[102,34,112,32],[103,8,113,6,"flushWithBackOff"],[103,24,113,22],[103,25,113,23],[103,26,113,24],[104,6,114,4],[105,6,116,4],[105,13,116,11],[106,8,117,6,"send"],[106,12,117,10],[107,8,118,6,"flush"],[107,13,118,11],[107,15,118,13,"t"],[107,16,118,14],[107,20,118,18,"transport"],[107,29,118,27],[107,30,118,28,"flush"],[107,35,118,33],[107,36,118,34,"t"],[107,37,118,35],[108,6,119,4],[108,7,119,5],[109,4,120,2],[109,5,120,3],[110,2,121,0],[111,2,123,0,"exports"],[111,9,123,7],[111,10,123,8,"MIN_DELAY"],[111,19,123,17],[111,22,123,20,"MIN_DELAY"],[111,31,123,29],[112,2,124,0,"exports"],[112,9,124,7],[112,10,124,8,"START_DELAY"],[112,21,124,19],[112,24,124,22,"START_DELAY"],[112,35,124,33],[113,2,125,0,"exports"],[113,9,125,7],[113,10,125,8,"makeOfflineTransport"],[113,30,125,28],[113,33,125,31,"makeOfflineTransport"],[113,53,125,51],[114,0,125,52],[114,3]],"functionMap":{"names":["<global>","log","makeOfflineTransport","<anonymous>","shouldQueue","flushIn","setTimeout$argument_0","send._catch$argument_0","flushWithBackOff","send","flush"],"mappings":"AAA;ACQ;CDE;AEO;SCG;ICO;KDc;IEE;8BCS;iCCM;WDE;ODE;KFM;IKE;KLQ;IME;KN6B;aOQ,uBP;GDE;CFC"},"hasCjsExports":true},"type":"js/module"}]}