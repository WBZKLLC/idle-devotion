{"dependencies":[{"name":"./object.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":48,"index":48}}],"key":"c+4yuYP7E2Xh9QIfj2WEKgywjI4=","exportNames":["*"],"imports":1}},{"name":"./stacktrace.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":49},"end":{"line":2,"column":62,"index":111}}],"key":"aMpe18tuIEoMpnkxgMUgt39EQuk=","exportNames":["*"],"imports":1}},{"name":"./node-stack-trace.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":112},"end":{"line":3,"column":56,"index":168}}],"key":"I4HuW3JMH4XPRKx+RMlbO8AEW38=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"createDebugPauseMessageHandler\", {\n    enumerable: true,\n    get: function () {\n      return createDebugPauseMessageHandler;\n    }\n  });\n  Object.defineProperty(exports, \"watchdogTimer\", {\n    enumerable: true,\n    get: function () {\n      return watchdogTimer;\n    }\n  });\n  var _objectJs = require(_dependencyMap[0], \"./object.js\");\n  var _stacktraceJs = require(_dependencyMap[1], \"./stacktrace.js\");\n  var _nodeStackTraceJs = require(_dependencyMap[2], \"./node-stack-trace.js\");\n  /**\n   * A node.js watchdog timer\n   * @param pollInterval The interval that we expect to get polled at\n   * @param anrThreshold The threshold for when we consider ANR\n   * @param callback The callback to call for ANR\n   * @returns An object with `poll` and `enabled` functions {@link WatchdogReturn}\n   */\n  function watchdogTimer(createTimer, pollInterval, anrThreshold, callback) {\n    const timer = createTimer();\n    let triggered = false;\n    let enabled = true;\n    setInterval(() => {\n      const diffMs = timer.getTimeMs();\n      if (triggered === false && diffMs > pollInterval + anrThreshold) {\n        triggered = true;\n        if (enabled) {\n          callback();\n        }\n      }\n      if (diffMs < pollInterval + anrThreshold) {\n        triggered = false;\n      }\n    }, 20);\n    return {\n      poll: () => {\n        timer.reset();\n      },\n      enabled: state => {\n        enabled = state;\n      }\n    };\n  }\n\n  // types copied from inspector.d.ts\n\n  /**\n   * Converts Debugger.CallFrame to Sentry StackFrame\n   */\n  function callFrameToStackFrame(frame, url, getModuleFromFilename) {\n    const filename = url ? url.replace(/^file:\\/\\//, '') : undefined;\n\n    // CallFrame row/col are 0 based, whereas StackFrame are 1 based\n    const colno = frame.location.columnNumber ? frame.location.columnNumber + 1 : undefined;\n    const lineno = frame.location.lineNumber ? frame.location.lineNumber + 1 : undefined;\n    return (0, _objectJs.dropUndefinedKeys)({\n      filename,\n      module: getModuleFromFilename(filename),\n      function: frame.functionName || '?',\n      colno,\n      lineno,\n      in_app: filename ? (0, _nodeStackTraceJs.filenameIsInApp)(filename) : undefined\n    });\n  }\n\n  // The only messages we care about\n\n  /**\n   * Creates a message handler from the v8 debugger protocol and passed stack frames to the callback when paused.\n   */\n  function createDebugPauseMessageHandler(sendCommand, getModuleFromFilename, pausedStackFrames) {\n    // Collect scriptId -> url map so we can look up the filenames later\n    const scripts = new Map();\n    return message => {\n      if (message.method === 'Debugger.scriptParsed') {\n        scripts.set(message.params.scriptId, message.params.url);\n      } else if (message.method === 'Debugger.paused') {\n        // copy the frames\n        const callFrames = [...message.params.callFrames];\n        // and resume immediately\n        sendCommand('Debugger.resume');\n        sendCommand('Debugger.disable');\n        const stackFrames = (0, _stacktraceJs.stripSentryFramesAndReverse)(callFrames.map(frame => callFrameToStackFrame(frame, scripts.get(frame.location.scriptId), getModuleFromFilename)));\n        pausedStackFrames(stackFrames);\n      }\n    };\n  }\n});","lineCount":98,"map":[[7,2,107,0,"Object"],[7,8,107,0],[7,9,107,0,"defineProperty"],[7,23,107,0],[7,24,107,0,"exports"],[7,31,107,0],[8,4,107,0,"enumerable"],[8,14,107,0],[9,4,107,0,"get"],[9,7,107,0],[9,18,107,0,"get"],[9,19,107,0],[10,6,107,0],[10,13,107,9,"createDebugPauseMessageHandler"],[10,43,107,39],[11,4,107,39],[12,2,107,39],[13,2,107,0,"Object"],[13,8,107,0],[13,9,107,0,"defineProperty"],[13,23,107,0],[13,24,107,0,"exports"],[13,31,107,0],[14,4,107,0,"enumerable"],[14,14,107,0],[15,4,107,0,"get"],[15,7,107,0],[15,18,107,0,"get"],[15,19,107,0],[16,6,107,0],[16,13,107,41,"watchdogTimer"],[16,26,107,54],[17,4,107,54],[18,2,107,54],[19,2,1,0],[19,6,1,0,"_objectJs"],[19,15,1,0],[19,18,1,0,"require"],[19,25,1,0],[19,26,1,0,"_dependencyMap"],[19,40,1,0],[20,2,2,0],[20,6,2,0,"_stacktraceJs"],[20,19,2,0],[20,22,2,0,"require"],[20,29,2,0],[20,30,2,0,"_dependencyMap"],[20,44,2,0],[21,2,3,0],[21,6,3,0,"_nodeStackTraceJs"],[21,23,3,0],[21,26,3,0,"require"],[21,33,3,0],[21,34,3,0,"_dependencyMap"],[21,48,3,0],[22,2,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[26,0,9,0],[27,0,10,0],[28,0,11,0],[29,2,12,0],[29,11,12,9,"watchdogTimer"],[29,24,12,22,"watchdogTimer"],[29,25,13,2,"createTimer"],[29,36,13,13],[29,38,14,2,"pollInterval"],[29,50,14,14],[29,52,15,2,"anrThreshold"],[29,64,15,14],[29,66,16,2,"callback"],[29,74,16,10],[29,76,17,2],[30,4,18,2],[30,10,18,8,"timer"],[30,15,18,13],[30,18,18,16,"createTimer"],[30,29,18,27],[30,30,18,28],[30,31,18,29],[31,4,19,2],[31,8,19,6,"triggered"],[31,17,19,15],[31,20,19,18],[31,25,19,23],[32,4,20,2],[32,8,20,6,"enabled"],[32,15,20,13],[32,18,20,16],[32,22,20,20],[33,4,22,2,"setInterval"],[33,15,22,13],[33,16,22,14],[33,22,22,20],[34,6,23,4],[34,12,23,10,"diffMs"],[34,18,23,16],[34,21,23,19,"timer"],[34,26,23,24],[34,27,23,25,"getTimeMs"],[34,36,23,34],[34,37,23,35],[34,38,23,36],[35,6,25,4],[35,10,25,8,"triggered"],[35,19,25,17],[35,24,25,22],[35,29,25,27],[35,33,25,31,"diffMs"],[35,39,25,37],[35,42,25,40,"pollInterval"],[35,54,25,52],[35,57,25,55,"anrThreshold"],[35,69,25,67],[35,71,25,69],[36,8,26,6,"triggered"],[36,17,26,15],[36,20,26,18],[36,24,26,22],[37,8,27,6],[37,12,27,10,"enabled"],[37,19,27,17],[37,21,27,19],[38,10,28,8,"callback"],[38,18,28,16],[38,19,28,17],[38,20,28,18],[39,8,29,6],[40,6,30,4],[41,6,32,4],[41,10,32,8,"diffMs"],[41,16,32,14],[41,19,32,17,"pollInterval"],[41,31,32,29],[41,34,32,32,"anrThreshold"],[41,46,32,44],[41,48,32,46],[42,8,33,6,"triggered"],[42,17,33,15],[42,20,33,18],[42,25,33,23],[43,6,34,4],[44,4,35,2],[44,5,35,3],[44,7,35,5],[44,9,35,7],[44,10,35,8],[45,4,37,2],[45,11,37,9],[46,6,38,4,"poll"],[46,10,38,8],[46,12,38,10,"poll"],[46,13,38,10],[46,18,38,16],[47,8,39,6,"timer"],[47,13,39,11],[47,14,39,12,"reset"],[47,19,39,17],[47,20,39,18],[47,21,39,19],[48,6,40,4],[48,7,40,5],[49,6,41,4,"enabled"],[49,13,41,11],[49,15,41,14,"state"],[49,20,41,19],[49,24,41,24],[50,8,42,6,"enabled"],[50,15,42,13],[50,18,42,16,"state"],[50,23,42,21],[51,6,43,4],[52,4,44,2],[52,5,44,3],[53,2,45,0],[55,2,47,0],[57,2,49,0],[58,0,50,0],[59,0,51,0],[60,2,52,0],[60,11,52,9,"callFrameToStackFrame"],[60,32,52,30,"callFrameToStackFrame"],[60,33,53,2,"frame"],[60,38,53,7],[60,40,54,2,"url"],[60,43,54,5],[60,45,55,2,"getModuleFromFilename"],[60,66,55,23],[60,68,56,2],[61,4,57,2],[61,10,57,8,"filename"],[61,18,57,16],[61,21,57,19,"url"],[61,24,57,22],[61,27,57,25,"url"],[61,30,57,28],[61,31,57,29,"replace"],[61,38,57,36],[61,39,57,37],[61,51,57,49],[61,53,57,51],[61,55,57,53],[61,56,57,54],[61,59,57,57,"undefined"],[61,68,57,66],[63,4,59,2],[64,4,60,2],[64,10,60,8,"colno"],[64,15,60,13],[64,18,60,16,"frame"],[64,23,60,21],[64,24,60,22,"location"],[64,32,60,30],[64,33,60,31,"columnNumber"],[64,45,60,43],[64,48,60,46,"frame"],[64,53,60,51],[64,54,60,52,"location"],[64,62,60,60],[64,63,60,61,"columnNumber"],[64,75,60,73],[64,78,60,76],[64,79,60,77],[64,82,60,80,"undefined"],[64,91,60,89],[65,4,61,2],[65,10,61,8,"lineno"],[65,16,61,14],[65,19,61,17,"frame"],[65,24,61,22],[65,25,61,23,"location"],[65,33,61,31],[65,34,61,32,"lineNumber"],[65,44,61,42],[65,47,61,45,"frame"],[65,52,61,50],[65,53,61,51,"location"],[65,61,61,59],[65,62,61,60,"lineNumber"],[65,72,61,70],[65,75,61,73],[65,76,61,74],[65,79,61,77,"undefined"],[65,88,61,86],[66,4,63,2],[66,11,63,9],[66,15,63,9,"dropUndefinedKeys"],[66,24,63,26],[66,25,63,26,"dropUndefinedKeys"],[66,42,63,26],[66,44,63,27],[67,6,64,4,"filename"],[67,14,64,12],[68,6,65,4,"module"],[68,12,65,10],[68,14,65,12,"getModuleFromFilename"],[68,35,65,33],[68,36,65,34,"filename"],[68,44,65,42],[68,45,65,43],[69,6,66,4,"function"],[69,14,66,12],[69,16,66,14,"frame"],[69,21,66,19],[69,22,66,20,"functionName"],[69,34,66,32],[69,38,66,36],[69,41,66,39],[70,6,67,4,"colno"],[70,11,67,9],[71,6,68,4,"lineno"],[71,12,68,10],[72,6,69,4,"in_app"],[72,12,69,10],[72,14,69,12,"filename"],[72,22,69,20],[72,25,69,23],[72,29,69,23,"filenameIsInApp"],[72,46,69,38],[72,47,69,38,"filenameIsInApp"],[72,62,69,38],[72,64,69,39,"filename"],[72,72,69,47],[72,73,69,48],[72,76,69,51,"undefined"],[73,4,70,2],[73,5,70,3],[73,6,70,4],[74,2,71,0],[76,2,73,0],[78,2,75,0],[79,0,76,0],[80,0,77,0],[81,2,78,0],[81,11,78,9,"createDebugPauseMessageHandler"],[81,41,78,39,"createDebugPauseMessageHandler"],[81,42,79,2,"sendCommand"],[81,53,79,13],[81,55,80,2,"getModuleFromFilename"],[81,76,80,23],[81,78,81,2,"pausedStackFrames"],[81,95,81,19],[81,97,82,2],[82,4,83,2],[83,4,84,2],[83,10,84,8,"scripts"],[83,17,84,15],[83,20,84,18],[83,24,84,22,"Map"],[83,27,84,25],[83,28,84,26],[83,29,84,27],[84,4,86,2],[84,11,86,9,"message"],[84,18,86,16],[84,22,86,20],[85,6,87,4],[85,10,87,8,"message"],[85,17,87,15],[85,18,87,16,"method"],[85,24,87,22],[85,29,87,27],[85,52,87,50],[85,54,87,52],[86,8,88,6,"scripts"],[86,15,88,13],[86,16,88,14,"set"],[86,19,88,17],[86,20,88,18,"message"],[86,27,88,25],[86,28,88,26,"params"],[86,34,88,32],[86,35,88,33,"scriptId"],[86,43,88,41],[86,45,88,43,"message"],[86,52,88,50],[86,53,88,51,"params"],[86,59,88,57],[86,60,88,58,"url"],[86,63,88,61],[86,64,88,62],[87,6,89,4],[87,7,89,5],[87,13,89,11],[87,17,89,15,"message"],[87,24,89,22],[87,25,89,23,"method"],[87,31,89,29],[87,36,89,34],[87,53,89,51],[87,55,89,53],[88,8,90,6],[89,8,91,6],[89,14,91,12,"callFrames"],[89,24,91,22],[89,27,91,25],[89,28,91,26],[89,31,91,29,"message"],[89,38,91,36],[89,39,91,37,"params"],[89,45,91,43],[89,46,91,44,"callFrames"],[89,56,91,54],[89,57,91,55],[90,8,92,6],[91,8,93,6,"sendCommand"],[91,19,93,17],[91,20,93,18],[91,37,93,35],[91,38,93,36],[92,8,94,6,"sendCommand"],[92,19,94,17],[92,20,94,18],[92,38,94,36],[92,39,94,37],[93,8,96,6],[93,14,96,12,"stackFrames"],[93,25,96,23],[93,28,96,26],[93,32,96,26,"stripSentryFramesAndReverse"],[93,45,96,53],[93,46,96,53,"stripSentryFramesAndReverse"],[93,73,96,53],[93,75,97,8,"callFrames"],[93,85,97,18],[93,86,97,19,"map"],[93,89,97,22],[93,90,97,23,"frame"],[93,95,97,28],[93,99,98,10,"callFrameToStackFrame"],[93,120,98,31],[93,121,98,32,"frame"],[93,126,98,37],[93,128,98,39,"scripts"],[93,135,98,46],[93,136,98,47,"get"],[93,139,98,50],[93,140,98,51,"frame"],[93,145,98,56],[93,146,98,57,"location"],[93,154,98,65],[93,155,98,66,"scriptId"],[93,163,98,74],[93,164,98,75],[93,166,98,77,"getModuleFromFilename"],[93,187,98,98],[93,188,99,8],[93,189,100,6],[93,190,100,7],[94,8,102,6,"pausedStackFrames"],[94,25,102,23],[94,26,102,24,"stackFrames"],[94,37,102,35],[94,38,102,36],[95,6,103,4],[96,4,104,2],[96,5,104,3],[97,2,105,0],[98,0,105,1],[98,3]],"functionMap":{"names":["<global>","watchdogTimer","setInterval$argument_0","poll","enabled","callFrameToStackFrame","createDebugPauseMessageHandler","<anonymous>","callFrames.map$argument_0"],"mappings":"AAA;ACW;cCU;GDa;UEG;KFE;aGC;KHE;CDE;AKO;CLmB;AMO;SCQ;uBCW;mGDC;GDM;CNC"},"hasCjsExports":false},"type":"js/module"}]}