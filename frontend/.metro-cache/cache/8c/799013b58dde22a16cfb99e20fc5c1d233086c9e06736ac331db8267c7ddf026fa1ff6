{"dependencies":[{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":149},"end":{"line":5,"column":26,"index":175}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"api\", {\n    enumerable: true,\n    get: function () {\n      return api;\n    }\n  });\n  exports.requireUsername = requireUsername;\n  exports.fetchUserHeroes = fetchUserHeroes;\n  exports.promoteHeroStar = promoteHeroStar;\n  exports.getHeroProgression = getHeroProgression;\n  exports.getUserHeroById = getUserHeroById;\n  exports.getUserHeroes = getUserHeroes;\n  exports.fetchUser = fetchUser;\n  exports.pullGacha = pullGacha;\n  exports.performSummon = performSummon;\n  exports.upgradeHero = upgradeHero;\n  var _axios = require(_dependencyMap[0], \"axios\");\n  var axios = _interopDefault(_axios);\n  // /app/frontend/lib/api.ts\n  // SINGLE SOURCE OF TRUTH for all backend API calls\n  // Screens should import from here to prevent endpoint string drift\n\n  const API_BASE = process.env.EXPO_PUBLIC_BACKEND_URL ? `${process.env.EXPO_PUBLIC_BACKEND_URL}/api` : '/api';\n  const api = axios.default.create({\n    baseURL: API_BASE,\n    timeout: 20000\n  });\n  function requireUsername(username) {\n    if (!username) throw new Error('Missing username');\n    return username;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // USER HEROES\n  // ─────────────────────────────────────────────────────────────\n\n  async function fetchUserHeroes(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // STAR PROMOTION (canonical endpoint)\n  // POST /api/hero/{user_hero_id}/promote-star?username=...\n  // ─────────────────────────────────────────────────────────────\n\n  async function promoteHeroStar(userHeroId, username) {\n    const u = requireUsername(username);\n    const res = await api.post(`/hero/${encodeURIComponent(userHeroId)}/promote-star`, null, {\n      params: {\n        username: u\n      }\n    });\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // HERO PROGRESSION (read model for hero-progression screen)\n  // GET /api/hero/{username}/hero/{heroId}/progression\n  // NOTE: Falls back gracefully if endpoint doesn't exist\n  // ─────────────────────────────────────────────────────────────\n\n  async function getHeroProgression(username, heroId) {\n    const u = requireUsername(username);\n    const res = await api.get(`/hero/${encodeURIComponent(u)}/hero/${encodeURIComponent(heroId)}/progression`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // SINGLE HERO FETCH (fallback when hero not in store cache)\n  // NOTE: Temporary implementation - fetches full list and filters.\n  // Replace with GET /user/{username}/heroes/{userHeroId} once backend exists.\n  // Screens call getUserHeroById() and never hit list endpoints directly.\n  // ─────────────────────────────────────────────────────────────\n\n  async function getUserHeroById(username, userHeroId) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    const list = Array.isArray(res.data) ? res.data : res.data?.heroes ?? res.data ?? [];\n    const found = list.find(h => String(h?.id) === String(userHeroId));\n    if (!found) throw new Error('Hero not found');\n    return found;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // FULL HERO LIST (centralized; screens must not call axios/fetch directly)\n  // Rule: screens import getUserHeroes()/getUserHeroById() — never hit /user/:username/heroes directly.\n  // ─────────────────────────────────────────────────────────────\n\n  async function getUserHeroes(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    return Array.isArray(res.data) ? res.data : res.data?.heroes ?? res.data ?? [];\n  }\n\n  // RULE: All hero endpoints live here.\n  // Screens should not build URLs manually (prevents drift).\n\n  // ─────────────────────────────────────────────────────────────\n  // USER AUTH / PROFILE\n  // ─────────────────────────────────────────────────────────────\n\n  async function fetchUser(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // GACHA / SUMMON\n  // POST /api/gacha/pull?username=...\n  // ─────────────────────────────────────────────────────────────\n\n  async function pullGacha(username, pullType, currencyType) {\n    const u = requireUsername(username);\n    const res = await api.post(`/gacha/pull`, {\n      pull_type: pullType,\n      currency_type: currencyType\n    }, {\n      params: {\n        username: u\n      }\n    });\n    return res.data;\n  }\n\n  // Legacy alias for backwards compatibility\n  async function performSummon(username, summonType) {\n    return pullGacha(username, summonType, 'gems');\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // HERO UPGRADE\n  // POST /api/user/{username}/heroes/{heroInstanceId}/upgrade\n  // ─────────────────────────────────────────────────────────────\n\n  async function upgradeHero(username, heroInstanceId) {\n    const u = requireUsername(username);\n    const res = await api.post(`/user/${encodeURIComponent(u)}/heroes/${encodeURIComponent(heroInstanceId)}/upgrade`);\n    return res.data;\n  }\n\n  // Add more hero endpoints here ONLY.\n  // Screens should import from lib/api.ts so route strings never drift again.\n});","lineCount":157,"map":[[12,2,11,0,"Object"],[12,8,11,0],[12,9,11,0,"defineProperty"],[12,23,11,0],[12,24,11,0,"exports"],[12,31,11,0],[13,4,11,0,"enumerable"],[13,14,11,0],[14,4,11,0,"get"],[14,7,11,0],[14,18,11,0,"get"],[14,19,11,0],[15,6,11,0],[15,13,11,0,"api"],[15,16,11,0],[16,4,11,0],[17,2,11,0],[18,2,16,0,"exports"],[18,9,16,0],[18,10,16,0,"requireUsername"],[18,25,16,0],[18,28,16,0,"requireUsername"],[18,43,16,0],[19,2,25,0,"exports"],[19,9,25,0],[19,10,25,0,"fetchUserHeroes"],[19,25,25,0],[19,28,25,0,"fetchUserHeroes"],[19,43,25,0],[20,2,36,0,"exports"],[20,9,36,0],[20,10,36,0,"promoteHeroStar"],[20,25,36,0],[20,28,36,0,"promoteHeroStar"],[20,43,36,0],[21,2,57,0,"exports"],[21,9,57,0],[21,10,57,0,"getHeroProgression"],[21,28,57,0],[21,31,57,0,"getHeroProgression"],[21,49,57,0],[22,2,70,0,"exports"],[22,9,70,0],[22,10,70,0,"getUserHeroById"],[22,25,70,0],[22,28,70,0,"getUserHeroById"],[22,43,70,0],[23,2,84,0,"exports"],[23,9,84,0],[23,10,84,0,"getUserHeroes"],[23,23,84,0],[23,26,84,0,"getUserHeroes"],[23,39,84,0],[24,2,97,0,"exports"],[24,9,97,0],[24,10,97,0,"fetchUser"],[24,19,97,0],[24,22,97,0,"fetchUser"],[24,31,97,0],[25,2,108,0,"exports"],[25,9,108,0],[25,10,108,0,"pullGacha"],[25,19,108,0],[25,22,108,0,"pullGacha"],[25,31,108,0],[26,2,123,0,"exports"],[26,9,123,0],[26,10,123,0,"performSummon"],[26,23,123,0],[26,26,123,0,"performSummon"],[26,39,123,0],[27,2,132,0,"exports"],[27,9,132,0],[27,10,132,0,"upgradeHero"],[27,21,132,0],[27,24,132,0,"upgradeHero"],[27,35,132,0],[28,2,5,0],[28,6,5,0,"_axios"],[28,12,5,0],[28,15,5,0,"require"],[28,22,5,0],[28,23,5,0,"_dependencyMap"],[28,37,5,0],[29,2,5,0],[29,6,5,0,"axios"],[29,11,5,0],[29,14,5,0,"_interopDefault"],[29,29,5,0],[29,30,5,0,"_axios"],[29,36,5,0],[30,2,1,0],[31,2,2,0],[32,2,3,0],[34,2,7,0],[34,8,7,6,"API_BASE"],[34,16,7,14],[34,19,7,17,"process"],[34,26,7,24],[34,27,7,25,"env"],[34,30,7,28],[34,31,7,29,"EXPO_PUBLIC_BACKEND_URL"],[34,54,7,52],[34,57,8,4],[34,60,8,7,"process"],[34,67,8,14],[34,68,8,15,"env"],[34,71,8,18],[34,72,8,19,"EXPO_PUBLIC_BACKEND_URL"],[34,95,8,42],[34,101,8,48],[34,104,9,4],[34,110,9,10],[35,2,11,7],[35,8,11,13,"api"],[35,11,11,16],[35,14,11,19,"axios"],[35,19,11,24],[35,20,11,24,"default"],[35,27,11,24],[35,28,11,25,"create"],[35,34,11,31],[35,35,11,32],[36,4,12,2,"baseURL"],[36,11,12,9],[36,13,12,11,"API_BASE"],[36,21,12,19],[37,4,13,2,"timeout"],[37,11,13,9],[37,13,13,11],[38,2,14,0],[38,3,14,1],[38,4,14,2],[39,2,16,7],[39,11,16,16,"requireUsername"],[39,26,16,31,"requireUsername"],[39,27,16,32,"username"],[39,35,16,49],[39,37,16,51],[40,4,17,2],[40,8,17,6],[40,9,17,7,"username"],[40,17,17,15],[40,19,17,17],[40,25,17,23],[40,29,17,27,"Error"],[40,34,17,32],[40,35,17,33],[40,53,17,51],[40,54,17,52],[41,4,18,2],[41,11,18,9,"username"],[41,19,18,17],[42,2,19,0],[44,2,21,0],[45,2,22,0],[46,2,23,0],[48,2,25,7],[48,17,25,22,"fetchUserHeroes"],[48,32,25,37,"fetchUserHeroes"],[48,33,25,38,"username"],[48,41,25,54],[48,43,25,56],[49,4,26,2],[49,10,26,8,"u"],[49,11,26,9],[49,14,26,12,"requireUsername"],[49,29,26,27],[49,30,26,28,"username"],[49,38,26,36],[49,39,26,37],[50,4,27,2],[50,10,27,8,"res"],[50,13,27,11],[50,16,27,14],[50,22,27,20,"api"],[50,25,27,23],[50,26,27,24,"get"],[50,29,27,27],[50,30,27,28],[50,39,27,37,"encodeURIComponent"],[50,57,27,55],[50,58,27,56,"u"],[50,59,27,57],[50,60,27,58],[50,69,27,67],[50,70,27,68],[51,4,28,2],[51,11,28,9,"res"],[51,14,28,12],[51,15,28,13,"data"],[51,19,28,17],[52,2,29,0],[54,2,31,0],[55,2,32,0],[56,2,33,0],[57,2,34,0],[59,2,36,7],[59,17,36,22,"promoteHeroStar"],[59,32,36,37,"promoteHeroStar"],[59,33,36,38,"userHeroId"],[59,43,36,56],[59,45,36,58,"username"],[59,53,36,74],[59,55,36,76],[60,4,37,2],[60,10,37,8,"u"],[60,11,37,9],[60,14,37,12,"requireUsername"],[60,29,37,27],[60,30,37,28,"username"],[60,38,37,36],[60,39,37,37],[61,4,38,2],[61,10,38,8,"res"],[61,13,38,11],[61,16,38,14],[61,22,38,20,"api"],[61,25,38,23],[61,26,38,24,"post"],[61,30,38,28],[61,31,39,4],[61,40,39,13,"encodeURIComponent"],[61,58,39,31],[61,59,39,32,"userHeroId"],[61,69,39,42],[61,70,39,43],[61,85,39,58],[61,87,40,4],[61,91,40,8],[61,93,41,4],[62,6,41,6,"params"],[62,12,41,12],[62,14,41,14],[63,8,41,16,"username"],[63,16,41,24],[63,18,41,26,"u"],[64,6,41,28],[65,4,41,30],[65,5,42,2],[65,6,42,3],[66,4,43,2],[66,11,43,9,"res"],[66,14,43,12],[66,15,43,13,"data"],[66,19,43,17],[67,2,49,0],[69,2,51,0],[70,2,52,0],[71,2,53,0],[72,2,54,0],[73,2,55,0],[75,2,57,7],[75,17,57,22,"getHeroProgression"],[75,35,57,40,"getHeroProgression"],[75,36,57,41,"username"],[75,44,57,57],[75,46,57,59,"heroId"],[75,52,57,73],[75,54,57,75],[76,4,58,2],[76,10,58,8,"u"],[76,11,58,9],[76,14,58,12,"requireUsername"],[76,29,58,27],[76,30,58,28,"username"],[76,38,58,36],[76,39,58,37],[77,4,59,2],[77,10,59,8,"res"],[77,13,59,11],[77,16,59,14],[77,22,59,20,"api"],[77,25,59,23],[77,26,59,24,"get"],[77,29,59,27],[77,30,59,28],[77,39,59,37,"encodeURIComponent"],[77,57,59,55],[77,58,59,56,"u"],[77,59,59,57],[77,60,59,58],[77,69,59,67,"encodeURIComponent"],[77,87,59,85],[77,88,59,86,"heroId"],[77,94,59,92],[77,95,59,93],[77,109,59,107],[77,110,59,108],[78,4,60,2],[78,11,60,9,"res"],[78,14,60,12],[78,15,60,13,"data"],[78,19,60,17],[79,2,61,0],[81,2,63,0],[82,2,64,0],[83,2,65,0],[84,2,66,0],[85,2,67,0],[86,2,68,0],[88,2,70,7],[88,17,70,22,"getUserHeroById"],[88,32,70,37,"getUserHeroById"],[88,33,70,38,"username"],[88,41,70,54],[88,43,70,56,"userHeroId"],[88,53,70,74],[88,55,70,76],[89,4,71,2],[89,10,71,8,"u"],[89,11,71,9],[89,14,71,12,"requireUsername"],[89,29,71,27],[89,30,71,28,"username"],[89,38,71,36],[89,39,71,37],[90,4,72,2],[90,10,72,8,"res"],[90,13,72,11],[90,16,72,14],[90,22,72,20,"api"],[90,25,72,23],[90,26,72,24,"get"],[90,29,72,27],[90,30,72,28],[90,39,72,37,"encodeURIComponent"],[90,57,72,55],[90,58,72,56,"u"],[90,59,72,57],[90,60,72,58],[90,69,72,67],[90,70,72,68],[91,4,73,2],[91,10,73,8,"list"],[91,14,73,12],[91,17,73,15,"Array"],[91,22,73,20],[91,23,73,21,"isArray"],[91,30,73,28],[91,31,73,29,"res"],[91,34,73,32],[91,35,73,33,"data"],[91,39,73,37],[91,40,73,38],[91,43,73,41,"res"],[91,46,73,44],[91,47,73,45,"data"],[91,51,73,49],[91,54,73,53,"res"],[91,57,73,56],[91,58,73,57,"data"],[91,62,73,61],[91,64,73,63,"heroes"],[91,70,73,69],[91,74,73,73,"res"],[91,77,73,76],[91,78,73,77,"data"],[91,82,73,81],[91,86,73,85],[91,88,73,88],[92,4,74,2],[92,10,74,8,"found"],[92,15,74,13],[92,18,74,16,"list"],[92,22,74,20],[92,23,74,21,"find"],[92,27,74,25],[92,28,74,27,"h"],[92,29,74,33],[92,33,74,38,"String"],[92,39,74,44],[92,40,74,45,"h"],[92,41,74,46],[92,43,74,48,"id"],[92,45,74,50],[92,46,74,51],[92,51,74,56,"String"],[92,57,74,62],[92,58,74,63,"userHeroId"],[92,68,74,73],[92,69,74,74],[92,70,74,75],[93,4,75,2],[93,8,75,6],[93,9,75,7,"found"],[93,14,75,12],[93,16,75,14],[93,22,75,20],[93,26,75,24,"Error"],[93,31,75,29],[93,32,75,30],[93,48,75,46],[93,49,75,47],[94,4,76,2],[94,11,76,9,"found"],[94,16,76,14],[95,2,77,0],[97,2,79,0],[98,2,80,0],[99,2,81,0],[100,2,82,0],[102,2,84,7],[102,17,84,22,"getUserHeroes"],[102,30,84,35,"getUserHeroes"],[102,31,84,36,"username"],[102,39,84,52],[102,41,84,54],[103,4,85,2],[103,10,85,8,"u"],[103,11,85,9],[103,14,85,12,"requireUsername"],[103,29,85,27],[103,30,85,28,"username"],[103,38,85,36],[103,39,85,37],[104,4,86,2],[104,10,86,8,"res"],[104,13,86,11],[104,16,86,14],[104,22,86,20,"api"],[104,25,86,23],[104,26,86,24,"get"],[104,29,86,27],[104,30,86,28],[104,39,86,37,"encodeURIComponent"],[104,57,86,55],[104,58,86,56,"u"],[104,59,86,57],[104,60,86,58],[104,69,86,67],[104,70,86,68],[105,4,87,2],[105,11,87,9,"Array"],[105,16,87,14],[105,17,87,15,"isArray"],[105,24,87,22],[105,25,87,23,"res"],[105,28,87,26],[105,29,87,27,"data"],[105,33,87,31],[105,34,87,32],[105,37,87,35,"res"],[105,40,87,38],[105,41,87,39,"data"],[105,45,87,43],[105,48,87,47,"res"],[105,51,87,50],[105,52,87,51,"data"],[105,56,87,55],[105,58,87,57,"heroes"],[105,64,87,63],[105,68,87,67,"res"],[105,71,87,70],[105,72,87,71,"data"],[105,76,87,75],[105,80,87,79],[105,82,87,82],[106,2,88,0],[108,2,90,0],[109,2,91,0],[111,2,93,0],[112,2,94,0],[113,2,95,0],[115,2,97,7],[115,17,97,22,"fetchUser"],[115,26,97,31,"fetchUser"],[115,27,97,32,"username"],[115,35,97,48],[115,37,97,50],[116,4,98,2],[116,10,98,8,"u"],[116,11,98,9],[116,14,98,12,"requireUsername"],[116,29,98,27],[116,30,98,28,"username"],[116,38,98,36],[116,39,98,37],[117,4,99,2],[117,10,99,8,"res"],[117,13,99,11],[117,16,99,14],[117,22,99,20,"api"],[117,25,99,23],[117,26,99,24,"get"],[117,29,99,27],[117,30,99,28],[117,39,99,37,"encodeURIComponent"],[117,57,99,55],[117,58,99,56,"u"],[117,59,99,57],[117,60,99,58],[117,62,99,60],[117,63,99,61],[118,4,100,2],[118,11,100,9,"res"],[118,14,100,12],[118,15,100,13,"data"],[118,19,100,17],[119,2,101,0],[121,2,103,0],[122,2,104,0],[123,2,105,0],[124,2,106,0],[126,2,108,7],[126,17,108,22,"pullGacha"],[126,26,108,31,"pullGacha"],[126,27,109,2,"username"],[126,35,109,18],[126,37,110,2,"pullType"],[126,45,110,30],[126,47,111,2,"currencyType"],[126,59,111,32],[126,61,112,2],[127,4,113,2],[127,10,113,8,"u"],[127,11,113,9],[127,14,113,12,"requireUsername"],[127,29,113,27],[127,30,113,28,"username"],[127,38,113,36],[127,39,113,37],[128,4,114,2],[128,10,114,8,"res"],[128,13,114,11],[128,16,114,14],[128,22,114,20,"api"],[128,25,114,23],[128,26,114,24,"post"],[128,30,114,28],[128,31,115,4],[128,44,115,17],[128,46,116,4],[129,6,116,6,"pull_type"],[129,15,116,15],[129,17,116,17,"pullType"],[129,25,116,25],[130,6,116,27,"currency_type"],[130,19,116,40],[130,21,116,42,"currencyType"],[131,4,116,55],[131,5,116,56],[131,7,117,4],[132,6,117,6,"params"],[132,12,117,12],[132,14,117,14],[133,8,117,16,"username"],[133,16,117,24],[133,18,117,26,"u"],[134,6,117,28],[135,4,117,30],[135,5,118,2],[135,6,118,3],[136,4,119,2],[136,11,119,9,"res"],[136,14,119,12],[136,15,119,13,"data"],[136,19,119,17],[137,2,120,0],[139,2,122,0],[140,2,123,7],[140,17,123,22,"performSummon"],[140,30,123,35,"performSummon"],[140,31,123,36,"username"],[140,39,123,52],[140,41,123,54,"summonType"],[140,51,123,84],[140,53,123,86],[141,4,124,2],[141,11,124,9,"pullGacha"],[141,20,124,18],[141,21,124,19,"username"],[141,29,124,27],[141,31,124,29,"summonType"],[141,41,124,39],[141,43,124,41],[141,49,124,47],[141,50,124,48],[142,2,125,0],[144,2,127,0],[145,2,128,0],[146,2,129,0],[147,2,130,0],[149,2,132,7],[149,17,132,22,"upgradeHero"],[149,28,132,33,"upgradeHero"],[149,29,132,34,"username"],[149,37,132,50],[149,39,132,52,"heroInstanceId"],[149,53,132,74],[149,55,132,76],[150,4,133,2],[150,10,133,8,"u"],[150,11,133,9],[150,14,133,12,"requireUsername"],[150,29,133,27],[150,30,133,28,"username"],[150,38,133,36],[150,39,133,37],[151,4,134,2],[151,10,134,8,"res"],[151,13,134,11],[151,16,134,14],[151,22,134,20,"api"],[151,25,134,23],[151,26,134,24,"post"],[151,30,134,28],[151,31,134,29],[151,40,134,38,"encodeURIComponent"],[151,58,134,56],[151,59,134,57,"u"],[151,60,134,58],[151,61,134,59],[151,72,134,70,"encodeURIComponent"],[151,90,134,88],[151,91,134,89,"heroInstanceId"],[151,105,134,103],[151,106,134,104],[151,116,134,114],[151,117,134,115],[152,4,135,2],[152,11,135,9,"res"],[152,14,135,12],[152,15,135,13,"data"],[152,19,135,17],[153,2,136,0],[155,2,138,0],[156,2,139,0],[157,0,139,0],[157,3]],"functionMap":{"names":["<global>","requireUsername","fetchUserHeroes","promoteHeroStar","getHeroProgression","getUserHeroById","list.find$argument_0","getUserHeroes","fetchUser","pullGacha","performSummon","upgradeHero"],"mappings":"AAA;OCe;CDG;OEM;CFI;OGO;CHa;OIQ;CJI;OKS;0BCI,gDD;CLG;OOO;CPI;OQS;CRI;OSO;CTY;OUG;CVE;OWO;CXI"},"hasCjsExports":false},"type":"js/module"}]}