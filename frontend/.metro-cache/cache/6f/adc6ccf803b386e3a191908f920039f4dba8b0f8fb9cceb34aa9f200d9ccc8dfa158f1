{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":149},"end":{"line":5,"column":26,"index":175}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"api\", {\n    enumerable: true,\n    get: function () {\n      return api;\n    }\n  });\n  exports.requireUsername = requireUsername;\n  exports.fetchUserHeroes = fetchUserHeroes;\n  exports.promoteHeroStar = promoteHeroStar;\n  exports.getHeroProgression = getHeroProgression;\n  exports.getUserHeroById = getUserHeroById;\n  exports.getUserHeroes = getUserHeroes;\n  exports.fetchUser = fetchUser;\n  exports.performSummon = performSummon;\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _axios = require(_dependencyMap[1], \"axios\");\n  var axios = _interopDefault(_axios);\n  // /app/frontend/lib/api.ts\n  // SINGLE SOURCE OF TRUTH for all backend API calls\n  // Screens should import from here to prevent endpoint string drift\n\n  const API_BASE = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL ? `${_expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL}/api` : '/api';\n  const api = axios.default.create({\n    baseURL: API_BASE,\n    timeout: 20000\n  });\n  function requireUsername(username) {\n    if (!username) throw new Error('Missing username');\n    return username;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // USER HEROES\n  // ─────────────────────────────────────────────────────────────\n\n  async function fetchUserHeroes(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // STAR PROMOTION (canonical endpoint)\n  // POST /api/hero/{user_hero_id}/promote-star?username=...\n  // ─────────────────────────────────────────────────────────────\n\n  async function promoteHeroStar(userHeroId, username) {\n    const u = requireUsername(username);\n    const res = await api.post(`/hero/${encodeURIComponent(userHeroId)}/promote-star`, null, {\n      params: {\n        username: u\n      }\n    });\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // HERO PROGRESSION (read model for hero-progression screen)\n  // GET /api/hero/{username}/hero/{heroId}/progression\n  // NOTE: Falls back gracefully if endpoint doesn't exist\n  // ─────────────────────────────────────────────────────────────\n\n  async function getHeroProgression(username, heroId) {\n    const u = requireUsername(username);\n    const res = await api.get(`/hero/${encodeURIComponent(u)}/hero/${encodeURIComponent(heroId)}/progression`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // SINGLE HERO FETCH (fallback when hero not in store cache)\n  // NOTE: Temporary implementation - fetches full list and filters.\n  // Replace with GET /user/{username}/heroes/{userHeroId} once backend exists.\n  // Screens call getUserHeroById() and never hit list endpoints directly.\n  // ─────────────────────────────────────────────────────────────\n\n  async function getUserHeroById(username, userHeroId) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    const list = Array.isArray(res.data) ? res.data : res.data?.heroes ?? res.data ?? [];\n    const found = list.find(h => String(h?.id) === String(userHeroId));\n    if (!found) throw new Error('Hero not found');\n    return found;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // FULL HERO LIST (centralized; screens must not call axios/fetch directly)\n  // Rule: screens import getUserHeroes()/getUserHeroById() — never hit /user/:username/heroes directly.\n  // ─────────────────────────────────────────────────────────────\n\n  async function getUserHeroes(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}/heroes`);\n    return Array.isArray(res.data) ? res.data : res.data?.heroes ?? res.data ?? [];\n  }\n\n  // RULE: All hero endpoints live here.\n  // Screens should not build URLs manually (prevents drift).\n\n  // ─────────────────────────────────────────────────────────────\n  // USER AUTH / PROFILE\n  // ─────────────────────────────────────────────────────────────\n\n  async function fetchUser(username) {\n    const u = requireUsername(username);\n    const res = await api.get(`/user/${encodeURIComponent(u)}`);\n    return res.data;\n  }\n\n  // ─────────────────────────────────────────────────────────────\n  // GACHA / SUMMON\n  // ─────────────────────────────────────────────────────────────\n\n  async function performSummon(username, summonType) {\n    const u = requireUsername(username);\n    const res = await api.post(`/gacha/summon`, null, {\n      params: {\n        username: u,\n        summon_type: summonType\n      }\n    });\n    return res.data;\n  }\n\n  // Add more hero endpoints here ONLY.\n  // Screens should import from lib/api.ts so route strings never drift again.\n});","lineCount":137,"map":[[12,2,11,0,"Object"],[12,8,11,0],[12,9,11,0,"defineProperty"],[12,23,11,0],[12,24,11,0,"exports"],[12,31,11,0],[13,4,11,0,"enumerable"],[13,14,11,0],[14,4,11,0,"get"],[14,7,11,0],[14,18,11,0,"get"],[14,19,11,0],[15,6,11,0],[15,13,11,0,"api"],[15,16,11,0],[16,4,11,0],[17,2,11,0],[18,2,16,0,"exports"],[18,9,16,0],[18,10,16,0,"requireUsername"],[18,25,16,0],[18,28,16,0,"requireUsername"],[18,43,16,0],[19,2,25,0,"exports"],[19,9,25,0],[19,10,25,0,"fetchUserHeroes"],[19,25,25,0],[19,28,25,0,"fetchUserHeroes"],[19,43,25,0],[20,2,36,0,"exports"],[20,9,36,0],[20,10,36,0,"promoteHeroStar"],[20,25,36,0],[20,28,36,0,"promoteHeroStar"],[20,43,36,0],[21,2,57,0,"exports"],[21,9,57,0],[21,10,57,0,"getHeroProgression"],[21,28,57,0],[21,31,57,0,"getHeroProgression"],[21,49,57,0],[22,2,70,0,"exports"],[22,9,70,0],[22,10,70,0,"getUserHeroById"],[22,25,70,0],[22,28,70,0,"getUserHeroById"],[22,43,70,0],[23,2,84,0,"exports"],[23,9,84,0],[23,10,84,0,"getUserHeroes"],[23,23,84,0],[23,26,84,0,"getUserHeroes"],[23,39,84,0],[24,2,97,0,"exports"],[24,9,97,0],[24,10,97,0,"fetchUser"],[24,19,97,0],[24,22,97,0,"fetchUser"],[24,31,97,0],[25,2,107,0,"exports"],[25,9,107,0],[25,10,107,0,"performSummon"],[25,23,107,0],[25,26,107,0,"performSummon"],[25,39,107,0],[26,2,113,1],[26,6,113,1,"_expoVirtualEnv"],[26,21,113,1],[26,24,113,1,"require"],[26,31,113,1],[26,32,113,1,"_dependencyMap"],[26,46,113,1],[27,2,5,0],[27,6,5,0,"_axios"],[27,12,5,0],[27,15,5,0,"require"],[27,22,5,0],[27,23,5,0,"_dependencyMap"],[27,37,5,0],[28,2,5,0],[28,6,5,0,"axios"],[28,11,5,0],[28,14,5,0,"_interopDefault"],[28,29,5,0],[28,30,5,0,"_axios"],[28,36,5,0],[29,2,1,0],[30,2,2,0],[31,2,3,0],[33,2,7,0],[33,8,7,6,"API_BASE"],[33,16,7,14],[33,19,7,17,"_expoVirtualEnv"],[33,34,7,17],[33,35,7,17,"env"],[33,38,7,17],[33,39,7,17,"EXPO_PUBLIC_BACKEND_URL"],[33,62,7,17],[33,65,8,4],[33,68,8,4,"_expoVirtualEnv"],[33,83,8,4],[33,84,8,4,"env"],[33,87,8,4],[33,88,8,4,"EXPO_PUBLIC_BACKEND_URL"],[33,111,8,4],[33,117,8,48],[33,120,9,4],[33,126,9,10],[34,2,11,7],[34,8,11,13,"api"],[34,11,11,16],[34,14,11,19,"axios"],[34,19,11,24],[34,20,11,24,"default"],[34,27,11,24],[34,28,11,25,"create"],[34,34,11,31],[34,35,11,32],[35,4,12,2,"baseURL"],[35,11,12,9],[35,13,12,11,"API_BASE"],[35,21,12,19],[36,4,13,2,"timeout"],[36,11,13,9],[36,13,13,11],[37,2,14,0],[37,3,14,1],[37,4,14,2],[38,2,16,7],[38,11,16,16,"requireUsername"],[38,26,16,31,"requireUsername"],[38,27,16,32,"username"],[38,35,16,49],[38,37,16,51],[39,4,17,2],[39,8,17,6],[39,9,17,7,"username"],[39,17,17,15],[39,19,17,17],[39,25,17,23],[39,29,17,27,"Error"],[39,34,17,32],[39,35,17,33],[39,53,17,51],[39,54,17,52],[40,4,18,2],[40,11,18,9,"username"],[40,19,18,17],[41,2,19,0],[43,2,21,0],[44,2,22,0],[45,2,23,0],[47,2,25,7],[47,17,25,22,"fetchUserHeroes"],[47,32,25,37,"fetchUserHeroes"],[47,33,25,38,"username"],[47,41,25,54],[47,43,25,56],[48,4,26,2],[48,10,26,8,"u"],[48,11,26,9],[48,14,26,12,"requireUsername"],[48,29,26,27],[48,30,26,28,"username"],[48,38,26,36],[48,39,26,37],[49,4,27,2],[49,10,27,8,"res"],[49,13,27,11],[49,16,27,14],[49,22,27,20,"api"],[49,25,27,23],[49,26,27,24,"get"],[49,29,27,27],[49,30,27,28],[49,39,27,37,"encodeURIComponent"],[49,57,27,55],[49,58,27,56,"u"],[49,59,27,57],[49,60,27,58],[49,69,27,67],[49,70,27,68],[50,4,28,2],[50,11,28,9,"res"],[50,14,28,12],[50,15,28,13,"data"],[50,19,28,17],[51,2,29,0],[53,2,31,0],[54,2,32,0],[55,2,33,0],[56,2,34,0],[58,2,36,7],[58,17,36,22,"promoteHeroStar"],[58,32,36,37,"promoteHeroStar"],[58,33,36,38,"userHeroId"],[58,43,36,56],[58,45,36,58,"username"],[58,53,36,74],[58,55,36,76],[59,4,37,2],[59,10,37,8,"u"],[59,11,37,9],[59,14,37,12,"requireUsername"],[59,29,37,27],[59,30,37,28,"username"],[59,38,37,36],[59,39,37,37],[60,4,38,2],[60,10,38,8,"res"],[60,13,38,11],[60,16,38,14],[60,22,38,20,"api"],[60,25,38,23],[60,26,38,24,"post"],[60,30,38,28],[60,31,39,4],[60,40,39,13,"encodeURIComponent"],[60,58,39,31],[60,59,39,32,"userHeroId"],[60,69,39,42],[60,70,39,43],[60,85,39,58],[60,87,40,4],[60,91,40,8],[60,93,41,4],[61,6,41,6,"params"],[61,12,41,12],[61,14,41,14],[62,8,41,16,"username"],[62,16,41,24],[62,18,41,26,"u"],[63,6,41,28],[64,4,41,30],[64,5,42,2],[64,6,42,3],[65,4,43,2],[65,11,43,9,"res"],[65,14,43,12],[65,15,43,13,"data"],[65,19,43,17],[66,2,49,0],[68,2,51,0],[69,2,52,0],[70,2,53,0],[71,2,54,0],[72,2,55,0],[74,2,57,7],[74,17,57,22,"getHeroProgression"],[74,35,57,40,"getHeroProgression"],[74,36,57,41,"username"],[74,44,57,57],[74,46,57,59,"heroId"],[74,52,57,73],[74,54,57,75],[75,4,58,2],[75,10,58,8,"u"],[75,11,58,9],[75,14,58,12,"requireUsername"],[75,29,58,27],[75,30,58,28,"username"],[75,38,58,36],[75,39,58,37],[76,4,59,2],[76,10,59,8,"res"],[76,13,59,11],[76,16,59,14],[76,22,59,20,"api"],[76,25,59,23],[76,26,59,24,"get"],[76,29,59,27],[76,30,59,28],[76,39,59,37,"encodeURIComponent"],[76,57,59,55],[76,58,59,56,"u"],[76,59,59,57],[76,60,59,58],[76,69,59,67,"encodeURIComponent"],[76,87,59,85],[76,88,59,86,"heroId"],[76,94,59,92],[76,95,59,93],[76,109,59,107],[76,110,59,108],[77,4,60,2],[77,11,60,9,"res"],[77,14,60,12],[77,15,60,13,"data"],[77,19,60,17],[78,2,61,0],[80,2,63,0],[81,2,64,0],[82,2,65,0],[83,2,66,0],[84,2,67,0],[85,2,68,0],[87,2,70,7],[87,17,70,22,"getUserHeroById"],[87,32,70,37,"getUserHeroById"],[87,33,70,38,"username"],[87,41,70,54],[87,43,70,56,"userHeroId"],[87,53,70,74],[87,55,70,76],[88,4,71,2],[88,10,71,8,"u"],[88,11,71,9],[88,14,71,12,"requireUsername"],[88,29,71,27],[88,30,71,28,"username"],[88,38,71,36],[88,39,71,37],[89,4,72,2],[89,10,72,8,"res"],[89,13,72,11],[89,16,72,14],[89,22,72,20,"api"],[89,25,72,23],[89,26,72,24,"get"],[89,29,72,27],[89,30,72,28],[89,39,72,37,"encodeURIComponent"],[89,57,72,55],[89,58,72,56,"u"],[89,59,72,57],[89,60,72,58],[89,69,72,67],[89,70,72,68],[90,4,73,2],[90,10,73,8,"list"],[90,14,73,12],[90,17,73,15,"Array"],[90,22,73,20],[90,23,73,21,"isArray"],[90,30,73,28],[90,31,73,29,"res"],[90,34,73,32],[90,35,73,33,"data"],[90,39,73,37],[90,40,73,38],[90,43,73,41,"res"],[90,46,73,44],[90,47,73,45,"data"],[90,51,73,49],[90,54,73,53,"res"],[90,57,73,56],[90,58,73,57,"data"],[90,62,73,61],[90,64,73,63,"heroes"],[90,70,73,69],[90,74,73,73,"res"],[90,77,73,76],[90,78,73,77,"data"],[90,82,73,81],[90,86,73,85],[90,88,73,88],[91,4,74,2],[91,10,74,8,"found"],[91,15,74,13],[91,18,74,16,"list"],[91,22,74,20],[91,23,74,21,"find"],[91,27,74,25],[91,28,74,27,"h"],[91,29,74,33],[91,33,74,38,"String"],[91,39,74,44],[91,40,74,45,"h"],[91,41,74,46],[91,43,74,48,"id"],[91,45,74,50],[91,46,74,51],[91,51,74,56,"String"],[91,57,74,62],[91,58,74,63,"userHeroId"],[91,68,74,73],[91,69,74,74],[91,70,74,75],[92,4,75,2],[92,8,75,6],[92,9,75,7,"found"],[92,14,75,12],[92,16,75,14],[92,22,75,20],[92,26,75,24,"Error"],[92,31,75,29],[92,32,75,30],[92,48,75,46],[92,49,75,47],[93,4,76,2],[93,11,76,9,"found"],[93,16,76,14],[94,2,77,0],[96,2,79,0],[97,2,80,0],[98,2,81,0],[99,2,82,0],[101,2,84,7],[101,17,84,22,"getUserHeroes"],[101,30,84,35,"getUserHeroes"],[101,31,84,36,"username"],[101,39,84,52],[101,41,84,54],[102,4,85,2],[102,10,85,8,"u"],[102,11,85,9],[102,14,85,12,"requireUsername"],[102,29,85,27],[102,30,85,28,"username"],[102,38,85,36],[102,39,85,37],[103,4,86,2],[103,10,86,8,"res"],[103,13,86,11],[103,16,86,14],[103,22,86,20,"api"],[103,25,86,23],[103,26,86,24,"get"],[103,29,86,27],[103,30,86,28],[103,39,86,37,"encodeURIComponent"],[103,57,86,55],[103,58,86,56,"u"],[103,59,86,57],[103,60,86,58],[103,69,86,67],[103,70,86,68],[104,4,87,2],[104,11,87,9,"Array"],[104,16,87,14],[104,17,87,15,"isArray"],[104,24,87,22],[104,25,87,23,"res"],[104,28,87,26],[104,29,87,27,"data"],[104,33,87,31],[104,34,87,32],[104,37,87,35,"res"],[104,40,87,38],[104,41,87,39,"data"],[104,45,87,43],[104,48,87,47,"res"],[104,51,87,50],[104,52,87,51,"data"],[104,56,87,55],[104,58,87,57,"heroes"],[104,64,87,63],[104,68,87,67,"res"],[104,71,87,70],[104,72,87,71,"data"],[104,76,87,75],[104,80,87,79],[104,82,87,82],[105,2,88,0],[107,2,90,0],[108,2,91,0],[110,2,93,0],[111,2,94,0],[112,2,95,0],[114,2,97,7],[114,17,97,22,"fetchUser"],[114,26,97,31,"fetchUser"],[114,27,97,32,"username"],[114,35,97,48],[114,37,97,50],[115,4,98,2],[115,10,98,8,"u"],[115,11,98,9],[115,14,98,12,"requireUsername"],[115,29,98,27],[115,30,98,28,"username"],[115,38,98,36],[115,39,98,37],[116,4,99,2],[116,10,99,8,"res"],[116,13,99,11],[116,16,99,14],[116,22,99,20,"api"],[116,25,99,23],[116,26,99,24,"get"],[116,29,99,27],[116,30,99,28],[116,39,99,37,"encodeURIComponent"],[116,57,99,55],[116,58,99,56,"u"],[116,59,99,57],[116,60,99,58],[116,62,99,60],[116,63,99,61],[117,4,100,2],[117,11,100,9,"res"],[117,14,100,12],[117,15,100,13,"data"],[117,19,100,17],[118,2,101,0],[120,2,103,0],[121,2,104,0],[122,2,105,0],[124,2,107,7],[124,17,107,22,"performSummon"],[124,30,107,35,"performSummon"],[124,31,107,36,"username"],[124,39,107,52],[124,41,107,54,"summonType"],[124,51,107,84],[124,53,107,86],[125,4,108,2],[125,10,108,8,"u"],[125,11,108,9],[125,14,108,12,"requireUsername"],[125,29,108,27],[125,30,108,28,"username"],[125,38,108,36],[125,39,108,37],[126,4,109,2],[126,10,109,8,"res"],[126,13,109,11],[126,16,109,14],[126,22,109,20,"api"],[126,25,109,23],[126,26,109,24,"post"],[126,30,109,28],[126,31,109,29],[126,46,109,44],[126,48,109,46],[126,52,109,50],[126,54,109,52],[127,6,110,4,"params"],[127,12,110,10],[127,14,110,12],[128,8,110,14,"username"],[128,16,110,22],[128,18,110,24,"u"],[128,19,110,25],[129,8,110,27,"summon_type"],[129,19,110,38],[129,21,110,40,"summonType"],[130,6,110,51],[131,4,111,2],[131,5,111,3],[131,6,111,4],[132,4,112,2],[132,11,112,9,"res"],[132,14,112,12],[132,15,112,13,"data"],[132,19,112,17],[133,2,113,0],[135,2,115,0],[136,2,116,0],[137,0,116,0],[137,3]],"functionMap":{"names":["<global>","requireUsername","fetchUserHeroes","promoteHeroStar","getHeroProgression","getUserHeroById","list.find$argument_0","getUserHeroes","fetchUser","performSummon"],"mappings":"AAA;OCe;CDG;OEM;CFI;OGO;CHa;OIQ;CJI;OKS;0BCI,gDD;CLG;OOO;CPI;OQS;CRI;OSM;CTM"},"hasCjsExports":false},"type":"js/module"}]}