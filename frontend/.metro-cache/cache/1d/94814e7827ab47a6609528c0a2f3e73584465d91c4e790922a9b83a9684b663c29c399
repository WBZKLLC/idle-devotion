{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":15,"column":0,"index":470},"end":{"line":15,"column":42,"index":512}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"react-native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":16,"column":0,"index":513},"end":{"line":16,"column":61,"index":574}}],"key":"KyzuX10g6ixS9UfynhmjlvCIG3g=","exportNames":["*"],"imports":1}},{"name":"../stores/entitlementStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":575},"end":{"line":17,"column":65,"index":640}}],"key":"zpvG3AWVhfkzof5ZAFPvPaVLiPY=","exportNames":["*"],"imports":1}},{"name":"../stores/gameStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":641},"end":{"line":18,"column":51,"index":692}}],"key":"88DACCakTvhUP715XDIJ2LVpqh0=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$(); // /app/frontend/hooks/useAppResumeReconcile.ts\n  // Phase 3.14: App resume reconciliation hook\n  //\n  // CANONICAL ENTRY POINT for app resume freshness checks.\n  // This hook MUST be the ONLY place that listens to AppState for entitlements.\n  //\n  // STRICT RULES:\n  // - Do nothing if no user\n  // - Do nothing if already refreshing  \n  // - Do nothing if not stale (ensureFreshEntitlements handles this)\n  // - Never show alerts/toasts\n  // - Never block render\n  // - Fire and forget ONLY\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.useAppResumeReconcile = useAppResumeReconcile;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNative = require(_dependencyMap[1], \"react-native\");\n  var _storesEntitlementStore = require(_dependencyMap[2], \"../stores/entitlementStore\");\n  var _storesGameStore = require(_dependencyMap[3], \"../stores/gameStore\");\n  // Debug logging\n  var dlog = function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    if (__DEV__) console.log('[useAppResumeReconcile]', ...args);\n  };\n\n  /**\n   * Hook that reconciles entitlements when app returns to foreground.\n   * \n   * MUST be called from _layout.tsx SessionProvider ONLY.\n   * Guards enforce this is the only place using AppState for entitlements.\n   * \n   * Uses ensureFreshEntitlements('app_resume') which:\n   * - No-ops if no user\n   * - No-ops if already refreshing\n   * - No-ops if not stale (server-time TTL)\n   * - Silent background refresh otherwise\n   */\n  function useAppResumeReconcile() {\n    _s();\n    var user = (0, _storesGameStore.useGameStore)(s => s.user);\n    var ensureFreshEntitlements = (0, _storesEntitlementStore.useEntitlementStore)(s => s.ensureFreshEntitlements);\n\n    // Track previous app state to detect background -> active transition\n    var appStateRef = (0, _react.useRef)(_reactNative.AppState.currentState);\n    (0, _react.useEffect)(() => {\n      // Don't set up listener if no user logged in\n      // (listener will be set up when user logs in via component re-render)\n      if (!user) {\n        dlog('No user, skipping AppState listener setup');\n        return;\n      }\n      var handleAppStateChange = nextAppState => {\n        var previousState = appStateRef.current;\n        appStateRef.current = nextAppState;\n\n        // Only trigger on background/inactive -> active transition\n        if (previousState.match(/inactive|background/) && nextAppState === 'active') {\n          dlog('App resumed from background, triggering entitlements freshness check');\n\n          // Fire and forget - ensureFreshEntitlements handles all guards internally:\n          // - No-ops if already refreshing\n          // - No-ops if not stale (server-time TTL)\n          // - Silent refresh otherwise\n          ensureFreshEntitlements('app_resume').catch(() => {\n            // Silently ignore errors - never block or alert\n          });\n        }\n      };\n      dlog('Setting up AppState listener for user:', user.username);\n      var subscription = _reactNative.AppState.addEventListener('change', handleAppStateChange);\n      return () => {\n        dlog('Cleaning up AppState listener');\n        subscription.remove();\n      };\n    }, [user, ensureFreshEntitlements]);\n  }\n  _s(useAppResumeReconcile, \"hWkZ3Y7ZNsXboSb5LBInCfZsh/k=\", false, function () {\n    return [_storesGameStore.useGameStore, _storesEntitlementStore.useEntitlementStore];\n  });\n});","lineCount":87,"map":[[4,27,1,0],[5,2,2,0],[6,2,3,0],[7,2,4,0],[8,2,5,0],[9,2,6,0],[10,2,7,0],[11,2,8,0],[12,2,9,0],[13,2,10,0],[14,2,11,0],[15,2,12,0],[16,2,13,0],[17,2,13,0,"Object"],[17,8,13,0],[17,9,13,0,"defineProperty"],[17,23,13,0],[17,24,13,0,"exports"],[17,31,13,0],[18,4,13,0,"value"],[18,9,13,0],[19,2,13,0],[20,2,35,0,"exports"],[20,9,35,0],[20,10,35,0,"useAppResumeReconcile"],[20,31,35,0],[20,34,35,0,"useAppResumeReconcile"],[20,55,35,0],[21,2,15,0],[21,6,15,0,"_react"],[21,12,15,0],[21,15,15,0,"require"],[21,22,15,0],[21,23,15,0,"_dependencyMap"],[21,37,15,0],[22,2,16,0],[22,6,16,0,"_reactNative"],[22,18,16,0],[22,21,16,0,"require"],[22,28,16,0],[22,29,16,0,"_dependencyMap"],[22,43,16,0],[23,2,17,0],[23,6,17,0,"_storesEntitlementStore"],[23,29,17,0],[23,32,17,0,"require"],[23,39,17,0],[23,40,17,0,"_dependencyMap"],[23,54,17,0],[24,2,18,0],[24,6,18,0,"_storesGameStore"],[24,22,18,0],[24,25,18,0,"require"],[24,32,18,0],[24,33,18,0,"_dependencyMap"],[24,47,18,0],[25,2,20,0],[26,2,21,0],[26,6,21,6,"dlog"],[26,10,21,10],[26,13,21,13],[26,22,21,13,"dlog"],[26,23,21,13],[26,25,21,33],[27,4,21,33],[27,13,21,33,"_len"],[27,17,21,33],[27,20,21,33,"arguments"],[27,29,21,33],[27,30,21,33,"length"],[27,36,21,33],[27,38,21,17,"args"],[27,42,21,21],[27,49,21,21,"Array"],[27,54,21,21],[27,55,21,21,"_len"],[27,59,21,21],[27,62,21,21,"_key"],[27,66,21,21],[27,72,21,21,"_key"],[27,76,21,21],[27,79,21,21,"_len"],[27,83,21,21],[27,85,21,21,"_key"],[27,89,21,21],[28,6,21,17,"args"],[28,10,21,21],[28,11,21,21,"_key"],[28,15,21,21],[28,19,21,21,"arguments"],[28,28,21,21],[28,29,21,21,"_key"],[28,33,21,21],[29,4,21,21],[30,4,21,35],[30,8,21,39,"__DEV__"],[30,15,21,46],[30,17,21,48,"console"],[30,24,21,55],[30,25,21,56,"log"],[30,28,21,59],[30,29,21,60],[30,54,21,85],[30,56,21,87],[30,59,21,90,"args"],[30,63,21,94],[30,64,21,95],[31,2,21,97],[31,3,21,98],[33,2,23,0],[34,0,24,0],[35,0,25,0],[36,0,26,0],[37,0,27,0],[38,0,28,0],[39,0,29,0],[40,0,30,0],[41,0,31,0],[42,0,32,0],[43,0,33,0],[44,0,34,0],[45,2,35,7],[45,11,35,16,"useAppResumeReconcile"],[45,32,35,37,"useAppResumeReconcile"],[45,33,35,37],[45,35,35,46],[46,4,35,46,"_s"],[46,6,35,46],[47,4,36,2],[47,8,36,8,"user"],[47,12,36,12],[47,15,36,15],[47,19,36,15,"useGameStore"],[47,35,36,27],[47,36,36,27,"useGameStore"],[47,48,36,27],[47,50,36,28,"s"],[47,51,36,29],[47,55,36,33,"s"],[47,56,36,34],[47,57,36,35,"user"],[47,61,36,39],[47,62,36,40],[48,4,37,2],[48,8,37,8,"ensureFreshEntitlements"],[48,31,37,31],[48,34,37,34],[48,38,37,34,"useEntitlementStore"],[48,61,37,53],[48,62,37,53,"useEntitlementStore"],[48,81,37,53],[48,83,37,54,"s"],[48,84,37,55],[48,88,37,59,"s"],[48,89,37,60],[48,90,37,61,"ensureFreshEntitlements"],[48,113,37,84],[48,114,37,85],[50,4,39,2],[51,4,40,2],[51,8,40,8,"appStateRef"],[51,19,40,19],[51,22,40,22],[51,26,40,22,"useRef"],[51,32,40,28],[51,33,40,28,"useRef"],[51,39,40,28],[51,41,40,45,"AppState"],[51,53,40,53],[51,54,40,53,"AppState"],[51,62,40,53],[51,63,40,54,"currentState"],[51,75,40,66],[51,76,40,67],[52,4,42,2],[52,8,42,2,"useEffect"],[52,14,42,11],[52,15,42,11,"useEffect"],[52,24,42,11],[52,26,42,12],[52,32,42,18],[53,6,43,4],[54,6,44,4],[55,6,45,4],[55,10,45,8],[55,11,45,9,"user"],[55,15,45,13],[55,17,45,15],[56,8,46,6,"dlog"],[56,12,46,10],[56,13,46,11],[56,56,46,54],[56,57,46,55],[57,8,47,6],[58,6,48,4],[59,6,50,4],[59,10,50,10,"handleAppStateChange"],[59,30,50,30],[59,33,50,34,"nextAppState"],[59,45,50,62],[59,49,50,67],[60,8,51,6],[60,12,51,12,"previousState"],[60,25,51,25],[60,28,51,28,"appStateRef"],[60,39,51,39],[60,40,51,40,"current"],[60,47,51,47],[61,8,52,6,"appStateRef"],[61,19,52,17],[61,20,52,18,"current"],[61,27,52,25],[61,30,52,28,"nextAppState"],[61,42,52,40],[63,8,54,6],[64,8,55,6],[64,12,56,8,"previousState"],[64,25,56,21],[64,26,56,22,"match"],[64,31,56,27],[64,32,56,28],[64,53,56,49],[64,54,56,50],[64,58,57,8,"nextAppState"],[64,70,57,20],[64,75,57,25],[64,83,57,33],[64,85,58,8],[65,10,59,8,"dlog"],[65,14,59,12],[65,15,59,13],[65,85,59,83],[65,86,59,84],[67,10,61,8],[68,10,62,8],[69,10,63,8],[70,10,64,8],[71,10,65,8,"ensureFreshEntitlements"],[71,33,65,31],[71,34,65,32],[71,46,65,44],[71,47,65,45],[71,48,65,46,"catch"],[71,53,65,51],[71,54,65,52],[71,60,65,58],[72,12,66,10],[73,10,66,10],[73,11,67,9],[73,12,67,10],[74,8,68,6],[75,6,69,4],[75,7,69,5],[76,6,71,4,"dlog"],[76,10,71,8],[76,11,71,9],[76,51,71,49],[76,53,71,51,"user"],[76,57,71,55],[76,58,71,56,"username"],[76,66,71,64],[76,67,71,65],[77,6,72,4],[77,10,72,10,"subscription"],[77,22,72,22],[77,25,72,25,"AppState"],[77,37,72,33],[77,38,72,33,"AppState"],[77,46,72,33],[77,47,72,34,"addEventListener"],[77,63,72,50],[77,64,72,51],[77,72,72,59],[77,74,72,61,"handleAppStateChange"],[77,94,72,81],[77,95,72,82],[78,6,74,4],[78,13,74,11],[78,19,74,17],[79,8,75,6,"dlog"],[79,12,75,10],[79,13,75,11],[79,44,75,42],[79,45,75,43],[80,8,76,6,"subscription"],[80,20,76,18],[80,21,76,19,"remove"],[80,27,76,25],[80,28,76,26],[80,29,76,27],[81,6,77,4],[81,7,77,5],[82,4,78,2],[82,5,78,3],[82,7,78,5],[82,8,78,6,"user"],[82,12,78,10],[82,14,78,12,"ensureFreshEntitlements"],[82,37,78,35],[82,38,78,36],[82,39,78,37],[83,2,79,0],[84,2,79,1,"_s"],[84,4,79,1],[84,5,35,16,"useAppResumeReconcile"],[84,26,35,37],[85,4,35,37],[85,12,36,15,"useGameStore"],[85,28,36,27],[85,29,36,27,"useGameStore"],[85,41,36,27],[85,43,37,34,"useEntitlementStore"],[85,66,37,53],[85,67,37,53,"useEntitlementStore"],[85,86,37,53],[86,2,37,53],[87,0,37,53],[87,3]],"functionMap":{"names":["<global>","dlog","useAppResumeReconcile","useGameStore$argument_0","useEntitlementStore$argument_0","useEffect$argument_0","handleAppStateChange","ensureFreshEntitlements._catch$argument_0","<anonymous>"],"mappings":"AAA;aCoB,qFD;OEc;4BCC,WD;sDEC,8BF;YGK;iCCQ;oDCe;SDE;KDE;WGK;KHG;GHC;CFC"},"hasCjsExports":false},"type":"js/module"}]}