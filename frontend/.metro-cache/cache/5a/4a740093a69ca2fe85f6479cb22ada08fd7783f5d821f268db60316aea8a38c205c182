{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.isValidReceipt = isValidReceipt;\n  exports.isValidGachaReceipt = isValidGachaReceipt;\n  exports.assertValidReceipt = assertValidReceipt;\n  exports.getReceiptItemCount = getReceiptItemCount;\n  exports.formatReceiptItems = formatReceiptItems;\n  // /app/frontend/lib/types/receipt.ts\n  // Phase 3.24: Canonical Reward Receipt Type\n  // Phase 3.26: Added mail_receipt_claim source\n  // Phase 3.33: Added gacha summon sources\n  //\n  // Single source of truth for receipt shape.\n  // All reward-granting endpoints return this shape.\n  // Frontend MUST use this type for all receipt handling.\n  //\n  // LOCKED source values:\n  // - bond_tribute\n  // - mail_reward_claim\n  // - mail_gift_claim\n  // - mail_receipt_claim (Phase 3.26)\n  // - daily_login_claim\n  // - idle_claim\n  // - admin_grant\n  // - summon_single (Phase 3.33)\n  // - summon_multi (Phase 3.33)\n  // - pity_reward (Phase 3.33)\n\n  /**\n   * Valid reward source types (matches backend RewardSource)\n   */\n\n  // Phase 3.33: Pity system reward\n\n  /**\n   * Single reward item in a receipt\n   */\n\n  /**\n   * Phase 3.33: Gacha pull result item\n   */\n\n  /**\n   * Phase 3.33: Gacha summon receipt (extends canonical receipt)\n   */\n\n  /**\n   * User balance snapshot\n   */\n\n  /**\n   * Canonical receipt shape for all reward grants (Phase 3.24)\n   * \n   * REQUIRED fields: source, sourceId, items, balances\n   * All reward endpoints MUST return this shape.\n   */\n\n  /**\n   * Type guard: Check if an object is a valid RewardReceipt\n   */\n  function isValidReceipt(obj) {\n    if (!obj || typeof obj !== 'object') return false;\n    const receipt = obj;\n    return typeof receipt.source === 'string' && typeof receipt.sourceId === 'string' && Array.isArray(receipt.items) && typeof receipt.balances === 'object' && receipt.balances !== null;\n  }\n\n  /**\n   * Type guard: Check if an object is a valid GachaReceipt\n   */\n  function isValidGachaReceipt(obj) {\n    if (!isValidReceipt(obj)) return false;\n    const receipt = obj;\n    return (receipt.source === 'summon_single' || receipt.source === 'summon_multi' || receipt.source === 'pity_reward') && typeof receipt.bannerId === 'string' && typeof receipt.pullCount === 'number' && Array.isArray(receipt.results);\n  }\n\n  /**\n   * Validate and assert receipt shape (throws if invalid)\n   */\n  function assertValidReceipt(obj, context) {\n    if (!isValidReceipt(obj)) {\n      const msg = `Invalid receipt shape${context ? ` in ${context}` : ''}: ` + `missing source, sourceId, items, or balances`;\n      console.error('[RECEIPT_GUARD_FAILED]', msg, obj);\n      throw new Error(msg);\n    }\n  }\n\n  /**\n   * Extract total reward count from receipt\n   */\n  function getReceiptItemCount(receipt) {\n    return receipt.items.reduce((sum, item) => sum + item.amount, 0);\n  }\n\n  /**\n   * Format reward items for display\n   */\n  function formatReceiptItems(receipt) {\n    if (receipt.items.length === 0) {\n      return receipt.alreadyClaimed ? 'Already claimed' : 'No rewards';\n    }\n    return receipt.items.filter(item => item.amount > 0).map(item => `${item.amount.toLocaleString()} ${formatRewardType(item.type)}`).join(', ');\n  }\n\n  /**\n   * Format reward type for display\n   */\n  function formatRewardType(type) {\n    const typeMap = {\n      gold: 'Gold',\n      coins: 'Coins',\n      gems: 'Gems',\n      divine_gems: 'Divine Gems',\n      crystals: 'Crystals',\n      stamina: 'Stamina',\n      divine_essence: 'Divine Essence',\n      soul_dust: 'Soul Dust',\n      skill_essence: 'Skill Essence',\n      enhancement_stones: 'Enhancement Stones',\n      hero_shards: 'Hero Shards',\n      rune_essence: 'Rune Essence',\n      hero_unlock: 'Hero Unlock',\n      hero_shard: 'Hero Shards'\n    };\n    return typeMap[type] || type.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\n  }\n});","lineCount":130,"map":[[7,2,128,0,"exports"],[7,9,128,0],[7,10,128,0,"isValidReceipt"],[7,24,128,0],[7,27,128,0,"isValidReceipt"],[7,41,128,0],[8,2,144,0,"exports"],[8,9,144,0],[8,10,144,0,"isValidGachaReceipt"],[8,29,144,0],[8,32,144,0,"isValidGachaReceipt"],[8,51,144,0],[9,2,159,0,"exports"],[9,9,159,0],[9,10,159,0,"assertValidReceipt"],[9,28,159,0],[9,31,159,0,"assertValidReceipt"],[9,49,159,0],[10,2,171,0,"exports"],[10,9,171,0],[10,10,171,0,"getReceiptItemCount"],[10,29,171,0],[10,32,171,0,"getReceiptItemCount"],[10,51,171,0],[11,2,178,0,"exports"],[11,9,178,0],[11,10,178,0,"formatReceiptItems"],[11,28,178,0],[11,31,178,0,"formatReceiptItems"],[11,49,178,0],[12,2,1,0],[13,2,2,0],[14,2,3,0],[15,2,4,0],[16,2,5,0],[17,2,6,0],[18,2,7,0],[19,2,8,0],[20,2,9,0],[21,2,10,0],[22,2,11,0],[23,2,12,0],[24,2,13,0],[25,2,14,0],[26,2,15,0],[27,2,16,0],[28,2,17,0],[29,2,18,0],[30,2,19,0],[31,2,20,0],[33,2,22,0],[34,0,23,0],[35,0,24,0],[37,2,38,20],[39,2,40,0],[40,0,41,0],[41,0,42,0],[43,2,52,0],[44,0,53,0],[45,0,54,0],[47,2,70,0],[48,0,71,0],[49,0,72,0],[51,2,91,0],[52,0,92,0],[53,0,93,0],[55,2,110,0],[56,0,111,0],[57,0,112,0],[58,0,113,0],[59,0,114,0],[60,0,115,0],[62,2,125,0],[63,0,126,0],[64,0,127,0],[65,2,128,7],[65,11,128,16,"isValidReceipt"],[65,25,128,30,"isValidReceipt"],[65,26,128,31,"obj"],[65,29,128,43],[65,31,128,67],[66,4,129,2],[66,8,129,6],[66,9,129,7,"obj"],[66,12,129,10],[66,16,129,14],[66,23,129,21,"obj"],[66,26,129,24],[66,31,129,29],[66,39,129,37],[66,41,129,39],[66,48,129,46],[66,53,129,51],[67,4,130,2],[67,10,130,8,"receipt"],[67,17,130,15],[67,20,130,18,"obj"],[67,23,130,48],[68,4,132,2],[68,11,133,4],[68,18,133,11,"receipt"],[68,25,133,18],[68,26,133,19,"source"],[68,32,133,25],[68,37,133,30],[68,45,133,38],[68,49,134,4],[68,56,134,11,"receipt"],[68,63,134,18],[68,64,134,19,"sourceId"],[68,72,134,27],[68,77,134,32],[68,85,134,40],[68,89,135,4,"Array"],[68,94,135,9],[68,95,135,10,"isArray"],[68,102,135,17],[68,103,135,18,"receipt"],[68,110,135,25],[68,111,135,26,"items"],[68,116,135,31],[68,117,135,32],[68,121,136,4],[68,128,136,11,"receipt"],[68,135,136,18],[68,136,136,19,"balances"],[68,144,136,27],[68,149,136,32],[68,157,136,40],[68,161,137,4,"receipt"],[68,168,137,11],[68,169,137,12,"balances"],[68,177,137,20],[68,182,137,25],[68,186,137,29],[69,2,139,0],[71,2,141,0],[72,0,142,0],[73,0,143,0],[74,2,144,7],[74,11,144,16,"isValidGachaReceipt"],[74,30,144,35,"isValidGachaReceipt"],[74,31,144,36,"obj"],[74,34,144,48],[74,36,144,71],[75,4,145,2],[75,8,145,6],[75,9,145,7,"isValidReceipt"],[75,23,145,21],[75,24,145,22,"obj"],[75,27,145,25],[75,28,145,26],[75,30,145,28],[75,37,145,35],[75,42,145,40],[76,4,146,2],[76,10,146,8,"receipt"],[76,17,146,15],[76,20,146,18,"obj"],[76,23,146,59],[77,4,148,2],[77,11,149,4],[77,12,149,5,"receipt"],[77,19,149,12],[77,20,149,13,"source"],[77,26,149,19],[77,31,149,24],[77,46,149,39],[77,50,149,43,"receipt"],[77,57,149,50],[77,58,149,51,"source"],[77,64,149,57],[77,69,149,62],[77,83,149,76],[77,87,149,80,"receipt"],[77,94,149,87],[77,95,149,88,"source"],[77,101,149,94],[77,106,149,99],[77,119,149,112],[77,124,150,4],[77,131,150,11,"receipt"],[77,138,150,18],[77,139,150,19,"bannerId"],[77,147,150,27],[77,152,150,32],[77,160,150,40],[77,164,151,4],[77,171,151,11,"receipt"],[77,178,151,18],[77,179,151,19,"pullCount"],[77,188,151,28],[77,193,151,33],[77,201,151,41],[77,205,152,4,"Array"],[77,210,152,9],[77,211,152,10,"isArray"],[77,218,152,17],[77,219,152,18,"receipt"],[77,226,152,25],[77,227,152,26,"results"],[77,234,152,33],[77,235,152,34],[78,2,154,0],[80,2,156,0],[81,0,157,0],[82,0,158,0],[83,2,159,7],[83,11,159,16,"assertValidReceipt"],[83,29,159,34,"assertValidReceipt"],[83,30,159,35,"obj"],[83,33,159,47],[83,35,159,49,"context"],[83,42,159,65],[83,44,159,97],[84,4,160,2],[84,8,160,6],[84,9,160,7,"isValidReceipt"],[84,23,160,21],[84,24,160,22,"obj"],[84,27,160,25],[84,28,160,26],[84,30,160,28],[85,6,161,4],[85,12,161,10,"msg"],[85,15,161,13],[85,18,161,16],[85,42,161,40,"context"],[85,49,161,47],[85,52,161,50],[85,59,161,57,"context"],[85,66,161,64],[85,68,161,66],[85,71,161,69],[85,73,161,71],[85,77,161,75],[85,80,162,6],[85,126,162,52],[86,6,163,4,"console"],[86,13,163,11],[86,14,163,12,"error"],[86,19,163,17],[86,20,163,18],[86,44,163,42],[86,46,163,44,"msg"],[86,49,163,47],[86,51,163,49,"obj"],[86,54,163,52],[86,55,163,53],[87,6,164,4],[87,12,164,10],[87,16,164,14,"Error"],[87,21,164,19],[87,22,164,20,"msg"],[87,25,164,23],[87,26,164,24],[88,4,165,2],[89,2,166,0],[91,2,168,0],[92,0,169,0],[93,0,170,0],[94,2,171,7],[94,11,171,16,"getReceiptItemCount"],[94,30,171,35,"getReceiptItemCount"],[94,31,171,36,"receipt"],[94,38,171,58],[94,40,171,68],[95,4,172,2],[95,11,172,9,"receipt"],[95,18,172,16],[95,19,172,17,"items"],[95,24,172,22],[95,25,172,23,"reduce"],[95,31,172,29],[95,32,172,30],[95,33,172,31,"sum"],[95,36,172,34],[95,38,172,36,"item"],[95,42,172,40],[95,47,172,45,"sum"],[95,50,172,48],[95,53,172,51,"item"],[95,57,172,55],[95,58,172,56,"amount"],[95,64,172,62],[95,66,172,64],[95,67,172,65],[95,68,172,66],[96,2,173,0],[98,2,175,0],[99,0,176,0],[100,0,177,0],[101,2,178,7],[101,11,178,16,"formatReceiptItems"],[101,29,178,34,"formatReceiptItems"],[101,30,178,35,"receipt"],[101,37,178,57],[101,39,178,67],[102,4,179,2],[102,8,179,6,"receipt"],[102,15,179,13],[102,16,179,14,"items"],[102,21,179,19],[102,22,179,20,"length"],[102,28,179,26],[102,33,179,31],[102,34,179,32],[102,36,179,34],[103,6,180,4],[103,13,180,11,"receipt"],[103,20,180,18],[103,21,180,19,"alreadyClaimed"],[103,35,180,33],[103,38,180,36],[103,55,180,53],[103,58,180,56],[103,70,180,68],[104,4,181,2],[105,4,183,2],[105,11,183,9,"receipt"],[105,18,183,16],[105,19,183,17,"items"],[105,24,183,22],[105,25,184,5,"filter"],[105,31,184,11],[105,32,184,12,"item"],[105,36,184,16],[105,40,184,20,"item"],[105,44,184,24],[105,45,184,25,"amount"],[105,51,184,31],[105,54,184,34],[105,55,184,35],[105,56,184,36],[105,57,185,5,"map"],[105,60,185,8],[105,61,185,9,"item"],[105,65,185,13],[105,69,185,17],[105,72,185,20,"item"],[105,76,185,24],[105,77,185,25,"amount"],[105,83,185,31],[105,84,185,32,"toLocaleString"],[105,98,185,46],[105,99,185,47],[105,100,185,48],[105,104,185,52,"formatRewardType"],[105,120,185,68],[105,121,185,69,"item"],[105,125,185,73],[105,126,185,74,"type"],[105,130,185,78],[105,131,185,79],[105,133,185,81],[105,134,185,82],[105,135,186,5,"join"],[105,139,186,9],[105,140,186,10],[105,144,186,14],[105,145,186,15],[106,2,187,0],[108,2,189,0],[109,0,190,0],[110,0,191,0],[111,2,192,0],[111,11,192,9,"formatRewardType"],[111,27,192,25,"formatRewardType"],[111,28,192,26,"type"],[111,32,192,38],[111,34,192,48],[112,4,193,2],[112,10,193,8,"typeMap"],[112,17,193,39],[112,20,193,42],[113,6,194,4,"gold"],[113,10,194,8],[113,12,194,10],[113,18,194,16],[114,6,195,4,"coins"],[114,11,195,9],[114,13,195,11],[114,20,195,18],[115,6,196,4,"gems"],[115,10,196,8],[115,12,196,10],[115,18,196,16],[116,6,197,4,"divine_gems"],[116,17,197,15],[116,19,197,17],[116,32,197,30],[117,6,198,4,"crystals"],[117,14,198,12],[117,16,198,14],[117,26,198,24],[118,6,199,4,"stamina"],[118,13,199,11],[118,15,199,13],[118,24,199,22],[119,6,200,4,"divine_essence"],[119,20,200,18],[119,22,200,20],[119,38,200,36],[120,6,201,4,"soul_dust"],[120,15,201,13],[120,17,201,15],[120,28,201,26],[121,6,202,4,"skill_essence"],[121,19,202,17],[121,21,202,19],[121,36,202,34],[122,6,203,4,"enhancement_stones"],[122,24,203,22],[122,26,203,24],[122,46,203,44],[123,6,204,4,"hero_shards"],[123,17,204,15],[123,19,204,17],[123,32,204,30],[124,6,205,4,"rune_essence"],[124,18,205,16],[124,20,205,18],[124,34,205,32],[125,6,206,4,"hero_unlock"],[125,17,206,15],[125,19,206,17],[125,32,206,30],[126,6,207,4,"hero_shard"],[126,16,207,14],[126,18,207,16],[127,4,208,2],[127,5,208,3],[128,4,210,2],[128,11,210,9,"typeMap"],[128,18,210,16],[128,19,210,17,"type"],[128,23,210,21],[128,24,210,22],[128,28,210,26,"type"],[128,32,210,30],[128,33,210,31,"replace"],[128,40,210,38],[128,41,210,39],[128,45,210,43],[128,47,210,45],[128,50,210,48],[128,51,210,49],[128,52,210,50,"replace"],[128,59,210,57],[128,60,210,58],[128,67,210,65],[128,69,210,67,"c"],[128,70,210,68],[128,74,210,72,"c"],[128,75,210,73],[128,76,210,74,"toUpperCase"],[128,87,210,85],[128,88,210,86],[128,89,210,87],[128,90,210,88],[129,2,211,0],[130,0,211,1],[130,3]],"functionMap":{"names":["<global>","isValidReceipt","isValidGachaReceipt","assertValidReceipt","getReceiptItemCount","items.reduce$argument_0","formatReceiptItems","items.filter$argument_0","items.filter.map$argument_0","formatRewardType","type.replace.replace$argument_1"],"mappings":"AAA;OC+H;CDW;OEK;CFU;OGK;CHO;OIK;8BCC,gCD;CJC;OMK;YCM,uBD;SEC,wEF;CNE;ASK;mECkB,oBD;CTC"},"hasCjsExports":false},"type":"js/module"}]}