{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.isValidReceipt = isValidReceipt;\n  exports.assertValidReceipt = assertValidReceipt;\n  exports.getReceiptItemCount = getReceiptItemCount;\n  exports.formatReceiptItems = formatReceiptItems;\n  // /app/frontend/lib/types/receipt.ts\n  // Phase 3.24: Canonical Reward Receipt Type\n  // Phase 3.26: Added mail_receipt_claim source\n  //\n  // Single source of truth for receipt shape.\n  // All reward-granting endpoints return this shape.\n  // Frontend MUST use this type for all receipt handling.\n  //\n  // LOCKED source values:\n  // - bond_tribute\n  // - mail_reward_claim\n  // - mail_gift_claim\n  // - mail_receipt_claim (Phase 3.26)\n  // - daily_login_claim\n  // - idle_claim\n  // - admin_grant\n\n  /**\n   * Valid reward source types (matches backend RewardSource)\n   */\n\n  /**\n   * Single reward item in a receipt\n   */\n\n  /**\n   * User balance snapshot\n   */\n\n  /**\n   * Canonical receipt shape for all reward grants (Phase 3.24)\n   * \n   * REQUIRED fields: source, sourceId, items, balances\n   * All reward endpoints MUST return this shape.\n   */\n\n  /**\n   * Type guard: Check if an object is a valid RewardReceipt\n   */\n  function isValidReceipt(obj) {\n    if (!obj || typeof obj !== 'object') return false;\n    const receipt = obj;\n    return typeof receipt.source === 'string' && typeof receipt.sourceId === 'string' && Array.isArray(receipt.items) && typeof receipt.balances === 'object' && receipt.balances !== null;\n  }\n\n  /**\n   * Validate and assert receipt shape (throws if invalid)\n   */\n  function assertValidReceipt(obj, context) {\n    if (!isValidReceipt(obj)) {\n      const msg = `Invalid receipt shape${context ? ` in ${context}` : ''}: ` + `missing source, sourceId, items, or balances`;\n      console.error('[RECEIPT_GUARD_FAILED]', msg, obj);\n      throw new Error(msg);\n    }\n  }\n\n  /**\n   * Extract total reward count from receipt\n   */\n  function getReceiptItemCount(receipt) {\n    return receipt.items.reduce((sum, item) => sum + item.amount, 0);\n  }\n\n  /**\n   * Format reward items for display\n   */\n  function formatReceiptItems(receipt) {\n    if (receipt.items.length === 0) {\n      return receipt.alreadyClaimed ? 'Already claimed' : 'No rewards';\n    }\n    return receipt.items.filter(item => item.amount > 0).map(item => `${item.amount.toLocaleString()} ${formatRewardType(item.type)}`).join(', ');\n  }\n\n  /**\n   * Format reward type for display\n   */\n  function formatRewardType(type) {\n    const typeMap = {\n      gold: 'Gold',\n      coins: 'Coins',\n      gems: 'Gems',\n      divine_gems: 'Divine Gems',\n      crystals: 'Crystals',\n      stamina: 'Stamina',\n      divine_essence: 'Divine Essence',\n      soul_dust: 'Soul Dust',\n      skill_essence: 'Skill Essence',\n      enhancement_stones: 'Enhancement Stones',\n      hero_shards: 'Hero Shards',\n      rune_essence: 'Rune Essence'\n    };\n    return typeMap[type] || type.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\n  }\n});","lineCount":104,"map":[[7,2,77,0,"exports"],[7,9,77,0],[7,10,77,0,"isValidReceipt"],[7,24,77,0],[7,27,77,0,"isValidReceipt"],[7,41,77,0],[8,2,93,0,"exports"],[8,9,93,0],[8,10,93,0,"assertValidReceipt"],[8,28,93,0],[8,31,93,0,"assertValidReceipt"],[8,49,93,0],[9,2,105,0,"exports"],[9,9,105,0],[9,10,105,0,"getReceiptItemCount"],[9,29,105,0],[9,32,105,0,"getReceiptItemCount"],[9,51,105,0],[10,2,112,0,"exports"],[10,9,112,0],[10,10,112,0,"formatReceiptItems"],[10,28,112,0],[10,31,112,0,"formatReceiptItems"],[10,49,112,0],[11,2,1,0],[12,2,2,0],[13,2,3,0],[14,2,4,0],[15,2,5,0],[16,2,6,0],[17,2,7,0],[18,2,8,0],[19,2,9,0],[20,2,10,0],[21,2,11,0],[22,2,12,0],[23,2,13,0],[24,2,14,0],[25,2,15,0],[26,2,16,0],[28,2,18,0],[29,0,19,0],[30,0,20,0],[32,2,30,0],[33,0,31,0],[34,0,32,0],[36,2,40,0],[37,0,41,0],[38,0,42,0],[40,2,59,0],[41,0,60,0],[42,0,61,0],[43,0,62,0],[44,0,63,0],[45,0,64,0],[47,2,74,0],[48,0,75,0],[49,0,76,0],[50,2,77,7],[50,11,77,16,"isValidReceipt"],[50,25,77,30,"isValidReceipt"],[50,26,77,31,"obj"],[50,29,77,43],[50,31,77,67],[51,4,78,2],[51,8,78,6],[51,9,78,7,"obj"],[51,12,78,10],[51,16,78,14],[51,23,78,21,"obj"],[51,26,78,24],[51,31,78,29],[51,39,78,37],[51,41,78,39],[51,48,78,46],[51,53,78,51],[52,4,79,2],[52,10,79,8,"receipt"],[52,17,79,15],[52,20,79,18,"obj"],[52,23,79,48],[53,4,81,2],[53,11,82,4],[53,18,82,11,"receipt"],[53,25,82,18],[53,26,82,19,"source"],[53,32,82,25],[53,37,82,30],[53,45,82,38],[53,49,83,4],[53,56,83,11,"receipt"],[53,63,83,18],[53,64,83,19,"sourceId"],[53,72,83,27],[53,77,83,32],[53,85,83,40],[53,89,84,4,"Array"],[53,94,84,9],[53,95,84,10,"isArray"],[53,102,84,17],[53,103,84,18,"receipt"],[53,110,84,25],[53,111,84,26,"items"],[53,116,84,31],[53,117,84,32],[53,121,85,4],[53,128,85,11,"receipt"],[53,135,85,18],[53,136,85,19,"balances"],[53,144,85,27],[53,149,85,32],[53,157,85,40],[53,161,86,4,"receipt"],[53,168,86,11],[53,169,86,12,"balances"],[53,177,86,20],[53,182,86,25],[53,186,86,29],[54,2,88,0],[56,2,90,0],[57,0,91,0],[58,0,92,0],[59,2,93,7],[59,11,93,16,"assertValidReceipt"],[59,29,93,34,"assertValidReceipt"],[59,30,93,35,"obj"],[59,33,93,47],[59,35,93,49,"context"],[59,42,93,65],[59,44,93,97],[60,4,94,2],[60,8,94,6],[60,9,94,7,"isValidReceipt"],[60,23,94,21],[60,24,94,22,"obj"],[60,27,94,25],[60,28,94,26],[60,30,94,28],[61,6,95,4],[61,12,95,10,"msg"],[61,15,95,13],[61,18,95,16],[61,42,95,40,"context"],[61,49,95,47],[61,52,95,50],[61,59,95,57,"context"],[61,66,95,64],[61,68,95,66],[61,71,95,69],[61,73,95,71],[61,77,95,75],[61,80,96,6],[61,126,96,52],[62,6,97,4,"console"],[62,13,97,11],[62,14,97,12,"error"],[62,19,97,17],[62,20,97,18],[62,44,97,42],[62,46,97,44,"msg"],[62,49,97,47],[62,51,97,49,"obj"],[62,54,97,52],[62,55,97,53],[63,6,98,4],[63,12,98,10],[63,16,98,14,"Error"],[63,21,98,19],[63,22,98,20,"msg"],[63,25,98,23],[63,26,98,24],[64,4,99,2],[65,2,100,0],[67,2,102,0],[68,0,103,0],[69,0,104,0],[70,2,105,7],[70,11,105,16,"getReceiptItemCount"],[70,30,105,35,"getReceiptItemCount"],[70,31,105,36,"receipt"],[70,38,105,58],[70,40,105,68],[71,4,106,2],[71,11,106,9,"receipt"],[71,18,106,16],[71,19,106,17,"items"],[71,24,106,22],[71,25,106,23,"reduce"],[71,31,106,29],[71,32,106,30],[71,33,106,31,"sum"],[71,36,106,34],[71,38,106,36,"item"],[71,42,106,40],[71,47,106,45,"sum"],[71,50,106,48],[71,53,106,51,"item"],[71,57,106,55],[71,58,106,56,"amount"],[71,64,106,62],[71,66,106,64],[71,67,106,65],[71,68,106,66],[72,2,107,0],[74,2,109,0],[75,0,110,0],[76,0,111,0],[77,2,112,7],[77,11,112,16,"formatReceiptItems"],[77,29,112,34,"formatReceiptItems"],[77,30,112,35,"receipt"],[77,37,112,57],[77,39,112,67],[78,4,113,2],[78,8,113,6,"receipt"],[78,15,113,13],[78,16,113,14,"items"],[78,21,113,19],[78,22,113,20,"length"],[78,28,113,26],[78,33,113,31],[78,34,113,32],[78,36,113,34],[79,6,114,4],[79,13,114,11,"receipt"],[79,20,114,18],[79,21,114,19,"alreadyClaimed"],[79,35,114,33],[79,38,114,36],[79,55,114,53],[79,58,114,56],[79,70,114,68],[80,4,115,2],[81,4,117,2],[81,11,117,9,"receipt"],[81,18,117,16],[81,19,117,17,"items"],[81,24,117,22],[81,25,118,5,"filter"],[81,31,118,11],[81,32,118,12,"item"],[81,36,118,16],[81,40,118,20,"item"],[81,44,118,24],[81,45,118,25,"amount"],[81,51,118,31],[81,54,118,34],[81,55,118,35],[81,56,118,36],[81,57,119,5,"map"],[81,60,119,8],[81,61,119,9,"item"],[81,65,119,13],[81,69,119,17],[81,72,119,20,"item"],[81,76,119,24],[81,77,119,25,"amount"],[81,83,119,31],[81,84,119,32,"toLocaleString"],[81,98,119,46],[81,99,119,47],[81,100,119,48],[81,104,119,52,"formatRewardType"],[81,120,119,68],[81,121,119,69,"item"],[81,125,119,73],[81,126,119,74,"type"],[81,130,119,78],[81,131,119,79],[81,133,119,81],[81,134,119,82],[81,135,120,5,"join"],[81,139,120,9],[81,140,120,10],[81,144,120,14],[81,145,120,15],[82,2,121,0],[84,2,123,0],[85,0,124,0],[86,0,125,0],[87,2,126,0],[87,11,126,9,"formatRewardType"],[87,27,126,25,"formatRewardType"],[87,28,126,26,"type"],[87,32,126,38],[87,34,126,48],[88,4,127,2],[88,10,127,8,"typeMap"],[88,17,127,39],[88,20,127,42],[89,6,128,4,"gold"],[89,10,128,8],[89,12,128,10],[89,18,128,16],[90,6,129,4,"coins"],[90,11,129,9],[90,13,129,11],[90,20,129,18],[91,6,130,4,"gems"],[91,10,130,8],[91,12,130,10],[91,18,130,16],[92,6,131,4,"divine_gems"],[92,17,131,15],[92,19,131,17],[92,32,131,30],[93,6,132,4,"crystals"],[93,14,132,12],[93,16,132,14],[93,26,132,24],[94,6,133,4,"stamina"],[94,13,133,11],[94,15,133,13],[94,24,133,22],[95,6,134,4,"divine_essence"],[95,20,134,18],[95,22,134,20],[95,38,134,36],[96,6,135,4,"soul_dust"],[96,15,135,13],[96,17,135,15],[96,28,135,26],[97,6,136,4,"skill_essence"],[97,19,136,17],[97,21,136,19],[97,36,136,34],[98,6,137,4,"enhancement_stones"],[98,24,137,22],[98,26,137,24],[98,46,137,44],[99,6,138,4,"hero_shards"],[99,17,138,15],[99,19,138,17],[99,32,138,30],[100,6,139,4,"rune_essence"],[100,18,139,16],[100,20,139,18],[101,4,140,2],[101,5,140,3],[102,4,142,2],[102,11,142,9,"typeMap"],[102,18,142,16],[102,19,142,17,"type"],[102,23,142,21],[102,24,142,22],[102,28,142,26,"type"],[102,32,142,30],[102,33,142,31,"replace"],[102,40,142,38],[102,41,142,39],[102,45,142,43],[102,47,142,45],[102,50,142,48],[102,51,142,49],[102,52,142,50,"replace"],[102,59,142,57],[102,60,142,58],[102,67,142,65],[102,69,142,67,"c"],[102,70,142,68],[102,74,142,72,"c"],[102,75,142,73],[102,76,142,74,"toUpperCase"],[102,87,142,85],[102,88,142,86],[102,89,142,87],[102,90,142,88],[103,2,143,0],[104,0,143,1],[104,3]],"functionMap":{"names":["<global>","isValidReceipt","assertValidReceipt","getReceiptItemCount","items.reduce$argument_0","formatReceiptItems","items.filter$argument_0","items.filter.map$argument_0","formatRewardType","type.replace.replace$argument_1"],"mappings":"AAA;OC4E;CDW;OEK;CFO;OGK;8BCC,gCD;CHC;OKK;YCM,uBD;SEC,wEF;CLE;AQK;mECgB,oBD;CRC"},"hasCjsExports":false},"type":"js/module"}]}