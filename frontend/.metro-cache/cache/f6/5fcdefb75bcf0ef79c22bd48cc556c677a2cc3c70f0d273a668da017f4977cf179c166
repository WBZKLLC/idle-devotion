{"dependencies":[{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"5y7e5+zC7teYEEC6niD9f5zII1M=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _slicedToArray = require(_dependencyMap[0], \"@babel/runtime/helpers/slicedToArray\").default;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n\n  // Intentionally keeping the key broad, as we don't know for sure what rate limit headers get returned from backend\n\n  var DEFAULT_RETRY_AFTER = 60 * 1000; // 60 seconds\n\n  /**\n   * Extracts Retry-After value from the request header or returns default value\n   * @param header string representation of 'Retry-After' header\n   * @param now current unix timestamp\n   *\n   */\n  function parseRetryAfterHeader(header) {\n    var now = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Date.now();\n    var headerDelay = parseInt(`${header}`, 10);\n    if (!isNaN(headerDelay)) {\n      return headerDelay * 1000;\n    }\n    var headerDate = Date.parse(`${header}`);\n    if (!isNaN(headerDate)) {\n      return headerDate - now;\n    }\n    return DEFAULT_RETRY_AFTER;\n  }\n\n  /**\n   * Gets the time that the given category is disabled until for rate limiting.\n   * In case no category-specific limit is set but a general rate limit across all categories is active,\n   * that time is returned.\n   *\n   * @return the time in ms that the category is disabled until or 0 if there's no active rate limit.\n   */\n  function disabledUntil(limits, category) {\n    return limits[category] || limits.all || 0;\n  }\n\n  /**\n   * Checks if a category is rate limited\n   */\n  function isRateLimited(limits, category) {\n    var now = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Date.now();\n    return disabledUntil(limits, category) > now;\n  }\n\n  /**\n   * Update ratelimits from incoming headers.\n   *\n   * @return the updated RateLimits object.\n   */\n  function updateRateLimits(limits, _ref) {\n    var statusCode = _ref.statusCode,\n      headers = _ref.headers;\n    var now = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Date.now();\n    var updatedRateLimits = {\n      ...limits\n    };\n\n    // \"The name is case-insensitive.\"\n    // https://developer.mozilla.org/en-US/docs/Web/API/Headers/get\n    var rateLimitHeader = headers && headers['x-sentry-rate-limits'];\n    var retryAfterHeader = headers && headers['retry-after'];\n    if (rateLimitHeader) {\n      /**\n       * rate limit headers are of the form\n       *     <header>,<header>,..\n       * where each <header> is of the form\n       *     <retry_after>: <categories>: <scope>: <reason_code>\n       * where\n       *     <retry_after> is a delay in seconds\n       *     <categories> is the event type(s) (error, transaction, etc) being rate limited and is of the form\n       *         <category>;<category>;...\n       *     <scope> is what's being limited (org, project, or key) - ignored by SDK\n       *     <reason_code> is an arbitrary string like \"org_quota\" - ignored by SDK\n       */\n      for (var limit of rateLimitHeader.trim().split(',')) {\n        var _limit$split = limit.split(':', 2),\n          _limit$split2 = _slicedToArray(_limit$split, 2),\n          retryAfter = _limit$split2[0],\n          categories = _limit$split2[1];\n        var headerDelay = parseInt(retryAfter, 10);\n        var delay = (!isNaN(headerDelay) ? headerDelay : 60) * 1000; // 60sec default\n        if (!categories) {\n          updatedRateLimits.all = now + delay;\n        } else {\n          for (var category of categories.split(';')) {\n            updatedRateLimits[category] = now + delay;\n          }\n        }\n      }\n    } else if (retryAfterHeader) {\n      updatedRateLimits.all = now + parseRetryAfterHeader(retryAfterHeader, now);\n    } else if (statusCode === 429) {\n      updatedRateLimits.all = now + 60 * 1000;\n    }\n    return updatedRateLimits;\n  }\n  exports.DEFAULT_RETRY_AFTER = DEFAULT_RETRY_AFTER;\n  exports.disabledUntil = disabledUntil;\n  exports.isRateLimited = isRateLimited;\n  exports.parseRetryAfterHeader = parseRetryAfterHeader;\n  exports.updateRateLimits = updateRateLimits;\n});","lineCount":106,"map":[[3,2,1,0,"Object"],[3,8,1,6],[3,9,1,7,"defineProperty"],[3,23,1,21],[3,24,1,22,"exports"],[3,31,1,29],[3,33,1,31],[3,45,1,43],[3,47,1,45],[4,4,1,47,"value"],[4,9,1,52],[4,11,1,54],[5,2,1,59],[5,3,1,60],[5,4,1,61],[7,2,3,0],[9,2,5,0],[9,6,5,6,"DEFAULT_RETRY_AFTER"],[9,25,5,25],[9,28,5,28],[9,30,5,30],[9,33,5,33],[9,37,5,37],[9,38,5,38],[9,39,5,39],[11,2,7,0],[12,0,8,0],[13,0,9,0],[14,0,10,0],[15,0,11,0],[16,0,12,0],[17,2,13,0],[17,11,13,9,"parseRetryAfterHeader"],[17,32,13,30,"parseRetryAfterHeader"],[17,33,13,31,"header"],[17,39,13,37],[17,41,13,57],[18,4,13,57],[18,8,13,39,"now"],[18,11,13,42],[18,14,13,42,"arguments"],[18,23,13,42],[18,24,13,42,"length"],[18,30,13,42],[18,38,13,42,"arguments"],[18,47,13,42],[18,55,13,42,"undefined"],[18,64,13,42],[18,67,13,42,"arguments"],[18,76,13,42],[18,82,13,45,"Date"],[18,86,13,49],[18,87,13,50,"now"],[18,90,13,53],[18,91,13,54],[18,92,13,55],[19,4,14,2],[19,8,14,8,"headerDelay"],[19,19,14,19],[19,22,14,22,"parseInt"],[19,30,14,30],[19,31,14,31],[19,34,14,34,"header"],[19,40,14,40],[19,42,14,42],[19,44,14,44],[19,46,14,46],[19,47,14,47],[20,4,15,2],[20,8,15,6],[20,9,15,7,"isNaN"],[20,14,15,12],[20,15,15,13,"headerDelay"],[20,26,15,24],[20,27,15,25],[20,29,15,27],[21,6,16,4],[21,13,16,11,"headerDelay"],[21,24,16,22],[21,27,16,25],[21,31,16,29],[22,4,17,2],[23,4,19,2],[23,8,19,8,"headerDate"],[23,18,19,18],[23,21,19,21,"Date"],[23,25,19,25],[23,26,19,26,"parse"],[23,31,19,31],[23,32,19,32],[23,35,19,35,"header"],[23,41,19,41],[23,43,19,43],[23,44,19,44],[24,4,20,2],[24,8,20,6],[24,9,20,7,"isNaN"],[24,14,20,12],[24,15,20,13,"headerDate"],[24,25,20,23],[24,26,20,24],[24,28,20,26],[25,6,21,4],[25,13,21,11,"headerDate"],[25,23,21,21],[25,26,21,24,"now"],[25,29,21,27],[26,4,22,2],[27,4,24,2],[27,11,24,9,"DEFAULT_RETRY_AFTER"],[27,30,24,28],[28,2,25,0],[30,2,27,0],[31,0,28,0],[32,0,29,0],[33,0,30,0],[34,0,31,0],[35,0,32,0],[36,0,33,0],[37,2,34,0],[37,11,34,9,"disabledUntil"],[37,24,34,22,"disabledUntil"],[37,25,34,23,"limits"],[37,31,34,29],[37,33,34,31,"category"],[37,41,34,39],[37,43,34,41],[38,4,35,2],[38,11,35,9,"limits"],[38,17,35,15],[38,18,35,16,"category"],[38,26,35,24],[38,27,35,25],[38,31,35,29,"limits"],[38,37,35,35],[38,38,35,36,"all"],[38,41,35,39],[38,45,35,43],[38,46,35,44],[39,2,36,0],[41,2,38,0],[42,0,39,0],[43,0,40,0],[44,2,41,0],[44,11,41,9,"isRateLimited"],[44,24,41,22,"isRateLimited"],[44,25,41,23,"limits"],[44,31,41,29],[44,33,41,31,"category"],[44,41,41,39],[44,43,41,59],[45,4,41,59],[45,8,41,41,"now"],[45,11,41,44],[45,14,41,44,"arguments"],[45,23,41,44],[45,24,41,44,"length"],[45,30,41,44],[45,38,41,44,"arguments"],[45,47,41,44],[45,55,41,44,"undefined"],[45,64,41,44],[45,67,41,44,"arguments"],[45,76,41,44],[45,82,41,47,"Date"],[45,86,41,51],[45,87,41,52,"now"],[45,90,41,55],[45,91,41,56],[45,92,41,57],[46,4,42,2],[46,11,42,9,"disabledUntil"],[46,24,42,22],[46,25,42,23,"limits"],[46,31,42,29],[46,33,42,31,"category"],[46,41,42,39],[46,42,42,40],[46,45,42,43,"now"],[46,48,42,46],[47,2,43,0],[49,2,45,0],[50,0,46,0],[51,0,47,0],[52,0,48,0],[53,0,49,0],[54,2,50,0],[54,11,50,9,"updateRateLimits"],[54,27,50,25,"updateRateLimits"],[54,28,51,2,"limits"],[54,34,51,8],[54,36,51,8,"_ref"],[54,40,51,8],[54,42,54,2],[55,4,54,2],[55,8,52,4,"statusCode"],[55,18,52,14],[55,21,52,14,"_ref"],[55,25,52,14],[55,26,52,4,"statusCode"],[55,36,52,14],[56,6,52,16,"headers"],[56,13,52,23],[56,16,52,23,"_ref"],[56,20,52,23],[56,21,52,16,"headers"],[56,28,52,23],[57,4,52,23],[57,8,53,2,"now"],[57,11,53,5],[57,14,53,5,"arguments"],[57,23,53,5],[57,24,53,5,"length"],[57,30,53,5],[57,38,53,5,"arguments"],[57,47,53,5],[57,55,53,5,"undefined"],[57,64,53,5],[57,67,53,5,"arguments"],[57,76,53,5],[57,82,53,8,"Date"],[57,86,53,12],[57,87,53,13,"now"],[57,90,53,16],[57,91,53,17],[57,92,53,18],[58,4,55,2],[58,8,55,8,"updatedRateLimits"],[58,25,55,25],[58,28,55,28],[59,6,56,4],[59,9,56,7,"limits"],[60,4,57,2],[60,5,57,3],[62,4,59,2],[63,4,60,2],[64,4,61,2],[64,8,61,8,"rateLimitHeader"],[64,23,61,23],[64,26,61,26,"headers"],[64,33,61,33],[64,37,61,37,"headers"],[64,44,61,44],[64,45,61,45],[64,67,61,67],[64,68,61,68],[65,4,62,2],[65,8,62,8,"retryAfterHeader"],[65,24,62,24],[65,27,62,27,"headers"],[65,34,62,34],[65,38,62,38,"headers"],[65,45,62,45],[65,46,62,46],[65,59,62,59],[65,60,62,60],[66,4,64,2],[66,8,64,6,"rateLimitHeader"],[66,23,64,21],[66,25,64,23],[67,6,65,4],[68,0,66,0],[69,0,67,0],[70,0,68,0],[71,0,69,0],[72,0,70,0],[73,0,71,0],[74,0,72,0],[75,0,73,0],[76,0,74,0],[77,0,75,0],[78,0,76,0],[79,6,77,4],[79,11,77,9],[79,15,77,15,"limit"],[79,20,77,20],[79,24,77,24,"rateLimitHeader"],[79,39,77,39],[79,40,77,40,"trim"],[79,44,77,44],[79,45,77,45],[79,46,77,46],[79,47,77,47,"split"],[79,52,77,52],[79,53,77,53],[79,56,77,56],[79,57,77,57],[79,59,77,59],[80,8,78,6],[80,12,78,6,"_limit$split"],[80,24,78,6],[80,27,78,39,"limit"],[80,32,78,44],[80,33,78,45,"split"],[80,38,78,50],[80,39,78,51],[80,42,78,54],[80,44,78,56],[80,45,78,57],[80,46,78,58],[81,10,78,58,"_limit$split2"],[81,23,78,58],[81,26,78,58,"_slicedToArray"],[81,40,78,58],[81,41,78,58,"_limit$split"],[81,53,78,58],[82,10,78,13,"retryAfter"],[82,20,78,23],[82,23,78,23,"_limit$split2"],[82,36,78,23],[83,10,78,25,"categories"],[83,20,78,35],[83,23,78,35,"_limit$split2"],[83,36,78,35],[84,8,79,6],[84,12,79,12,"headerDelay"],[84,23,79,23],[84,26,79,26,"parseInt"],[84,34,79,34],[84,35,79,35,"retryAfter"],[84,45,79,45],[84,47,79,47],[84,49,79,49],[84,50,79,50],[85,8,80,6],[85,12,80,12,"delay"],[85,17,80,17],[85,20,80,20],[85,21,80,21],[85,22,80,22,"isNaN"],[85,27,80,27],[85,28,80,28,"headerDelay"],[85,39,80,39],[85,40,80,40],[85,43,80,43,"headerDelay"],[85,54,80,54],[85,57,80,57],[85,59,80,59],[85,63,80,63],[85,67,80,67],[85,68,80,68],[85,69,80,69],[86,8,81,6],[86,12,81,10],[86,13,81,11,"categories"],[86,23,81,21],[86,25,81,23],[87,10,82,8,"updatedRateLimits"],[87,27,82,25],[87,28,82,26,"all"],[87,31,82,29],[87,34,82,32,"now"],[87,37,82,35],[87,40,82,38,"delay"],[87,45,82,43],[88,8,83,6],[88,9,83,7],[88,15,83,13],[89,10,84,8],[89,15,84,13],[89,19,84,19,"category"],[89,27,84,27],[89,31,84,31,"categories"],[89,41,84,41],[89,42,84,42,"split"],[89,47,84,47],[89,48,84,48],[89,51,84,51],[89,52,84,52],[89,54,84,54],[90,12,85,10,"updatedRateLimits"],[90,29,85,27],[90,30,85,28,"category"],[90,38,85,36],[90,39,85,37],[90,42,85,40,"now"],[90,45,85,43],[90,48,85,46,"delay"],[90,53,85,51],[91,10,86,8],[92,8,87,6],[93,6,88,4],[94,4,89,2],[94,5,89,3],[94,11,89,9],[94,15,89,13,"retryAfterHeader"],[94,31,89,29],[94,33,89,31],[95,6,90,4,"updatedRateLimits"],[95,23,90,21],[95,24,90,22,"all"],[95,27,90,25],[95,30,90,28,"now"],[95,33,90,31],[95,36,90,34,"parseRetryAfterHeader"],[95,57,90,55],[95,58,90,56,"retryAfterHeader"],[95,74,90,72],[95,76,90,74,"now"],[95,79,90,77],[95,80,90,78],[96,4,91,2],[96,5,91,3],[96,11,91,9],[96,15,91,13,"statusCode"],[96,25,91,23],[96,30,91,28],[96,33,91,31],[96,35,91,33],[97,6,92,4,"updatedRateLimits"],[97,23,92,21],[97,24,92,22,"all"],[97,27,92,25],[97,30,92,28,"now"],[97,33,92,31],[97,36,92,34],[97,38,92,36],[97,41,92,39],[97,45,92,43],[98,4,93,2],[99,4,95,2],[99,11,95,9,"updatedRateLimits"],[99,28,95,26],[100,2,96,0],[101,2,98,0,"exports"],[101,9,98,7],[101,10,98,8,"DEFAULT_RETRY_AFTER"],[101,29,98,27],[101,32,98,30,"DEFAULT_RETRY_AFTER"],[101,51,98,49],[102,2,99,0,"exports"],[102,9,99,7],[102,10,99,8,"disabledUntil"],[102,23,99,21],[102,26,99,24,"disabledUntil"],[102,39,99,37],[103,2,100,0,"exports"],[103,9,100,7],[103,10,100,8,"isRateLimited"],[103,23,100,21],[103,26,100,24,"isRateLimited"],[103,39,100,37],[104,2,101,0,"exports"],[104,9,101,7],[104,10,101,8,"parseRetryAfterHeader"],[104,31,101,29],[104,34,101,32,"parseRetryAfterHeader"],[104,55,101,53],[105,2,102,0,"exports"],[105,9,102,7],[105,10,102,8,"updateRateLimits"],[105,26,102,24],[105,29,102,27,"updateRateLimits"],[105,45,102,43],[106,0,102,44],[106,3]],"functionMap":{"names":["<global>","parseRetryAfterHeader","disabledUntil","isRateLimited","updateRateLimits"],"mappings":"AAA;ACY;CDY;AES;CFE;AGK;CHE;AIO;CJ8C"},"hasCjsExports":true},"type":"js/module"}]}