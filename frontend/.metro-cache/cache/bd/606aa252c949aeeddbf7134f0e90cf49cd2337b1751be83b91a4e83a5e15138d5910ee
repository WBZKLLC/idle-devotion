{"dependencies":[{"name":"@sentry/utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":14,"index":78},"end":{"line":3,"column":38,"index":102}}],"key":"ud8OE6Lg8Q81+bS6ynZj2uyMPdA=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  const utils = require(_dependencyMap[0], \"@sentry/utils\");\n  const DEFAULT_TRANSPORT_BUFFER_SIZE = 30;\n\n  /**\n   * Creates an instance of a Sentry `Transport`\n   *\n   * @param options\n   * @param makeRequest\n   */\n  function createTransport(options, makeRequest, buffer = utils.makePromiseBuffer(options.bufferSize || DEFAULT_TRANSPORT_BUFFER_SIZE)) {\n    let rateLimits = {};\n    const flush = timeout => buffer.drain(timeout);\n    function send(envelope) {\n      const filteredEnvelopeItems = [];\n\n      // Drop rate limited items from envelope\n      utils.forEachEnvelopeItem(envelope, (item, type) => {\n        const envelopeItemDataCategory = utils.envelopeItemTypeToDataCategory(type);\n        if (utils.isRateLimited(rateLimits, envelopeItemDataCategory)) {\n          const event = getEventForEnvelopeItem(item, type);\n          options.recordDroppedEvent('ratelimit_backoff', envelopeItemDataCategory, event);\n        } else {\n          filteredEnvelopeItems.push(item);\n        }\n      });\n\n      // Skip sending if envelope is empty after filtering out rate limited events\n      if (filteredEnvelopeItems.length === 0) {\n        return utils.resolvedSyncPromise();\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const filteredEnvelope = utils.createEnvelope(envelope[0], filteredEnvelopeItems);\n\n      // Creates client report for each item in an envelope\n      const recordEnvelopeLoss = reason => {\n        utils.forEachEnvelopeItem(filteredEnvelope, (item, type) => {\n          const event = getEventForEnvelopeItem(item, type);\n          options.recordDroppedEvent(reason, utils.envelopeItemTypeToDataCategory(type), event);\n        });\n      };\n      const requestTask = () => makeRequest({\n        body: utils.serializeEnvelope(filteredEnvelope, options.textEncoder)\n      }).then(response => {\n        // We don't want to throw on NOK responses, but we want to at least log them\n        if (response.statusCode !== undefined && (response.statusCode < 200 || response.statusCode >= 300)) {\n          (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && utils.logger.warn(`Sentry responded with status code ${response.statusCode} to sent event.`);\n        }\n        rateLimits = utils.updateRateLimits(rateLimits, response);\n        return response;\n      }, error => {\n        recordEnvelopeLoss('network_error');\n        throw error;\n      });\n      return buffer.add(requestTask).then(result => result, error => {\n        if (error instanceof utils.SentryError) {\n          (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && utils.logger.error('Skipped sending event because buffer is full.');\n          recordEnvelopeLoss('queue_overflow');\n          return utils.resolvedSyncPromise();\n        } else {\n          throw error;\n        }\n      });\n    }\n\n    // We use this to identifify if the transport is the base transport\n    // TODO (v8): Remove this again as we'll no longer need it\n    send.__sentry__baseTransport__ = true;\n    return {\n      send,\n      flush\n    };\n  }\n  function getEventForEnvelopeItem(item, type) {\n    if (type !== 'event' && type !== 'transaction') {\n      return undefined;\n    }\n    return Array.isArray(item) ? item[1] : undefined;\n  }\n  exports.DEFAULT_TRANSPORT_BUFFER_SIZE = DEFAULT_TRANSPORT_BUFFER_SIZE;\n  exports.createTransport = createTransport;\n});","lineCount":86,"map":[[2,2,1,0,"Object"],[2,8,1,6],[2,9,1,7,"defineProperty"],[2,23,1,21],[2,24,1,22,"exports"],[2,31,1,29],[2,33,1,31],[2,45,1,43],[2,47,1,45],[3,4,1,47,"value"],[3,9,1,52],[3,11,1,54],[4,2,1,59],[4,3,1,60],[4,4,1,61],[5,2,3,0],[5,8,3,6,"utils"],[5,13,3,11],[5,16,3,14,"require"],[5,23,3,21],[5,24,3,21,"_dependencyMap"],[5,38,3,21],[5,58,3,37],[5,59,3,38],[6,2,5,0],[6,8,5,6,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[6,37,5,35],[6,40,5,38],[6,42,5,40],[8,2,7,0],[9,0,8,0],[10,0,9,0],[11,0,10,0],[12,0,11,0],[13,0,12,0],[14,2,13,0],[14,11,13,9,"createTransport"],[14,26,13,24,"createTransport"],[14,27,14,2,"options"],[14,34,14,9],[14,36,15,2,"makeRequest"],[14,47,15,13],[14,49,16,2,"buffer"],[14,55,16,8],[14,58,16,11,"utils"],[14,63,16,16],[14,64,16,17,"makePromiseBuffer"],[14,81,16,34],[14,82,17,4,"options"],[14,89,17,11],[14,90,17,12,"bufferSize"],[14,100,17,22],[14,104,17,26,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[14,133,18,2],[14,134,18,3],[14,136,19,2],[15,4,20,2],[15,8,20,6,"rateLimits"],[15,18,20,16],[15,21,20,19],[15,22,20,20],[15,23,20,21],[16,4,21,2],[16,10,21,8,"flush"],[16,15,21,13],[16,18,21,17,"timeout"],[16,25,21,24],[16,29,21,29,"buffer"],[16,35,21,35],[16,36,21,36,"drain"],[16,41,21,41],[16,42,21,42,"timeout"],[16,49,21,49],[16,50,21,50],[17,4,23,2],[17,13,23,11,"send"],[17,17,23,15,"send"],[17,18,23,16,"envelope"],[17,26,23,24],[17,28,23,26],[18,6,24,4],[18,12,24,10,"filteredEnvelopeItems"],[18,33,24,31],[18,36,24,34],[18,38,24,36],[20,6,26,4],[21,6,27,4,"utils"],[21,11,27,9],[21,12,27,10,"forEachEnvelopeItem"],[21,31,27,29],[21,32,27,30,"envelope"],[21,40,27,38],[21,42,27,40],[21,43,27,41,"item"],[21,47,27,45],[21,49,27,47,"type"],[21,53,27,51],[21,58,27,56],[22,8,28,6],[22,14,28,12,"envelopeItemDataCategory"],[22,38,28,36],[22,41,28,39,"utils"],[22,46,28,44],[22,47,28,45,"envelopeItemTypeToDataCategory"],[22,77,28,75],[22,78,28,76,"type"],[22,82,28,80],[22,83,28,81],[23,8,29,6],[23,12,29,10,"utils"],[23,17,29,15],[23,18,29,16,"isRateLimited"],[23,31,29,29],[23,32,29,30,"rateLimits"],[23,42,29,40],[23,44,29,42,"envelopeItemDataCategory"],[23,68,29,66],[23,69,29,67],[23,71,29,69],[24,10,30,8],[24,16,30,14,"event"],[24,21,30,19],[24,24,30,22,"getEventForEnvelopeItem"],[24,47,30,45],[24,48,30,46,"item"],[24,52,30,50],[24,54,30,52,"type"],[24,58,30,56],[24,59,30,57],[25,10,31,8,"options"],[25,17,31,15],[25,18,31,16,"recordDroppedEvent"],[25,36,31,34],[25,37,31,35],[25,56,31,54],[25,58,31,56,"envelopeItemDataCategory"],[25,82,31,80],[25,84,31,82,"event"],[25,89,31,87],[25,90,31,88],[26,8,32,6],[26,9,32,7],[26,15,32,13],[27,10,33,8,"filteredEnvelopeItems"],[27,31,33,29],[27,32,33,30,"push"],[27,36,33,34],[27,37,33,35,"item"],[27,41,33,39],[27,42,33,40],[28,8,34,6],[29,6,35,4],[29,7,35,5],[29,8,35,6],[31,6,37,4],[32,6,38,4],[32,10,38,8,"filteredEnvelopeItems"],[32,31,38,29],[32,32,38,30,"length"],[32,38,38,36],[32,43,38,41],[32,44,38,42],[32,46,38,44],[33,8,39,6],[33,15,39,13,"utils"],[33,20,39,18],[33,21,39,19,"resolvedSyncPromise"],[33,40,39,38],[33,41,39,39],[33,42,39,40],[34,6,40,4],[36,6,42,4],[37,6,43,4],[37,12,43,10,"filteredEnvelope"],[37,28,43,26],[37,31,43,29,"utils"],[37,36,43,34],[37,37,43,35,"createEnvelope"],[37,51,43,49],[37,52,43,50,"envelope"],[37,60,43,58],[37,61,43,59],[37,62,43,60],[37,63,43,61],[37,65,43,63,"filteredEnvelopeItems"],[37,86,43,85],[37,87,43,86],[39,6,45,4],[40,6,46,4],[40,12,46,10,"recordEnvelopeLoss"],[40,30,46,28],[40,33,46,32,"reason"],[40,39,46,38],[40,43,46,43],[41,8,47,6,"utils"],[41,13,47,11],[41,14,47,12,"forEachEnvelopeItem"],[41,33,47,31],[41,34,47,32,"filteredEnvelope"],[41,50,47,48],[41,52,47,50],[41,53,47,51,"item"],[41,57,47,55],[41,59,47,57,"type"],[41,63,47,61],[41,68,47,66],[42,10,48,8],[42,16,48,14,"event"],[42,21,48,19],[42,24,48,22,"getEventForEnvelopeItem"],[42,47,48,45],[42,48,48,46,"item"],[42,52,48,50],[42,54,48,52,"type"],[42,58,48,56],[42,59,48,57],[43,10,49,8,"options"],[43,17,49,15],[43,18,49,16,"recordDroppedEvent"],[43,36,49,34],[43,37,49,35,"reason"],[43,43,49,41],[43,45,49,43,"utils"],[43,50,49,48],[43,51,49,49,"envelopeItemTypeToDataCategory"],[43,81,49,79],[43,82,49,80,"type"],[43,86,49,84],[43,87,49,85],[43,89,49,87,"event"],[43,94,49,92],[43,95,49,93],[44,8,50,6],[44,9,50,7],[44,10,50,8],[45,6,51,4],[45,7,51,5],[46,6,53,4],[46,12,53,10,"requestTask"],[46,23,53,21],[46,26,53,24,"requestTask"],[46,27,53,24],[46,32,54,6,"makeRequest"],[46,43,54,17],[46,44,54,18],[47,8,54,20,"body"],[47,12,54,24],[47,14,54,26,"utils"],[47,19,54,31],[47,20,54,32,"serializeEnvelope"],[47,37,54,49],[47,38,54,50,"filteredEnvelope"],[47,54,54,66],[47,56,54,68,"options"],[47,63,54,75],[47,64,54,76,"textEncoder"],[47,75,54,87],[48,6,54,89],[48,7,54,90],[48,8,54,91],[48,9,54,92,"then"],[48,13,54,96],[48,14,55,8,"response"],[48,22,55,16],[48,26,55,20],[49,8,56,10],[50,8,57,10],[50,12,57,14,"response"],[50,20,57,22],[50,21,57,23,"statusCode"],[50,31,57,33],[50,36,57,38,"undefined"],[50,45,57,47],[50,50,57,52,"response"],[50,58,57,60],[50,59,57,61,"statusCode"],[50,69,57,71],[50,72,57,74],[50,75,57,77],[50,79,57,81,"response"],[50,87,57,89],[50,88,57,90,"statusCode"],[50,98,57,100],[50,102,57,104],[50,105,57,107],[50,106,57,108],[50,108,57,110],[51,10,58,12],[51,11,58,13],[51,18,58,20,"__SENTRY_DEBUG__"],[51,34,58,36],[51,39,58,41],[51,50,58,52],[51,54,58,56,"__SENTRY_DEBUG__"],[51,70,58,72],[51,75,58,77,"utils"],[51,80,58,82],[51,81,58,83,"logger"],[51,87,58,89],[51,88,58,90,"warn"],[51,92,58,94],[51,93,58,95],[51,130,58,132,"response"],[51,138,58,140],[51,139,58,141,"statusCode"],[51,149,58,151],[51,166,58,168],[51,167,58,169],[52,8,59,10],[53,8,61,10,"rateLimits"],[53,18,61,20],[53,21,61,23,"utils"],[53,26,61,28],[53,27,61,29,"updateRateLimits"],[53,43,61,45],[53,44,61,46,"rateLimits"],[53,54,61,56],[53,56,61,58,"response"],[53,64,61,66],[53,65,61,67],[54,8,62,10],[54,15,62,17,"response"],[54,23,62,25],[55,6,63,8],[55,7,63,9],[55,9,64,8,"error"],[55,14,64,13],[55,18,64,17],[56,8,65,10,"recordEnvelopeLoss"],[56,26,65,28],[56,27,65,29],[56,42,65,44],[56,43,65,45],[57,8,66,10],[57,14,66,16,"error"],[57,19,66,21],[58,6,67,8],[58,7,68,6],[58,8,68,7],[59,6,70,4],[59,13,70,11,"buffer"],[59,19,70,17],[59,20,70,18,"add"],[59,23,70,21],[59,24,70,22,"requestTask"],[59,35,70,33],[59,36,70,34],[59,37,70,35,"then"],[59,41,70,39],[59,42,71,6,"result"],[59,48,71,12],[59,52,71,16,"result"],[59,58,71,22],[59,60,72,6,"error"],[59,65,72,11],[59,69,72,15],[60,8,73,8],[60,12,73,12,"error"],[60,17,73,17],[60,29,73,29,"utils"],[60,34,73,34],[60,35,73,35,"SentryError"],[60,46,73,46],[60,48,73,48],[61,10,74,10],[61,11,74,11],[61,18,74,18,"__SENTRY_DEBUG__"],[61,34,74,34],[61,39,74,39],[61,50,74,50],[61,54,74,54,"__SENTRY_DEBUG__"],[61,70,74,70],[61,75,74,75,"utils"],[61,80,74,80],[61,81,74,81,"logger"],[61,87,74,87],[61,88,74,88,"error"],[61,93,74,93],[61,94,74,94],[61,141,74,141],[61,142,74,142],[62,10,75,10,"recordEnvelopeLoss"],[62,28,75,28],[62,29,75,29],[62,45,75,45],[62,46,75,46],[63,10,76,10],[63,17,76,17,"utils"],[63,22,76,22],[63,23,76,23,"resolvedSyncPromise"],[63,42,76,42],[63,43,76,43],[63,44,76,44],[64,8,77,8],[64,9,77,9],[64,15,77,15],[65,10,78,10],[65,16,78,16,"error"],[65,21,78,21],[66,8,79,8],[67,6,80,6],[67,7,81,4],[67,8,81,5],[68,4,82,2],[70,4,84,2],[71,4,85,2],[72,4,86,2,"send"],[72,8,86,6],[72,9,86,7,"__sentry__baseTransport__"],[72,34,86,32],[72,37,86,35],[72,41,86,39],[73,4,88,2],[73,11,88,9],[74,6,89,4,"send"],[74,10,89,8],[75,6,90,4,"flush"],[76,4,91,2],[76,5,91,3],[77,2,92,0],[78,2,94,0],[78,11,94,9,"getEventForEnvelopeItem"],[78,34,94,32,"getEventForEnvelopeItem"],[78,35,94,33,"item"],[78,39,94,37],[78,41,94,39,"type"],[78,45,94,43],[78,47,94,45],[79,4,95,2],[79,8,95,6,"type"],[79,12,95,10],[79,17,95,15],[79,24,95,22],[79,28,95,26,"type"],[79,32,95,30],[79,37,95,35],[79,50,95,48],[79,52,95,50],[80,6,96,4],[80,13,96,11,"undefined"],[80,22,96,20],[81,4,97,2],[82,4,99,2],[82,11,99,9,"Array"],[82,16,99,14],[82,17,99,15,"isArray"],[82,24,99,22],[82,25,99,23,"item"],[82,29,99,27],[82,30,99,28],[82,33,99,32,"item"],[82,37,99,36],[82,38,99,39],[82,39,99,40],[82,40,99,41],[82,43,99,44,"undefined"],[82,52,99,53],[83,2,100,0],[84,2,102,0,"exports"],[84,9,102,7],[84,10,102,8,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[84,39,102,37],[84,42,102,40,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[84,71,102,69],[85,2,103,0,"exports"],[85,9,103,7],[85,10,103,8,"createTransport"],[85,25,103,23],[85,28,103,26,"createTransport"],[85,43,103,41],[86,0,103,42],[86,3]],"functionMap":{"names":["<global>","createTransport","flush","send","utils.forEachEnvelopeItem$argument_1","recordEnvelopeLoss","requestTask","makeRequest.then$argument_0","makeRequest.then$argument_1","buffer.add.then$argument_0","buffer.add.then$argument_1","getEventForEnvelopeItem"],"mappings":"AAA;ACY;gBCQ,kCD;EEE;wCCI;KDQ;+BEW;kDDC;OCG;KFC;wBGE;QCE;SDQ;QEC;SFG;OHC;MMG,gBN;MOC;OPQ;GFE;CDU;AWE;CXM"},"hasCjsExports":true},"type":"js/module"}]}